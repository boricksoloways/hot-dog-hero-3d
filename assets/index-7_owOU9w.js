import{r as Zn,R as vt,a as me,b as Qn,V as Be,S as qn,B as $n,U as En,M as Zt,c as ea,E as ta,d as ra,e as na,f as aa,g as oa,h as ia,C as Qt,i as sa,j as Dt,I as la,k as fa,l as Tn,m as ca,T as ua,L as tn,n as da,o as rn,D as ha,P as Fr,u as Je,s as va,p as O,q as pa,t as Dr,v as ga,w as Cn,x as ma,y as ya,z as ba}from"./vendor-BS8H-R5R.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))u(t);new MutationObserver(t=>{for(const e of t)if(e.type==="childList")for(const a of e.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&u(a)}).observe(document,{childList:!0,subtree:!0});function d(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?e.credentials="include":t.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function u(t){if(t.ep)return;t.ep=!0;const e=d(t);fetch(t.href,e)}})();var Ur={},nn=Zn;Ur.createRoot=nn.createRoot,Ur.hydrateRoot=nn.hydrateRoot;function At(){return At=Object.assign?Object.assign.bind():function(l){for(var r=1;r<arguments.length;r++){var d=arguments[r];for(var u in d)({}).hasOwnProperty.call(d,u)&&(l[u]=d[u])}return l},At.apply(null,arguments)}const an=l=>{let r;const d=new Set,u=(o,s)=>{const f=typeof o=="function"?o(r):o;if(!Object.is(f,r)){const c=r;r=s??(typeof f!="object"||f===null)?f:Object.assign({},r,f),d.forEach(h=>h(r,c))}},t=()=>r,i={setState:u,getState:t,getInitialState:()=>n,subscribe:o=>(d.add(o),()=>d.delete(o))},n=r=l(u,t,i);return i},xa=l=>l?an(l):an,Sa=l=>l;function wa(l,r=Sa){const d=vt.useSyncExternalStore(l.subscribe,vt.useCallback(()=>r(l.getState()),[l,r]),vt.useCallback(()=>r(l.getInitialState()),[l,r]));return vt.useDebugValue(d),d}const on=l=>{const r=xa(l),d=u=>wa(r,u);return Object.assign(d,r),d},_a=l=>l?on(l):on,Ua=l=>(r,d,u)=>{const t=u.subscribe;return u.subscribe=(a,i,n)=>{let o=a;if(i){const s=(n==null?void 0:n.equalityFn)||Object.is;let f=a(u.getState());o=c=>{const h=a(c);if(!s(f,h)){const v=f;i(f=h,v)}},n!=null&&n.fireImmediately&&i(f,f)}return t(o)},l(r,d,u)},ka=Ua,Fn=me.createContext(null);function Ea({map:l,children:r,onChange:d,domElement:u}){const t=l.map(n=>n.name+n.keys).join("-"),e=me.useMemo(()=>_a(ka(()=>l.reduce((n,o)=>({...n,[o.name]:!1}),{}))),[t]),a=me.useMemo(()=>[e.subscribe,e.getState,e],[t]),i=e.setState;return me.useEffect(()=>{const o=l.map(({name:h,keys:v,up:g})=>({keys:v,up:g,fn:m=>{i({[h]:m}),d&&d(h,m,a[1]())}})).reduce((h,{keys:v,fn:g,up:m=!0})=>(v.forEach(D=>h[D]={fn:g,pressed:!1,up:m}),h),{}),s=({key:h,code:v})=>{const g=o[h]||o[v];if(!g)return;const{fn:m,pressed:D,up:_}=g;g.pressed=!0,(_||!D)&&m(!0)},f=({key:h,code:v})=>{const g=o[h]||o[v];if(!g)return;const{fn:m,up:D}=g;g.pressed=!1,D&&m(!1)},c=u||window;return c.addEventListener("keydown",s,{passive:!0}),c.addEventListener("keyup",f,{passive:!0}),()=>{c.removeEventListener("keydown",s),c.removeEventListener("keyup",f)}},[u,t]),me.createElement(Fn.Provider,{value:a,children:r})}function Ta(l){const[r,d,u]=me.useContext(Fn);return[r,d]}const Ca=parseInt(Qn.replace(/\D+/g,""));var Fa=Object.defineProperty,Da=(l,r,d)=>r in l?Fa(l,r,{enumerable:!0,configurable:!0,writable:!0,value:d}):l[r]=d,sn=(l,r,d)=>(Da(l,typeof r!="symbol"?r+"":r,d),d);const Aa=(()=>{const l={uniforms:{turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new Be},up:{value:new Be(0,1,0)}},vertexShader:`
      uniform vec3 sunPosition;
      uniform float rayleigh;
      uniform float turbidity;
      uniform float mieCoefficient;
      uniform vec3 up;

      varying vec3 vWorldPosition;
      varying vec3 vSunDirection;
      varying float vSunfade;
      varying vec3 vBetaR;
      varying vec3 vBetaM;
      varying float vSunE;

      // constants for atmospheric scattering
      const float e = 2.71828182845904523536028747135266249775724709369995957;
      const float pi = 3.141592653589793238462643383279502884197169;

      // wavelength of used primaries, according to preetham
      const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );
      // this pre-calcuation replaces older TotalRayleigh(vec3 lambda) function:
      // (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn))
      const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );

      // mie stuff
      // K coefficient for the primaries
      const float v = 4.0;
      const vec3 K = vec3( 0.686, 0.678, 0.666 );
      // MieConst = pi * pow( ( 2.0 * pi ) / lambda, vec3( v - 2.0 ) ) * K
      const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );

      // earth shadow hack
      // cutoffAngle = pi / 1.95;
      const float cutoffAngle = 1.6110731556870734;
      const float steepness = 1.5;
      const float EE = 1000.0;

      float sunIntensity( float zenithAngleCos ) {
        zenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );
        return EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );
      }

      vec3 totalMie( float T ) {
        float c = ( 0.2 * T ) * 10E-18;
        return 0.434 * c * MieConst;
      }

      void main() {

        vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
        vWorldPosition = worldPosition.xyz;

        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        gl_Position.z = gl_Position.w; // set z to camera.far

        vSunDirection = normalize( sunPosition );

        vSunE = sunIntensity( dot( vSunDirection, up ) );

        vSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );

        float rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );

      // extinction (absorbtion + out scattering)
      // rayleigh coefficients
        vBetaR = totalRayleigh * rayleighCoefficient;

      // mie coefficients
        vBetaM = totalMie( turbidity ) * mieCoefficient;

      }
    `,fragmentShader:`
      varying vec3 vWorldPosition;
      varying vec3 vSunDirection;
      varying float vSunfade;
      varying vec3 vBetaR;
      varying vec3 vBetaM;
      varying float vSunE;

      uniform float mieDirectionalG;
      uniform vec3 up;

      const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );

      // constants for atmospheric scattering
      const float pi = 3.141592653589793238462643383279502884197169;

      const float n = 1.0003; // refractive index of air
      const float N = 2.545E25; // number of molecules per unit volume for air at 288.15K and 1013mb (sea level -45 celsius)

      // optical length at zenith for molecules
      const float rayleighZenithLength = 8.4E3;
      const float mieZenithLength = 1.25E3;
      // 66 arc seconds -> degrees, and the cosine of that
      const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;

      // 3.0 / ( 16.0 * pi )
      const float THREE_OVER_SIXTEENPI = 0.05968310365946075;
      // 1.0 / ( 4.0 * pi )
      const float ONE_OVER_FOURPI = 0.07957747154594767;

      float rayleighPhase( float cosTheta ) {
        return THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );
      }

      float hgPhase( float cosTheta, float g ) {
        float g2 = pow( g, 2.0 );
        float inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );
        return ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );
      }

      void main() {

        vec3 direction = normalize( vWorldPosition - cameraPos );

      // optical length
      // cutoff angle at 90 to avoid singularity in next formula.
        float zenithAngle = acos( max( 0.0, dot( up, direction ) ) );
        float inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );
        float sR = rayleighZenithLength * inverse;
        float sM = mieZenithLength * inverse;

      // combined extinction factor
        vec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );

      // in scattering
        float cosTheta = dot( direction, vSunDirection );

        float rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );
        vec3 betaRTheta = vBetaR * rPhase;

        float mPhase = hgPhase( cosTheta, mieDirectionalG );
        vec3 betaMTheta = vBetaM * mPhase;

        vec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );
        Lin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );

      // nightsky
        float theta = acos( direction.y ); // elevation --> y-axis, [-pi/2, pi/2]
        float phi = atan( direction.z, direction.x ); // azimuth --> x-axis [-pi/2, pi/2]
        vec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );
        vec3 L0 = vec3( 0.1 ) * Fex;

      // composition + solar disc
        float sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );
        L0 += ( vSunE * 19000.0 * Fex ) * sundisk;

        vec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );

        vec3 retColor = pow( texColor, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );

        gl_FragColor = vec4( retColor, 1.0 );

      #include <tonemapping_fragment>
      #include <${Ca>=154?"colorspace_fragment":"encodings_fragment"}>

      }
    `},r=new qn({name:"SkyShader",fragmentShader:l.fragmentShader,vertexShader:l.vertexShader,uniforms:En.clone(l.uniforms),side:$n,depthWrite:!1});class d extends Zt{constructor(){super(new ea(1,1,1),r)}}return sn(d,"SkyShader",l),sn(d,"material",r),d})();var Ma=Object.defineProperty,La=(l,r,d)=>r in l?Ma(l,r,{enumerable:!0,configurable:!0,writable:!0,value:d}):l[r]=d,Pa=(l,r,d)=>(La(l,r+"",d),d);class Ra{constructor(){Pa(this,"_listeners")}addEventListener(r,d){this._listeners===void 0&&(this._listeners={});const u=this._listeners;u[r]===void 0&&(u[r]=[]),u[r].indexOf(d)===-1&&u[r].push(d)}hasEventListener(r,d){if(this._listeners===void 0)return!1;const u=this._listeners;return u[r]!==void 0&&u[r].indexOf(d)!==-1}removeEventListener(r,d){if(this._listeners===void 0)return;const t=this._listeners[r];if(t!==void 0){const e=t.indexOf(d);e!==-1&&t.splice(e,1)}}dispatchEvent(r){if(this._listeners===void 0)return;const u=this._listeners[r.type];if(u!==void 0){r.target=this;const t=u.slice(0);for(let e=0,a=t.length;e<a;e++)t[e].call(this,r);r.target=null}}}var Oa=Object.defineProperty,Ga=(l,r,d)=>r in l?Oa(l,r,{enumerable:!0,configurable:!0,writable:!0,value:d}):l[r]=d,Le=(l,r,d)=>(Ga(l,typeof r!="symbol"?r+"":r,d),d);const ut=new ta(0,0,0,"YXZ"),dt=new Be,Ba={type:"change"},Ia={type:"lock"},ja={type:"unlock"},ln=.002,fn=Math.PI/2;let Na=class extends Ra{constructor(r,d){super(),Le(this,"camera"),Le(this,"domElement"),Le(this,"isLocked"),Le(this,"minPolarAngle"),Le(this,"maxPolarAngle"),Le(this,"pointerSpeed"),Le(this,"onMouseMove",u=>{!this.domElement||this.isLocked===!1||(ut.setFromQuaternion(this.camera.quaternion),ut.y-=u.movementX*ln*this.pointerSpeed,ut.x-=u.movementY*ln*this.pointerSpeed,ut.x=Math.max(fn-this.maxPolarAngle,Math.min(fn-this.minPolarAngle,ut.x)),this.camera.quaternion.setFromEuler(ut),this.dispatchEvent(Ba))}),Le(this,"onPointerlockChange",()=>{this.domElement&&(this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(Ia),this.isLocked=!0):(this.dispatchEvent(ja),this.isLocked=!1))}),Le(this,"onPointerlockError",()=>{console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}),Le(this,"connect",u=>{this.domElement=u||this.domElement,this.domElement&&(this.domElement.ownerDocument.addEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError))}),Le(this,"disconnect",()=>{this.domElement&&(this.domElement.ownerDocument.removeEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError))}),Le(this,"dispose",()=>{this.disconnect()}),Le(this,"getObject",()=>this.camera),Le(this,"direction",new Be(0,0,-1)),Le(this,"getDirection",u=>u.copy(this.direction).applyQuaternion(this.camera.quaternion)),Le(this,"moveForward",u=>{dt.setFromMatrixColumn(this.camera.matrix,0),dt.crossVectors(this.camera.up,dt),this.camera.position.addScaledVector(dt,u)}),Le(this,"moveRight",u=>{dt.setFromMatrixColumn(this.camera.matrix,0),this.camera.position.addScaledVector(dt,u)}),Le(this,"lock",()=>{this.domElement&&this.domElement.requestPointerLock()}),Le(this,"unlock",()=>{this.domElement&&this.domElement.ownerDocument.exitPointerLock()}),this.camera=r,this.domElement=d,this.isLocked=!1,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,d&&this.connect(d)}};function Wa(){var l=Object.create(null);function r(t,e){var a=t.id,i=t.name,n=t.dependencies;n===void 0&&(n=[]);var o=t.init;o===void 0&&(o=function(){});var s=t.getTransferables;if(s===void 0&&(s=null),!l[a])try{n=n.map(function(c){return c&&c.isWorkerModule&&(r(c,function(h){if(h instanceof Error)throw h}),c=l[c.id].value),c}),o=u("<"+i+">.init",o),s&&(s=u("<"+i+">.getTransferables",s));var f=null;typeof o=="function"?f=o.apply(void 0,n):console.error("worker module init function failed to rehydrate"),l[a]={id:a,value:f,getTransferables:s},e(f)}catch(c){c&&c.noLog||console.error(c),e(c)}}function d(t,e){var a,i=t.id,n=t.args;(!l[i]||typeof l[i].value!="function")&&e(new Error("Worker module "+i+": not found or its 'init' did not return a function"));try{var o=(a=l[i]).value.apply(a,n);o&&typeof o.then=="function"?o.then(s,function(f){return e(f instanceof Error?f:new Error(""+f))}):s(o)}catch(f){e(f)}function s(f){try{var c=l[i].getTransferables&&l[i].getTransferables(f);(!c||!Array.isArray(c)||!c.length)&&(c=void 0),e(f,c)}catch(h){console.error(h),e(h)}}}function u(t,e){var a=void 0;self.troikaDefine=function(n){return a=n};var i=URL.createObjectURL(new Blob(["/** "+t.replace(/\*/g,"")+` **/

troikaDefine(
`+e+`
)`],{type:"application/javascript"}));try{importScripts(i)}catch(n){console.error(n)}return URL.revokeObjectURL(i),delete self.troikaDefine,a}self.addEventListener("message",function(t){var e=t.data,a=e.messageId,i=e.action,n=e.data;try{i==="registerModule"&&r(n,function(o){o instanceof Error?postMessage({messageId:a,success:!1,error:o.message}):postMessage({messageId:a,success:!0,result:{isCallable:typeof o=="function"}})}),i==="callModule"&&d(n,function(o,s){o instanceof Error?postMessage({messageId:a,success:!1,error:o.message}):postMessage({messageId:a,success:!0,result:o},s||void 0)})}catch(o){postMessage({messageId:a,success:!1,error:o.stack})}})}function za(l){var r=function(){for(var d=[],u=arguments.length;u--;)d[u]=arguments[u];return r._getInitResult().then(function(t){if(typeof t=="function")return t.apply(void 0,d);throw new Error("Worker module function was called but `init` did not return a callable function")})};return r._getInitResult=function(){var d=l.dependencies,u=l.init;d=Array.isArray(d)?d.map(function(e){return e&&(e=e.onMainThread||e,e._getInitResult&&(e=e._getInitResult())),e}):[];var t=Promise.all(d).then(function(e){return u.apply(null,e)});return r._getInitResult=function(){return t},t},r}var Dn=function(){var l=!1;if(typeof window<"u"&&typeof window.document<"u")try{var r=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})));r.terminate(),l=!0}catch(d){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+d.message+"]")}return Dn=function(){return l},l},Va=0,Ha=0,br=!1,Ct=Object.create(null),Ft=Object.create(null),kr=Object.create(null);function pt(l){if((!l||typeof l.init!="function")&&!br)throw new Error("requires `options.init` function");var r=l.dependencies,d=l.init,u=l.getTransferables,t=l.workerId,e=za(l);t==null&&(t="#default");var a="workerModule"+ ++Va,i=l.name||a,n=null;r=r&&r.map(function(s){return typeof s=="function"&&!s.workerModuleData&&(br=!0,s=pt({workerId:t,name:"<"+i+"> function dependency: "+s.name,init:`function(){return (
`+Yt(s)+`
)}`}),br=!1),s&&s.workerModuleData&&(s=s.workerModuleData),s});function o(){for(var s=[],f=arguments.length;f--;)s[f]=arguments[f];if(!Dn())return e.apply(void 0,s);if(!n){n=cn(t,"registerModule",o.workerModuleData);var c=function(){n=null,Ft[t].delete(c)};(Ft[t]||(Ft[t]=new Set)).add(c)}return n.then(function(h){var v=h.isCallable;if(v)return cn(t,"callModule",{id:a,args:s});throw new Error("Worker module function was called but `init` did not return a callable function")})}return o.workerModuleData={isWorkerModule:!0,id:a,name:i,dependencies:r,init:Yt(d),getTransferables:u&&Yt(u)},o.onMainThread=e,o}function Xa(l){Ft[l]&&Ft[l].forEach(function(r){r()}),Ct[l]&&(Ct[l].terminate(),delete Ct[l])}function Yt(l){var r=l.toString();return!/^function/.test(r)&&/^\w+\s*\(/.test(r)&&(r="function "+r),r}function Ya(l){var r=Ct[l];if(!r){var d=Yt(Wa);r=Ct[l]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+l.replace(/\*/g,"")+` **/

;(`+d+")()"],{type:"application/javascript"}))),r.onmessage=function(u){var t=u.data,e=t.messageId,a=kr[e];if(!a)throw new Error("WorkerModule response with empty or unknown messageId");delete kr[e],a(t)}}return r}function cn(l,r,d){return new Promise(function(u,t){var e=++Ha;kr[e]=function(a){a.success?u(a.result):t(new Error("Error in worker "+r+" call: "+a.error))},Ya(l).postMessage({messageId:e,action:r,data:d})})}function An(){var l=function(r){function d(I,R,p,S,T,F,k,N){var L=1-k;N.x=L*L*I+2*L*k*p+k*k*T,N.y=L*L*R+2*L*k*S+k*k*F}function u(I,R,p,S,T,F,k,N,L,j){var K=1-L;j.x=K*K*K*I+3*K*K*L*p+3*K*L*L*T+L*L*L*k,j.y=K*K*K*R+3*K*K*L*S+3*K*L*L*F+L*L*L*N}function t(I,R){for(var p=/([MLQCZ])([^MLQCZ]*)/g,S,T,F,k,N;S=p.exec(I);){var L=S[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(j){return parseFloat(j)});switch(S[1]){case"M":k=T=L[0],N=F=L[1];break;case"L":(L[0]!==k||L[1]!==N)&&R("L",k,N,k=L[0],N=L[1]);break;case"Q":{R("Q",k,N,k=L[2],N=L[3],L[0],L[1]);break}case"C":{R("C",k,N,k=L[4],N=L[5],L[0],L[1],L[2],L[3]);break}case"Z":(k!==T||N!==F)&&R("L",k,N,T,F);break}}}function e(I,R,p){p===void 0&&(p=16);var S={x:0,y:0};t(I,function(T,F,k,N,L,j,K,ee,H){switch(T){case"L":R(F,k,N,L);break;case"Q":{for(var W=F,ge=k,ue=1;ue<p;ue++)d(F,k,j,K,N,L,ue/(p-1),S),R(W,ge,S.x,S.y),W=S.x,ge=S.y;break}case"C":{for(var Q=F,te=k,le=1;le<p;le++)u(F,k,j,K,ee,H,N,L,le/(p-1),S),R(Q,te,S.x,S.y),Q=S.x,te=S.y;break}}})}var a="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",i="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",n=new WeakMap,o={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function s(I,R){var p=I.getContext?I.getContext("webgl",o):I,S=n.get(p);if(!S){let K=function(Q){var te=F[Q];if(!te&&(te=F[Q]=p.getExtension(Q),!te))throw new Error(Q+" not supported");return te},ee=function(Q,te){var le=p.createShader(te);return p.shaderSource(le,Q),p.compileShader(le),le},H=function(Q,te,le,V){if(!k[Q]){var re={},$={},G=p.createProgram();p.attachShader(G,ee(te,p.VERTEX_SHADER)),p.attachShader(G,ee(le,p.FRAGMENT_SHADER)),p.linkProgram(G),k[Q]={program:G,transaction:function(Z){p.useProgram(G),Z({setUniform:function(J,Se){for(var ae=[],ie=arguments.length-2;ie-- >0;)ae[ie]=arguments[ie+2];var ce=$[Se]||($[Se]=p.getUniformLocation(G,Se));p["uniform"+J].apply(p,[ce].concat(ae))},setAttribute:function(J,Se,ae,ie,ce){var ve=re[J];ve||(ve=re[J]={buf:p.createBuffer(),loc:p.getAttribLocation(G,J),data:null}),p.bindBuffer(p.ARRAY_BUFFER,ve.buf),p.vertexAttribPointer(ve.loc,Se,p.FLOAT,!1,0,0),p.enableVertexAttribArray(ve.loc),T?p.vertexAttribDivisor(ve.loc,ie):K("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(ve.loc,ie),ce!==ve.data&&(p.bufferData(p.ARRAY_BUFFER,ce,ae),ve.data=ce)}})}}}k[Q].transaction(V)},W=function(Q,te){L++;try{p.activeTexture(p.TEXTURE0+L);var le=N[Q];le||(le=N[Q]=p.createTexture(),p.bindTexture(p.TEXTURE_2D,le),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.NEAREST),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.NEAREST)),p.bindTexture(p.TEXTURE_2D,le),te(le,L)}finally{L--}},ge=function(Q,te,le){var V=p.createFramebuffer();j.push(V),p.bindFramebuffer(p.FRAMEBUFFER,V),p.activeTexture(p.TEXTURE0+te),p.bindTexture(p.TEXTURE_2D,Q),p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,Q,0);try{le(V)}finally{p.deleteFramebuffer(V),p.bindFramebuffer(p.FRAMEBUFFER,j[--j.length-1]||null)}},ue=function(){F={},k={},N={},L=-1,j.length=0};var T=typeof WebGL2RenderingContext<"u"&&p instanceof WebGL2RenderingContext,F={},k={},N={},L=-1,j=[];p.canvas.addEventListener("webglcontextlost",function(Q){ue(),Q.preventDefault()},!1),n.set(p,S={gl:p,isWebGL2:T,getExtension:K,withProgram:H,withTexture:W,withTextureFramebuffer:ge,handleContextLoss:ue})}R(S)}function f(I,R,p,S,T,F,k,N){k===void 0&&(k=15),N===void 0&&(N=null),s(I,function(L){var j=L.gl,K=L.withProgram,ee=L.withTexture;ee("copy",function(H,W){j.texImage2D(j.TEXTURE_2D,0,j.RGBA,T,F,0,j.RGBA,j.UNSIGNED_BYTE,R),K("copy",a,i,function(ge){var ue=ge.setUniform,Q=ge.setAttribute;Q("aUV",2,j.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),ue("1i","image",W),j.bindFramebuffer(j.FRAMEBUFFER,N||null),j.disable(j.BLEND),j.colorMask(k&8,k&4,k&2,k&1),j.viewport(p,S,T,F),j.scissor(p,S,T,F),j.drawArrays(j.TRIANGLES,0,3)})})})}function c(I,R,p){var S=I.width,T=I.height;s(I,function(F){var k=F.gl,N=new Uint8Array(S*T*4);k.readPixels(0,0,S,T,k.RGBA,k.UNSIGNED_BYTE,N),I.width=R,I.height=p,f(k,N,0,0,S,T)})}var h=Object.freeze({__proto__:null,withWebGLContext:s,renderImageData:f,resizeWebGLCanvasWithoutClearing:c});function v(I,R,p,S,T,F){F===void 0&&(F=1);var k=new Uint8Array(I*R),N=S[2]-S[0],L=S[3]-S[1],j=[];e(p,function(Q,te,le,V){j.push({x1:Q,y1:te,x2:le,y2:V,minX:Math.min(Q,le),minY:Math.min(te,V),maxX:Math.max(Q,le),maxY:Math.max(te,V)})}),j.sort(function(Q,te){return Q.maxX-te.maxX});for(var K=0;K<I;K++)for(var ee=0;ee<R;ee++){var H=ge(S[0]+N*(K+.5)/I,S[1]+L*(ee+.5)/R),W=Math.pow(1-Math.abs(H)/T,F)/2;H<0&&(W=1-W),W=Math.max(0,Math.min(255,Math.round(W*255))),k[ee*I+K]=W}return k;function ge(Q,te){for(var le=1/0,V=1/0,re=j.length;re--;){var $=j[re];if($.maxX+V<=Q)break;if(Q+V>$.minX&&te-V<$.maxY&&te+V>$.minY){var G=D(Q,te,$.x1,$.y1,$.x2,$.y2);G<le&&(le=G,V=Math.sqrt(le))}}return ue(Q,te)&&(V=-V),V}function ue(Q,te){for(var le=0,V=j.length;V--;){var re=j[V];if(re.maxX<=Q)break;var $=re.y1>te!=re.y2>te&&Q<(re.x2-re.x1)*(te-re.y1)/(re.y2-re.y1)+re.x1;$&&(le+=re.y1<re.y2?1:-1)}return le!==0}}function g(I,R,p,S,T,F,k,N,L,j){F===void 0&&(F=1),N===void 0&&(N=0),L===void 0&&(L=0),j===void 0&&(j=0),m(I,R,p,S,T,F,k,null,N,L,j)}function m(I,R,p,S,T,F,k,N,L,j,K){F===void 0&&(F=1),L===void 0&&(L=0),j===void 0&&(j=0),K===void 0&&(K=0);for(var ee=v(I,R,p,S,T,F),H=new Uint8Array(ee.length*4),W=0;W<ee.length;W++)H[W*4+K]=ee[W];f(k,H,L,j,I,R,1<<3-K,N)}function D(I,R,p,S,T,F){var k=T-p,N=F-S,L=k*k+N*N,j=L?Math.max(0,Math.min(1,((I-p)*k+(R-S)*N)/L)):0,K=I-(p+j*k),ee=R-(S+j*N);return K*K+ee*ee}var _=Object.freeze({__proto__:null,generate:v,generateIntoCanvas:g,generateIntoFramebuffer:m}),E="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",y="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",x="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",A=new Float32Array([0,0,2,0,0,2]),w=null,U=!1,B={},P=new WeakMap;function Y(I){if(!U&&!X(I))throw new Error("WebGL generation not supported")}function b(I,R,p,S,T,F,k){if(F===void 0&&(F=1),k===void 0&&(k=null),!k&&(k=w,!k)){var N=typeof OffscreenCanvas=="function"?new OffscreenCanvas(1,1):typeof document<"u"?document.createElement("canvas"):null;if(!N)throw new Error("OffscreenCanvas or DOM canvas not supported");k=w=N.getContext("webgl",{depth:!1})}Y(k);var L=new Uint8Array(I*R*4);s(k,function(H){var W=H.gl,ge=H.withTexture,ue=H.withTextureFramebuffer;ge("readable",function(Q,te){W.texImage2D(W.TEXTURE_2D,0,W.RGBA,I,R,0,W.RGBA,W.UNSIGNED_BYTE,null),ue(Q,te,function(le){C(I,R,p,S,T,F,W,le,0,0,0),W.readPixels(0,0,I,R,W.RGBA,W.UNSIGNED_BYTE,L)})})});for(var j=new Uint8Array(I*R),K=0,ee=0;K<L.length;K+=4)j[ee++]=L[K];return j}function M(I,R,p,S,T,F,k,N,L,j){F===void 0&&(F=1),N===void 0&&(N=0),L===void 0&&(L=0),j===void 0&&(j=0),C(I,R,p,S,T,F,k,null,N,L,j)}function C(I,R,p,S,T,F,k,N,L,j,K){F===void 0&&(F=1),L===void 0&&(L=0),j===void 0&&(j=0),K===void 0&&(K=0),Y(k);var ee=[];e(p,function(H,W,ge,ue){ee.push(H,W,ge,ue)}),ee=new Float32Array(ee),s(k,function(H){var W=H.gl,ge=H.isWebGL2,ue=H.getExtension,Q=H.withProgram,te=H.withTexture,le=H.withTextureFramebuffer,V=H.handleContextLoss;if(te("rawDistances",function(re,$){(I!==re._lastWidth||R!==re._lastHeight)&&W.texImage2D(W.TEXTURE_2D,0,W.RGBA,re._lastWidth=I,re._lastHeight=R,0,W.RGBA,W.UNSIGNED_BYTE,null),Q("main",E,y,function(G){var he=G.setAttribute,Z=G.setUniform,oe=!ge&&ue("ANGLE_instanced_arrays"),J=!ge&&ue("EXT_blend_minmax");he("aUV",2,W.STATIC_DRAW,0,A),he("aLineSegment",4,W.DYNAMIC_DRAW,1,ee),Z.apply(void 0,["4f","uGlyphBounds"].concat(S)),Z("1f","uMaxDistance",T),Z("1f","uExponent",F),le(re,$,function(Se){W.enable(W.BLEND),W.colorMask(!0,!0,!0,!0),W.viewport(0,0,I,R),W.scissor(0,0,I,R),W.blendFunc(W.ONE,W.ONE),W.blendEquationSeparate(W.FUNC_ADD,ge?W.MAX:J.MAX_EXT),W.clear(W.COLOR_BUFFER_BIT),ge?W.drawArraysInstanced(W.TRIANGLES,0,3,ee.length/4):oe.drawArraysInstancedANGLE(W.TRIANGLES,0,3,ee.length/4)})}),Q("post",a,x,function(G){G.setAttribute("aUV",2,W.STATIC_DRAW,0,A),G.setUniform("1i","tex",$),W.bindFramebuffer(W.FRAMEBUFFER,N),W.disable(W.BLEND),W.colorMask(K===0,K===1,K===2,K===3),W.viewport(L,j,I,R),W.scissor(L,j,I,R),W.drawArrays(W.TRIANGLES,0,3)})}),W.isContextLost())throw V(),new Error("webgl context lost")})}function X(I){var R=!I||I===w?B:I.canvas||I,p=P.get(R);if(p===void 0){U=!0;var S=null;try{var T=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],F=b(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,I);p=F&&T.length===F.length&&F.every(function(k,N){return k===T[N]}),p||(S="bad trial run results",console.info(T,F))}catch(k){p=!1,S=k.message}S&&console.warn("WebGL SDF generation not supported:",S),U=!1,P.set(R,p)}return p}var z=Object.freeze({__proto__:null,generate:b,generateIntoCanvas:M,generateIntoFramebuffer:C,isSupported:X});function q(I,R,p,S,T,F){T===void 0&&(T=Math.max(S[2]-S[0],S[3]-S[1])/2),F===void 0&&(F=1);try{return b.apply(z,arguments)}catch(k){return console.info("WebGL SDF generation failed, falling back to JS",k),v.apply(_,arguments)}}function ne(I,R,p,S,T,F,k,N,L,j){T===void 0&&(T=Math.max(S[2]-S[0],S[3]-S[1])/2),F===void 0&&(F=1),N===void 0&&(N=0),L===void 0&&(L=0),j===void 0&&(j=0);try{return M.apply(z,arguments)}catch(K){return console.info("WebGL SDF generation failed, falling back to JS",K),g.apply(_,arguments)}}return r.forEachPathCommand=t,r.generate=q,r.generateIntoCanvas=ne,r.javascript=_,r.pathToLineSegments=e,r.webgl=z,r.webglUtils=h,Object.defineProperty(r,"__esModule",{value:!0}),r}({});return l}function Ka(){var l=function(r){var d={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},u={},t={};u.L=1,t[1]="L",Object.keys(d).forEach(function(V,re){u[V]=1<<re+1,t[u[V]]=V}),Object.freeze(u);var e=u.LRI|u.RLI|u.FSI,a=u.L|u.R|u.AL,i=u.B|u.S|u.WS|u.ON|u.FSI|u.LRI|u.RLI|u.PDI,n=u.BN|u.RLE|u.LRE|u.RLO|u.LRO|u.PDF,o=u.S|u.WS|u.B|e|u.PDI|n,s=null;function f(){if(!s){s=new Map;var V=function($){if(d.hasOwnProperty($)){var G=0;d[$].split(",").forEach(function(he){var Z=he.split("+"),oe=Z[0],J=Z[1];oe=parseInt(oe,36),J=J?parseInt(J,36):0,s.set(G+=oe,u[$]);for(var Se=0;Se<J;Se++)s.set(++G,u[$])})}};for(var re in d)V(re)}}function c(V){return f(),s.get(V.codePointAt(0))||u.L}function h(V){return t[c(V)]}var v={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function g(V,re){var $=36,G=0,he=new Map,Z=re&&new Map,oe;return V.split(",").forEach(function J(Se){if(Se.indexOf("+")!==-1)for(var ae=+Se;ae--;)J(oe);else{oe=Se;var ie=Se.split(">"),ce=ie[0],ve=ie[1];ce=String.fromCodePoint(G+=parseInt(ce,$)),ve=String.fromCodePoint(G+=parseInt(ve,$)),he.set(ce,ve),re&&Z.set(ve,ce)}}),{map:he,reverseMap:Z}}var m,D,_;function E(){if(!m){var V=g(v.pairs,!0),re=V.map,$=V.reverseMap;m=re,D=$,_=g(v.canonical,!1).map}}function y(V){return E(),m.get(V)||null}function x(V){return E(),D.get(V)||null}function A(V){return E(),_.get(V)||null}var w=u.L,U=u.R,B=u.EN,P=u.ES,Y=u.ET,b=u.AN,M=u.CS,C=u.B,X=u.S,z=u.ON,q=u.BN,ne=u.NSM,I=u.AL,R=u.LRO,p=u.RLO,S=u.LRE,T=u.RLE,F=u.PDF,k=u.LRI,N=u.RLI,L=u.FSI,j=u.PDI;function K(V,re){for(var $=125,G=new Uint32Array(V.length),he=0;he<V.length;he++)G[he]=c(V[he]);var Z=new Map;function oe(je,He){var Ne=G[je];G[je]=He,Z.set(Ne,Z.get(Ne)-1),Ne&i&&Z.set(i,Z.get(i)-1),Z.set(He,(Z.get(He)||0)+1),He&i&&Z.set(i,(Z.get(i)||0)+1)}for(var J=new Uint8Array(V.length),Se=new Map,ae=[],ie=null,ce=0;ce<V.length;ce++)ie||ae.push(ie={start:ce,end:V.length-1,level:re==="rtl"?1:re==="ltr"?0:$r(ce,!1)}),G[ce]&C&&(ie.end=ce,ie=null);for(var ve=T|S|p|R|e|j|F|C,Ue=function(je){return je+(je&1?1:2)},Fe=function(je){return je+(je&1?2:1)},ye=0;ye<ae.length;ye++){ie=ae[ye];var be=[{_level:ie.level,_override:0,_isolate:0}],fe=void 0,De=0,Ee=0,Ie=0;Z.clear();for(var ke=ie.start;ke<=ie.end;ke++){var de=G[ke];if(fe=be[be.length-1],Z.set(de,(Z.get(de)||0)+1),de&i&&Z.set(i,(Z.get(i)||0)+1),de&ve)if(de&(T|S)){J[ke]=fe._level;var we=(de===T?Fe:Ue)(fe._level);we<=$&&!De&&!Ee?be.push({_level:we,_override:0,_isolate:0}):De||Ee++}else if(de&(p|R)){J[ke]=fe._level;var qe=(de===p?Fe:Ue)(fe._level);qe<=$&&!De&&!Ee?be.push({_level:qe,_override:de&p?U:w,_isolate:0}):De||Ee++}else if(de&e){de&L&&(de=$r(ke+1,!0)===1?N:k),J[ke]=fe._level,fe._override&&oe(ke,fe._override);var _e=(de===N?Fe:Ue)(fe._level);_e<=$&&De===0&&Ee===0?(Ie++,be.push({_level:_e,_override:0,_isolate:1,_isolInitIndex:ke})):De++}else if(de&j){if(De>0)De--;else if(Ie>0){for(Ee=0;!be[be.length-1]._isolate;)be.pop();var xe=be[be.length-1]._isolInitIndex;xe!=null&&(Se.set(xe,ke),Se.set(ke,xe)),be.pop(),Ie--}fe=be[be.length-1],J[ke]=fe._level,fe._override&&oe(ke,fe._override)}else de&F?(De===0&&(Ee>0?Ee--:!fe._isolate&&be.length>1&&(be.pop(),fe=be[be.length-1])),J[ke]=fe._level):de&C&&(J[ke]=ie.level);else J[ke]=fe._level,fe._override&&de!==q&&oe(ke,fe._override)}for(var Ae=[],Te=null,pe=ie.start;pe<=ie.end;pe++){var Ce=G[pe];if(!(Ce&n)){var Oe=J[pe],Re=Ce&e,Me=Ce===j;Te&&Oe===Te._level?(Te._end=pe,Te._endsWithIsolInit=Re):Ae.push(Te={_start:pe,_end:pe,_level:Oe,_startsWithPDI:Me,_endsWithIsolInit:Re})}}for(var ze=[],$e=0;$e<Ae.length;$e++){var Ye=Ae[$e];if(!Ye._startsWithPDI||Ye._startsWithPDI&&!Se.has(Ye._start)){for(var et=[Te=Ye],nt=void 0;Te&&Te._endsWithIsolInit&&(nt=Se.get(Te._end))!=null;)for(var Ke=$e+1;Ke<Ae.length;Ke++)if(Ae[Ke]._start===nt){et.push(Te=Ae[Ke]);break}for(var Ge=[],at=0;at<et.length;at++)for(var Lr=et[at],$t=Lr._start;$t<=Lr._end;$t++)Ge.push($t);for(var Vn=J[Ge[0]],Pr=ie.level,Mt=Ge[0]-1;Mt>=0;Mt--)if(!(G[Mt]&n)){Pr=J[Mt];break}var er=Ge[Ge.length-1],Hn=J[er],Rr=ie.level;if(!(G[er]&e)){for(var Lt=er+1;Lt<=ie.end;Lt++)if(!(G[Lt]&n)){Rr=J[Lt];break}}ze.push({_seqIndices:Ge,_sosType:Math.max(Pr,Vn)%2?U:w,_eosType:Math.max(Rr,Hn)%2?U:w})}}for(var tr=0;tr<ze.length;tr++){var rr=ze[tr],se=rr._seqIndices,gt=rr._sosType,Xn=rr._eosType,st=J[se[0]]&1?U:w;if(Z.get(ne))for(var Pt=0;Pt<se.length;Pt++){var Or=se[Pt];if(G[Or]&ne){for(var nr=gt,Rt=Pt-1;Rt>=0;Rt--)if(!(G[se[Rt]]&n)){nr=G[se[Rt]];break}oe(Or,nr&(e|j)?z:nr)}}if(Z.get(B))for(var Ot=0;Ot<se.length;Ot++){var Gr=se[Ot];if(G[Gr]&B)for(var Gt=Ot-1;Gt>=-1;Gt--){var Br=Gt===-1?gt:G[se[Gt]];if(Br&a){Br===I&&oe(Gr,b);break}}}if(Z.get(I))for(var ar=0;ar<se.length;ar++){var Ir=se[ar];G[Ir]&I&&oe(Ir,U)}if(Z.get(P)||Z.get(M))for(var mt=1;mt<se.length-1;mt++){var or=se[mt];if(G[or]&(P|M)){for(var lt=0,ir=0,sr=mt-1;sr>=0&&(lt=G[se[sr]],!!(lt&n));sr--);for(var lr=mt+1;lr<se.length&&(ir=G[se[lr]],!!(ir&n));lr++);lt===ir&&(G[or]===P?lt===B:lt&(B|b))&&oe(or,lt)}}if(Z.get(B))for(var Xe=0;Xe<se.length;Xe++){var Yn=se[Xe];if(G[Yn]&B){for(var Bt=Xe-1;Bt>=0&&G[se[Bt]]&(Y|n);Bt--)oe(se[Bt],B);for(Xe++;Xe<se.length&&G[se[Xe]]&(Y|n|B);Xe++)G[se[Xe]]!==B&&oe(se[Xe],B)}}if(Z.get(Y)||Z.get(P)||Z.get(M))for(var yt=0;yt<se.length;yt++){var jr=se[yt];if(G[jr]&(Y|P|M)){oe(jr,z);for(var It=yt-1;It>=0&&G[se[It]]&n;It--)oe(se[It],z);for(var jt=yt+1;jt<se.length&&G[se[jt]]&n;jt++)oe(se[jt],z)}}if(Z.get(B))for(var fr=0,Nr=gt;fr<se.length;fr++){var Wr=se[fr],cr=G[Wr];cr&B?Nr===w&&oe(Wr,w):cr&a&&(Nr=cr)}if(Z.get(i)){var bt=U|B|b,zr=bt|w,Nt=[];{for(var ft=[],ct=0;ct<se.length;ct++)if(G[se[ct]]&i){var xt=V[se[ct]],Vr=void 0;if(y(xt)!==null)if(ft.length<63)ft.push({char:xt,seqIndex:ct});else break;else if((Vr=x(xt))!==null)for(var St=ft.length-1;St>=0;St--){var ur=ft[St].char;if(ur===Vr||ur===x(A(xt))||y(A(ur))===xt){Nt.push([ft[St].seqIndex,ct]),ft.length=St;break}}}Nt.sort(function(je,He){return je[0]-He[0]})}for(var dr=0;dr<Nt.length;dr++){for(var Hr=Nt[dr],Wt=Hr[0],hr=Hr[1],Xr=!1,Ve=0,vr=Wt+1;vr<hr;vr++){var Yr=se[vr];if(G[Yr]&zr){Xr=!0;var Kr=G[Yr]&bt?U:w;if(Kr===st){Ve=Kr;break}}}if(Xr&&!Ve){Ve=gt;for(var pr=Wt-1;pr>=0;pr--){var Jr=se[pr];if(G[Jr]&zr){var Zr=G[Jr]&bt?U:w;Zr!==st?Ve=Zr:Ve=st;break}}}if(Ve){if(G[se[Wt]]=G[se[hr]]=Ve,Ve!==st){for(var wt=Wt+1;wt<se.length;wt++)if(!(G[se[wt]]&n)){c(V[se[wt]])&ne&&(G[se[wt]]=Ve);break}}if(Ve!==st){for(var _t=hr+1;_t<se.length;_t++)if(!(G[se[_t]]&n)){c(V[se[_t]])&ne&&(G[se[_t]]=Ve);break}}}}for(var tt=0;tt<se.length;tt++)if(G[se[tt]]&i){for(var Qr=tt,gr=tt,mr=gt,Ut=tt-1;Ut>=0;Ut--)if(G[se[Ut]]&n)Qr=Ut;else{mr=G[se[Ut]]&bt?U:w;break}for(var qr=Xn,kt=tt+1;kt<se.length;kt++)if(G[se[kt]]&(i|n))gr=kt;else{qr=G[se[kt]]&bt?U:w;break}for(var yr=Qr;yr<=gr;yr++)G[se[yr]]=mr===qr?mr:st;tt=gr}}}for(var We=ie.start;We<=ie.end;We++){var Kn=J[We],zt=G[We];if(Kn&1?zt&(w|B|b)&&J[We]++:zt&U?J[We]++:zt&(b|B)&&(J[We]+=2),zt&n&&(J[We]=We===0?ie.level:J[We-1]),We===ie.end||c(V[We])&(X|C))for(var Vt=We;Vt>=0&&c(V[Vt])&o;Vt--)J[Vt]=ie.level}}return{levels:J,paragraphs:ae};function $r(je,He){for(var Ne=je;Ne<V.length;Ne++){var rt=G[Ne];if(rt&(U|I))return 1;if(rt&(C|w)||He&&rt===j)return 0;if(rt&e){var en=Jn(Ne);Ne=en===-1?V.length:en}}return 0}function Jn(je){for(var He=1,Ne=je+1;Ne<V.length;Ne++){var rt=G[Ne];if(rt&C)break;if(rt&j){if(--He===0)return Ne}else rt&e&&He++}return-1}}var ee="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",H;function W(){if(!H){var V=g(ee,!0),re=V.map,$=V.reverseMap;$.forEach(function(G,he){re.set(he,G)}),H=re}}function ge(V){return W(),H.get(V)||null}function ue(V,re,$,G){var he=V.length;$=Math.max(0,$==null?0:+$),G=Math.min(he-1,G==null?he-1:+G);for(var Z=new Map,oe=$;oe<=G;oe++)if(re[oe]&1){var J=ge(V[oe]);J!==null&&Z.set(oe,J)}return Z}function Q(V,re,$,G){var he=V.length;$=Math.max(0,$==null?0:+$),G=Math.min(he-1,G==null?he-1:+G);var Z=[];return re.paragraphs.forEach(function(oe){var J=Math.max($,oe.start),Se=Math.min(G,oe.end);if(J<Se){for(var ae=re.levels.slice(J,Se+1),ie=Se;ie>=J&&c(V[ie])&o;ie--)ae[ie]=oe.level;for(var ce=oe.level,ve=1/0,Ue=0;Ue<ae.length;Ue++){var Fe=ae[Ue];Fe>ce&&(ce=Fe),Fe<ve&&(ve=Fe|1)}for(var ye=ce;ye>=ve;ye--)for(var be=0;be<ae.length;be++)if(ae[be]>=ye){for(var fe=be;be+1<ae.length&&ae[be+1]>=ye;)be++;be>fe&&Z.push([fe+J,be+J])}}}),Z}function te(V,re,$,G){var he=le(V,re,$,G),Z=[].concat(V);return he.forEach(function(oe,J){Z[J]=(re.levels[oe]&1?ge(V[oe]):null)||V[oe]}),Z.join("")}function le(V,re,$,G){for(var he=Q(V,re,$,G),Z=[],oe=0;oe<V.length;oe++)Z[oe]=oe;return he.forEach(function(J){for(var Se=J[0],ae=J[1],ie=Z.slice(Se,ae+1),ce=ie.length;ce--;)Z[ae-ce]=ie[ce]}),Z}return r.closingToOpeningBracket=x,r.getBidiCharType=c,r.getBidiCharTypeName=h,r.getCanonicalBracket=A,r.getEmbeddingLevels=K,r.getMirroredCharacter=ge,r.getMirroredCharactersMap=ue,r.getReorderSegments=Q,r.getReorderedIndices=le,r.getReorderedString=te,r.openingToClosingBracket=y,Object.defineProperty(r,"__esModule",{value:!0}),r}({});return l}const Mn=/\bvoid\s+main\s*\(\s*\)\s*{/g;function Er(l){const r=/^[ \t]*#include +<([\w\d./]+)>/gm;function d(u,t){let e=oa[t];return e?Er(e):u}return l.replace(r,d)}const Pe=[];for(let l=0;l<256;l++)Pe[l]=(l<16?"0":"")+l.toString(16);function Ja(){const l=Math.random()*4294967295|0,r=Math.random()*4294967295|0,d=Math.random()*4294967295|0,u=Math.random()*4294967295|0;return(Pe[l&255]+Pe[l>>8&255]+Pe[l>>16&255]+Pe[l>>24&255]+"-"+Pe[r&255]+Pe[r>>8&255]+"-"+Pe[r>>16&15|64]+Pe[r>>24&255]+"-"+Pe[d&63|128]+Pe[d>>8&255]+"-"+Pe[d>>16&255]+Pe[d>>24&255]+Pe[u&255]+Pe[u>>8&255]+Pe[u>>16&255]+Pe[u>>24&255]).toUpperCase()}const ot=Object.assign||function(){let l=arguments[0];for(let r=1,d=arguments.length;r<d;r++){let u=arguments[r];if(u)for(let t in u)Object.prototype.hasOwnProperty.call(u,t)&&(l[t]=u[t])}return l},Za=Date.now(),un=new WeakMap,dn=new Map;let Qa=1e10;function Tr(l,r){const d=to(r);let u=un.get(l);if(u||un.set(l,u=Object.create(null)),u[d])return new u[d];const t=`_onBeforeCompile${d}`,e=function(o,s){l.onBeforeCompile.call(this,o,s);const f=this.customProgramCacheKey()+"|"+o.vertexShader+"|"+o.fragmentShader;let c=dn[f];if(!c){const h=qa(this,o,r,d);c=dn[f]=h}o.vertexShader=c.vertexShader,o.fragmentShader=c.fragmentShader,ot(o.uniforms,this.uniforms),r.timeUniform&&(o.uniforms[r.timeUniform]={get value(){return Date.now()-Za}}),this[t]&&this[t](o)},a=function(){return i(r.chained?l:l.clone())},i=function(o){const s=Object.create(o,n);return Object.defineProperty(s,"baseMaterial",{value:l}),Object.defineProperty(s,"id",{value:Qa++}),s.uuid=Ja(),s.uniforms=ot({},o.uniforms,r.uniforms),s.defines=ot({},o.defines,r.defines),s.defines[`TROIKA_DERIVED_MATERIAL_${d}`]="",s.extensions=ot({},o.extensions,r.extensions),s._listeners=void 0,s},n={constructor:{value:a},isDerivedMaterial:{value:!0},type:{get:()=>l.type,set:o=>{l.type=o}},isDerivedFrom:{writable:!0,configurable:!0,value:function(o){const s=this.baseMaterial;return o===s||s.isDerivedMaterial&&s.isDerivedFrom(o)||!1}},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return l.customProgramCacheKey()+"|"+d}},onBeforeCompile:{get(){return e},set(o){this[t]=o}},copy:{writable:!0,configurable:!0,value:function(o){return l.copy.call(this,o),!l.isShaderMaterial&&!l.isDerivedMaterial&&(ot(this.extensions,o.extensions),ot(this.defines,o.defines),ot(this.uniforms,En.clone(o.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const o=new l.constructor;return i(o).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let o=this._depthMaterial;return o||(o=this._depthMaterial=Tr(l.isDerivedMaterial?l.getDepthMaterial():new na({depthPacking:aa}),r),o.defines.IS_DEPTH_MATERIAL="",o.uniforms=this.uniforms),o}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let o=this._distanceMaterial;return o||(o=this._distanceMaterial=Tr(l.isDerivedMaterial?l.getDistanceMaterial():new ra,r),o.defines.IS_DISTANCE_MATERIAL="",o.uniforms=this.uniforms),o}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:o,_distanceMaterial:s}=this;o&&o.dispose(),s&&s.dispose(),l.dispose.call(this)}}};return u[d]=a,new a}function qa(l,{vertexShader:r,fragmentShader:d},u,t){let{vertexDefs:e,vertexMainIntro:a,vertexMainOutro:i,vertexTransform:n,fragmentDefs:o,fragmentMainIntro:s,fragmentMainOutro:f,fragmentColorTransform:c,customRewriter:h,timeUniform:v}=u;if(e=e||"",a=a||"",i=i||"",o=o||"",s=s||"",f=f||"",(n||h)&&(r=Er(r)),(c||h)&&(d=d.replace(/^[ \t]*#include <((?:tonemapping|encodings|colorspace|fog|premultiplied_alpha|dithering)_fragment)>/gm,`
//!BEGIN_POST_CHUNK $1
$&
//!END_POST_CHUNK
`),d=Er(d)),h){let g=h({vertexShader:r,fragmentShader:d});r=g.vertexShader,d=g.fragmentShader}if(c){let g=[];d=d.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,m=>(g.push(m),"")),f=`${c}
${g.join(`
`)}
${f}`}if(v){const g=`
uniform float ${v};
`;e=g+e,o=g+o}return n&&(r=`vec3 troika_position_${t};
vec3 troika_normal_${t};
vec2 troika_uv_${t};
${r}
`,e=`${e}
void troikaVertexTransform${t}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${n}
}
`,a=`
troika_position_${t} = vec3(position);
troika_normal_${t} = vec3(normal);
troika_uv_${t} = vec2(uv);
troikaVertexTransform${t}(troika_position_${t}, troika_normal_${t}, troika_uv_${t});
${a}
`,r=r.replace(/\b(position|normal|uv)\b/g,(g,m,D,_)=>/\battribute\s+vec[23]\s+$/.test(_.substr(0,D))?m:`troika_${m}_${t}`),l.map&&l.map.channel>0||(r=r.replace(/\bMAP_UV\b/g,`troika_uv_${t}`))),r=hn(r,t,e,a,i),d=hn(d,t,o,s,f),{vertexShader:r,fragmentShader:d}}function hn(l,r,d,u,t){return(u||t||d)&&(l=l.replace(Mn,`
${d}
void troikaOrigMain${r}() {`),l+=`
void main() {
  ${u}
  troikaOrigMain${r}();
  ${t}
}`),l}function $a(l,r){return l==="uniforms"?void 0:typeof r=="function"?r.toString():r}let eo=0;const vn=new Map;function to(l){const r=JSON.stringify(l,$a);let d=vn.get(r);return d==null&&vn.set(r,d=++eo),d}/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/function ro(){return typeof window>"u"&&(self.window=self),function(l){var r={parse:function(t){var e=r._bin,a=new Uint8Array(t);if(e.readASCII(a,0,4)=="ttcf"){var i=4;e.readUshort(a,i),i+=2,e.readUshort(a,i),i+=2;var n=e.readUint(a,i);i+=4;for(var o=[],s=0;s<n;s++){var f=e.readUint(a,i);i+=4,o.push(r._readFont(a,f))}return o}return[r._readFont(a,0)]},_readFont:function(t,e){var a=r._bin,i=e;a.readFixed(t,e),e+=4;var n=a.readUshort(t,e);e+=2,a.readUshort(t,e),e+=2,a.readUshort(t,e),e+=2,a.readUshort(t,e),e+=2;for(var o=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],s={_data:t,_offset:i},f={},c=0;c<n;c++){var h=a.readASCII(t,e,4);e+=4,a.readUint(t,e),e+=4;var v=a.readUint(t,e);e+=4;var g=a.readUint(t,e);e+=4,f[h]={offset:v,length:g}}for(c=0;c<o.length;c++){var m=o[c];f[m]&&(s[m.trim()]=r[m.trim()].parse(t,f[m].offset,f[m].length,s))}return s},_tabOffset:function(t,e,a){for(var i=r._bin,n=i.readUshort(t,a+4),o=a+12,s=0;s<n;s++){var f=i.readASCII(t,o,4);o+=4,i.readUint(t,o),o+=4;var c=i.readUint(t,o);if(o+=4,i.readUint(t,o),o+=4,f==e)return c}return 0}};r._bin={readFixed:function(t,e){return(t[e]<<8|t[e+1])+(t[e+2]<<8|t[e+3])/65540},readF2dot14:function(t,e){return r._bin.readShort(t,e)/16384},readInt:function(t,e){return r._bin._view(t).getInt32(e)},readInt8:function(t,e){return r._bin._view(t).getInt8(e)},readShort:function(t,e){return r._bin._view(t).getInt16(e)},readUshort:function(t,e){return r._bin._view(t).getUint16(e)},readUshorts:function(t,e,a){for(var i=[],n=0;n<a;n++)i.push(r._bin.readUshort(t,e+2*n));return i},readUint:function(t,e){return r._bin._view(t).getUint32(e)},readUint64:function(t,e){return 4294967296*r._bin.readUint(t,e)+r._bin.readUint(t,e+4)},readASCII:function(t,e,a){for(var i="",n=0;n<a;n++)i+=String.fromCharCode(t[e+n]);return i},readUnicode:function(t,e,a){for(var i="",n=0;n<a;n++){var o=t[e++]<<8|t[e++];i+=String.fromCharCode(o)}return i},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(t,e,a){var i=r._bin._tdec;return i&&e==0&&a==t.length?i.decode(t):r._bin.readASCII(t,e,a)},readBytes:function(t,e,a){for(var i=[],n=0;n<a;n++)i.push(t[e+n]);return i},readASCIIArray:function(t,e,a){for(var i=[],n=0;n<a;n++)i.push(String.fromCharCode(t[e+n]));return i},_view:function(t){return t._dataView||(t._dataView=t.buffer?new DataView(t.buffer,t.byteOffset,t.byteLength):new DataView(new Uint8Array(t).buffer))}},r._lctf={},r._lctf.parse=function(t,e,a,i,n){var o=r._bin,s={},f=e;o.readFixed(t,e),e+=4;var c=o.readUshort(t,e);e+=2;var h=o.readUshort(t,e);e+=2;var v=o.readUshort(t,e);return e+=2,s.scriptList=r._lctf.readScriptList(t,f+c),s.featureList=r._lctf.readFeatureList(t,f+h),s.lookupList=r._lctf.readLookupList(t,f+v,n),s},r._lctf.readLookupList=function(t,e,a){var i=r._bin,n=e,o=[],s=i.readUshort(t,e);e+=2;for(var f=0;f<s;f++){var c=i.readUshort(t,e);e+=2;var h=r._lctf.readLookupTable(t,n+c,a);o.push(h)}return o},r._lctf.readLookupTable=function(t,e,a){var i=r._bin,n=e,o={tabs:[]};o.ltype=i.readUshort(t,e),e+=2,o.flag=i.readUshort(t,e),e+=2;var s=i.readUshort(t,e);e+=2;for(var f=o.ltype,c=0;c<s;c++){var h=i.readUshort(t,e);e+=2;var v=a(t,f,n+h,o);o.tabs.push(v)}return o},r._lctf.numOfOnes=function(t){for(var e=0,a=0;a<32;a++)t>>>a&1&&e++;return e},r._lctf.readClassDef=function(t,e){var a=r._bin,i=[],n=a.readUshort(t,e);if(e+=2,n==1){var o=a.readUshort(t,e);e+=2;var s=a.readUshort(t,e);e+=2;for(var f=0;f<s;f++)i.push(o+f),i.push(o+f),i.push(a.readUshort(t,e)),e+=2}if(n==2){var c=a.readUshort(t,e);for(e+=2,f=0;f<c;f++)i.push(a.readUshort(t,e)),e+=2,i.push(a.readUshort(t,e)),e+=2,i.push(a.readUshort(t,e)),e+=2}return i},r._lctf.getInterval=function(t,e){for(var a=0;a<t.length;a+=3){var i=t[a],n=t[a+1];if(t[a+2],i<=e&&e<=n)return a}return-1},r._lctf.readCoverage=function(t,e){var a=r._bin,i={};i.fmt=a.readUshort(t,e),e+=2;var n=a.readUshort(t,e);return e+=2,i.fmt==1&&(i.tab=a.readUshorts(t,e,n)),i.fmt==2&&(i.tab=a.readUshorts(t,e,3*n)),i},r._lctf.coverageIndex=function(t,e){var a=t.tab;if(t.fmt==1)return a.indexOf(e);if(t.fmt==2){var i=r._lctf.getInterval(a,e);if(i!=-1)return a[i+2]+(e-a[i])}return-1},r._lctf.readFeatureList=function(t,e){var a=r._bin,i=e,n=[],o=a.readUshort(t,e);e+=2;for(var s=0;s<o;s++){var f=a.readASCII(t,e,4);e+=4;var c=a.readUshort(t,e);e+=2;var h=r._lctf.readFeatureTable(t,i+c);h.tag=f.trim(),n.push(h)}return n},r._lctf.readFeatureTable=function(t,e){var a=r._bin,i=e,n={},o=a.readUshort(t,e);e+=2,o>0&&(n.featureParams=i+o);var s=a.readUshort(t,e);e+=2,n.tab=[];for(var f=0;f<s;f++)n.tab.push(a.readUshort(t,e+2*f));return n},r._lctf.readScriptList=function(t,e){var a=r._bin,i=e,n={},o=a.readUshort(t,e);e+=2;for(var s=0;s<o;s++){var f=a.readASCII(t,e,4);e+=4;var c=a.readUshort(t,e);e+=2,n[f.trim()]=r._lctf.readScriptTable(t,i+c)}return n},r._lctf.readScriptTable=function(t,e){var a=r._bin,i=e,n={},o=a.readUshort(t,e);e+=2,o>0&&(n.default=r._lctf.readLangSysTable(t,i+o));var s=a.readUshort(t,e);e+=2;for(var f=0;f<s;f++){var c=a.readASCII(t,e,4);e+=4;var h=a.readUshort(t,e);e+=2,n[c.trim()]=r._lctf.readLangSysTable(t,i+h)}return n},r._lctf.readLangSysTable=function(t,e){var a=r._bin,i={};a.readUshort(t,e),e+=2,i.reqFeature=a.readUshort(t,e),e+=2;var n=a.readUshort(t,e);return e+=2,i.features=a.readUshorts(t,e,n),i},r.CFF={},r.CFF.parse=function(t,e,a){var i=r._bin;(t=new Uint8Array(t.buffer,e,a))[e=0],t[++e],t[++e],t[++e],e++;var n=[];e=r.CFF.readIndex(t,e,n);for(var o=[],s=0;s<n.length-1;s++)o.push(i.readASCII(t,e+n[s],n[s+1]-n[s]));e+=n[n.length-1];var f=[];e=r.CFF.readIndex(t,e,f);var c=[];for(s=0;s<f.length-1;s++)c.push(r.CFF.readDict(t,e+f[s],e+f[s+1]));e+=f[f.length-1];var h=c[0],v=[];e=r.CFF.readIndex(t,e,v);var g=[];for(s=0;s<v.length-1;s++)g.push(i.readASCII(t,e+v[s],v[s+1]-v[s]));if(e+=v[v.length-1],r.CFF.readSubrs(t,e,h),h.CharStrings){e=h.CharStrings,v=[],e=r.CFF.readIndex(t,e,v);var m=[];for(s=0;s<v.length-1;s++)m.push(i.readBytes(t,e+v[s],v[s+1]-v[s]));h.CharStrings=m}if(h.ROS){e=h.FDArray;var D=[];for(e=r.CFF.readIndex(t,e,D),h.FDArray=[],s=0;s<D.length-1;s++){var _=r.CFF.readDict(t,e+D[s],e+D[s+1]);r.CFF._readFDict(t,_,g),h.FDArray.push(_)}e+=D[D.length-1],e=h.FDSelect,h.FDSelect=[];var E=t[e];if(e++,E!=3)throw E;var y=i.readUshort(t,e);for(e+=2,s=0;s<y+1;s++)h.FDSelect.push(i.readUshort(t,e),t[e+2]),e+=3}return h.Encoding&&(h.Encoding=r.CFF.readEncoding(t,h.Encoding,h.CharStrings.length)),h.charset&&(h.charset=r.CFF.readCharset(t,h.charset,h.CharStrings.length)),r.CFF._readFDict(t,h,g),h},r.CFF._readFDict=function(t,e,a){var i;for(var n in e.Private&&(i=e.Private[1],e.Private=r.CFF.readDict(t,i,i+e.Private[0]),e.Private.Subrs&&r.CFF.readSubrs(t,i+e.Private.Subrs,e.Private)),e)["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(n)!=-1&&(e[n]=a[e[n]-426+35])},r.CFF.readSubrs=function(t,e,a){var i=r._bin,n=[];e=r.CFF.readIndex(t,e,n);var o,s=n.length;o=s<1240?107:s<33900?1131:32768,a.Bias=o,a.Subrs=[];for(var f=0;f<n.length-1;f++)a.Subrs.push(i.readBytes(t,e+n[f],n[f+1]-n[f]))},r.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],r.CFF.glyphByUnicode=function(t,e){for(var a=0;a<t.charset.length;a++)if(t.charset[a]==e)return a;return-1},r.CFF.glyphBySE=function(t,e){return e<0||e>255?-1:r.CFF.glyphByUnicode(t,r.CFF.tableSE[e])},r.CFF.readEncoding=function(t,e,a){r._bin;var i=[".notdef"],n=t[e];if(e++,n!=0)throw"error: unknown encoding format: "+n;var o=t[e];e++;for(var s=0;s<o;s++)i.push(t[e+s]);return i},r.CFF.readCharset=function(t,e,a){var i=r._bin,n=[".notdef"],o=t[e];if(e++,o==0)for(var s=0;s<a;s++){var f=i.readUshort(t,e);e+=2,n.push(f)}else{if(o!=1&&o!=2)throw"error: format: "+o;for(;n.length<a;){f=i.readUshort(t,e),e+=2;var c=0;for(o==1?(c=t[e],e++):(c=i.readUshort(t,e),e+=2),s=0;s<=c;s++)n.push(f),f++}}return n},r.CFF.readIndex=function(t,e,a){var i=r._bin,n=i.readUshort(t,e)+1,o=t[e+=2];if(e++,o==1)for(var s=0;s<n;s++)a.push(t[e+s]);else if(o==2)for(s=0;s<n;s++)a.push(i.readUshort(t,e+2*s));else if(o==3)for(s=0;s<n;s++)a.push(16777215&i.readUint(t,e+3*s-1));else if(n!=1)throw"unsupported offset size: "+o+", count: "+n;return(e+=n*o)-1},r.CFF.getCharString=function(t,e,a){var i=r._bin,n=t[e],o=t[e+1];t[e+2],t[e+3],t[e+4];var s=1,f=null,c=null;n<=20&&(f=n,s=1),n==12&&(f=100*n+o,s=2),21<=n&&n<=27&&(f=n,s=1),n==28&&(c=i.readShort(t,e+1),s=3),29<=n&&n<=31&&(f=n,s=1),32<=n&&n<=246&&(c=n-139,s=1),247<=n&&n<=250&&(c=256*(n-247)+o+108,s=2),251<=n&&n<=254&&(c=256*-(n-251)-o-108,s=2),n==255&&(c=i.readInt(t,e+1)/65535,s=5),a.val=c??"o"+f,a.size=s},r.CFF.readCharString=function(t,e,a){for(var i=e+a,n=r._bin,o=[];e<i;){var s=t[e],f=t[e+1];t[e+2],t[e+3],t[e+4];var c=1,h=null,v=null;s<=20&&(h=s,c=1),s==12&&(h=100*s+f,c=2),s!=19&&s!=20||(h=s,c=2),21<=s&&s<=27&&(h=s,c=1),s==28&&(v=n.readShort(t,e+1),c=3),29<=s&&s<=31&&(h=s,c=1),32<=s&&s<=246&&(v=s-139,c=1),247<=s&&s<=250&&(v=256*(s-247)+f+108,c=2),251<=s&&s<=254&&(v=256*-(s-251)-f-108,c=2),s==255&&(v=n.readInt(t,e+1)/65535,c=5),o.push(v??"o"+h),e+=c}return o},r.CFF.readDict=function(t,e,a){for(var i=r._bin,n={},o=[];e<a;){var s=t[e],f=t[e+1];t[e+2],t[e+3],t[e+4];var c=1,h=null,v=null;if(s==28&&(v=i.readShort(t,e+1),c=3),s==29&&(v=i.readInt(t,e+1),c=5),32<=s&&s<=246&&(v=s-139,c=1),247<=s&&s<=250&&(v=256*(s-247)+f+108,c=2),251<=s&&s<=254&&(v=256*-(s-251)-f-108,c=2),s==255)throw v=i.readInt(t,e+1)/65535,c=5,"unknown number";if(s==30){var g=[];for(c=1;;){var m=t[e+c];c++;var D=m>>4,_=15&m;if(D!=15&&g.push(D),_!=15&&g.push(_),_==15)break}for(var E="",y=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],x=0;x<g.length;x++)E+=y[g[x]];v=parseFloat(E)}s<=21&&(h=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][s],c=1,s==12&&(h=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][f],c=2)),h!=null?(n[h]=o.length==1?o[0]:o,o=[]):o.push(v),e+=c}return n},r.cmap={},r.cmap.parse=function(t,e,a){t=new Uint8Array(t.buffer,e,a),e=0;var i=r._bin,n={};i.readUshort(t,e),e+=2;var o=i.readUshort(t,e);e+=2;var s=[];n.tables=[];for(var f=0;f<o;f++){var c=i.readUshort(t,e);e+=2;var h=i.readUshort(t,e);e+=2;var v=i.readUint(t,e);e+=4;var g="p"+c+"e"+h,m=s.indexOf(v);if(m==-1){var D;m=n.tables.length,s.push(v);var _=i.readUshort(t,v);_==0?D=r.cmap.parse0(t,v):_==4?D=r.cmap.parse4(t,v):_==6?D=r.cmap.parse6(t,v):_==12?D=r.cmap.parse12(t,v):console.debug("unknown format: "+_,c,h,v),n.tables.push(D)}if(n[g]!=null)throw"multiple tables for one platform+encoding";n[g]=m}return n},r.cmap.parse0=function(t,e){var a=r._bin,i={};i.format=a.readUshort(t,e),e+=2;var n=a.readUshort(t,e);e+=2,a.readUshort(t,e),e+=2,i.map=[];for(var o=0;o<n-6;o++)i.map.push(t[e+o]);return i},r.cmap.parse4=function(t,e){var a=r._bin,i=e,n={};n.format=a.readUshort(t,e),e+=2;var o=a.readUshort(t,e);e+=2,a.readUshort(t,e),e+=2;var s=a.readUshort(t,e);e+=2;var f=s/2;n.searchRange=a.readUshort(t,e),e+=2,n.entrySelector=a.readUshort(t,e),e+=2,n.rangeShift=a.readUshort(t,e),e+=2,n.endCount=a.readUshorts(t,e,f),e+=2*f,e+=2,n.startCount=a.readUshorts(t,e,f),e+=2*f,n.idDelta=[];for(var c=0;c<f;c++)n.idDelta.push(a.readShort(t,e)),e+=2;for(n.idRangeOffset=a.readUshorts(t,e,f),e+=2*f,n.glyphIdArray=[];e<i+o;)n.glyphIdArray.push(a.readUshort(t,e)),e+=2;return n},r.cmap.parse6=function(t,e){var a=r._bin,i={};i.format=a.readUshort(t,e),e+=2,a.readUshort(t,e),e+=2,a.readUshort(t,e),e+=2,i.firstCode=a.readUshort(t,e),e+=2;var n=a.readUshort(t,e);e+=2,i.glyphIdArray=[];for(var o=0;o<n;o++)i.glyphIdArray.push(a.readUshort(t,e)),e+=2;return i},r.cmap.parse12=function(t,e){var a=r._bin,i={};i.format=a.readUshort(t,e),e+=2,e+=2,a.readUint(t,e),e+=4,a.readUint(t,e),e+=4;var n=a.readUint(t,e);e+=4,i.groups=[];for(var o=0;o<n;o++){var s=e+12*o,f=a.readUint(t,s+0),c=a.readUint(t,s+4),h=a.readUint(t,s+8);i.groups.push([f,c,h])}return i},r.glyf={},r.glyf.parse=function(t,e,a,i){for(var n=[],o=0;o<i.maxp.numGlyphs;o++)n.push(null);return n},r.glyf._parseGlyf=function(t,e){var a=r._bin,i=t._data,n=r._tabOffset(i,"glyf",t._offset)+t.loca[e];if(t.loca[e]==t.loca[e+1])return null;var o={};if(o.noc=a.readShort(i,n),n+=2,o.xMin=a.readShort(i,n),n+=2,o.yMin=a.readShort(i,n),n+=2,o.xMax=a.readShort(i,n),n+=2,o.yMax=a.readShort(i,n),n+=2,o.xMin>=o.xMax||o.yMin>=o.yMax)return null;if(o.noc>0){o.endPts=[];for(var s=0;s<o.noc;s++)o.endPts.push(a.readUshort(i,n)),n+=2;var f=a.readUshort(i,n);if(n+=2,i.length-n<f)return null;o.instructions=a.readBytes(i,n,f),n+=f;var c=o.endPts[o.noc-1]+1;for(o.flags=[],s=0;s<c;s++){var h=i[n];if(n++,o.flags.push(h),(8&h)!=0){var v=i[n];n++;for(var g=0;g<v;g++)o.flags.push(h),s++}}for(o.xs=[],s=0;s<c;s++){var m=(2&o.flags[s])!=0,D=(16&o.flags[s])!=0;m?(o.xs.push(D?i[n]:-i[n]),n++):D?o.xs.push(0):(o.xs.push(a.readShort(i,n)),n+=2)}for(o.ys=[],s=0;s<c;s++)m=(4&o.flags[s])!=0,D=(32&o.flags[s])!=0,m?(o.ys.push(D?i[n]:-i[n]),n++):D?o.ys.push(0):(o.ys.push(a.readShort(i,n)),n+=2);var _=0,E=0;for(s=0;s<c;s++)_+=o.xs[s],E+=o.ys[s],o.xs[s]=_,o.ys[s]=E}else{var y;o.parts=[];do{y=a.readUshort(i,n),n+=2;var x={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(o.parts.push(x),x.glyphIndex=a.readUshort(i,n),n+=2,1&y){var A=a.readShort(i,n);n+=2;var w=a.readShort(i,n);n+=2}else A=a.readInt8(i,n),n++,w=a.readInt8(i,n),n++;2&y?(x.m.tx=A,x.m.ty=w):(x.p1=A,x.p2=w),8&y?(x.m.a=x.m.d=a.readF2dot14(i,n),n+=2):64&y?(x.m.a=a.readF2dot14(i,n),n+=2,x.m.d=a.readF2dot14(i,n),n+=2):128&y&&(x.m.a=a.readF2dot14(i,n),n+=2,x.m.b=a.readF2dot14(i,n),n+=2,x.m.c=a.readF2dot14(i,n),n+=2,x.m.d=a.readF2dot14(i,n),n+=2)}while(32&y);if(256&y){var U=a.readUshort(i,n);for(n+=2,o.instr=[],s=0;s<U;s++)o.instr.push(i[n]),n++}}return o},r.GDEF={},r.GDEF.parse=function(t,e,a,i){var n=e;e+=4;var o=r._bin.readUshort(t,e);return{glyphClassDef:o===0?null:r._lctf.readClassDef(t,n+o)}},r.GPOS={},r.GPOS.parse=function(t,e,a,i){return r._lctf.parse(t,e,a,i,r.GPOS.subt)},r.GPOS.subt=function(t,e,a,i){var n=r._bin,o=a,s={};if(s.fmt=n.readUshort(t,a),a+=2,e==1||e==2||e==3||e==7||e==8&&s.fmt<=2){var f=n.readUshort(t,a);a+=2,s.coverage=r._lctf.readCoverage(t,f+o)}if(e==1&&s.fmt==1){var c=n.readUshort(t,a);a+=2,c!=0&&(s.pos=r.GPOS.readValueRecord(t,a,c))}else if(e==2&&s.fmt>=1&&s.fmt<=2){c=n.readUshort(t,a),a+=2;var h=n.readUshort(t,a);a+=2;var v=r._lctf.numOfOnes(c),g=r._lctf.numOfOnes(h);if(s.fmt==1){s.pairsets=[];var m=n.readUshort(t,a);a+=2;for(var D=0;D<m;D++){var _=o+n.readUshort(t,a);a+=2;var E=n.readUshort(t,_);_+=2;for(var y=[],x=0;x<E;x++){var A=n.readUshort(t,_);_+=2,c!=0&&(b=r.GPOS.readValueRecord(t,_,c),_+=2*v),h!=0&&(M=r.GPOS.readValueRecord(t,_,h),_+=2*g),y.push({gid2:A,val1:b,val2:M})}s.pairsets.push(y)}}if(s.fmt==2){var w=n.readUshort(t,a);a+=2;var U=n.readUshort(t,a);a+=2;var B=n.readUshort(t,a);a+=2;var P=n.readUshort(t,a);for(a+=2,s.classDef1=r._lctf.readClassDef(t,o+w),s.classDef2=r._lctf.readClassDef(t,o+U),s.matrix=[],D=0;D<B;D++){var Y=[];for(x=0;x<P;x++){var b=null,M=null;c!=0&&(b=r.GPOS.readValueRecord(t,a,c),a+=2*v),h!=0&&(M=r.GPOS.readValueRecord(t,a,h),a+=2*g),Y.push({val1:b,val2:M})}s.matrix.push(Y)}}}else if(e==4&&s.fmt==1)s.markCoverage=r._lctf.readCoverage(t,n.readUshort(t,a)+o),s.baseCoverage=r._lctf.readCoverage(t,n.readUshort(t,a+2)+o),s.markClassCount=n.readUshort(t,a+4),s.markArray=r.GPOS.readMarkArray(t,n.readUshort(t,a+6)+o),s.baseArray=r.GPOS.readBaseArray(t,n.readUshort(t,a+8)+o,s.markClassCount);else if(e==6&&s.fmt==1)s.mark1Coverage=r._lctf.readCoverage(t,n.readUshort(t,a)+o),s.mark2Coverage=r._lctf.readCoverage(t,n.readUshort(t,a+2)+o),s.markClassCount=n.readUshort(t,a+4),s.mark1Array=r.GPOS.readMarkArray(t,n.readUshort(t,a+6)+o),s.mark2Array=r.GPOS.readBaseArray(t,n.readUshort(t,a+8)+o,s.markClassCount);else{if(e==9&&s.fmt==1){var C=n.readUshort(t,a);a+=2;var X=n.readUint(t,a);if(a+=4,i.ltype==9)i.ltype=C;else if(i.ltype!=C)throw"invalid extension substitution";return r.GPOS.subt(t,i.ltype,o+X)}console.debug("unsupported GPOS table LookupType",e,"format",s.fmt)}return s},r.GPOS.readValueRecord=function(t,e,a){var i=r._bin,n=[];return n.push(1&a?i.readShort(t,e):0),e+=1&a?2:0,n.push(2&a?i.readShort(t,e):0),e+=2&a?2:0,n.push(4&a?i.readShort(t,e):0),e+=4&a?2:0,n.push(8&a?i.readShort(t,e):0),e+=8&a?2:0,n},r.GPOS.readBaseArray=function(t,e,a){var i=r._bin,n=[],o=e,s=i.readUshort(t,e);e+=2;for(var f=0;f<s;f++){for(var c=[],h=0;h<a;h++)c.push(r.GPOS.readAnchorRecord(t,o+i.readUshort(t,e))),e+=2;n.push(c)}return n},r.GPOS.readMarkArray=function(t,e){var a=r._bin,i=[],n=e,o=a.readUshort(t,e);e+=2;for(var s=0;s<o;s++){var f=r.GPOS.readAnchorRecord(t,a.readUshort(t,e+2)+n);f.markClass=a.readUshort(t,e),i.push(f),e+=4}return i},r.GPOS.readAnchorRecord=function(t,e){var a=r._bin,i={};return i.fmt=a.readUshort(t,e),i.x=a.readShort(t,e+2),i.y=a.readShort(t,e+4),i},r.GSUB={},r.GSUB.parse=function(t,e,a,i){return r._lctf.parse(t,e,a,i,r.GSUB.subt)},r.GSUB.subt=function(t,e,a,i){var n=r._bin,o=a,s={};if(s.fmt=n.readUshort(t,a),a+=2,e!=1&&e!=2&&e!=4&&e!=5&&e!=6)return null;if(e==1||e==2||e==4||e==5&&s.fmt<=2||e==6&&s.fmt<=2){var f=n.readUshort(t,a);a+=2,s.coverage=r._lctf.readCoverage(t,o+f)}if(e==1&&s.fmt>=1&&s.fmt<=2){if(s.fmt==1)s.delta=n.readShort(t,a),a+=2;else if(s.fmt==2){var c=n.readUshort(t,a);a+=2,s.newg=n.readUshorts(t,a,c),a+=2*s.newg.length}}else if(e==2&&s.fmt==1){c=n.readUshort(t,a),a+=2,s.seqs=[];for(var h=0;h<c;h++){var v=n.readUshort(t,a)+o;a+=2;var g=n.readUshort(t,v);s.seqs.push(n.readUshorts(t,v+2,g))}}else if(e==4)for(s.vals=[],c=n.readUshort(t,a),a+=2,h=0;h<c;h++){var m=n.readUshort(t,a);a+=2,s.vals.push(r.GSUB.readLigatureSet(t,o+m))}else if(e==5&&s.fmt==2){if(s.fmt==2){var D=n.readUshort(t,a);a+=2,s.cDef=r._lctf.readClassDef(t,o+D),s.scset=[];var _=n.readUshort(t,a);for(a+=2,h=0;h<_;h++){var E=n.readUshort(t,a);a+=2,s.scset.push(E==0?null:r.GSUB.readSubClassSet(t,o+E))}}}else if(e==6&&s.fmt==3){if(s.fmt==3){for(h=0;h<3;h++){c=n.readUshort(t,a),a+=2;for(var y=[],x=0;x<c;x++)y.push(r._lctf.readCoverage(t,o+n.readUshort(t,a+2*x)));a+=2*c,h==0&&(s.backCvg=y),h==1&&(s.inptCvg=y),h==2&&(s.ahedCvg=y)}c=n.readUshort(t,a),a+=2,s.lookupRec=r.GSUB.readSubstLookupRecords(t,a,c)}}else{if(e==7&&s.fmt==1){var A=n.readUshort(t,a);a+=2;var w=n.readUint(t,a);if(a+=4,i.ltype==9)i.ltype=A;else if(i.ltype!=A)throw"invalid extension substitution";return r.GSUB.subt(t,i.ltype,o+w)}console.debug("unsupported GSUB table LookupType",e,"format",s.fmt)}return s},r.GSUB.readSubClassSet=function(t,e){var a=r._bin.readUshort,i=e,n=[],o=a(t,e);e+=2;for(var s=0;s<o;s++){var f=a(t,e);e+=2,n.push(r.GSUB.readSubClassRule(t,i+f))}return n},r.GSUB.readSubClassRule=function(t,e){var a=r._bin.readUshort,i={},n=a(t,e),o=a(t,e+=2);e+=2,i.input=[];for(var s=0;s<n-1;s++)i.input.push(a(t,e)),e+=2;return i.substLookupRecords=r.GSUB.readSubstLookupRecords(t,e,o),i},r.GSUB.readSubstLookupRecords=function(t,e,a){for(var i=r._bin.readUshort,n=[],o=0;o<a;o++)n.push(i(t,e),i(t,e+2)),e+=4;return n},r.GSUB.readChainSubClassSet=function(t,e){var a=r._bin,i=e,n=[],o=a.readUshort(t,e);e+=2;for(var s=0;s<o;s++){var f=a.readUshort(t,e);e+=2,n.push(r.GSUB.readChainSubClassRule(t,i+f))}return n},r.GSUB.readChainSubClassRule=function(t,e){for(var a=r._bin,i={},n=["backtrack","input","lookahead"],o=0;o<n.length;o++){var s=a.readUshort(t,e);e+=2,o==1&&s--,i[n[o]]=a.readUshorts(t,e,s),e+=2*i[n[o]].length}return s=a.readUshort(t,e),e+=2,i.subst=a.readUshorts(t,e,2*s),e+=2*i.subst.length,i},r.GSUB.readLigatureSet=function(t,e){var a=r._bin,i=e,n=[],o=a.readUshort(t,e);e+=2;for(var s=0;s<o;s++){var f=a.readUshort(t,e);e+=2,n.push(r.GSUB.readLigature(t,i+f))}return n},r.GSUB.readLigature=function(t,e){var a=r._bin,i={chain:[]};i.nglyph=a.readUshort(t,e),e+=2;var n=a.readUshort(t,e);e+=2;for(var o=0;o<n-1;o++)i.chain.push(a.readUshort(t,e)),e+=2;return i},r.head={},r.head.parse=function(t,e,a){var i=r._bin,n={};return i.readFixed(t,e),e+=4,n.fontRevision=i.readFixed(t,e),e+=4,i.readUint(t,e),e+=4,i.readUint(t,e),e+=4,n.flags=i.readUshort(t,e),e+=2,n.unitsPerEm=i.readUshort(t,e),e+=2,n.created=i.readUint64(t,e),e+=8,n.modified=i.readUint64(t,e),e+=8,n.xMin=i.readShort(t,e),e+=2,n.yMin=i.readShort(t,e),e+=2,n.xMax=i.readShort(t,e),e+=2,n.yMax=i.readShort(t,e),e+=2,n.macStyle=i.readUshort(t,e),e+=2,n.lowestRecPPEM=i.readUshort(t,e),e+=2,n.fontDirectionHint=i.readShort(t,e),e+=2,n.indexToLocFormat=i.readShort(t,e),e+=2,n.glyphDataFormat=i.readShort(t,e),e+=2,n},r.hhea={},r.hhea.parse=function(t,e,a){var i=r._bin,n={};return i.readFixed(t,e),e+=4,n.ascender=i.readShort(t,e),e+=2,n.descender=i.readShort(t,e),e+=2,n.lineGap=i.readShort(t,e),e+=2,n.advanceWidthMax=i.readUshort(t,e),e+=2,n.minLeftSideBearing=i.readShort(t,e),e+=2,n.minRightSideBearing=i.readShort(t,e),e+=2,n.xMaxExtent=i.readShort(t,e),e+=2,n.caretSlopeRise=i.readShort(t,e),e+=2,n.caretSlopeRun=i.readShort(t,e),e+=2,n.caretOffset=i.readShort(t,e),e+=2,e+=8,n.metricDataFormat=i.readShort(t,e),e+=2,n.numberOfHMetrics=i.readUshort(t,e),e+=2,n},r.hmtx={},r.hmtx.parse=function(t,e,a,i){for(var n=r._bin,o={aWidth:[],lsBearing:[]},s=0,f=0,c=0;c<i.maxp.numGlyphs;c++)c<i.hhea.numberOfHMetrics&&(s=n.readUshort(t,e),e+=2,f=n.readShort(t,e),e+=2),o.aWidth.push(s),o.lsBearing.push(f);return o},r.kern={},r.kern.parse=function(t,e,a,i){var n=r._bin,o=n.readUshort(t,e);if(e+=2,o==1)return r.kern.parseV1(t,e-2,a,i);var s=n.readUshort(t,e);e+=2;for(var f={glyph1:[],rval:[]},c=0;c<s;c++){e+=2,a=n.readUshort(t,e),e+=2;var h=n.readUshort(t,e);e+=2;var v=h>>>8;if((v&=15)!=0)throw"unknown kern table format: "+v;e=r.kern.readFormat0(t,e,f)}return f},r.kern.parseV1=function(t,e,a,i){var n=r._bin;n.readFixed(t,e),e+=4;var o=n.readUint(t,e);e+=4;for(var s={glyph1:[],rval:[]},f=0;f<o;f++){n.readUint(t,e),e+=4;var c=n.readUshort(t,e);e+=2,n.readUshort(t,e),e+=2;var h=c>>>8;if((h&=15)!=0)throw"unknown kern table format: "+h;e=r.kern.readFormat0(t,e,s)}return s},r.kern.readFormat0=function(t,e,a){var i=r._bin,n=-1,o=i.readUshort(t,e);e+=2,i.readUshort(t,e),e+=2,i.readUshort(t,e),e+=2,i.readUshort(t,e),e+=2;for(var s=0;s<o;s++){var f=i.readUshort(t,e);e+=2;var c=i.readUshort(t,e);e+=2;var h=i.readShort(t,e);e+=2,f!=n&&(a.glyph1.push(f),a.rval.push({glyph2:[],vals:[]}));var v=a.rval[a.rval.length-1];v.glyph2.push(c),v.vals.push(h),n=f}return e},r.loca={},r.loca.parse=function(t,e,a,i){var n=r._bin,o=[],s=i.head.indexToLocFormat,f=i.maxp.numGlyphs+1;if(s==0)for(var c=0;c<f;c++)o.push(n.readUshort(t,e+(c<<1))<<1);if(s==1)for(c=0;c<f;c++)o.push(n.readUint(t,e+(c<<2)));return o},r.maxp={},r.maxp.parse=function(t,e,a){var i=r._bin,n={},o=i.readUint(t,e);return e+=4,n.numGlyphs=i.readUshort(t,e),e+=2,o==65536&&(n.maxPoints=i.readUshort(t,e),e+=2,n.maxContours=i.readUshort(t,e),e+=2,n.maxCompositePoints=i.readUshort(t,e),e+=2,n.maxCompositeContours=i.readUshort(t,e),e+=2,n.maxZones=i.readUshort(t,e),e+=2,n.maxTwilightPoints=i.readUshort(t,e),e+=2,n.maxStorage=i.readUshort(t,e),e+=2,n.maxFunctionDefs=i.readUshort(t,e),e+=2,n.maxInstructionDefs=i.readUshort(t,e),e+=2,n.maxStackElements=i.readUshort(t,e),e+=2,n.maxSizeOfInstructions=i.readUshort(t,e),e+=2,n.maxComponentElements=i.readUshort(t,e),e+=2,n.maxComponentDepth=i.readUshort(t,e),e+=2),n},r.name={},r.name.parse=function(t,e,a){var i=r._bin,n={};i.readUshort(t,e),e+=2;var o=i.readUshort(t,e);e+=2,i.readUshort(t,e);for(var s,f=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],c=e+=2,h=0;h<o;h++){var v=i.readUshort(t,e);e+=2;var g=i.readUshort(t,e);e+=2;var m=i.readUshort(t,e);e+=2;var D=i.readUshort(t,e);e+=2;var _=i.readUshort(t,e);e+=2;var E=i.readUshort(t,e);e+=2;var y,x=f[D],A=c+12*o+E;if(v==0)y=i.readUnicode(t,A,_/2);else if(v==3&&g==0)y=i.readUnicode(t,A,_/2);else if(g==0)y=i.readASCII(t,A,_);else if(g==1)y=i.readUnicode(t,A,_/2);else if(g==3)y=i.readUnicode(t,A,_/2);else{if(v!=1)throw"unknown encoding "+g+", platformID: "+v;y=i.readASCII(t,A,_),console.debug("reading unknown MAC encoding "+g+" as ASCII")}var w="p"+v+","+m.toString(16);n[w]==null&&(n[w]={}),n[w][x!==void 0?x:D]=y,n[w]._lang=m}for(var U in n)if(n[U].postScriptName!=null&&n[U]._lang==1033)return n[U];for(var U in n)if(n[U].postScriptName!=null&&n[U]._lang==0)return n[U];for(var U in n)if(n[U].postScriptName!=null&&n[U]._lang==3084)return n[U];for(var U in n)if(n[U].postScriptName!=null)return n[U];for(var U in n){s=U;break}return console.debug("returning name table with languageID "+n[s]._lang),n[s]},r["OS/2"]={},r["OS/2"].parse=function(t,e,a){var i=r._bin.readUshort(t,e);e+=2;var n={};if(i==0)r["OS/2"].version0(t,e,n);else if(i==1)r["OS/2"].version1(t,e,n);else if(i==2||i==3||i==4)r["OS/2"].version2(t,e,n);else{if(i!=5)throw"unknown OS/2 table version: "+i;r["OS/2"].version5(t,e,n)}return n},r["OS/2"].version0=function(t,e,a){var i=r._bin;return a.xAvgCharWidth=i.readShort(t,e),e+=2,a.usWeightClass=i.readUshort(t,e),e+=2,a.usWidthClass=i.readUshort(t,e),e+=2,a.fsType=i.readUshort(t,e),e+=2,a.ySubscriptXSize=i.readShort(t,e),e+=2,a.ySubscriptYSize=i.readShort(t,e),e+=2,a.ySubscriptXOffset=i.readShort(t,e),e+=2,a.ySubscriptYOffset=i.readShort(t,e),e+=2,a.ySuperscriptXSize=i.readShort(t,e),e+=2,a.ySuperscriptYSize=i.readShort(t,e),e+=2,a.ySuperscriptXOffset=i.readShort(t,e),e+=2,a.ySuperscriptYOffset=i.readShort(t,e),e+=2,a.yStrikeoutSize=i.readShort(t,e),e+=2,a.yStrikeoutPosition=i.readShort(t,e),e+=2,a.sFamilyClass=i.readShort(t,e),e+=2,a.panose=i.readBytes(t,e,10),e+=10,a.ulUnicodeRange1=i.readUint(t,e),e+=4,a.ulUnicodeRange2=i.readUint(t,e),e+=4,a.ulUnicodeRange3=i.readUint(t,e),e+=4,a.ulUnicodeRange4=i.readUint(t,e),e+=4,a.achVendID=[i.readInt8(t,e),i.readInt8(t,e+1),i.readInt8(t,e+2),i.readInt8(t,e+3)],e+=4,a.fsSelection=i.readUshort(t,e),e+=2,a.usFirstCharIndex=i.readUshort(t,e),e+=2,a.usLastCharIndex=i.readUshort(t,e),e+=2,a.sTypoAscender=i.readShort(t,e),e+=2,a.sTypoDescender=i.readShort(t,e),e+=2,a.sTypoLineGap=i.readShort(t,e),e+=2,a.usWinAscent=i.readUshort(t,e),e+=2,a.usWinDescent=i.readUshort(t,e),e+=2},r["OS/2"].version1=function(t,e,a){var i=r._bin;return e=r["OS/2"].version0(t,e,a),a.ulCodePageRange1=i.readUint(t,e),e+=4,a.ulCodePageRange2=i.readUint(t,e),e+=4},r["OS/2"].version2=function(t,e,a){var i=r._bin;return e=r["OS/2"].version1(t,e,a),a.sxHeight=i.readShort(t,e),e+=2,a.sCapHeight=i.readShort(t,e),e+=2,a.usDefault=i.readUshort(t,e),e+=2,a.usBreak=i.readUshort(t,e),e+=2,a.usMaxContext=i.readUshort(t,e),e+=2},r["OS/2"].version5=function(t,e,a){var i=r._bin;return e=r["OS/2"].version2(t,e,a),a.usLowerOpticalPointSize=i.readUshort(t,e),e+=2,a.usUpperOpticalPointSize=i.readUshort(t,e),e+=2},r.post={},r.post.parse=function(t,e,a){var i=r._bin,n={};return n.version=i.readFixed(t,e),e+=4,n.italicAngle=i.readFixed(t,e),e+=4,n.underlinePosition=i.readShort(t,e),e+=2,n.underlineThickness=i.readShort(t,e),e+=2,n},r==null&&(r={}),r.U==null&&(r.U={}),r.U.codeToGlyph=function(t,e){var a=t.cmap,i=-1;if(a.p0e4!=null?i=a.p0e4:a.p3e1!=null?i=a.p3e1:a.p1e0!=null?i=a.p1e0:a.p0e3!=null&&(i=a.p0e3),i==-1)throw"no familiar platform and encoding!";var n=a.tables[i];if(n.format==0)return e>=n.map.length?0:n.map[e];if(n.format==4){for(var o=-1,s=0;s<n.endCount.length;s++)if(e<=n.endCount[s]){o=s;break}return o==-1||n.startCount[o]>e?0:65535&(n.idRangeOffset[o]!=0?n.glyphIdArray[e-n.startCount[o]+(n.idRangeOffset[o]>>1)-(n.idRangeOffset.length-o)]:e+n.idDelta[o])}if(n.format==12){if(e>n.groups[n.groups.length-1][1])return 0;for(s=0;s<n.groups.length;s++){var f=n.groups[s];if(f[0]<=e&&e<=f[1])return f[2]+(e-f[0])}return 0}throw"unknown cmap table format "+n.format},r.U.glyphToPath=function(t,e){var a={cmds:[],crds:[]};if(t.SVG&&t.SVG.entries[e]){var i=t.SVG.entries[e];return i==null?a:(typeof i=="string"&&(i=r.SVG.toPath(i),t.SVG.entries[e]=i),i)}if(t.CFF){var n={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:t.CFF.Private?t.CFF.Private.defaultWidthX:0,open:!1},o=t.CFF,s=t.CFF.Private;if(o.ROS){for(var f=0;o.FDSelect[f+2]<=e;)f+=2;s=o.FDArray[o.FDSelect[f+1]].Private}r.U._drawCFF(t.CFF.CharStrings[e],n,o,s,a)}else t.glyf&&r.U._drawGlyf(e,t,a);return a},r.U._drawGlyf=function(t,e,a){var i=e.glyf[t];i==null&&(i=e.glyf[t]=r.glyf._parseGlyf(e,t)),i!=null&&(i.noc>-1?r.U._simpleGlyph(i,a):r.U._compoGlyph(i,e,a))},r.U._simpleGlyph=function(t,e){for(var a=0;a<t.noc;a++){for(var i=a==0?0:t.endPts[a-1]+1,n=t.endPts[a],o=i;o<=n;o++){var s=o==i?n:o-1,f=o==n?i:o+1,c=1&t.flags[o],h=1&t.flags[s],v=1&t.flags[f],g=t.xs[o],m=t.ys[o];if(o==i)if(c){if(!h){r.U.P.moveTo(e,g,m);continue}r.U.P.moveTo(e,t.xs[s],t.ys[s])}else h?r.U.P.moveTo(e,t.xs[s],t.ys[s]):r.U.P.moveTo(e,(t.xs[s]+g)/2,(t.ys[s]+m)/2);c?h&&r.U.P.lineTo(e,g,m):v?r.U.P.qcurveTo(e,g,m,t.xs[f],t.ys[f]):r.U.P.qcurveTo(e,g,m,(g+t.xs[f])/2,(m+t.ys[f])/2)}r.U.P.closePath(e)}},r.U._compoGlyph=function(t,e,a){for(var i=0;i<t.parts.length;i++){var n={cmds:[],crds:[]},o=t.parts[i];r.U._drawGlyf(o.glyphIndex,e,n);for(var s=o.m,f=0;f<n.crds.length;f+=2){var c=n.crds[f],h=n.crds[f+1];a.crds.push(c*s.a+h*s.b+s.tx),a.crds.push(c*s.c+h*s.d+s.ty)}for(f=0;f<n.cmds.length;f++)a.cmds.push(n.cmds[f])}},r.U._getGlyphClass=function(t,e){var a=r._lctf.getInterval(e,t);return a==-1?0:e[a+2]},r.U._applySubs=function(t,e,a,i){for(var n=t.length-e-1,o=0;o<a.tabs.length;o++)if(a.tabs[o]!=null){var s,f=a.tabs[o];if(!f.coverage||(s=r._lctf.coverageIndex(f.coverage,t[e]))!=-1){if(a.ltype==1)t[e],f.fmt==1?t[e]=t[e]+f.delta:t[e]=f.newg[s];else if(a.ltype==4)for(var c=f.vals[s],h=0;h<c.length;h++){var v=c[h],g=v.chain.length;if(!(g>n)){for(var m=!0,D=0,_=0;_<g;_++){for(;t[e+D+(1+_)]==-1;)D++;v.chain[_]!=t[e+D+(1+_)]&&(m=!1)}if(m){for(t[e]=v.nglyph,_=0;_<g+D;_++)t[e+_+1]=-1;break}}}else if(a.ltype==5&&f.fmt==2)for(var E=r._lctf.getInterval(f.cDef,t[e]),y=f.cDef[E+2],x=f.scset[y],A=0;A<x.length;A++){var w=x[A],U=w.input;if(!(U.length>n)){for(m=!0,_=0;_<U.length;_++){var B=r._lctf.getInterval(f.cDef,t[e+1+_]);if(E==-1&&f.cDef[B+2]!=U[_]){m=!1;break}}if(m){var P=w.substLookupRecords;for(h=0;h<P.length;h+=2)P[h],P[h+1]}}}else if(a.ltype==6&&f.fmt==3){if(!r.U._glsCovered(t,f.backCvg,e-f.backCvg.length)||!r.U._glsCovered(t,f.inptCvg,e)||!r.U._glsCovered(t,f.ahedCvg,e+f.inptCvg.length))continue;var Y=f.lookupRec;for(A=0;A<Y.length;A+=2){E=Y[A];var b=i[Y[A+1]];r.U._applySubs(t,e+E,b,i)}}}}},r.U._glsCovered=function(t,e,a){for(var i=0;i<e.length;i++)if(r._lctf.coverageIndex(e[i],t[a+i])==-1)return!1;return!0},r.U.glyphsToPath=function(t,e,a){for(var i={cmds:[],crds:[]},n=0,o=0;o<e.length;o++){var s=e[o];if(s!=-1){for(var f=o<e.length-1&&e[o+1]!=-1?e[o+1]:0,c=r.U.glyphToPath(t,s),h=0;h<c.crds.length;h+=2)i.crds.push(c.crds[h]+n),i.crds.push(c.crds[h+1]);for(a&&i.cmds.push(a),h=0;h<c.cmds.length;h++)i.cmds.push(c.cmds[h]);a&&i.cmds.push("X"),n+=t.hmtx.aWidth[s],o<e.length-1&&(n+=r.U.getPairAdjustment(t,s,f))}}return i},r.U.P={},r.U.P.moveTo=function(t,e,a){t.cmds.push("M"),t.crds.push(e,a)},r.U.P.lineTo=function(t,e,a){t.cmds.push("L"),t.crds.push(e,a)},r.U.P.curveTo=function(t,e,a,i,n,o,s){t.cmds.push("C"),t.crds.push(e,a,i,n,o,s)},r.U.P.qcurveTo=function(t,e,a,i,n){t.cmds.push("Q"),t.crds.push(e,a,i,n)},r.U.P.closePath=function(t){t.cmds.push("Z")},r.U._drawCFF=function(t,e,a,i,n){for(var o=e.stack,s=e.nStems,f=e.haveWidth,c=e.width,h=e.open,v=0,g=e.x,m=e.y,D=0,_=0,E=0,y=0,x=0,A=0,w=0,U=0,B=0,P=0,Y={val:0,size:0};v<t.length;){r.CFF.getCharString(t,v,Y);var b=Y.val;if(v+=Y.size,b=="o1"||b=="o18")o.length%2!=0&&!f&&(c=o.shift()+i.nominalWidthX),s+=o.length>>1,o.length=0,f=!0;else if(b=="o3"||b=="o23")o.length%2!=0&&!f&&(c=o.shift()+i.nominalWidthX),s+=o.length>>1,o.length=0,f=!0;else if(b=="o4")o.length>1&&!f&&(c=o.shift()+i.nominalWidthX,f=!0),h&&r.U.P.closePath(n),m+=o.pop(),r.U.P.moveTo(n,g,m),h=!0;else if(b=="o5")for(;o.length>0;)g+=o.shift(),m+=o.shift(),r.U.P.lineTo(n,g,m);else if(b=="o6"||b=="o7")for(var M=o.length,C=b=="o6",X=0;X<M;X++){var z=o.shift();C?g+=z:m+=z,C=!C,r.U.P.lineTo(n,g,m)}else if(b=="o8"||b=="o24"){M=o.length;for(var q=0;q+6<=M;)D=g+o.shift(),_=m+o.shift(),E=D+o.shift(),y=_+o.shift(),g=E+o.shift(),m=y+o.shift(),r.U.P.curveTo(n,D,_,E,y,g,m),q+=6;b=="o24"&&(g+=o.shift(),m+=o.shift(),r.U.P.lineTo(n,g,m))}else{if(b=="o11")break;if(b=="o1234"||b=="o1235"||b=="o1236"||b=="o1237")b=="o1234"&&(_=m,E=(D=g+o.shift())+o.shift(),P=y=_+o.shift(),A=y,U=m,g=(w=(x=(B=E+o.shift())+o.shift())+o.shift())+o.shift(),r.U.P.curveTo(n,D,_,E,y,B,P),r.U.P.curveTo(n,x,A,w,U,g,m)),b=="o1235"&&(D=g+o.shift(),_=m+o.shift(),E=D+o.shift(),y=_+o.shift(),B=E+o.shift(),P=y+o.shift(),x=B+o.shift(),A=P+o.shift(),w=x+o.shift(),U=A+o.shift(),g=w+o.shift(),m=U+o.shift(),o.shift(),r.U.P.curveTo(n,D,_,E,y,B,P),r.U.P.curveTo(n,x,A,w,U,g,m)),b=="o1236"&&(D=g+o.shift(),_=m+o.shift(),E=D+o.shift(),P=y=_+o.shift(),A=y,w=(x=(B=E+o.shift())+o.shift())+o.shift(),U=A+o.shift(),g=w+o.shift(),r.U.P.curveTo(n,D,_,E,y,B,P),r.U.P.curveTo(n,x,A,w,U,g,m)),b=="o1237"&&(D=g+o.shift(),_=m+o.shift(),E=D+o.shift(),y=_+o.shift(),B=E+o.shift(),P=y+o.shift(),x=B+o.shift(),A=P+o.shift(),w=x+o.shift(),U=A+o.shift(),Math.abs(w-g)>Math.abs(U-m)?g=w+o.shift():m=U+o.shift(),r.U.P.curveTo(n,D,_,E,y,B,P),r.U.P.curveTo(n,x,A,w,U,g,m));else if(b=="o14"){if(o.length>0&&!f&&(c=o.shift()+a.nominalWidthX,f=!0),o.length==4){var ne=o.shift(),I=o.shift(),R=o.shift(),p=o.shift(),S=r.CFF.glyphBySE(a,R),T=r.CFF.glyphBySE(a,p);r.U._drawCFF(a.CharStrings[S],e,a,i,n),e.x=ne,e.y=I,r.U._drawCFF(a.CharStrings[T],e,a,i,n)}h&&(r.U.P.closePath(n),h=!1)}else if(b=="o19"||b=="o20")o.length%2!=0&&!f&&(c=o.shift()+i.nominalWidthX),s+=o.length>>1,o.length=0,f=!0,v+=s+7>>3;else if(b=="o21")o.length>2&&!f&&(c=o.shift()+i.nominalWidthX,f=!0),m+=o.pop(),g+=o.pop(),h&&r.U.P.closePath(n),r.U.P.moveTo(n,g,m),h=!0;else if(b=="o22")o.length>1&&!f&&(c=o.shift()+i.nominalWidthX,f=!0),g+=o.pop(),h&&r.U.P.closePath(n),r.U.P.moveTo(n,g,m),h=!0;else if(b=="o25"){for(;o.length>6;)g+=o.shift(),m+=o.shift(),r.U.P.lineTo(n,g,m);D=g+o.shift(),_=m+o.shift(),E=D+o.shift(),y=_+o.shift(),g=E+o.shift(),m=y+o.shift(),r.U.P.curveTo(n,D,_,E,y,g,m)}else if(b=="o26")for(o.length%2&&(g+=o.shift());o.length>0;)D=g,_=m+o.shift(),g=E=D+o.shift(),m=(y=_+o.shift())+o.shift(),r.U.P.curveTo(n,D,_,E,y,g,m);else if(b=="o27")for(o.length%2&&(m+=o.shift());o.length>0;)_=m,E=(D=g+o.shift())+o.shift(),y=_+o.shift(),g=E+o.shift(),m=y,r.U.P.curveTo(n,D,_,E,y,g,m);else if(b=="o10"||b=="o29"){var F=b=="o10"?i:a;if(o.length==0)console.debug("error: empty stack");else{var k=o.pop(),N=F.Subrs[k+F.Bias];e.x=g,e.y=m,e.nStems=s,e.haveWidth=f,e.width=c,e.open=h,r.U._drawCFF(N,e,a,i,n),g=e.x,m=e.y,s=e.nStems,f=e.haveWidth,c=e.width,h=e.open}}else if(b=="o30"||b=="o31"){var L=o.length,j=(q=0,b=="o31");for(q+=L-(M=-3&L);q<M;)j?(_=m,E=(D=g+o.shift())+o.shift(),m=(y=_+o.shift())+o.shift(),M-q==5?(g=E+o.shift(),q++):g=E,j=!1):(D=g,_=m+o.shift(),E=D+o.shift(),y=_+o.shift(),g=E+o.shift(),M-q==5?(m=y+o.shift(),q++):m=y,j=!0),r.U.P.curveTo(n,D,_,E,y,g,m),q+=4}else{if((b+"").charAt(0)=="o")throw console.debug("Unknown operation: "+b,t),b;o.push(b)}}}e.x=g,e.y=m,e.nStems=s,e.haveWidth=f,e.width=c,e.open=h};var d=r,u={Typr:d};return l.Typr=d,l.default=u,Object.defineProperty(l,"__esModule",{value:!0}),l}({}).Typr}/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/function no(){return function(l){var r=Uint8Array,d=Uint16Array,u=Uint32Array,t=new r([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),e=new r([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),a=new r([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),i=function(b,M){for(var C=new d(31),X=0;X<31;++X)C[X]=M+=1<<b[X-1];var z=new u(C[30]);for(X=1;X<30;++X)for(var q=C[X];q<C[X+1];++q)z[q]=q-C[X]<<5|X;return[C,z]},n=i(t,2),o=n[0],s=n[1];o[28]=258,s[258]=28;for(var f=i(e,0)[0],c=new d(32768),h=0;h<32768;++h){var v=(43690&h)>>>1|(21845&h)<<1;v=(61680&(v=(52428&v)>>>2|(13107&v)<<2))>>>4|(3855&v)<<4,c[h]=((65280&v)>>>8|(255&v)<<8)>>>1}var g=function(b,M,C){for(var X=b.length,z=0,q=new d(M);z<X;++z)++q[b[z]-1];var ne,I=new d(M);for(z=0;z<M;++z)I[z]=I[z-1]+q[z-1]<<1;{ne=new d(1<<M);var R=15-M;for(z=0;z<X;++z)if(b[z])for(var p=z<<4|b[z],S=M-b[z],T=I[b[z]-1]++<<S,F=T|(1<<S)-1;T<=F;++T)ne[c[T]>>>R]=p}return ne},m=new r(288);for(h=0;h<144;++h)m[h]=8;for(h=144;h<256;++h)m[h]=9;for(h=256;h<280;++h)m[h]=7;for(h=280;h<288;++h)m[h]=8;var D=new r(32);for(h=0;h<32;++h)D[h]=5;var _=g(m,9),E=g(D,5),y=function(b){for(var M=b[0],C=1;C<b.length;++C)b[C]>M&&(M=b[C]);return M},x=function(b,M,C){var X=M/8|0;return(b[X]|b[X+1]<<8)>>(7&M)&C},A=function(b,M){var C=M/8|0;return(b[C]|b[C+1]<<8|b[C+2]<<16)>>(7&M)},w=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],U=function(b,M,C){var X=new Error(M||w[b]);if(X.code=b,Error.captureStackTrace&&Error.captureStackTrace(X,U),!C)throw X;return X},B=function(b,M,C){var X=b.length;if(!X||C&&!C.l&&X<5)return M||new r(0);var z=!M||C,q=!C||C.i;C||(C={}),M||(M=new r(3*X));var ne,I=function(fe){var De=M.length;if(fe>De){var Ee=new r(Math.max(2*De,fe));Ee.set(M),M=Ee}},R=C.f||0,p=C.p||0,S=C.b||0,T=C.l,F=C.d,k=C.m,N=C.n,L=8*X;do{if(!T){C.f=R=x(b,p,1);var j=x(b,p+1,3);if(p+=3,!j){var K=b[($=((ne=p)/8|0)+(7&ne&&1)+4)-4]|b[$-3]<<8,ee=$+K;if(ee>X){q&&U(0);break}z&&I(S+K),M.set(b.subarray($,ee),S),C.b=S+=K,C.p=p=8*ee;continue}if(j==1)T=_,F=E,k=9,N=5;else if(j==2){var H=x(b,p,31)+257,W=x(b,p+10,15)+4,ge=H+x(b,p+5,31)+1;p+=14;for(var ue=new r(ge),Q=new r(19),te=0;te<W;++te)Q[a[te]]=x(b,p+3*te,7);p+=3*W;var le=y(Q),V=(1<<le)-1,re=g(Q,le);for(te=0;te<ge;){var $,G=re[x(b,p,V)];if(p+=15&G,($=G>>>4)<16)ue[te++]=$;else{var he=0,Z=0;for($==16?(Z=3+x(b,p,3),p+=2,he=ue[te-1]):$==17?(Z=3+x(b,p,7),p+=3):$==18&&(Z=11+x(b,p,127),p+=7);Z--;)ue[te++]=he}}var oe=ue.subarray(0,H),J=ue.subarray(H);k=y(oe),N=y(J),T=g(oe,k),F=g(J,N)}else U(1);if(p>L){q&&U(0);break}}z&&I(S+131072);for(var Se=(1<<k)-1,ae=(1<<N)-1,ie=p;;ie=p){var ce=(he=T[A(b,p)&Se])>>>4;if((p+=15&he)>L){q&&U(0);break}if(he||U(2),ce<256)M[S++]=ce;else{if(ce==256){ie=p,T=null;break}var ve=ce-254;if(ce>264){var Ue=t[te=ce-257];ve=x(b,p,(1<<Ue)-1)+o[te],p+=Ue}var Fe=F[A(b,p)&ae],ye=Fe>>>4;if(Fe||U(3),p+=15&Fe,J=f[ye],ye>3&&(Ue=e[ye],J+=A(b,p)&(1<<Ue)-1,p+=Ue),p>L){q&&U(0);break}z&&I(S+131072);for(var be=S+ve;S<be;S+=4)M[S]=M[S-J],M[S+1]=M[S+1-J],M[S+2]=M[S+2-J],M[S+3]=M[S+3-J];S=be}}C.l=T,C.p=ie,C.b=S,T&&(R=1,C.m=k,C.d=F,C.n=N)}while(!R);return S==M.length?M:function(fe,De,Ee){(Ee==null||Ee>fe.length)&&(Ee=fe.length);var Ie=new(fe instanceof d?d:fe instanceof u?u:r)(Ee-De);return Ie.set(fe.subarray(De,Ee)),Ie}(M,0,S)},P=new r(0),Y=typeof TextDecoder<"u"&&new TextDecoder;try{Y.decode(P,{stream:!0})}catch{}return l.convert_streams=function(b){var M=new DataView(b),C=0;function X(){var H=M.getUint16(C);return C+=2,H}function z(){var H=M.getUint32(C);return C+=4,H}function q(H){K.setUint16(ee,H),ee+=2}function ne(H){K.setUint32(ee,H),ee+=4}for(var I={signature:z(),flavor:z(),length:z(),numTables:X(),reserved:X(),totalSfntSize:z(),majorVersion:X(),minorVersion:X(),metaOffset:z(),metaLength:z(),metaOrigLength:z(),privOffset:z(),privLength:z()},R=0;Math.pow(2,R)<=I.numTables;)R++;R--;for(var p=16*Math.pow(2,R),S=16*I.numTables-p,T=12,F=[],k=0;k<I.numTables;k++)F.push({tag:z(),offset:z(),compLength:z(),origLength:z(),origChecksum:z()}),T+=16;var N,L=new Uint8Array(12+16*F.length+F.reduce(function(H,W){return H+W.origLength+4},0)),j=L.buffer,K=new DataView(j),ee=0;return ne(I.flavor),q(I.numTables),q(p),q(R),q(S),F.forEach(function(H){ne(H.tag),ne(H.origChecksum),ne(T),ne(H.origLength),H.outOffset=T,(T+=H.origLength)%4!=0&&(T+=4-T%4)}),F.forEach(function(H){var W,ge=b.slice(H.offset,H.offset+H.compLength);if(H.compLength!=H.origLength){var ue=new Uint8Array(H.origLength);W=new Uint8Array(ge,2),B(W,ue)}else ue=new Uint8Array(ge);L.set(ue,H.outOffset);var Q=0;(T=H.outOffset+H.origLength)%4!=0&&(Q=4-T%4),L.set(new Uint8Array(Q).buffer,H.outOffset+H.origLength),N=T+Q}),j.slice(0,N)},Object.defineProperty(l,"__esModule",{value:!0}),l}({}).convert_streams}function ao(l,r){const d={M:2,L:2,Q:4,C:6,Z:0},u={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},t=1,e=2,a=4,i=8,n=16,o=32;let s;function f(w){if(!s){const U={R:e,L:t,D:a,C:n,U:o,T:i};s=new Map;for(let B in u){let P=0;u[B].split(",").forEach(Y=>{let[b,M]=Y.split("+");b=parseInt(b,36),M=M?parseInt(M,36):0,s.set(P+=b,U[B]);for(let C=M;C--;)s.set(++P,U[B])})}}return s.get(w)||o}const c=1,h=2,v=3,g=4,m=[null,"isol","init","fina","medi"];function D(w){const U=new Uint8Array(w.length);let B=o,P=c,Y=-1;for(let b=0;b<w.length;b++){const M=w.codePointAt(b);let C=f(M)|0,X=c;C&i||(B&(t|a|n)?C&(e|a|n)?(X=v,(P===c||P===v)&&U[Y]++):C&(t|o)&&(P===h||P===g)&&U[Y]--:B&(e|o)&&(P===h||P===g)&&U[Y]--,P=U[b]=X,B=C,Y=b,M>65535&&b++)}return U}function _(w,U){const B=[];for(let Y=0;Y<U.length;Y++){const b=U.codePointAt(Y);b>65535&&Y++,B.push(l.U.codeToGlyph(w,b))}const P=w.GSUB;if(P){const{lookupList:Y,featureList:b}=P;let M;const C=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,X=[];b.forEach(z=>{if(C.test(z.tag))for(let q=0;q<z.tab.length;q++){if(X[z.tab[q]])continue;X[z.tab[q]]=!0;const ne=Y[z.tab[q]],I=/^(isol|init|fina|medi)$/.test(z.tag);I&&!M&&(M=D(U));for(let R=0;R<B.length;R++)(!M||!I||m[M[R]]===z.tag)&&l.U._applySubs(B,R,ne,Y)}})}return B}function E(w,U){const B=new Int16Array(U.length*3);let P=0;for(;P<U.length;P++){const C=U[P];if(C===-1)continue;B[P*3+2]=w.hmtx.aWidth[C];const X=w.GPOS;if(X){const z=X.lookupList;for(let q=0;q<z.length;q++){const ne=z[q];for(let I=0;I<ne.tabs.length;I++){const R=ne.tabs[I];if(ne.ltype===1){if(l._lctf.coverageIndex(R.coverage,C)!==-1&&R.pos){M(R.pos,P);break}}else if(ne.ltype===2){let p=null,S=Y();if(S!==-1){const T=l._lctf.coverageIndex(R.coverage,U[S]);if(T!==-1){if(R.fmt===1){const F=R.pairsets[T];for(let k=0;k<F.length;k++)F[k].gid2===C&&(p=F[k])}else if(R.fmt===2){const F=l.U._getGlyphClass(U[S],R.classDef1),k=l.U._getGlyphClass(C,R.classDef2);p=R.matrix[F][k]}if(p){p.val1&&M(p.val1,S),p.val2&&M(p.val2,P);break}}}}else if(ne.ltype===4){const p=l._lctf.coverageIndex(R.markCoverage,C);if(p!==-1){const S=Y(b),T=S===-1?-1:l._lctf.coverageIndex(R.baseCoverage,U[S]);if(T!==-1){const F=R.markArray[p],k=R.baseArray[T][F.markClass];B[P*3]=k.x-F.x+B[S*3]-B[S*3+2],B[P*3+1]=k.y-F.y+B[S*3+1];break}}}else if(ne.ltype===6){const p=l._lctf.coverageIndex(R.mark1Coverage,C);if(p!==-1){const S=Y();if(S!==-1){const T=U[S];if(y(w,T)===3){const F=l._lctf.coverageIndex(R.mark2Coverage,T);if(F!==-1){const k=R.mark1Array[p],N=R.mark2Array[F][k.markClass];B[P*3]=N.x-k.x+B[S*3]-B[S*3+2],B[P*3+1]=N.y-k.y+B[S*3+1];break}}}}}}}}else if(w.kern&&!w.cff){const z=Y();if(z!==-1){const q=w.kern.glyph1.indexOf(U[z]);if(q!==-1){const ne=w.kern.rval[q].glyph2.indexOf(C);ne!==-1&&(B[z*3+2]+=w.kern.rval[q].vals[ne])}}}}return B;function Y(C){for(let X=P-1;X>=0;X--)if(U[X]!==-1&&(!C||C(U[X])))return X;return-1}function b(C){return y(w,C)===1}function M(C,X){for(let z=0;z<3;z++)B[X*3+z]+=C[z]||0}}function y(w,U){const B=w.GDEF&&w.GDEF.glyphClassDef;return B?l.U._getGlyphClass(U,B):0}function x(...w){for(let U=0;U<w.length;U++)if(typeof w[U]=="number")return w[U]}function A(w){const U=Object.create(null),B=w["OS/2"],P=w.hhea,Y=w.head.unitsPerEm,b=x(B&&B.sTypoAscender,P&&P.ascender,Y),M={unitsPerEm:Y,ascender:b,descender:x(B&&B.sTypoDescender,P&&P.descender,0),capHeight:x(B&&B.sCapHeight,b),xHeight:x(B&&B.sxHeight,b),lineGap:x(B&&B.sTypoLineGap,P&&P.lineGap),supportsCodePoint(C){return l.U.codeToGlyph(w,C)>0},forEachGlyph(C,X,z,q){let ne=0;const I=1/M.unitsPerEm*X,R=_(w,C);let p=0;const S=E(w,R);return R.forEach((T,F)=>{if(T!==-1){let k=U[T];if(!k){const{cmds:N,crds:L}=l.U.glyphToPath(w,T);let j="",K=0;for(let ue=0,Q=N.length;ue<Q;ue++){const te=d[N[ue]];j+=N[ue];for(let le=1;le<=te;le++)j+=(le>1?",":"")+L[K++]}let ee,H,W,ge;if(L.length){ee=H=1/0,W=ge=-1/0;for(let ue=0,Q=L.length;ue<Q;ue+=2){let te=L[ue],le=L[ue+1];te<ee&&(ee=te),le<H&&(H=le),te>W&&(W=te),le>ge&&(ge=le)}}else ee=W=H=ge=0;k=U[T]={index:T,advanceWidth:w.hmtx.aWidth[T],xMin:ee,yMin:H,xMax:W,yMax:ge,path:j}}q.call(null,k,ne+S[F*3]*I,S[F*3+1]*I,p),ne+=S[F*3+2]*I,z&&(ne+=z*X)}p+=C.codePointAt(p)>65535?2:1}),ne}};return M}return function(U){const B=new Uint8Array(U,0,4),P=l._bin.readASCII(B,0,4);if(P==="wOFF")U=r(U);else if(P==="wOF2")throw new Error("woff2 fonts not supported");return A(l.parse(U)[0])}}const oo=pt({name:"Typr Font Parser",dependencies:[ro,no,ao],init(l,r,d){const u=l(),t=r();return d(u,t)}});/*!
Custom bundle of @unicode-font-resolver/client v1.0.2 (https://github.com/lojjic/unicode-font-resolver)
for use in Troika text rendering. 
Original MIT license applies
*/function io(){return function(l){var r=function(){this.buckets=new Map};r.prototype.add=function(E){var y=E>>5;this.buckets.set(y,(this.buckets.get(y)||0)|1<<(31&E))},r.prototype.has=function(E){var y=this.buckets.get(E>>5);return y!==void 0&&(y&1<<(31&E))!=0},r.prototype.serialize=function(){var E=[];return this.buckets.forEach(function(y,x){E.push((+x).toString(36)+":"+y.toString(36))}),E.join(",")},r.prototype.deserialize=function(E){var y=this;this.buckets.clear(),E.split(",").forEach(function(x){var A=x.split(":");y.buckets.set(parseInt(A[0],36),parseInt(A[1],36))})};var d=Math.pow(2,8),u=d-1,t=~u;function e(E){var y=function(A){return A&t}(E).toString(16),x=function(A){return(A&t)+d-1}(E).toString(16);return"codepoint-index/plane"+(E>>16)+"/"+y+"-"+x+".json"}function a(E,y){var x=E&u,A=y.codePointAt(x/6|0);return((A=(A||48)-48)&1<<x%6)!=0}function i(E,y){var x;(x=E,x.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map(function(A){return A.split("-").map(function(w){return parseInt(w.trim(),16)})})).forEach(function(A){var w=A[0],U=A[1];U===void 0&&(U=w),y(w,U)})}function n(E,y){i(E,function(x,A){for(var w=x;w<=A;w++)y(w)})}var o={},s={},f=new WeakMap,c="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function h(E){var y=f.get(E);return y||(y=new r,n(E.ranges,function(x){return y.add(x)}),f.set(E,y)),y}var v,g=new Map;function m(E,y,x){return E[y]?y:E[x]?x:function(A){for(var w in A)return w}(E)}function D(E,y){var x=y;if(!E.includes(x)){x=1/0;for(var A=0;A<E.length;A++)Math.abs(E[A]-y)<Math.abs(x-y)&&(x=E[A])}return x}function _(E){return v||(v=new Set,n("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",function(y){v.add(y)})),v.has(E)}return l.CodePointSet=r,l.clearCache=function(){o={},s={}},l.getFontsForString=function(E,y){y===void 0&&(y={});var x,A=y.lang;A===void 0&&(A=new RegExp("\\p{Script=Hangul}","u").test(x=E)?"ko":new RegExp("\\p{Script=Hiragana}|\\p{Script=Katakana}","u").test(x)?"ja":"en");var w=y.category;w===void 0&&(w="sans-serif");var U=y.style;U===void 0&&(U="normal");var B=y.weight;B===void 0&&(B=400);var P=(y.dataUrl||c).replace(/\/$/g,""),Y=new Map,b=new Uint8Array(E.length),M={},C={},X=new Array(E.length),z=new Map,q=!1;function ne(p){var S=g.get(p);return S||(S=fetch(P+"/"+p).then(function(T){if(!T.ok)throw new Error(T.statusText);return T.json().then(function(F){if(!Array.isArray(F)||F[0]!==1)throw new Error("Incorrect schema version; need 1, got "+F[0]);return F[1]})}).catch(function(T){if(P!==c)return q||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+P+'", trying default CDN. '+T.message),q=!0),P=c,g.delete(p),ne(p);throw T}),g.set(p,S)),S}for(var I=function(p){var S=E.codePointAt(p),T=e(S);X[p]=T,o[T]||z.has(T)||z.set(T,ne(T).then(function(F){o[T]=F})),S>65535&&(p++,R=p)},R=0;R<E.length;R++)I(R);return Promise.all(z.values()).then(function(){z.clear();for(var p=function(T){var F=E.codePointAt(T),k=null,N=o[X[T]],L=void 0;for(var j in N){var K=C[j];if(K===void 0&&(K=C[j]=new RegExp(j).test(A||"en")),K){for(var ee in L=j,N[j])if(a(F,N[j][ee])){k=ee;break}break}}if(!k){e:for(var H in N)if(H!==L){for(var W in N[H])if(a(F,N[H][W])){k=W;break e}}}k||(console.debug("No font coverage for U+"+F.toString(16)),k="latin"),X[T]=k,s[k]||z.has(k)||z.set(k,ne("font-meta/"+k+".json").then(function(ge){s[k]=ge})),F>65535&&(T++,S=T)},S=0;S<E.length;S++)p(S);return Promise.all(z.values())}).then(function(){for(var p,S=null,T=0;T<E.length;T++){var F=E.codePointAt(T);if(S&&(_(F)||h(S).has(F)))b[T]=b[T-1];else{S=s[X[T]];var k=M[S.id];if(!k){var N=S.typeforms,L=m(N,w,"sans-serif"),j=m(N[L],U,"normal"),K=D((p=N[L])===null||p===void 0?void 0:p[j],B);k=M[S.id]=P+"/font-files/"+S.id+"/"+L+"."+j+"."+K+".woff"}var ee=Y.get(k);ee==null&&(ee=Y.size,Y.set(k,ee)),b[T]=ee}F>65535&&(T++,b[T]=b[T-1])}return{fontUrls:Array.from(Y.keys()),chars:b}})},Object.defineProperty(l,"__esModule",{value:!0}),l}({})}function so(l,r){const d=Object.create(null),u=Object.create(null);function t(a,i){const n=o=>{console.error(`Failure loading font ${a}`,o)};try{const o=new XMLHttpRequest;o.open("get",a,!0),o.responseType="arraybuffer",o.onload=function(){if(o.status>=400)n(new Error(o.statusText));else if(o.status>0)try{const s=l(o.response);s.src=a,i(s)}catch(s){n(s)}},o.onerror=n,o.send()}catch(o){n(o)}}function e(a,i){let n=d[a];n?i(n):u[a]?u[a].push(i):(u[a]=[i],t(a,o=>{o.src=a,d[a]=o,u[a].forEach(s=>s(o)),delete u[a]}))}return function(a,i,{lang:n,fonts:o=[],style:s="normal",weight:f="normal",unicodeFontsURL:c}={}){const h=new Uint8Array(a.length),v=[];a.length||_();const g=new Map,m=[];if(s!=="italic"&&(s="normal"),typeof f!="number"&&(f=f==="bold"?700:400),o&&!Array.isArray(o)&&(o=[o]),o=o.slice().filter(y=>!y.lang||y.lang.test(n)).reverse(),o.length){let w=0;(function U(B=0){for(let P=B,Y=a.length;P<Y;P++){const b=a.codePointAt(P);if(w===1&&v[h[P-1]].supportsCodePoint(b)||P>0&&/\s/.test(a[P]))h[P]=h[P-1],w===2&&(m[m.length-1][1]=P);else for(let M=h[P],C=o.length;M<=C;M++)if(M===C){const X=w===2?m[m.length-1]:m[m.length]=[P,P];X[1]=P,w=2}else{h[P]=M;const{src:X,unicodeRange:z}=o[M];if(!z||E(b,z)){const q=d[X];if(!q){e(X,()=>{U(P)});return}if(q.supportsCodePoint(b)){let ne=g.get(q);typeof ne!="number"&&(ne=v.length,v.push(q),g.set(q,ne)),h[P]=ne,w=1;break}}}b>65535&&P+1<Y&&(h[P+1]=h[P],P++,w===2&&(m[m.length-1][1]=P))}D()})()}else m.push([0,a.length-1]),D();function D(){if(m.length){const y=m.map(x=>a.substring(x[0],x[1]+1)).join(`
`);r.getFontsForString(y,{lang:n||void 0,style:s,weight:f,dataUrl:c}).then(({fontUrls:x,chars:A})=>{const w=v.length;let U=0;m.forEach(P=>{for(let Y=0,b=P[1]-P[0];Y<=b;Y++)h[P[0]+Y]=A[U++]+w;U++});let B=0;x.forEach((P,Y)=>{e(P,b=>{v[Y+w]=b,++B===x.length&&_()})})})}else _()}function _(){i({chars:h,fonts:v})}function E(y,x){for(let A=0;A<x.length;A++){const[w,U=w]=x[A];if(w<=y&&y<=U)return!0}return!1}}}const lo=pt({name:"FontResolver",dependencies:[so,oo,io],init(l,r,d){return l(r,d())}});function fo(l,r){const u=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,t="[^\\S\\u00A0]",e=new RegExp(`${t}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function a({text:v,lang:g,fonts:m,style:D,weight:_,preResolvedFonts:E,unicodeFontsURL:y},x){const A=({chars:w,fonts:U})=>{let B,P;const Y=[];for(let b=0;b<w.length;b++)w[b]!==P?(P=w[b],Y.push(B={start:b,end:b,fontObj:U[w[b]]})):B.end=b;x(Y)};E?A(E):l(v,A,{lang:g,fonts:m,style:D,weight:_,unicodeFontsURL:y})}function i({text:v="",font:g,lang:m,sdfGlyphSize:D=64,fontSize:_=400,fontWeight:E=1,fontStyle:y="normal",letterSpacing:x=0,lineHeight:A="normal",maxWidth:w=1/0,direction:U,textAlign:B="left",textIndent:P=0,whiteSpace:Y="normal",overflowWrap:b="normal",anchorX:M=0,anchorY:C=0,metricsOnly:X=!1,unicodeFontsURL:z,preResolvedFonts:q=null,includeCaretPositions:ne=!1,chunkedBoundsSize:I=8192,colorRanges:R=null},p){const S=f(),T={fontLoad:0,typesetting:0};v.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),v=v.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),_=+_,x=+x,w=+w,A=A||"normal",P=+P,a({text:v,lang:m,style:y,weight:E,fonts:typeof g=="string"?[{src:g}]:g,unicodeFontsURL:z,preResolvedFonts:q},F=>{T.fontLoad=f()-S;const k=isFinite(w);let N=null,L=null,j=null,K=null,ee=null,H=null,W=null,ge=null,ue=0,Q=0,te=Y!=="nowrap";const le=new Map,V=f();let re=P,$=0,G=new c;const he=[G];F.forEach(ae=>{const{fontObj:ie}=ae,{ascender:ce,descender:ve,unitsPerEm:Ue,lineGap:Fe,capHeight:ye,xHeight:be}=ie;let fe=le.get(ie);if(!fe){const de=_/Ue,we=A==="normal"?(ce-ve+Fe)*de:A*_,qe=(we-(ce-ve)*de)/2,_e=Math.min(we,(ce-ve)*de),xe=(ce+ve)/2*de+_e/2;fe={index:le.size,src:ie.src,fontObj:ie,fontSizeMult:de,unitsPerEm:Ue,ascender:ce*de,descender:ve*de,capHeight:ye*de,xHeight:be*de,lineHeight:we,baseline:-qe-ce*de,caretTop:xe,caretBottom:xe-_e},le.set(ie,fe)}const{fontSizeMult:De}=fe,Ee=v.slice(ae.start,ae.end+1);let Ie,ke;ie.forEachGlyph(Ee,_,x,(de,we,qe,_e)=>{we+=$,_e+=ae.start,Ie=we,ke=de;const xe=v.charAt(_e),Ae=de.advanceWidth*De,Te=G.count;let pe;if("isEmpty"in de||(de.isWhitespace=!!xe&&new RegExp(t).test(xe),de.canBreakAfter=!!xe&&e.test(xe),de.isEmpty=de.xMin===de.xMax||de.yMin===de.yMax||u.test(xe)),!de.isWhitespace&&!de.isEmpty&&Q++,te&&k&&!de.isWhitespace&&we+Ae+re>w&&Te){if(G.glyphAt(Te-1).glyphObj.canBreakAfter)pe=new c,re=-we;else for(let Oe=Te;Oe--;)if(Oe===0&&b==="break-word"){pe=new c,re=-we;break}else if(G.glyphAt(Oe).glyphObj.canBreakAfter){pe=G.splitAt(Oe+1);const Re=pe.glyphAt(0).x;re-=Re;for(let Me=pe.count;Me--;)pe.glyphAt(Me).x-=Re;break}pe&&(G.isSoftWrapped=!0,G=pe,he.push(G),ue=w)}let Ce=G.glyphAt(G.count);Ce.glyphObj=de,Ce.x=we+re,Ce.y=qe,Ce.width=Ae,Ce.charIndex=_e,Ce.fontData=fe,xe===`
`&&(G=new c,he.push(G),re=-(we+Ae+x*_)+P)}),$=Ie+ke.advanceWidth*De+x*_});let Z=0;he.forEach(ae=>{let ie=!0;for(let ce=ae.count;ce--;){const ve=ae.glyphAt(ce);ie&&!ve.glyphObj.isWhitespace&&(ae.width=ve.x+ve.width,ae.width>ue&&(ue=ae.width),ie=!1);let{lineHeight:Ue,capHeight:Fe,xHeight:ye,baseline:be}=ve.fontData;Ue>ae.lineHeight&&(ae.lineHeight=Ue);const fe=be-ae.baseline;fe<0&&(ae.baseline+=fe,ae.cap+=fe,ae.ex+=fe),ae.cap=Math.max(ae.cap,ae.baseline+Fe),ae.ex=Math.max(ae.ex,ae.baseline+ye)}ae.baseline-=Z,ae.cap-=Z,ae.ex-=Z,Z+=ae.lineHeight});let oe=0,J=0;if(M&&(typeof M=="number"?oe=-M:typeof M=="string"&&(oe=-ue*(M==="left"?0:M==="center"?.5:M==="right"?1:o(M)))),C&&(typeof C=="number"?J=-C:typeof C=="string"&&(J=C==="top"?0:C==="top-baseline"?-he[0].baseline:C==="top-cap"?-he[0].cap:C==="top-ex"?-he[0].ex:C==="middle"?Z/2:C==="bottom"?Z:C==="bottom-baseline"?-he[he.length-1].baseline:o(C)*Z)),!X){const ae=r.getEmbeddingLevels(v,U);N=new Uint16Array(Q),L=new Uint8Array(Q),j=new Float32Array(Q*2),K={},W=[1/0,1/0,-1/0,-1/0],ge=[],ne&&(H=new Float32Array(v.length*4)),R&&(ee=new Uint8Array(Q*3));let ie=0,ce=-1,ve=-1,Ue,Fe;if(he.forEach((ye,be)=>{let{count:fe,width:De}=ye;if(fe>0){let Ee=0;for(let _e=fe;_e--&&ye.glyphAt(_e).glyphObj.isWhitespace;)Ee++;let Ie=0,ke=0;if(B==="center")Ie=(ue-De)/2;else if(B==="right")Ie=ue-De;else if(B==="justify"&&ye.isSoftWrapped){let _e=0;for(let xe=fe-Ee;xe--;)ye.glyphAt(xe).glyphObj.isWhitespace&&_e++;ke=(ue-De)/_e}if(ke||Ie){let _e=0;for(let xe=0;xe<fe;xe++){let Ae=ye.glyphAt(xe);const Te=Ae.glyphObj;Ae.x+=Ie+_e,ke!==0&&Te.isWhitespace&&xe<fe-Ee&&(_e+=ke,Ae.width+=ke)}}const de=r.getReorderSegments(v,ae,ye.glyphAt(0).charIndex,ye.glyphAt(ye.count-1).charIndex);for(let _e=0;_e<de.length;_e++){const[xe,Ae]=de[_e];let Te=1/0,pe=-1/0;for(let Ce=0;Ce<fe;Ce++)if(ye.glyphAt(Ce).charIndex>=xe){let Oe=Ce,Re=Ce;for(;Re<fe;Re++){let Me=ye.glyphAt(Re);if(Me.charIndex>Ae)break;Re<fe-Ee&&(Te=Math.min(Te,Me.x),pe=Math.max(pe,Me.x+Me.width))}for(let Me=Oe;Me<Re;Me++){const ze=ye.glyphAt(Me);ze.x=pe-(ze.x+ze.width-Te)}break}}let we;const qe=_e=>we=_e;for(let _e=0;_e<fe;_e++){const xe=ye.glyphAt(_e);we=xe.glyphObj;const Ae=we.index,Te=ae.levels[xe.charIndex]&1;if(Te){const pe=r.getMirroredCharacter(v[xe.charIndex]);pe&&xe.fontData.fontObj.forEachGlyph(pe,0,0,qe)}if(ne){const{charIndex:pe,fontData:Ce}=xe,Oe=xe.x+oe,Re=xe.x+xe.width+oe;H[pe*4]=Te?Re:Oe,H[pe*4+1]=Te?Oe:Re,H[pe*4+2]=ye.baseline+Ce.caretBottom+J,H[pe*4+3]=ye.baseline+Ce.caretTop+J;const Me=pe-ce;Me>1&&s(H,ce,Me),ce=pe}if(R){const{charIndex:pe}=xe;for(;pe>ve;)ve++,R.hasOwnProperty(ve)&&(Fe=R[ve])}if(!we.isWhitespace&&!we.isEmpty){const pe=ie++,{fontSizeMult:Ce,src:Oe,index:Re}=xe.fontData,Me=K[Oe]||(K[Oe]={});Me[Ae]||(Me[Ae]={path:we.path,pathBounds:[we.xMin,we.yMin,we.xMax,we.yMax]});const ze=xe.x+oe,$e=xe.y+ye.baseline+J;j[pe*2]=ze,j[pe*2+1]=$e;const Ye=ze+we.xMin*Ce,et=$e+we.yMin*Ce,nt=ze+we.xMax*Ce,Ke=$e+we.yMax*Ce;Ye<W[0]&&(W[0]=Ye),et<W[1]&&(W[1]=et),nt>W[2]&&(W[2]=nt),Ke>W[3]&&(W[3]=Ke),pe%I===0&&(Ue={start:pe,end:pe,rect:[1/0,1/0,-1/0,-1/0]},ge.push(Ue)),Ue.end++;const Ge=Ue.rect;if(Ye<Ge[0]&&(Ge[0]=Ye),et<Ge[1]&&(Ge[1]=et),nt>Ge[2]&&(Ge[2]=nt),Ke>Ge[3]&&(Ge[3]=Ke),N[pe]=Ae,L[pe]=Re,R){const at=pe*3;ee[at]=Fe>>16&255,ee[at+1]=Fe>>8&255,ee[at+2]=Fe&255}}}}}),H){const ye=v.length-ce;ye>1&&s(H,ce,ye)}}const Se=[];le.forEach(({index:ae,src:ie,unitsPerEm:ce,ascender:ve,descender:Ue,lineHeight:Fe,capHeight:ye,xHeight:be})=>{Se[ae]={src:ie,unitsPerEm:ce,ascender:ve,descender:Ue,lineHeight:Fe,capHeight:ye,xHeight:be}}),T.typesetting=f()-V,p({glyphIds:N,glyphFontIndices:L,glyphPositions:j,glyphData:K,fontData:Se,caretPositions:H,glyphColors:ee,chunkedBounds:ge,fontSize:_,topBaseline:J+he[0].baseline,blockBounds:[oe,J-Z,oe+ue,J],visibleBounds:W,timings:T})})}function n(v,g){i({...v,metricsOnly:!0},m=>{const[D,_,E,y]=m.blockBounds;g({width:E-D,height:y-_})})}function o(v){let g=v.match(/^([\d.]+)%$/),m=g?parseFloat(g[1]):NaN;return isNaN(m)?0:m/100}function s(v,g,m){const D=v[g*4],_=v[g*4+1],E=v[g*4+2],y=v[g*4+3],x=(_-D)/m;for(let A=0;A<m;A++){const w=(g+A)*4;v[w]=D+x*A,v[w+1]=D+x*(A+1),v[w+2]=E,v[w+3]=y}}function f(){return(self.performance||Date).now()}function c(){this.data=[]}const h=["glyphObj","x","y","width","charIndex","fontData"];return c.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/h.length)},glyphAt(v){let g=c.flyweight;return g.data=this.data,g.index=v,g},splitAt(v){let g=new c;return g.data=this.data.splice(v*h.length),g}},c.flyweight=h.reduce((v,g,m,D)=>(Object.defineProperty(v,g,{get(){return this.data[this.index*h.length+m]},set(_){this.data[this.index*h.length+m]=_}}),v),{data:null,index:0}),{typeset:i,measure:n}}const it=()=>(self.performance||Date).now(),qt=An();let pn;function co(l,r,d,u,t,e,a,i,n,o,s=!0){return s?ho(l,r,d,u,t,e,a,i,n,o).then(null,f=>(pn||(console.warn("WebGL SDF generation failed, falling back to JS",f),pn=!0),mn(l,r,d,u,t,e,a,i,n,o))):mn(l,r,d,u,t,e,a,i,n,o)}const Kt=[],uo=5;let Cr=0;function Ln(){const l=it();for(;Kt.length&&it()-l<uo;)Kt.shift()();Cr=Kt.length?setTimeout(Ln,0):0}const ho=(...l)=>new Promise((r,d)=>{Kt.push(()=>{const u=it();try{qt.webgl.generateIntoCanvas(...l),r({timing:it()-u})}catch(t){d(t)}}),Cr||(Cr=setTimeout(Ln,0))}),vo=4,po=2e3,gn={};let go=0;function mn(l,r,d,u,t,e,a,i,n,o){const s="TroikaTextSDFGenerator_JS_"+go++%vo;let f=gn[s];return f||(f=gn[s]={workerModule:pt({name:s,workerId:s,dependencies:[An,it],init(c,h){const v=c().javascript.generate;return function(...g){const m=h();return{textureData:v(...g),timing:h()-m}}},getTransferables(c){return[c.textureData.buffer]}}),requests:0,idleTimer:null}),f.requests++,clearTimeout(f.idleTimer),f.workerModule(l,r,d,u,t,e).then(({textureData:c,timing:h})=>{const v=it(),g=new Uint8Array(c.length*4);for(let m=0;m<c.length;m++)g[m*4+o]=c[m];return qt.webglUtils.renderImageData(a,g,i,n,l,r,1<<3-o),h+=it()-v,--f.requests===0&&(f.idleTimer=setTimeout(()=>{Xa(s)},po)),{timing:h}})}function mo(l){l._warm||(qt.webgl.isSupported(l),l._warm=!0)}const yo=qt.webglUtils.resizeWebGLCanvasWithoutClearing,Tt={unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},bo=new Qt;function ht(){return(self.performance||Date).now()}const yn=Object.create(null);function Pn(l,r){l=wo({},l);const d=ht(),u=[];if(l.font&&u.push({label:"user",src:_o(l.font)}),l.font=u,l.text=""+l.text,l.sdfGlyphSize=l.sdfGlyphSize||Tt.sdfGlyphSize,l.unicodeFontsURL=l.unicodeFontsURL||Tt.unicodeFontsURL,l.colorRanges!=null){let c={};for(let h in l.colorRanges)if(l.colorRanges.hasOwnProperty(h)){let v=l.colorRanges[h];typeof v!="number"&&(v=bo.set(v).getHex()),c[h]=v}l.colorRanges=c}Object.freeze(l);const{textureWidth:t,sdfExponent:e}=Tt,{sdfGlyphSize:a}=l,i=t/a*4;let n=yn[a];if(!n){const c=document.createElement("canvas");c.width=t,c.height=a*256/i,n=yn[a]={glyphCount:0,sdfGlyphSize:a,sdfCanvas:c,sdfTexture:new ua(c,void 0,void 0,void 0,tn,tn),contextLost:!1,glyphsByFont:new Map},n.sdfTexture.generateMipmaps=!1,xo(n)}const{sdfTexture:o,sdfCanvas:s}=n;Gn(l).then(c=>{const{glyphIds:h,glyphFontIndices:v,fontData:g,glyphPositions:m,fontSize:D,timings:_}=c,E=[],y=new Float32Array(h.length*4);let x=0,A=0;const w=ht(),U=g.map(M=>{let C=n.glyphsByFont.get(M.src);return C||n.glyphsByFont.set(M.src,C=new Map),C});h.forEach((M,C)=>{const X=v[C],{src:z,unitsPerEm:q}=g[X];let ne=U[X].get(M);if(!ne){const{path:T,pathBounds:F}=c.glyphData[z][M],k=Math.max(F[2]-F[0],F[3]-F[1])/a*(Tt.sdfMargin*a+.5),N=n.glyphCount++,L=[F[0]-k,F[1]-k,F[2]+k,F[3]+k];U[X].set(M,ne={path:T,atlasIndex:N,sdfViewBox:L}),E.push(ne)}const{sdfViewBox:I}=ne,R=m[A++],p=m[A++],S=D/q;y[x++]=R+I[0]*S,y[x++]=p+I[1]*S,y[x++]=R+I[2]*S,y[x++]=p+I[3]*S,h[C]=ne.atlasIndex}),_.quads=(_.quads||0)+(ht()-w);const B=ht();_.sdf={};const P=s.height,Y=Math.ceil(n.glyphCount/i),b=Math.pow(2,Math.ceil(Math.log2(Y*a)));b>P&&(console.info(`Increasing SDF texture size ${P}->${b}`),yo(s,t,b),o.dispose()),Promise.all(E.map(M=>Rn(M,n,l.gpuAccelerateSDF).then(({timing:C})=>{_.sdf[M.atlasIndex]=C}))).then(()=>{E.length&&!n.contextLost&&(On(n),o.needsUpdate=!0),_.sdfTotal=ht()-B,_.total=ht()-d,r(Object.freeze({parameters:l,sdfTexture:o,sdfGlyphSize:a,sdfExponent:e,glyphBounds:y,glyphAtlasIndices:h,glyphColors:c.glyphColors,caretPositions:c.caretPositions,chunkedBounds:c.chunkedBounds,ascender:c.ascender,descender:c.descender,lineHeight:c.lineHeight,capHeight:c.capHeight,xHeight:c.xHeight,topBaseline:c.topBaseline,blockBounds:c.blockBounds,visibleBounds:c.visibleBounds,timings:c.timings}))})}),Promise.resolve().then(()=>{n.contextLost||mo(s)})}function Rn({path:l,atlasIndex:r,sdfViewBox:d},{sdfGlyphSize:u,sdfCanvas:t,contextLost:e},a){if(e)return Promise.resolve({timing:-1});const{textureWidth:i,sdfExponent:n}=Tt,o=Math.max(d[2]-d[0],d[3]-d[1]),s=Math.floor(r/4),f=s%(i/u)*u,c=Math.floor(s/(i/u))*u,h=r%4;return co(u,u,l,d,o,n,t,f,c,h,a)}function xo(l){const r=l.sdfCanvas;r.addEventListener("webglcontextlost",d=>{console.log("Context Lost",d),d.preventDefault(),l.contextLost=!0}),r.addEventListener("webglcontextrestored",d=>{console.log("Context Restored",d),l.contextLost=!1;const u=[];l.glyphsByFont.forEach(t=>{t.forEach(e=>{u.push(Rn(e,l,!0))})}),Promise.all(u).then(()=>{On(l),l.sdfTexture.needsUpdate=!0})})}function So({font:l,characters:r,sdfGlyphSize:d},u){let t=Array.isArray(r)?r.join(`
`):""+r;Pn({font:l,sdfGlyphSize:d,text:t},u)}function wo(l,r){for(let d in r)r.hasOwnProperty(d)&&(l[d]=r[d]);return l}let Ht;function _o(l){return Ht||(Ht=typeof document>"u"?{}:document.createElement("a")),Ht.href=l,Ht.href}function On(l){if(typeof createImageBitmap!="function"){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:r,sdfTexture:d}=l,{width:u,height:t}=r,e=l.sdfCanvas.getContext("webgl");let a=d.image.data;(!a||a.length!==u*t*4)&&(a=new Uint8Array(u*t*4),d.image={width:u,height:t,data:a},d.flipY=!1,d.isDataTexture=!0),e.readPixels(0,0,u,t,e.RGBA,e.UNSIGNED_BYTE,a)}}const Uo=pt({name:"Typesetter",dependencies:[fo,lo,Ka],init(l,r,d){return l(r,d())}}),Gn=pt({name:"Typesetter",dependencies:[Uo],init(l){return function(r){return new Promise(d=>{l.typeset(r,d)})}},getTransferables(l){const r=[];for(let d in l)l[d]&&l[d].buffer&&r.push(l[d].buffer);return r}});Gn.onMainThread;const bn={};function ko(l){let r=bn[l];return r||(r=bn[l]=new Fr(1,1,l,l).translate(.5,.5,0)),r}const Eo="aTroikaGlyphBounds",xn="aTroikaGlyphIndex",To="aTroikaGlyphColor";class Co extends la{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new fa,this.boundingBox=new Tn}computeBoundingSphere(){}computeBoundingBox(){}set detail(r){if(r!==this._detail){this._detail=r,(typeof r!="number"||r<1)&&(r=1);let d=ko(r);["position","normal","uv"].forEach(u=>{this.attributes[u]=d.attributes[u].clone()}),this.setIndex(d.getIndex().clone())}}get detail(){return this._detail}set curveRadius(r){r!==this._curveRadius&&(this._curveRadius=r,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(r,d,u,t,e){this.updateAttributeData(Eo,r,4),this.updateAttributeData(xn,d,1),this.updateAttributeData(To,e,3),this._blockBounds=u,this._chunkedBounds=t,this.instanceCount=d.length,this._updateBounds()}_updateBounds(){const r=this._blockBounds;if(r){const{curveRadius:d,boundingBox:u}=this;if(d){const{PI:t,floor:e,min:a,max:i,sin:n,cos:o}=Math,s=t/2,f=t*2,c=Math.abs(d),h=r[0]/c,v=r[2]/c,g=e((h+s)/f)!==e((v+s)/f)?-c:a(n(h)*c,n(v)*c),m=e((h-s)/f)!==e((v-s)/f)?c:i(n(h)*c,n(v)*c),D=e((h+t)/f)!==e((v+t)/f)?c*2:i(c-o(h)*c,c-o(v)*c);u.min.set(g,r[1],d<0?-D:0),u.max.set(m,r[3],d<0?0:D)}else u.min.set(r[0],r[1],0),u.max.set(r[2],r[3],0);u.getBoundingSphere(this.boundingSphere)}}applyClipRect(r){let d=this.getAttribute(xn).count,u=this._chunkedBounds;if(u)for(let t=u.length;t--;){d=u[t].end;let e=u[t].rect;if(e[1]<r.w&&e[3]>r.y&&e[0]<r.z&&e[2]>r.x)break}this.instanceCount=d}updateAttributeData(r,d,u){const t=this.getAttribute(r);d?t&&t.array.length===d.length?(t.array.set(d),t.needsUpdate=!0):(this.setAttribute(r,new ca(d,u)),delete this._maxInstanceCount,this.dispose()):t&&this.deleteAttribute(r)}}const Fo=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaEdgeOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,Do=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaEdgeOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaEdgeOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,Ao=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaEdgeOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,Mo=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaEdgeOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`;function Lo(l){const r=Tr(l,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new Dt},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new rn(0,0,0,0)},uTroikaClipRect:{value:new rn(0,0,0,0)},uTroikaEdgeOffset:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new Dt},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new Qt},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new da},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:Fo,vertexTransform:Do,fragmentDefs:Ao,fragmentColorTransform:Mo,customRewriter({vertexShader:d,fragmentShader:u}){let t=/\buniform\s+vec3\s+diffuse\b/;return t.test(u)&&(u=u.replace(t,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),t.test(d)||(d=d.replace(Mn,`uniform vec3 diffuse;
$&
vTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;
`))),{vertexShader:d,fragmentShader:u}}});return r.transparent=!0,r.forceSinglePass=!0,Object.defineProperties(r,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),r}const Ar=new ia({color:16777215,side:ha,transparent:!0}),Sn=8421504,wn=new sa,Xt=new Be,xr=new Be,Et=[],Po=new Be,Sr="+x+y";function _n(l){return Array.isArray(l)?l[0]:l}let Bn=()=>{const l=new Zt(new Fr(1,1),Ar);return Bn=()=>l,l},In=()=>{const l=new Zt(new Fr(1,1,32,1),Ar);return In=()=>l,l};const Ro={type:"syncstart"},Oo={type:"synccomplete"},jn=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],Go=jn.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");let Nn=class extends Zt{constructor(){const r=new Co;super(r,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=Sn,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=Sr,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(r){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(r):(this._isSyncing=!0,this.dispatchEvent(Ro),Pn({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},d=>{this._isSyncing=!1,this._textRenderInfo=d,this.geometry.updateGlyphs(d.glyphBounds,d.glyphAtlasIndices,d.blockBounds,d.chunkedBounds,d.glyphColors);const u=this._queuedSyncs;u&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{u.forEach(t=>t&&t())})),this.dispatchEvent(Oo),r&&r()})))}onBeforeRender(r,d,u,t,e,a){this.sync(),e.isTroikaTextMaterial&&this._prepareForRender(e)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}createDerivedMaterial(r){return Lo(r)}get material(){let r=this._derivedMaterial;const d=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=Ar.clone());if((!r||!r.isDerivedFrom(d))&&(r=this._derivedMaterial=this.createDerivedMaterial(d),d.addEventListener("dispose",function u(){d.removeEventListener("dispose",u),r.dispose()})),this.hasOutline()){let u=r._outlineMtl;return u||(u=r._outlineMtl=Object.create(r,{id:{value:r.id+.1}}),u.isTextOutlineMaterial=!0,u.depthWrite=!1,u.map=null,r.addEventListener("dispose",function t(){r.removeEventListener("dispose",t),u.dispose()})),[u,r]}else return r}set material(r){r&&r.isTroikaTextMaterial?(this._derivedMaterial=r,this._baseMaterial=r.baseMaterial):this._baseMaterial=r}hasOutline(){return!!(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY)}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(r){this.geometry.detail=r}get curveRadius(){return this.geometry.curveRadius}set curveRadius(r){this.geometry.curveRadius=r}get customDepthMaterial(){return _n(this.material).getDepthMaterial()}set customDepthMaterial(r){}get customDistanceMaterial(){return _n(this.material).getDistanceMaterial()}set customDistanceMaterial(r){}_prepareForRender(r){const d=r.isTextOutlineMaterial,u=r.uniforms,t=this.textRenderInfo;if(t){const{sdfTexture:i,blockBounds:n}=t;u.uTroikaSDFTexture.value=i,u.uTroikaSDFTextureSize.value.set(i.image.width,i.image.height),u.uTroikaSDFGlyphSize.value=t.sdfGlyphSize,u.uTroikaSDFExponent.value=t.sdfExponent,u.uTroikaTotalBounds.value.fromArray(n),u.uTroikaUseGlyphColors.value=!d&&!!t.glyphColors;let o=0,s=0,f=0,c,h,v,g=0,m=0;if(d){let{outlineWidth:_,outlineOffsetX:E,outlineOffsetY:y,outlineBlur:x,outlineOpacity:A}=this;o=this._parsePercent(_)||0,s=Math.max(0,this._parsePercent(x)||0),c=A,g=this._parsePercent(E)||0,m=this._parsePercent(y)||0}else f=Math.max(0,this._parsePercent(this.strokeWidth)||0),f&&(v=this.strokeColor,u.uTroikaStrokeColor.value.set(v??Sn),h=this.strokeOpacity,h==null&&(h=1)),c=this.fillOpacity;u.uTroikaEdgeOffset.value=o,u.uTroikaPositionOffset.value.set(g,m),u.uTroikaBlurRadius.value=s,u.uTroikaStrokeWidth.value=f,u.uTroikaStrokeOpacity.value=h,u.uTroikaFillOpacity.value=c??1,u.uTroikaCurveRadius.value=this.curveRadius||0;let D=this.clipRect;if(D&&Array.isArray(D)&&D.length===4)u.uTroikaClipRect.value.fromArray(D);else{const _=(this.fontSize||.1)*100;u.uTroikaClipRect.value.set(n[0]-_,n[1]-_,n[2]+_,n[3]+_)}this.geometry.applyClipRect(u.uTroikaClipRect.value)}u.uTroikaSDFDebug.value=!!this.debugSDF,r.polygonOffset=!!this.depthOffset,r.polygonOffsetFactor=r.polygonOffsetUnits=this.depthOffset||0;const e=d?this.outlineColor||0:this.color;if(e==null)delete r.color;else{const i=r.hasOwnProperty("color")?r.color:r.color=new Qt;(e!==i._input||typeof e=="object")&&i.set(i._input=e)}let a=this.orientation||Sr;if(a!==r._orientation){let i=u.uTroikaOrient.value;a=a.replace(/[^-+xyz]/g,"");let n=a!==Sr&&a.match(/^([-+])([xyz])([-+])([xyz])$/);if(n){let[,o,s,f,c]=n;Xt.set(0,0,0)[s]=o==="-"?1:-1,xr.set(0,0,0)[c]=f==="-"?-1:1,wn.lookAt(Po,Xt.cross(xr),xr),i.setFromMatrix4(wn)}else i.identity();r._orientation=a}}_parsePercent(r){if(typeof r=="string"){let d=r.match(/^(-?[\d.]+)%$/),u=d?parseFloat(d[1]):NaN;r=(isNaN(u)?0:u/100)*this.fontSize}return r}localPositionToTextCoords(r,d=new Dt){d.copy(r);const u=this.curveRadius;return u&&(d.x=Math.atan2(r.x,Math.abs(u)-Math.abs(r.z))*Math.abs(u)),d}worldPositionToTextCoords(r,d=new Dt){return Xt.copy(r),this.localPositionToTextCoords(this.worldToLocal(Xt),d)}raycast(r,d){const{textRenderInfo:u,curveRadius:t}=this;if(u){const e=u.blockBounds,a=t?In():Bn(),i=a.geometry,{position:n,uv:o}=i.attributes;for(let s=0;s<o.count;s++){let f=e[0]+o.getX(s)*(e[2]-e[0]);const c=e[1]+o.getY(s)*(e[3]-e[1]);let h=0;t&&(h=t-Math.cos(f/t)*t,f=Math.sin(f/t)*t),n.setXYZ(s,f,c,h)}i.boundingSphere=this.geometry.boundingSphere,i.boundingBox=this.geometry.boundingBox,a.matrixWorld=this.matrixWorld,a.material.side=this.material.side,Et.length=0,a.raycast(r,Et);for(let s=0;s<Et.length;s++)Et[s].object=this,d.push(Et[s])}}copy(r){const d=this.geometry;return super.copy(r),this.geometry=d,Go.forEach(u=>{this[u]=r[u]}),this}clone(){return new this.constructor().copy(this)}};jn.forEach(l=>{const r="_private_"+l;Object.defineProperty(Nn.prototype,l,{get(){return this[r]},set(d){d!==this[r]&&(this[r]=d,this._needsSync=!0)}})});new Tn;new Qt;const Wn=me.forwardRef(({sdfGlyphSize:l=64,anchorX:r="center",anchorY:d="middle",font:u,fontSize:t=1,children:e,characters:a,onSync:i,...n},o)=>{const s=Je(({invalidate:v})=>v),[f]=me.useState(()=>new Nn),[c,h]=me.useMemo(()=>{const v=[];let g="";return me.Children.forEach(e,m=>{typeof m=="string"||typeof m=="number"?g+=m:v.push(m)}),[v,g]},[e]);return va(()=>new Promise(v=>So({font:u,characters:a},v)),["troika-text",u,a]),me.useLayoutEffect(()=>void f.sync(()=>{s(),i&&i(f)})),me.useEffect(()=>()=>f.dispose(),[f]),me.createElement("primitive",At({object:f,ref:o,font:u,text:h,anchorX:r,anchorY:d,fontSize:t,sdfGlyphSize:l},n),c)}),Bo=me.forwardRef(({domElement:l,selector:r,onChange:d,onLock:u,onUnlock:t,enabled:e=!0,makeDefault:a,...i},n)=>{const{camera:o,...s}=i,f=Je(x=>x.setEvents),c=Je(x=>x.gl),h=Je(x=>x.camera),v=Je(x=>x.invalidate),g=Je(x=>x.events),m=Je(x=>x.get),D=Je(x=>x.set),_=o||h,E=l||g.connected||c.domElement,y=me.useMemo(()=>new Na(_),[_]);return me.useEffect(()=>{if(e){y.connect(E);const x=m().events.compute;return f({compute(A,w){const U=w.size.width/2,B=w.size.height/2;w.pointer.set(U/w.size.width*2-1,-(B/w.size.height)*2+1),w.raycaster.setFromCamera(w.pointer,w.camera)}}),()=>{y.disconnect(),f({compute:x})}}},[e,y]),me.useEffect(()=>{const x=U=>{v(),d&&d(U)};y.addEventListener("change",x),u&&y.addEventListener("lock",u),t&&y.addEventListener("unlock",t);const A=()=>y.lock(),w=r?Array.from(document.querySelectorAll(r)):[document];return w.forEach(U=>U&&U.addEventListener("click",A)),()=>{y.removeEventListener("change",x),u&&y.removeEventListener("lock",u),t&&y.removeEventListener("unlock",t),w.forEach(U=>U?U.removeEventListener("click",A):void 0)}},[d,u,t,r,y,v]),me.useEffect(()=>{if(a){const x=m().controls;return D({controls:y}),()=>D({controls:x})}},[a,y]),me.createElement("primitive",At({ref:n,object:y},s))});function Io(l,r,d=new Be){const u=Math.PI*(l-.5),t=2*Math.PI*(r-.5);return d.x=Math.cos(t),d.y=Math.sin(u),d.z=Math.sin(t),d}const jo=me.forwardRef(({inclination:l=.6,azimuth:r=.1,distance:d=1e3,mieCoefficient:u=.005,mieDirectionalG:t=.8,rayleigh:e=.5,turbidity:a=10,sunPosition:i=Io(l,r),...n},o)=>{const s=me.useMemo(()=>new Be().setScalar(d),[d]),[f]=me.useState(()=>new Aa);return me.createElement("primitive",At({object:f,ref:o,"material-uniforms-mieCoefficient-value":u,"material-uniforms-mieDirectionalG-value":t,"material-uniforms-rayleigh-value":e,"material-uniforms-sunPosition-value":i,"material-uniforms-turbidity-value":a,scale:s},n))});var Qe=(l=>(l.BUN="BUN",l.SAUSAGE="SAUSAGE",l))(Qe||{});const Jt={BUN:"#FCD34D",SAUSAGE:"#EF4444"},No=()=>{const[l]=pa(()=>({rotation:[-Math.PI/2,0,0],position:[0,0,0],material:{friction:.1}}));return O.jsxs("group",{children:[O.jsxs("mesh",{ref:l,receiveShadow:!0,children:[O.jsx("planeGeometry",{args:[50,50]}),O.jsx("meshStandardMaterial",{color:"#1a1a1a",roughness:.8})]}),O.jsx("gridHelper",{args:[50,50,4473924,2236962],position:[0,.01,0]})]})},wr=({position:l,color:r="#8B4513"})=>{const[d]=Dr(()=>({type:"Static",position:[l[0],l[1]+.9,l[2]],args:[4,.2,3]}));return O.jsxs("group",{children:[O.jsxs("mesh",{ref:d,castShadow:!0,receiveShadow:!0,children:[O.jsx("boxGeometry",{args:[4,.2,3]}),O.jsx("meshStandardMaterial",{color:r,roughness:.6})]}),[[-1.8,-1.3],[1.8,-1.3],[-1.8,1.3],[1.8,1.3]].map((u,t)=>O.jsxs("mesh",{position:[l[0]+u[0],.4,l[2]+u[1]],castShadow:!0,children:[O.jsx("boxGeometry",{args:[.2,.8,.2]}),O.jsx("meshStandardMaterial",{color:"#3E2723"})]},t))]})},Un=({position:l,type:r})=>{const[d]=Dr(()=>({type:"Static",position:[l[0],l[1]+1.6,l[2]],args:[1.8,1.2,1.8]})),u=r===Qe.BUN;return O.jsxs("group",{ref:d,userData:{interactable:!0,type:r},children:[O.jsxs("mesh",{castShadow:!0,children:[O.jsx("boxGeometry",{args:[1.8,1.2,1.8]}),O.jsx("meshStandardMaterial",{color:"#5D4037"})]}),O.jsxs("mesh",{position:[0,.61,0],rotation:[-Math.PI/2,0,0],children:[O.jsx("planeGeometry",{args:[1.6,1.6]}),O.jsx("meshStandardMaterial",{color:"#3E2723"})]}),O.jsx("group",{position:[0,1,0],children:u?O.jsxs("mesh",{rotation:[0,0,Math.PI/4],children:[O.jsx("capsuleGeometry",{args:[.3,.8,4,8]}),O.jsx("meshStandardMaterial",{color:Jt[r]})]}):O.jsxs("mesh",{rotation:[0,0,Math.PI/4],children:[O.jsx("capsuleGeometry",{args:[.2,.8,4,8]}),O.jsx("meshStandardMaterial",{color:Jt[r]})]})}),O.jsxs("mesh",{position:[0,1,1],children:[O.jsx("boxGeometry",{args:[3.5,4.5,3.5]}),O.jsx("meshBasicMaterial",{transparent:!0,opacity:0,depthWrite:!1})]}),O.jsx(Wn,{position:[0,1.8,0],fontSize:.5,color:"white",anchorX:"center",anchorY:"middle",outlineWidth:.05,outlineColor:"#000",children:r})]})},Wo=({position:l,addScore:r})=>{const d=l[1]+1;return O.jsxs("group",{children:[O.jsxs("mesh",{position:[l[0],d+.05,l[2]],receiveShadow:!0,children:[O.jsx("cylinderGeometry",{args:[1.4,1,.1,32]}),O.jsx("meshStandardMaterial",{color:"#ECEFF1",roughness:.2})]}),O.jsxs("mesh",{position:[l[0],d,l[2]],receiveShadow:!0,children:[O.jsx("cylinderGeometry",{args:[1.5,1.5,.1,32]}),O.jsx("meshStandardMaterial",{color:"#CFD8DC"})]}),O.jsx(Wn,{position:[l[0],d+2,l[2]],fontSize:.5,color:"#4ADE80",anchorX:"center",anchorY:"middle",outlineWidth:.05,outlineColor:"#000",children:"THROW HERE!"})]})},zo=({addScore:l})=>O.jsxs(O.Fragment,{children:[O.jsx(No,{}),O.jsx(wr,{position:[-5,0,-4]}),O.jsx(Un,{position:[-5,0,-4],type:Qe.BUN}),O.jsx(wr,{position:[5,0,-4]}),O.jsx(Un,{position:[5,0,-4],type:Qe.SAUSAGE}),O.jsx(wr,{position:[0,0,-10],color:"#263238"}),O.jsx(Wo,{position:[0,0,-10],addScore:l})]}),Vo=6,Ho=6,_r=18,Xo=20;function kn(l){let r=l;for(;r;){if(r.userData&&r.userData.interactable)return{type:r.userData.type};r=r.parent}return null}const Yo=({heldItem:l,setHeldItem:r,throwItem:d,setHovering:u,setIsLocked:t})=>{const{camera:e,raycaster:a,scene:i}=Je(),n=me.useRef(null),[o,s]=ga(()=>({mass:60,type:"Dynamic",position:[0,2,10],args:[.6],fixedRotation:!0,linearDamping:.95,material:{friction:0,restitution:0}})),f=me.useRef([0,0,0]);me.useEffect(()=>s.velocity.subscribe(v=>f.current=v),[s.velocity]);const c=me.useRef([0,0,0]);me.useEffect(()=>s.position.subscribe(v=>c.current=v),[s.position]);const[,h]=Ta();return Cn(v=>{if(!o.current)return;e.position.copy(new Be(c.current[0],c.current[1]+1.7,c.current[2]));const{forward:g,backward:m,left:D,right:_,jump:E}=h(),y=new Be;e.getWorldDirection(y),y.y=0,y.normalize();const x=new Be(-y.z,0,y.x),A=new Be;if(g&&A.add(y),m&&A.sub(y),_&&A.add(x),D&&A.sub(x),A.normalize().multiplyScalar(Vo),s.velocity.set(A.x,f.current[1],A.z),E&&Math.abs(f.current[1])<.1&&s.velocity.set(f.current[0],Ho,f.current[2]),l)n.current=null,u(!1);else{const U=document.pointerLockElement!==null?new Dt(0,0):v.pointer;a.setFromCamera(U,e);const P=a.intersectObjects(i.children,!0).find(Y=>Y.distance>Xo?!1:kn(Y.object)!==null);if(P){const Y=kn(P.object);n.current=Y?Y.type:null,u(!0)}else n.current=null,u(!1)}}),me.useEffect(()=>{const v=g=>{if(g.button===0)if(l){const m=new Be;e.getWorldDirection(m);const D=e.position.clone().add(m.clone().multiplyScalar(1.2)),_=[m.x*_r,m.y*_r+4,m.z*_r];d([D.x,D.y,D.z],_)}else n.current&&r(n.current)};return window.addEventListener("mousedown",v),()=>window.removeEventListener("mousedown",v)},[l,e,r,d]),O.jsxs(O.Fragment,{children:[O.jsx(Bo,{onLock:()=>t(!0),onUnlock:()=>t(!1)}),O.jsx("mesh",{ref:o})]})},Ze={hasBun:!1,hasSausage:!1,reset:()=>{Ze.hasBun=!1,Ze.hasSausage=!1}},Ko=({id:l,type:r,initialPosition:d,initialVelocity:u,onRemove:t})=>{const[e,a]=me.useState(!1),i=r===Qe.BUN,[n,o]=i?Dr(()=>({mass:1,position:d,velocity:u,args:[.7,.3,.4],rotation:[Math.random(),Math.random(),Math.random()]})):ma(()=>({mass:.8,position:d,velocity:u,args:[.1,.1,.6,8],rotation:[Math.PI/2,0,0],angularDamping:.1}));return Cn(()=>{if(!n.current||e)return;const s=n.current.position;if(s.y<-10){t(l);return}const f=new Be(0,1.8,-10);s.distanceTo(f)<2.5&&(o.velocity.set(0,0,0),o.angularVelocity.set(0,0,0),r===Qe.BUN&&!Ze.hasBun?Ze.hasBun=!0:r===Qe.SAUSAGE&&!Ze.hasSausage&&(Ze.hasSausage=!0),Ze.hasBun&&Ze.hasSausage&&(window.dispatchEvent(new CustomEvent("hotdog-made")),Ze.reset(),t(l)))}),O.jsx("group",{ref:n,userData:{interactable:!0,type:r},children:i?O.jsxs("mesh",{castShadow:!0,receiveShadow:!0,children:[O.jsx("capsuleGeometry",{args:[.2,.6,4,8]}),O.jsx("meshStandardMaterial",{color:Jt[r],roughness:.8}),O.jsx("group",{scale:[1,.7,1]})]}):O.jsxs("mesh",{castShadow:!0,receiveShadow:!0,children:[O.jsx("capsuleGeometry",{args:[.1,.6,4,8]}),O.jsx("meshStandardMaterial",{color:Jt[r],roughness:.3,metalness:.1})]})})},Jo=l=>{vt.useEffect(()=>{const r=()=>l();return window.addEventListener("hotdog-made",r),()=>window.removeEventListener("hotdog-made",r)},[l])},Zo=({gameState:l,setHeldItem:r,throwItem:d,removeIngredient:u,addScore:t,setHovering:e,setIsLocked:a})=>(Jo(()=>{t()}),O.jsxs(O.Fragment,{children:[O.jsx(Yo,{heldItem:l.heldItem,setHeldItem:r,throwItem:d,setHovering:e,setIsLocked:a}),O.jsx(zo,{addScore:t}),l.activeIngredients.map(i=>O.jsx(Ko,{id:i.id,type:i.type,initialPosition:i.position,initialVelocity:i.velocity,onRemove:u},i.id))]}));/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Qo={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qo=l=>l.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),Mr=(l,r)=>{const d=me.forwardRef(({color:u="currentColor",size:t=24,strokeWidth:e=2,absoluteStrokeWidth:a,className:i="",children:n,...o},s)=>me.createElement("svg",{ref:s,...Qo,width:t,height:t,stroke:u,strokeWidth:a?Number(e)*24/Number(t):e,className:["lucide",`lucide-${qo(l)}`,i].join(" "),...o},[...r.map(([f,c])=>me.createElement(f,c)),...Array.isArray(n)?n:[n]]));return d.displayName=`${l}`,d};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $o=Mr("MousePointer2",[["path",{d:"m4 4 7.07 17 2.51-7.39L21 11.07z",key:"1vqm48"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ei=Mr("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ti=Mr("Utensils",[["path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2",key:"cjf0a3"}],["path",{d:"M7 2v20",key:"1473qp"}],["path",{d:"M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7",key:"1ogz0v"}]]);function ri(){const[l,r]=me.useState({score:0,heldItem:null,activeIngredients:[],lastMessage:"Welcome! Make Hot Dogs!"}),[d,u]=me.useState(!1),[t,e]=me.useState(!1),a=me.useCallback(f=>{r(c=>({...c,heldItem:f,lastMessage:f?`Picked up ${f}`:c.lastMessage}))},[]),i=me.useCallback(()=>{r(f=>({...f,score:f.score+1,lastMessage:"HOT DOG ASSEMBLED! +100 Points"}))},[]),n=me.useCallback((f,c)=>{r(h=>{if(!h.heldItem)return h;const v={id:Math.random().toString(36).substr(2,9),type:h.heldItem,position:f,velocity:c};return{...h,heldItem:null,activeIngredients:[...h.activeIngredients,v],lastMessage:"Yeet!"}})},[]),o=me.useCallback(f=>{r(c=>({...c,activeIngredients:c.activeIngredients.filter(h=>h.id!==f)}))},[]),s=[{name:"forward",keys:["ArrowUp","w","W"]},{name:"backward",keys:["ArrowDown","s","S"]},{name:"left",keys:["ArrowLeft","a","A"]},{name:"right",keys:["ArrowRight","d","D"]},{name:"jump",keys:["Space"]},{name:"interact",keys:["e","E"]}];return O.jsxs("div",{className:"relative w-full h-full bg-gray-900 select-none",children:[O.jsxs("div",{className:"absolute inset-0 pointer-events-none z-10 flex flex-col justify-between p-6",children:[O.jsxs("div",{className:"flex justify-between items-start",children:[O.jsxs("div",{className:"bg-black/60 backdrop-blur-md p-4 rounded-xl border border-white/10 text-white shadow-xl",children:[O.jsxs("h1",{className:"text-2xl font-bold text-yellow-400 flex items-center gap-2",children:[O.jsx(ti,{className:"w-6 h-6"})," Hot Dog Hero"]}),O.jsxs("p",{className:"text-gray-300 mt-1",children:["Score: ",O.jsx("span",{className:"text-3xl font-mono font-bold text-white",children:l.score})]})]}),O.jsxs("div",{className:"bg-black/60 backdrop-blur-md p-4 rounded-xl border border-white/10 text-white w-64 text-center shadow-xl",children:[O.jsx("h2",{className:"text-sm uppercase tracking-wider text-gray-400 mb-2",children:"Current Status"}),O.jsx("div",{className:"text-xl font-bold text-blue-300 animate-pulse",children:l.lastMessage},l.lastMessage)]})]}),O.jsxs("div",{className:"flex justify-between items-end",children:[O.jsx("div",{className:"bg-black/60 backdrop-blur-md p-4 rounded-xl border border-white/10 text-white shadow-xl",children:O.jsxs("div",{className:"flex items-center gap-4",children:[O.jsxs("div",{className:`w-16 h-16 rounded-lg border-2 flex items-center justify-center transition-all ${l.heldItem?"border-yellow-400 bg-yellow-400/20":"border-gray-600 bg-gray-800"}`,children:[l.heldItem===Qe.BUN&&O.jsx("div",{className:"w-10 h-6 bg-yellow-300 rounded-full shadow-lg"}),l.heldItem===Qe.SAUSAGE&&O.jsx("div",{className:"w-12 h-3 bg-red-500 rounded-full shadow-lg rotate-45"})]}),O.jsxs("div",{children:[O.jsx("p",{className:"text-xs text-gray-400 uppercase",children:"Holding"}),O.jsx("p",{className:"text-lg font-bold",children:l.heldItem||"Empty Handed"})]})]})}),O.jsx("div",{className:"bg-black/60 backdrop-blur-md p-4 rounded-xl border border-white/10 text-white text-sm shadow-xl",children:O.jsxs("div",{className:"flex flex-col gap-2",children:[O.jsxs("div",{className:"flex items-center gap-2",children:[O.jsx($o,{className:"w-4 h-4"})," ",O.jsx("span",{children:t?"Left Click to Throw":"Click Game to Lock"})]}),O.jsxs("div",{className:"flex items-center gap-2",children:[O.jsx(ei,{className:"w-4 h-4"})," ",O.jsx("span",{children:"Aim at Tables / Plate"})]}),O.jsx("div",{className:"opacity-50 text-xs mt-2",children:"WASD to Move  Space to Jump"})]})})]})]}),t&&O.jsxs(O.Fragment,{children:[O.jsx("div",{className:`absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-50 pointer-events-none transition-all duration-100 ease-out
              ${d?"w-8 h-8 border-2 border-green-400 bg-green-400/30":"w-2 h-2 bg-white border border-black"}
              rounded-full
            `}),d&&O.jsx("div",{className:"absolute top-[53%] left-1/2 -translate-x-1/2 text-green-400 font-bold text-sm tracking-widest shadow-black drop-shadow-md z-50 pointer-events-none",children:"GRAB"})]}),O.jsx(Ea,{map:s,children:O.jsxs(ya,{shadows:!0,camera:{fov:80},children:[O.jsx(jo,{sunPosition:[100,20,100]}),O.jsx("ambientLight",{intensity:.4}),O.jsx("pointLight",{position:[10,15,10],castShadow:!0,intensity:.8}),O.jsx("pointLight",{position:[-10,5,-5],intensity:.5,color:"#ffd700"}),O.jsx(ba,{gravity:[0,-20,0],children:O.jsx(Zo,{gameState:l,setHeldItem:a,throwItem:n,removeIngredient:o,addScore:i,setHovering:u,setIsLocked:e})})]})})]})}const zn=document.getElementById("root");if(!zn)throw new Error("Could not find root element to mount to");const ni=Ur.createRoot(zn);ni.render(O.jsx(vt.StrictMode,{children:O.jsx(ri,{})}));
