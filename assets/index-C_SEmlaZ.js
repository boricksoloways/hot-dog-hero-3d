import{r as $n,R as pt,a as me,b as ea,V as Ie,S as ta,B as ra,U as Fn,M as $t,c as na,E as aa,d as oa,e as ia,f as sa,g as la,h as fa,C as er,i as ca,j as Mt,I as ua,k as da,l as Dn,m as ha,T as va,L as an,n as pa,o as on,D as ga,P as Mr,u as Je,s as ma,p as O,q as ya,t as Lr,v as ba,w as An,x as xa,y as Sa,z as wa}from"./vendor-BS8H-R5R.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))c(t);new MutationObserver(t=>{for(const e of t)if(e.type==="childList")for(const a of e.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&c(a)}).observe(document,{childList:!0,subtree:!0});function u(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?e.credentials="include":t.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function c(t){if(t.ep)return;t.ep=!0;const e=u(t);fetch(t.href,e)}})();var Tr={},sn=$n;Tr.createRoot=sn.createRoot,Tr.hydrateRoot=sn.hydrateRoot;function Lt(){return Lt=Object.assign?Object.assign.bind():function(l){for(var r=1;r<arguments.length;r++){var u=arguments[r];for(var c in u)({}).hasOwnProperty.call(u,c)&&(l[c]=u[c])}return l},Lt.apply(null,arguments)}const ln=l=>{let r;const u=new Set,c=(o,s)=>{const f=typeof o=="function"?o(r):o;if(!Object.is(f,r)){const d=r;r=s??(typeof f!="object"||f===null)?f:Object.assign({},r,f),u.forEach(h=>h(r,d))}},t=()=>r,i={setState:c,getState:t,getInitialState:()=>n,subscribe:o=>(u.add(o),()=>u.delete(o))},n=r=l(c,t,i);return i},_a=l=>l?ln(l):ln,ka=l=>l;function Ua(l,r=ka){const u=pt.useSyncExternalStore(l.subscribe,pt.useCallback(()=>r(l.getState()),[l,r]),pt.useCallback(()=>r(l.getInitialState()),[l,r]));return pt.useDebugValue(u),u}const fn=l=>{const r=_a(l),u=c=>Ua(r,c);return Object.assign(u,r),u},Ea=l=>l?fn(l):fn,Ta=l=>(r,u,c)=>{const t=c.subscribe;return c.subscribe=(a,i,n)=>{let o=a;if(i){const s=(n==null?void 0:n.equalityFn)||Object.is;let f=a(c.getState());o=d=>{const h=a(d);if(!s(f,h)){const v=f;i(f=h,v)}},n!=null&&n.fireImmediately&&i(f,f)}return t(o)},l(r,u,c)},Ca=Ta,Mn=me.createContext(null);function Fa({map:l,children:r,onChange:u,domElement:c}){const t=l.map(n=>n.name+n.keys).join("-"),e=me.useMemo(()=>Ea(Ca(()=>l.reduce((n,o)=>({...n,[o.name]:!1}),{}))),[t]),a=me.useMemo(()=>[e.subscribe,e.getState,e],[t]),i=e.setState;return me.useEffect(()=>{const o=l.map(({name:h,keys:v,up:g})=>({keys:v,up:g,fn:m=>{i({[h]:m}),u&&u(h,m,a[1]())}})).reduce((h,{keys:v,fn:g,up:m=!0})=>(v.forEach(D=>h[D]={fn:g,pressed:!1,up:m}),h),{}),s=({key:h,code:v})=>{const g=o[h]||o[v];if(!g)return;const{fn:m,pressed:D,up:_}=g;g.pressed=!0,(_||!D)&&m(!0)},f=({key:h,code:v})=>{const g=o[h]||o[v];if(!g)return;const{fn:m,up:D}=g;g.pressed=!1,D&&m(!1)},d=c||window;return d.addEventListener("keydown",s,{passive:!0}),d.addEventListener("keyup",f,{passive:!0}),()=>{d.removeEventListener("keydown",s),d.removeEventListener("keyup",f)}},[c,t]),me.createElement(Mn.Provider,{value:a,children:r})}function Da(l){const[r,u,c]=me.useContext(Mn);return[r,u]}const Aa=parseInt(ea.replace(/\D+/g,""));var Ma=Object.defineProperty,La=(l,r,u)=>r in l?Ma(l,r,{enumerable:!0,configurable:!0,writable:!0,value:u}):l[r]=u,cn=(l,r,u)=>(La(l,typeof r!="symbol"?r+"":r,u),u);const Pa=(()=>{const l={uniforms:{turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new Ie},up:{value:new Ie(0,1,0)}},vertexShader:`
      uniform vec3 sunPosition;
      uniform float rayleigh;
      uniform float turbidity;
      uniform float mieCoefficient;
      uniform vec3 up;

      varying vec3 vWorldPosition;
      varying vec3 vSunDirection;
      varying float vSunfade;
      varying vec3 vBetaR;
      varying vec3 vBetaM;
      varying float vSunE;

      // constants for atmospheric scattering
      const float e = 2.71828182845904523536028747135266249775724709369995957;
      const float pi = 3.141592653589793238462643383279502884197169;

      // wavelength of used primaries, according to preetham
      const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );
      // this pre-calcuation replaces older TotalRayleigh(vec3 lambda) function:
      // (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn))
      const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );

      // mie stuff
      // K coefficient for the primaries
      const float v = 4.0;
      const vec3 K = vec3( 0.686, 0.678, 0.666 );
      // MieConst = pi * pow( ( 2.0 * pi ) / lambda, vec3( v - 2.0 ) ) * K
      const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );

      // earth shadow hack
      // cutoffAngle = pi / 1.95;
      const float cutoffAngle = 1.6110731556870734;
      const float steepness = 1.5;
      const float EE = 1000.0;

      float sunIntensity( float zenithAngleCos ) {
        zenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );
        return EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );
      }

      vec3 totalMie( float T ) {
        float c = ( 0.2 * T ) * 10E-18;
        return 0.434 * c * MieConst;
      }

      void main() {

        vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
        vWorldPosition = worldPosition.xyz;

        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        gl_Position.z = gl_Position.w; // set z to camera.far

        vSunDirection = normalize( sunPosition );

        vSunE = sunIntensity( dot( vSunDirection, up ) );

        vSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );

        float rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );

      // extinction (absorbtion + out scattering)
      // rayleigh coefficients
        vBetaR = totalRayleigh * rayleighCoefficient;

      // mie coefficients
        vBetaM = totalMie( turbidity ) * mieCoefficient;

      }
    `,fragmentShader:`
      varying vec3 vWorldPosition;
      varying vec3 vSunDirection;
      varying float vSunfade;
      varying vec3 vBetaR;
      varying vec3 vBetaM;
      varying float vSunE;

      uniform float mieDirectionalG;
      uniform vec3 up;

      const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );

      // constants for atmospheric scattering
      const float pi = 3.141592653589793238462643383279502884197169;

      const float n = 1.0003; // refractive index of air
      const float N = 2.545E25; // number of molecules per unit volume for air at 288.15K and 1013mb (sea level -45 celsius)

      // optical length at zenith for molecules
      const float rayleighZenithLength = 8.4E3;
      const float mieZenithLength = 1.25E3;
      // 66 arc seconds -> degrees, and the cosine of that
      const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;

      // 3.0 / ( 16.0 * pi )
      const float THREE_OVER_SIXTEENPI = 0.05968310365946075;
      // 1.0 / ( 4.0 * pi )
      const float ONE_OVER_FOURPI = 0.07957747154594767;

      float rayleighPhase( float cosTheta ) {
        return THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );
      }

      float hgPhase( float cosTheta, float g ) {
        float g2 = pow( g, 2.0 );
        float inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );
        return ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );
      }

      void main() {

        vec3 direction = normalize( vWorldPosition - cameraPos );

      // optical length
      // cutoff angle at 90 to avoid singularity in next formula.
        float zenithAngle = acos( max( 0.0, dot( up, direction ) ) );
        float inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );
        float sR = rayleighZenithLength * inverse;
        float sM = mieZenithLength * inverse;

      // combined extinction factor
        vec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );

      // in scattering
        float cosTheta = dot( direction, vSunDirection );

        float rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );
        vec3 betaRTheta = vBetaR * rPhase;

        float mPhase = hgPhase( cosTheta, mieDirectionalG );
        vec3 betaMTheta = vBetaM * mPhase;

        vec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );
        Lin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );

      // nightsky
        float theta = acos( direction.y ); // elevation --> y-axis, [-pi/2, pi/2]
        float phi = atan( direction.z, direction.x ); // azimuth --> x-axis [-pi/2, pi/2]
        vec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );
        vec3 L0 = vec3( 0.1 ) * Fex;

      // composition + solar disc
        float sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );
        L0 += ( vSunE * 19000.0 * Fex ) * sundisk;

        vec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );

        vec3 retColor = pow( texColor, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );

        gl_FragColor = vec4( retColor, 1.0 );

      #include <tonemapping_fragment>
      #include <${Aa>=154?"colorspace_fragment":"encodings_fragment"}>

      }
    `},r=new ta({name:"SkyShader",fragmentShader:l.fragmentShader,vertexShader:l.vertexShader,uniforms:Fn.clone(l.uniforms),side:ra,depthWrite:!1});class u extends $t{constructor(){super(new na(1,1,1),r)}}return cn(u,"SkyShader",l),cn(u,"material",r),u})();var Ra=Object.defineProperty,Oa=(l,r,u)=>r in l?Ra(l,r,{enumerable:!0,configurable:!0,writable:!0,value:u}):l[r]=u,Ga=(l,r,u)=>(Oa(l,r+"",u),u);class Ia{constructor(){Ga(this,"_listeners")}addEventListener(r,u){this._listeners===void 0&&(this._listeners={});const c=this._listeners;c[r]===void 0&&(c[r]=[]),c[r].indexOf(u)===-1&&c[r].push(u)}hasEventListener(r,u){if(this._listeners===void 0)return!1;const c=this._listeners;return c[r]!==void 0&&c[r].indexOf(u)!==-1}removeEventListener(r,u){if(this._listeners===void 0)return;const t=this._listeners[r];if(t!==void 0){const e=t.indexOf(u);e!==-1&&t.splice(e,1)}}dispatchEvent(r){if(this._listeners===void 0)return;const c=this._listeners[r.type];if(c!==void 0){r.target=this;const t=c.slice(0);for(let e=0,a=t.length;e<a;e++)t[e].call(this,r);r.target=null}}}var Ba=Object.defineProperty,ja=(l,r,u)=>r in l?Ba(l,r,{enumerable:!0,configurable:!0,writable:!0,value:u}):l[r]=u,Le=(l,r,u)=>(ja(l,typeof r!="symbol"?r+"":r,u),u);const dt=new aa(0,0,0,"YXZ"),ht=new Ie,Na={type:"change"},Wa={type:"lock"},za={type:"unlock"},un=.002,dn=Math.PI/2;let Va=class extends Ia{constructor(r,u){super(),Le(this,"camera"),Le(this,"domElement"),Le(this,"isLocked"),Le(this,"minPolarAngle"),Le(this,"maxPolarAngle"),Le(this,"pointerSpeed"),Le(this,"onMouseMove",c=>{!this.domElement||this.isLocked===!1||(dt.setFromQuaternion(this.camera.quaternion),dt.y-=c.movementX*un*this.pointerSpeed,dt.x-=c.movementY*un*this.pointerSpeed,dt.x=Math.max(dn-this.maxPolarAngle,Math.min(dn-this.minPolarAngle,dt.x)),this.camera.quaternion.setFromEuler(dt),this.dispatchEvent(Na))}),Le(this,"onPointerlockChange",()=>{this.domElement&&(this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(Wa),this.isLocked=!0):(this.dispatchEvent(za),this.isLocked=!1))}),Le(this,"onPointerlockError",()=>{console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}),Le(this,"connect",c=>{this.domElement=c||this.domElement,this.domElement&&(this.domElement.ownerDocument.addEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError))}),Le(this,"disconnect",()=>{this.domElement&&(this.domElement.ownerDocument.removeEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError))}),Le(this,"dispose",()=>{this.disconnect()}),Le(this,"getObject",()=>this.camera),Le(this,"direction",new Ie(0,0,-1)),Le(this,"getDirection",c=>c.copy(this.direction).applyQuaternion(this.camera.quaternion)),Le(this,"moveForward",c=>{ht.setFromMatrixColumn(this.camera.matrix,0),ht.crossVectors(this.camera.up,ht),this.camera.position.addScaledVector(ht,c)}),Le(this,"moveRight",c=>{ht.setFromMatrixColumn(this.camera.matrix,0),this.camera.position.addScaledVector(ht,c)}),Le(this,"lock",()=>{this.domElement&&this.domElement.requestPointerLock()}),Le(this,"unlock",()=>{this.domElement&&this.domElement.ownerDocument.exitPointerLock()}),this.camera=r,this.domElement=u,this.isLocked=!1,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,u&&this.connect(u)}};function Ha(){var l=Object.create(null);function r(t,e){var a=t.id,i=t.name,n=t.dependencies;n===void 0&&(n=[]);var o=t.init;o===void 0&&(o=function(){});var s=t.getTransferables;if(s===void 0&&(s=null),!l[a])try{n=n.map(function(d){return d&&d.isWorkerModule&&(r(d,function(h){if(h instanceof Error)throw h}),d=l[d.id].value),d}),o=c("<"+i+">.init",o),s&&(s=c("<"+i+">.getTransferables",s));var f=null;typeof o=="function"?f=o.apply(void 0,n):console.error("worker module init function failed to rehydrate"),l[a]={id:a,value:f,getTransferables:s},e(f)}catch(d){d&&d.noLog||console.error(d),e(d)}}function u(t,e){var a,i=t.id,n=t.args;(!l[i]||typeof l[i].value!="function")&&e(new Error("Worker module "+i+": not found or its 'init' did not return a function"));try{var o=(a=l[i]).value.apply(a,n);o&&typeof o.then=="function"?o.then(s,function(f){return e(f instanceof Error?f:new Error(""+f))}):s(o)}catch(f){e(f)}function s(f){try{var d=l[i].getTransferables&&l[i].getTransferables(f);(!d||!Array.isArray(d)||!d.length)&&(d=void 0),e(f,d)}catch(h){console.error(h),e(h)}}}function c(t,e){var a=void 0;self.troikaDefine=function(n){return a=n};var i=URL.createObjectURL(new Blob(["/** "+t.replace(/\*/g,"")+` **/

troikaDefine(
`+e+`
)`],{type:"application/javascript"}));try{importScripts(i)}catch(n){console.error(n)}return URL.revokeObjectURL(i),delete self.troikaDefine,a}self.addEventListener("message",function(t){var e=t.data,a=e.messageId,i=e.action,n=e.data;try{i==="registerModule"&&r(n,function(o){o instanceof Error?postMessage({messageId:a,success:!1,error:o.message}):postMessage({messageId:a,success:!0,result:{isCallable:typeof o=="function"}})}),i==="callModule"&&u(n,function(o,s){o instanceof Error?postMessage({messageId:a,success:!1,error:o.message}):postMessage({messageId:a,success:!0,result:o},s||void 0)})}catch(o){postMessage({messageId:a,success:!1,error:o.stack})}})}function Xa(l){var r=function(){for(var u=[],c=arguments.length;c--;)u[c]=arguments[c];return r._getInitResult().then(function(t){if(typeof t=="function")return t.apply(void 0,u);throw new Error("Worker module function was called but `init` did not return a callable function")})};return r._getInitResult=function(){var u=l.dependencies,c=l.init;u=Array.isArray(u)?u.map(function(e){return e&&(e=e.onMainThread||e,e._getInitResult&&(e=e._getInitResult())),e}):[];var t=Promise.all(u).then(function(e){return c.apply(null,e)});return r._getInitResult=function(){return t},t},r}var Ln=function(){var l=!1;if(typeof window<"u"&&typeof window.document<"u")try{var r=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})));r.terminate(),l=!0}catch(u){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+u.message+"]")}return Ln=function(){return l},l},Ya=0,Ka=0,wr=!1,Dt=Object.create(null),At=Object.create(null),Cr=Object.create(null);function gt(l){if((!l||typeof l.init!="function")&&!wr)throw new Error("requires `options.init` function");var r=l.dependencies,u=l.init,c=l.getTransferables,t=l.workerId,e=Xa(l);t==null&&(t="#default");var a="workerModule"+ ++Ya,i=l.name||a,n=null;r=r&&r.map(function(s){return typeof s=="function"&&!s.workerModuleData&&(wr=!0,s=gt({workerId:t,name:"<"+i+"> function dependency: "+s.name,init:`function(){return (
`+Jt(s)+`
)}`}),wr=!1),s&&s.workerModuleData&&(s=s.workerModuleData),s});function o(){for(var s=[],f=arguments.length;f--;)s[f]=arguments[f];if(!Ln())return e.apply(void 0,s);if(!n){n=hn(t,"registerModule",o.workerModuleData);var d=function(){n=null,At[t].delete(d)};(At[t]||(At[t]=new Set)).add(d)}return n.then(function(h){var v=h.isCallable;if(v)return hn(t,"callModule",{id:a,args:s});throw new Error("Worker module function was called but `init` did not return a callable function")})}return o.workerModuleData={isWorkerModule:!0,id:a,name:i,dependencies:r,init:Jt(u),getTransferables:c&&Jt(c)},o.onMainThread=e,o}function Ja(l){At[l]&&At[l].forEach(function(r){r()}),Dt[l]&&(Dt[l].terminate(),delete Dt[l])}function Jt(l){var r=l.toString();return!/^function/.test(r)&&/^\w+\s*\(/.test(r)&&(r="function "+r),r}function Za(l){var r=Dt[l];if(!r){var u=Jt(Ha);r=Dt[l]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+l.replace(/\*/g,"")+` **/

;(`+u+")()"],{type:"application/javascript"}))),r.onmessage=function(c){var t=c.data,e=t.messageId,a=Cr[e];if(!a)throw new Error("WorkerModule response with empty or unknown messageId");delete Cr[e],a(t)}}return r}function hn(l,r,u){return new Promise(function(c,t){var e=++Ka;Cr[e]=function(a){a.success?c(a.result):t(new Error("Error in worker "+r+" call: "+a.error))},Za(l).postMessage({messageId:e,action:r,data:u})})}function Pn(){var l=function(r){function u(B,R,p,S,T,F,U,N){var L=1-U;N.x=L*L*B+2*L*U*p+U*U*T,N.y=L*L*R+2*L*U*S+U*U*F}function c(B,R,p,S,T,F,U,N,L,j){var K=1-L;j.x=K*K*K*B+3*K*K*L*p+3*K*L*L*T+L*L*L*U,j.y=K*K*K*R+3*K*K*L*S+3*K*L*L*F+L*L*L*N}function t(B,R){for(var p=/([MLQCZ])([^MLQCZ]*)/g,S,T,F,U,N;S=p.exec(B);){var L=S[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(j){return parseFloat(j)});switch(S[1]){case"M":U=T=L[0],N=F=L[1];break;case"L":(L[0]!==U||L[1]!==N)&&R("L",U,N,U=L[0],N=L[1]);break;case"Q":{R("Q",U,N,U=L[2],N=L[3],L[0],L[1]);break}case"C":{R("C",U,N,U=L[4],N=L[5],L[0],L[1],L[2],L[3]);break}case"Z":(U!==T||N!==F)&&R("L",U,N,T,F);break}}}function e(B,R,p){p===void 0&&(p=16);var S={x:0,y:0};t(B,function(T,F,U,N,L,j,K,ee,H){switch(T){case"L":R(F,U,N,L);break;case"Q":{for(var W=F,ge=U,ue=1;ue<p;ue++)u(F,U,j,K,N,L,ue/(p-1),S),R(W,ge,S.x,S.y),W=S.x,ge=S.y;break}case"C":{for(var Q=F,te=U,le=1;le<p;le++)c(F,U,j,K,ee,H,N,L,le/(p-1),S),R(Q,te,S.x,S.y),Q=S.x,te=S.y;break}}})}var a="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",i="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",n=new WeakMap,o={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function s(B,R){var p=B.getContext?B.getContext("webgl",o):B,S=n.get(p);if(!S){let K=function(Q){var te=F[Q];if(!te&&(te=F[Q]=p.getExtension(Q),!te))throw new Error(Q+" not supported");return te},ee=function(Q,te){var le=p.createShader(te);return p.shaderSource(le,Q),p.compileShader(le),le},H=function(Q,te,le,V){if(!U[Q]){var re={},$={},G=p.createProgram();p.attachShader(G,ee(te,p.VERTEX_SHADER)),p.attachShader(G,ee(le,p.FRAGMENT_SHADER)),p.linkProgram(G),U[Q]={program:G,transaction:function(Z){p.useProgram(G),Z({setUniform:function(J,Se){for(var ae=[],ie=arguments.length-2;ie-- >0;)ae[ie]=arguments[ie+2];var ce=$[Se]||($[Se]=p.getUniformLocation(G,Se));p["uniform"+J].apply(p,[ce].concat(ae))},setAttribute:function(J,Se,ae,ie,ce){var ve=re[J];ve||(ve=re[J]={buf:p.createBuffer(),loc:p.getAttribLocation(G,J),data:null}),p.bindBuffer(p.ARRAY_BUFFER,ve.buf),p.vertexAttribPointer(ve.loc,Se,p.FLOAT,!1,0,0),p.enableVertexAttribArray(ve.loc),T?p.vertexAttribDivisor(ve.loc,ie):K("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(ve.loc,ie),ce!==ve.data&&(p.bufferData(p.ARRAY_BUFFER,ce,ae),ve.data=ce)}})}}}U[Q].transaction(V)},W=function(Q,te){L++;try{p.activeTexture(p.TEXTURE0+L);var le=N[Q];le||(le=N[Q]=p.createTexture(),p.bindTexture(p.TEXTURE_2D,le),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.NEAREST),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.NEAREST)),p.bindTexture(p.TEXTURE_2D,le),te(le,L)}finally{L--}},ge=function(Q,te,le){var V=p.createFramebuffer();j.push(V),p.bindFramebuffer(p.FRAMEBUFFER,V),p.activeTexture(p.TEXTURE0+te),p.bindTexture(p.TEXTURE_2D,Q),p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,Q,0);try{le(V)}finally{p.deleteFramebuffer(V),p.bindFramebuffer(p.FRAMEBUFFER,j[--j.length-1]||null)}},ue=function(){F={},U={},N={},L=-1,j.length=0};var T=typeof WebGL2RenderingContext<"u"&&p instanceof WebGL2RenderingContext,F={},U={},N={},L=-1,j=[];p.canvas.addEventListener("webglcontextlost",function(Q){ue(),Q.preventDefault()},!1),n.set(p,S={gl:p,isWebGL2:T,getExtension:K,withProgram:H,withTexture:W,withTextureFramebuffer:ge,handleContextLoss:ue})}R(S)}function f(B,R,p,S,T,F,U,N){U===void 0&&(U=15),N===void 0&&(N=null),s(B,function(L){var j=L.gl,K=L.withProgram,ee=L.withTexture;ee("copy",function(H,W){j.texImage2D(j.TEXTURE_2D,0,j.RGBA,T,F,0,j.RGBA,j.UNSIGNED_BYTE,R),K("copy",a,i,function(ge){var ue=ge.setUniform,Q=ge.setAttribute;Q("aUV",2,j.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),ue("1i","image",W),j.bindFramebuffer(j.FRAMEBUFFER,N||null),j.disable(j.BLEND),j.colorMask(U&8,U&4,U&2,U&1),j.viewport(p,S,T,F),j.scissor(p,S,T,F),j.drawArrays(j.TRIANGLES,0,3)})})})}function d(B,R,p){var S=B.width,T=B.height;s(B,function(F){var U=F.gl,N=new Uint8Array(S*T*4);U.readPixels(0,0,S,T,U.RGBA,U.UNSIGNED_BYTE,N),B.width=R,B.height=p,f(U,N,0,0,S,T)})}var h=Object.freeze({__proto__:null,withWebGLContext:s,renderImageData:f,resizeWebGLCanvasWithoutClearing:d});function v(B,R,p,S,T,F){F===void 0&&(F=1);var U=new Uint8Array(B*R),N=S[2]-S[0],L=S[3]-S[1],j=[];e(p,function(Q,te,le,V){j.push({x1:Q,y1:te,x2:le,y2:V,minX:Math.min(Q,le),minY:Math.min(te,V),maxX:Math.max(Q,le),maxY:Math.max(te,V)})}),j.sort(function(Q,te){return Q.maxX-te.maxX});for(var K=0;K<B;K++)for(var ee=0;ee<R;ee++){var H=ge(S[0]+N*(K+.5)/B,S[1]+L*(ee+.5)/R),W=Math.pow(1-Math.abs(H)/T,F)/2;H<0&&(W=1-W),W=Math.max(0,Math.min(255,Math.round(W*255))),U[ee*B+K]=W}return U;function ge(Q,te){for(var le=1/0,V=1/0,re=j.length;re--;){var $=j[re];if($.maxX+V<=Q)break;if(Q+V>$.minX&&te-V<$.maxY&&te+V>$.minY){var G=D(Q,te,$.x1,$.y1,$.x2,$.y2);G<le&&(le=G,V=Math.sqrt(le))}}return ue(Q,te)&&(V=-V),V}function ue(Q,te){for(var le=0,V=j.length;V--;){var re=j[V];if(re.maxX<=Q)break;var $=re.y1>te!=re.y2>te&&Q<(re.x2-re.x1)*(te-re.y1)/(re.y2-re.y1)+re.x1;$&&(le+=re.y1<re.y2?1:-1)}return le!==0}}function g(B,R,p,S,T,F,U,N,L,j){F===void 0&&(F=1),N===void 0&&(N=0),L===void 0&&(L=0),j===void 0&&(j=0),m(B,R,p,S,T,F,U,null,N,L,j)}function m(B,R,p,S,T,F,U,N,L,j,K){F===void 0&&(F=1),L===void 0&&(L=0),j===void 0&&(j=0),K===void 0&&(K=0);for(var ee=v(B,R,p,S,T,F),H=new Uint8Array(ee.length*4),W=0;W<ee.length;W++)H[W*4+K]=ee[W];f(U,H,L,j,B,R,1<<3-K,N)}function D(B,R,p,S,T,F){var U=T-p,N=F-S,L=U*U+N*N,j=L?Math.max(0,Math.min(1,((B-p)*U+(R-S)*N)/L)):0,K=B-(p+j*U),ee=R-(S+j*N);return K*K+ee*ee}var _=Object.freeze({__proto__:null,generate:v,generateIntoCanvas:g,generateIntoFramebuffer:m}),E="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",y="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",x="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",A=new Float32Array([0,0,2,0,0,2]),w=null,k=!1,I={},P=new WeakMap;function Y(B){if(!k&&!X(B))throw new Error("WebGL generation not supported")}function b(B,R,p,S,T,F,U){if(F===void 0&&(F=1),U===void 0&&(U=null),!U&&(U=w,!U)){var N=typeof OffscreenCanvas=="function"?new OffscreenCanvas(1,1):typeof document<"u"?document.createElement("canvas"):null;if(!N)throw new Error("OffscreenCanvas or DOM canvas not supported");U=w=N.getContext("webgl",{depth:!1})}Y(U);var L=new Uint8Array(B*R*4);s(U,function(H){var W=H.gl,ge=H.withTexture,ue=H.withTextureFramebuffer;ge("readable",function(Q,te){W.texImage2D(W.TEXTURE_2D,0,W.RGBA,B,R,0,W.RGBA,W.UNSIGNED_BYTE,null),ue(Q,te,function(le){C(B,R,p,S,T,F,W,le,0,0,0),W.readPixels(0,0,B,R,W.RGBA,W.UNSIGNED_BYTE,L)})})});for(var j=new Uint8Array(B*R),K=0,ee=0;K<L.length;K+=4)j[ee++]=L[K];return j}function M(B,R,p,S,T,F,U,N,L,j){F===void 0&&(F=1),N===void 0&&(N=0),L===void 0&&(L=0),j===void 0&&(j=0),C(B,R,p,S,T,F,U,null,N,L,j)}function C(B,R,p,S,T,F,U,N,L,j,K){F===void 0&&(F=1),L===void 0&&(L=0),j===void 0&&(j=0),K===void 0&&(K=0),Y(U);var ee=[];e(p,function(H,W,ge,ue){ee.push(H,W,ge,ue)}),ee=new Float32Array(ee),s(U,function(H){var W=H.gl,ge=H.isWebGL2,ue=H.getExtension,Q=H.withProgram,te=H.withTexture,le=H.withTextureFramebuffer,V=H.handleContextLoss;if(te("rawDistances",function(re,$){(B!==re._lastWidth||R!==re._lastHeight)&&W.texImage2D(W.TEXTURE_2D,0,W.RGBA,re._lastWidth=B,re._lastHeight=R,0,W.RGBA,W.UNSIGNED_BYTE,null),Q("main",E,y,function(G){var he=G.setAttribute,Z=G.setUniform,oe=!ge&&ue("ANGLE_instanced_arrays"),J=!ge&&ue("EXT_blend_minmax");he("aUV",2,W.STATIC_DRAW,0,A),he("aLineSegment",4,W.DYNAMIC_DRAW,1,ee),Z.apply(void 0,["4f","uGlyphBounds"].concat(S)),Z("1f","uMaxDistance",T),Z("1f","uExponent",F),le(re,$,function(Se){W.enable(W.BLEND),W.colorMask(!0,!0,!0,!0),W.viewport(0,0,B,R),W.scissor(0,0,B,R),W.blendFunc(W.ONE,W.ONE),W.blendEquationSeparate(W.FUNC_ADD,ge?W.MAX:J.MAX_EXT),W.clear(W.COLOR_BUFFER_BIT),ge?W.drawArraysInstanced(W.TRIANGLES,0,3,ee.length/4):oe.drawArraysInstancedANGLE(W.TRIANGLES,0,3,ee.length/4)})}),Q("post",a,x,function(G){G.setAttribute("aUV",2,W.STATIC_DRAW,0,A),G.setUniform("1i","tex",$),W.bindFramebuffer(W.FRAMEBUFFER,N),W.disable(W.BLEND),W.colorMask(K===0,K===1,K===2,K===3),W.viewport(L,j,B,R),W.scissor(L,j,B,R),W.drawArrays(W.TRIANGLES,0,3)})}),W.isContextLost())throw V(),new Error("webgl context lost")})}function X(B){var R=!B||B===w?I:B.canvas||B,p=P.get(R);if(p===void 0){k=!0;var S=null;try{var T=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],F=b(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,B);p=F&&T.length===F.length&&F.every(function(U,N){return U===T[N]}),p||(S="bad trial run results",console.info(T,F))}catch(U){p=!1,S=U.message}S&&console.warn("WebGL SDF generation not supported:",S),k=!1,P.set(R,p)}return p}var z=Object.freeze({__proto__:null,generate:b,generateIntoCanvas:M,generateIntoFramebuffer:C,isSupported:X});function q(B,R,p,S,T,F){T===void 0&&(T=Math.max(S[2]-S[0],S[3]-S[1])/2),F===void 0&&(F=1);try{return b.apply(z,arguments)}catch(U){return console.info("WebGL SDF generation failed, falling back to JS",U),v.apply(_,arguments)}}function ne(B,R,p,S,T,F,U,N,L,j){T===void 0&&(T=Math.max(S[2]-S[0],S[3]-S[1])/2),F===void 0&&(F=1),N===void 0&&(N=0),L===void 0&&(L=0),j===void 0&&(j=0);try{return M.apply(z,arguments)}catch(K){return console.info("WebGL SDF generation failed, falling back to JS",K),g.apply(_,arguments)}}return r.forEachPathCommand=t,r.generate=q,r.generateIntoCanvas=ne,r.javascript=_,r.pathToLineSegments=e,r.webgl=z,r.webglUtils=h,Object.defineProperty(r,"__esModule",{value:!0}),r}({});return l}function Qa(){var l=function(r){var u={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},c={},t={};c.L=1,t[1]="L",Object.keys(u).forEach(function(V,re){c[V]=1<<re+1,t[c[V]]=V}),Object.freeze(c);var e=c.LRI|c.RLI|c.FSI,a=c.L|c.R|c.AL,i=c.B|c.S|c.WS|c.ON|c.FSI|c.LRI|c.RLI|c.PDI,n=c.BN|c.RLE|c.LRE|c.RLO|c.LRO|c.PDF,o=c.S|c.WS|c.B|e|c.PDI|n,s=null;function f(){if(!s){s=new Map;var V=function($){if(u.hasOwnProperty($)){var G=0;u[$].split(",").forEach(function(he){var Z=he.split("+"),oe=Z[0],J=Z[1];oe=parseInt(oe,36),J=J?parseInt(J,36):0,s.set(G+=oe,c[$]);for(var Se=0;Se<J;Se++)s.set(++G,c[$])})}};for(var re in u)V(re)}}function d(V){return f(),s.get(V.codePointAt(0))||c.L}function h(V){return t[d(V)]}var v={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function g(V,re){var $=36,G=0,he=new Map,Z=re&&new Map,oe;return V.split(",").forEach(function J(Se){if(Se.indexOf("+")!==-1)for(var ae=+Se;ae--;)J(oe);else{oe=Se;var ie=Se.split(">"),ce=ie[0],ve=ie[1];ce=String.fromCodePoint(G+=parseInt(ce,$)),ve=String.fromCodePoint(G+=parseInt(ve,$)),he.set(ce,ve),re&&Z.set(ve,ce)}}),{map:he,reverseMap:Z}}var m,D,_;function E(){if(!m){var V=g(v.pairs,!0),re=V.map,$=V.reverseMap;m=re,D=$,_=g(v.canonical,!1).map}}function y(V){return E(),m.get(V)||null}function x(V){return E(),D.get(V)||null}function A(V){return E(),_.get(V)||null}var w=c.L,k=c.R,I=c.EN,P=c.ES,Y=c.ET,b=c.AN,M=c.CS,C=c.B,X=c.S,z=c.ON,q=c.BN,ne=c.NSM,B=c.AL,R=c.LRO,p=c.RLO,S=c.LRE,T=c.RLE,F=c.PDF,U=c.LRI,N=c.RLI,L=c.FSI,j=c.PDI;function K(V,re){for(var $=125,G=new Uint32Array(V.length),he=0;he<V.length;he++)G[he]=d(V[he]);var Z=new Map;function oe(je,He){var Ne=G[je];G[je]=He,Z.set(Ne,Z.get(Ne)-1),Ne&i&&Z.set(i,Z.get(i)-1),Z.set(He,(Z.get(He)||0)+1),He&i&&Z.set(i,(Z.get(i)||0)+1)}for(var J=new Uint8Array(V.length),Se=new Map,ae=[],ie=null,ce=0;ce<V.length;ce++)ie||ae.push(ie={start:ce,end:V.length-1,level:re==="rtl"?1:re==="ltr"?0:rn(ce,!1)}),G[ce]&C&&(ie.end=ce,ie=null);for(var ve=T|S|p|R|e|j|F|C,ke=function(je){return je+(je&1?1:2)},Fe=function(je){return je+(je&1?2:1)},ye=0;ye<ae.length;ye++){ie=ae[ye];var be=[{_level:ie.level,_override:0,_isolate:0}],fe=void 0,De=0,Ee=0,Be=0;Z.clear();for(var Ue=ie.start;Ue<=ie.end;Ue++){var de=G[Ue];if(fe=be[be.length-1],Z.set(de,(Z.get(de)||0)+1),de&i&&Z.set(i,(Z.get(i)||0)+1),de&ve)if(de&(T|S)){J[Ue]=fe._level;var we=(de===T?Fe:ke)(fe._level);we<=$&&!De&&!Ee?be.push({_level:we,_override:0,_isolate:0}):De||Ee++}else if(de&(p|R)){J[Ue]=fe._level;var qe=(de===p?Fe:ke)(fe._level);qe<=$&&!De&&!Ee?be.push({_level:qe,_override:de&p?k:w,_isolate:0}):De||Ee++}else if(de&e){de&L&&(de=rn(Ue+1,!0)===1?N:U),J[Ue]=fe._level,fe._override&&oe(Ue,fe._override);var _e=(de===N?Fe:ke)(fe._level);_e<=$&&De===0&&Ee===0?(Be++,be.push({_level:_e,_override:0,_isolate:1,_isolInitIndex:Ue})):De++}else if(de&j){if(De>0)De--;else if(Be>0){for(Ee=0;!be[be.length-1]._isolate;)be.pop();var xe=be[be.length-1]._isolInitIndex;xe!=null&&(Se.set(xe,Ue),Se.set(Ue,xe)),be.pop(),Be--}fe=be[be.length-1],J[Ue]=fe._level,fe._override&&oe(Ue,fe._override)}else de&F?(De===0&&(Ee>0?Ee--:!fe._isolate&&be.length>1&&(be.pop(),fe=be[be.length-1])),J[Ue]=fe._level):de&C&&(J[Ue]=ie.level);else J[Ue]=fe._level,fe._override&&de!==q&&oe(Ue,fe._override)}for(var Ae=[],Te=null,pe=ie.start;pe<=ie.end;pe++){var Ce=G[pe];if(!(Ce&n)){var Oe=J[pe],Re=Ce&e,Me=Ce===j;Te&&Oe===Te._level?(Te._end=pe,Te._endsWithIsolInit=Re):Ae.push(Te={_start:pe,_end:pe,_level:Oe,_startsWithPDI:Me,_endsWithIsolInit:Re})}}for(var ze=[],$e=0;$e<Ae.length;$e++){var Ye=Ae[$e];if(!Ye._startsWithPDI||Ye._startsWithPDI&&!Se.has(Ye._start)){for(var et=[Te=Ye],at=void 0;Te&&Te._endsWithIsolInit&&(at=Se.get(Te._end))!=null;)for(var Ke=$e+1;Ke<Ae.length;Ke++)if(Ae[Ke]._start===at){et.push(Te=Ae[Ke]);break}for(var Ge=[],ot=0;ot<et.length;ot++)for(var Or=et[ot],rr=Or._start;rr<=Or._end;rr++)Ge.push(rr);for(var Yn=J[Ge[0]],Gr=ie.level,Pt=Ge[0]-1;Pt>=0;Pt--)if(!(G[Pt]&n)){Gr=J[Pt];break}var nr=Ge[Ge.length-1],Kn=J[nr],Ir=ie.level;if(!(G[nr]&e)){for(var Rt=nr+1;Rt<=ie.end;Rt++)if(!(G[Rt]&n)){Ir=J[Rt];break}}ze.push({_seqIndices:Ge,_sosType:Math.max(Gr,Yn)%2?k:w,_eosType:Math.max(Ir,Kn)%2?k:w})}}for(var ar=0;ar<ze.length;ar++){var or=ze[ar],se=or._seqIndices,mt=or._sosType,Jn=or._eosType,lt=J[se[0]]&1?k:w;if(Z.get(ne))for(var Ot=0;Ot<se.length;Ot++){var Br=se[Ot];if(G[Br]&ne){for(var ir=mt,Gt=Ot-1;Gt>=0;Gt--)if(!(G[se[Gt]]&n)){ir=G[se[Gt]];break}oe(Br,ir&(e|j)?z:ir)}}if(Z.get(I))for(var It=0;It<se.length;It++){var jr=se[It];if(G[jr]&I)for(var Bt=It-1;Bt>=-1;Bt--){var Nr=Bt===-1?mt:G[se[Bt]];if(Nr&a){Nr===B&&oe(jr,b);break}}}if(Z.get(B))for(var sr=0;sr<se.length;sr++){var Wr=se[sr];G[Wr]&B&&oe(Wr,k)}if(Z.get(P)||Z.get(M))for(var yt=1;yt<se.length-1;yt++){var lr=se[yt];if(G[lr]&(P|M)){for(var ft=0,fr=0,cr=yt-1;cr>=0&&(ft=G[se[cr]],!!(ft&n));cr--);for(var ur=yt+1;ur<se.length&&(fr=G[se[ur]],!!(fr&n));ur++);ft===fr&&(G[lr]===P?ft===I:ft&(I|b))&&oe(lr,ft)}}if(Z.get(I))for(var Xe=0;Xe<se.length;Xe++){var Zn=se[Xe];if(G[Zn]&I){for(var jt=Xe-1;jt>=0&&G[se[jt]]&(Y|n);jt--)oe(se[jt],I);for(Xe++;Xe<se.length&&G[se[Xe]]&(Y|n|I);Xe++)G[se[Xe]]!==I&&oe(se[Xe],I)}}if(Z.get(Y)||Z.get(P)||Z.get(M))for(var bt=0;bt<se.length;bt++){var zr=se[bt];if(G[zr]&(Y|P|M)){oe(zr,z);for(var Nt=bt-1;Nt>=0&&G[se[Nt]]&n;Nt--)oe(se[Nt],z);for(var Wt=bt+1;Wt<se.length&&G[se[Wt]]&n;Wt++)oe(se[Wt],z)}}if(Z.get(I))for(var dr=0,Vr=mt;dr<se.length;dr++){var Hr=se[dr],hr=G[Hr];hr&I?Vr===w&&oe(Hr,w):hr&a&&(Vr=hr)}if(Z.get(i)){var xt=k|I|b,Xr=xt|w,zt=[];{for(var ct=[],ut=0;ut<se.length;ut++)if(G[se[ut]]&i){var St=V[se[ut]],Yr=void 0;if(y(St)!==null)if(ct.length<63)ct.push({char:St,seqIndex:ut});else break;else if((Yr=x(St))!==null)for(var wt=ct.length-1;wt>=0;wt--){var vr=ct[wt].char;if(vr===Yr||vr===x(A(St))||y(A(vr))===St){zt.push([ct[wt].seqIndex,ut]),ct.length=wt;break}}}zt.sort(function(je,He){return je[0]-He[0]})}for(var pr=0;pr<zt.length;pr++){for(var Kr=zt[pr],Vt=Kr[0],gr=Kr[1],Jr=!1,Ve=0,mr=Vt+1;mr<gr;mr++){var Zr=se[mr];if(G[Zr]&Xr){Jr=!0;var Qr=G[Zr]&xt?k:w;if(Qr===lt){Ve=Qr;break}}}if(Jr&&!Ve){Ve=mt;for(var yr=Vt-1;yr>=0;yr--){var qr=se[yr];if(G[qr]&Xr){var $r=G[qr]&xt?k:w;$r!==lt?Ve=$r:Ve=lt;break}}}if(Ve){if(G[se[Vt]]=G[se[gr]]=Ve,Ve!==lt){for(var _t=Vt+1;_t<se.length;_t++)if(!(G[se[_t]]&n)){d(V[se[_t]])&ne&&(G[se[_t]]=Ve);break}}if(Ve!==lt){for(var kt=gr+1;kt<se.length;kt++)if(!(G[se[kt]]&n)){d(V[se[kt]])&ne&&(G[se[kt]]=Ve);break}}}}for(var tt=0;tt<se.length;tt++)if(G[se[tt]]&i){for(var en=tt,br=tt,xr=mt,Ut=tt-1;Ut>=0;Ut--)if(G[se[Ut]]&n)en=Ut;else{xr=G[se[Ut]]&xt?k:w;break}for(var tn=Jn,Et=tt+1;Et<se.length;Et++)if(G[se[Et]]&(i|n))br=Et;else{tn=G[se[Et]]&xt?k:w;break}for(var Sr=en;Sr<=br;Sr++)G[se[Sr]]=xr===tn?xr:lt;tt=br}}}for(var We=ie.start;We<=ie.end;We++){var Qn=J[We],Ht=G[We];if(Qn&1?Ht&(w|I|b)&&J[We]++:Ht&k?J[We]++:Ht&(b|I)&&(J[We]+=2),Ht&n&&(J[We]=We===0?ie.level:J[We-1]),We===ie.end||d(V[We])&(X|C))for(var Xt=We;Xt>=0&&d(V[Xt])&o;Xt--)J[Xt]=ie.level}}return{levels:J,paragraphs:ae};function rn(je,He){for(var Ne=je;Ne<V.length;Ne++){var rt=G[Ne];if(rt&(k|B))return 1;if(rt&(C|w)||He&&rt===j)return 0;if(rt&e){var nn=qn(Ne);Ne=nn===-1?V.length:nn}}return 0}function qn(je){for(var He=1,Ne=je+1;Ne<V.length;Ne++){var rt=G[Ne];if(rt&C)break;if(rt&j){if(--He===0)return Ne}else rt&e&&He++}return-1}}var ee="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",H;function W(){if(!H){var V=g(ee,!0),re=V.map,$=V.reverseMap;$.forEach(function(G,he){re.set(he,G)}),H=re}}function ge(V){return W(),H.get(V)||null}function ue(V,re,$,G){var he=V.length;$=Math.max(0,$==null?0:+$),G=Math.min(he-1,G==null?he-1:+G);for(var Z=new Map,oe=$;oe<=G;oe++)if(re[oe]&1){var J=ge(V[oe]);J!==null&&Z.set(oe,J)}return Z}function Q(V,re,$,G){var he=V.length;$=Math.max(0,$==null?0:+$),G=Math.min(he-1,G==null?he-1:+G);var Z=[];return re.paragraphs.forEach(function(oe){var J=Math.max($,oe.start),Se=Math.min(G,oe.end);if(J<Se){for(var ae=re.levels.slice(J,Se+1),ie=Se;ie>=J&&d(V[ie])&o;ie--)ae[ie]=oe.level;for(var ce=oe.level,ve=1/0,ke=0;ke<ae.length;ke++){var Fe=ae[ke];Fe>ce&&(ce=Fe),Fe<ve&&(ve=Fe|1)}for(var ye=ce;ye>=ve;ye--)for(var be=0;be<ae.length;be++)if(ae[be]>=ye){for(var fe=be;be+1<ae.length&&ae[be+1]>=ye;)be++;be>fe&&Z.push([fe+J,be+J])}}}),Z}function te(V,re,$,G){var he=le(V,re,$,G),Z=[].concat(V);return he.forEach(function(oe,J){Z[J]=(re.levels[oe]&1?ge(V[oe]):null)||V[oe]}),Z.join("")}function le(V,re,$,G){for(var he=Q(V,re,$,G),Z=[],oe=0;oe<V.length;oe++)Z[oe]=oe;return he.forEach(function(J){for(var Se=J[0],ae=J[1],ie=Z.slice(Se,ae+1),ce=ie.length;ce--;)Z[ae-ce]=ie[ce]}),Z}return r.closingToOpeningBracket=x,r.getBidiCharType=d,r.getBidiCharTypeName=h,r.getCanonicalBracket=A,r.getEmbeddingLevels=K,r.getMirroredCharacter=ge,r.getMirroredCharactersMap=ue,r.getReorderSegments=Q,r.getReorderedIndices=le,r.getReorderedString=te,r.openingToClosingBracket=y,Object.defineProperty(r,"__esModule",{value:!0}),r}({});return l}const Rn=/\bvoid\s+main\s*\(\s*\)\s*{/g;function Fr(l){const r=/^[ \t]*#include +<([\w\d./]+)>/gm;function u(c,t){let e=la[t];return e?Fr(e):c}return l.replace(r,u)}const Pe=[];for(let l=0;l<256;l++)Pe[l]=(l<16?"0":"")+l.toString(16);function qa(){const l=Math.random()*4294967295|0,r=Math.random()*4294967295|0,u=Math.random()*4294967295|0,c=Math.random()*4294967295|0;return(Pe[l&255]+Pe[l>>8&255]+Pe[l>>16&255]+Pe[l>>24&255]+"-"+Pe[r&255]+Pe[r>>8&255]+"-"+Pe[r>>16&15|64]+Pe[r>>24&255]+"-"+Pe[u&63|128]+Pe[u>>8&255]+"-"+Pe[u>>16&255]+Pe[u>>24&255]+Pe[c&255]+Pe[c>>8&255]+Pe[c>>16&255]+Pe[c>>24&255]).toUpperCase()}const it=Object.assign||function(){let l=arguments[0];for(let r=1,u=arguments.length;r<u;r++){let c=arguments[r];if(c)for(let t in c)Object.prototype.hasOwnProperty.call(c,t)&&(l[t]=c[t])}return l},$a=Date.now(),vn=new WeakMap,pn=new Map;let eo=1e10;function Dr(l,r){const u=ao(r);let c=vn.get(l);if(c||vn.set(l,c=Object.create(null)),c[u])return new c[u];const t=`_onBeforeCompile${u}`,e=function(o,s){l.onBeforeCompile.call(this,o,s);const f=this.customProgramCacheKey()+"|"+o.vertexShader+"|"+o.fragmentShader;let d=pn[f];if(!d){const h=to(this,o,r,u);d=pn[f]=h}o.vertexShader=d.vertexShader,o.fragmentShader=d.fragmentShader,it(o.uniforms,this.uniforms),r.timeUniform&&(o.uniforms[r.timeUniform]={get value(){return Date.now()-$a}}),this[t]&&this[t](o)},a=function(){return i(r.chained?l:l.clone())},i=function(o){const s=Object.create(o,n);return Object.defineProperty(s,"baseMaterial",{value:l}),Object.defineProperty(s,"id",{value:eo++}),s.uuid=qa(),s.uniforms=it({},o.uniforms,r.uniforms),s.defines=it({},o.defines,r.defines),s.defines[`TROIKA_DERIVED_MATERIAL_${u}`]="",s.extensions=it({},o.extensions,r.extensions),s._listeners=void 0,s},n={constructor:{value:a},isDerivedMaterial:{value:!0},type:{get:()=>l.type,set:o=>{l.type=o}},isDerivedFrom:{writable:!0,configurable:!0,value:function(o){const s=this.baseMaterial;return o===s||s.isDerivedMaterial&&s.isDerivedFrom(o)||!1}},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return l.customProgramCacheKey()+"|"+u}},onBeforeCompile:{get(){return e},set(o){this[t]=o}},copy:{writable:!0,configurable:!0,value:function(o){return l.copy.call(this,o),!l.isShaderMaterial&&!l.isDerivedMaterial&&(it(this.extensions,o.extensions),it(this.defines,o.defines),it(this.uniforms,Fn.clone(o.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const o=new l.constructor;return i(o).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let o=this._depthMaterial;return o||(o=this._depthMaterial=Dr(l.isDerivedMaterial?l.getDepthMaterial():new ia({depthPacking:sa}),r),o.defines.IS_DEPTH_MATERIAL="",o.uniforms=this.uniforms),o}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let o=this._distanceMaterial;return o||(o=this._distanceMaterial=Dr(l.isDerivedMaterial?l.getDistanceMaterial():new oa,r),o.defines.IS_DISTANCE_MATERIAL="",o.uniforms=this.uniforms),o}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:o,_distanceMaterial:s}=this;o&&o.dispose(),s&&s.dispose(),l.dispose.call(this)}}};return c[u]=a,new a}function to(l,{vertexShader:r,fragmentShader:u},c,t){let{vertexDefs:e,vertexMainIntro:a,vertexMainOutro:i,vertexTransform:n,fragmentDefs:o,fragmentMainIntro:s,fragmentMainOutro:f,fragmentColorTransform:d,customRewriter:h,timeUniform:v}=c;if(e=e||"",a=a||"",i=i||"",o=o||"",s=s||"",f=f||"",(n||h)&&(r=Fr(r)),(d||h)&&(u=u.replace(/^[ \t]*#include <((?:tonemapping|encodings|colorspace|fog|premultiplied_alpha|dithering)_fragment)>/gm,`
//!BEGIN_POST_CHUNK $1
$&
//!END_POST_CHUNK
`),u=Fr(u)),h){let g=h({vertexShader:r,fragmentShader:u});r=g.vertexShader,u=g.fragmentShader}if(d){let g=[];u=u.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,m=>(g.push(m),"")),f=`${d}
${g.join(`
`)}
${f}`}if(v){const g=`
uniform float ${v};
`;e=g+e,o=g+o}return n&&(r=`vec3 troika_position_${t};
vec3 troika_normal_${t};
vec2 troika_uv_${t};
${r}
`,e=`${e}
void troikaVertexTransform${t}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${n}
}
`,a=`
troika_position_${t} = vec3(position);
troika_normal_${t} = vec3(normal);
troika_uv_${t} = vec2(uv);
troikaVertexTransform${t}(troika_position_${t}, troika_normal_${t}, troika_uv_${t});
${a}
`,r=r.replace(/\b(position|normal|uv)\b/g,(g,m,D,_)=>/\battribute\s+vec[23]\s+$/.test(_.substr(0,D))?m:`troika_${m}_${t}`),l.map&&l.map.channel>0||(r=r.replace(/\bMAP_UV\b/g,`troika_uv_${t}`))),r=gn(r,t,e,a,i),u=gn(u,t,o,s,f),{vertexShader:r,fragmentShader:u}}function gn(l,r,u,c,t){return(c||t||u)&&(l=l.replace(Rn,`
${u}
void troikaOrigMain${r}() {`),l+=`
void main() {
  ${c}
  troikaOrigMain${r}();
  ${t}
}`),l}function ro(l,r){return l==="uniforms"?void 0:typeof r=="function"?r.toString():r}let no=0;const mn=new Map;function ao(l){const r=JSON.stringify(l,ro);let u=mn.get(r);return u==null&&mn.set(r,u=++no),u}/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/function oo(){return typeof window>"u"&&(self.window=self),function(l){var r={parse:function(t){var e=r._bin,a=new Uint8Array(t);if(e.readASCII(a,0,4)=="ttcf"){var i=4;e.readUshort(a,i),i+=2,e.readUshort(a,i),i+=2;var n=e.readUint(a,i);i+=4;for(var o=[],s=0;s<n;s++){var f=e.readUint(a,i);i+=4,o.push(r._readFont(a,f))}return o}return[r._readFont(a,0)]},_readFont:function(t,e){var a=r._bin,i=e;a.readFixed(t,e),e+=4;var n=a.readUshort(t,e);e+=2,a.readUshort(t,e),e+=2,a.readUshort(t,e),e+=2,a.readUshort(t,e),e+=2;for(var o=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],s={_data:t,_offset:i},f={},d=0;d<n;d++){var h=a.readASCII(t,e,4);e+=4,a.readUint(t,e),e+=4;var v=a.readUint(t,e);e+=4;var g=a.readUint(t,e);e+=4,f[h]={offset:v,length:g}}for(d=0;d<o.length;d++){var m=o[d];f[m]&&(s[m.trim()]=r[m.trim()].parse(t,f[m].offset,f[m].length,s))}return s},_tabOffset:function(t,e,a){for(var i=r._bin,n=i.readUshort(t,a+4),o=a+12,s=0;s<n;s++){var f=i.readASCII(t,o,4);o+=4,i.readUint(t,o),o+=4;var d=i.readUint(t,o);if(o+=4,i.readUint(t,o),o+=4,f==e)return d}return 0}};r._bin={readFixed:function(t,e){return(t[e]<<8|t[e+1])+(t[e+2]<<8|t[e+3])/65540},readF2dot14:function(t,e){return r._bin.readShort(t,e)/16384},readInt:function(t,e){return r._bin._view(t).getInt32(e)},readInt8:function(t,e){return r._bin._view(t).getInt8(e)},readShort:function(t,e){return r._bin._view(t).getInt16(e)},readUshort:function(t,e){return r._bin._view(t).getUint16(e)},readUshorts:function(t,e,a){for(var i=[],n=0;n<a;n++)i.push(r._bin.readUshort(t,e+2*n));return i},readUint:function(t,e){return r._bin._view(t).getUint32(e)},readUint64:function(t,e){return 4294967296*r._bin.readUint(t,e)+r._bin.readUint(t,e+4)},readASCII:function(t,e,a){for(var i="",n=0;n<a;n++)i+=String.fromCharCode(t[e+n]);return i},readUnicode:function(t,e,a){for(var i="",n=0;n<a;n++){var o=t[e++]<<8|t[e++];i+=String.fromCharCode(o)}return i},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(t,e,a){var i=r._bin._tdec;return i&&e==0&&a==t.length?i.decode(t):r._bin.readASCII(t,e,a)},readBytes:function(t,e,a){for(var i=[],n=0;n<a;n++)i.push(t[e+n]);return i},readASCIIArray:function(t,e,a){for(var i=[],n=0;n<a;n++)i.push(String.fromCharCode(t[e+n]));return i},_view:function(t){return t._dataView||(t._dataView=t.buffer?new DataView(t.buffer,t.byteOffset,t.byteLength):new DataView(new Uint8Array(t).buffer))}},r._lctf={},r._lctf.parse=function(t,e,a,i,n){var o=r._bin,s={},f=e;o.readFixed(t,e),e+=4;var d=o.readUshort(t,e);e+=2;var h=o.readUshort(t,e);e+=2;var v=o.readUshort(t,e);return e+=2,s.scriptList=r._lctf.readScriptList(t,f+d),s.featureList=r._lctf.readFeatureList(t,f+h),s.lookupList=r._lctf.readLookupList(t,f+v,n),s},r._lctf.readLookupList=function(t,e,a){var i=r._bin,n=e,o=[],s=i.readUshort(t,e);e+=2;for(var f=0;f<s;f++){var d=i.readUshort(t,e);e+=2;var h=r._lctf.readLookupTable(t,n+d,a);o.push(h)}return o},r._lctf.readLookupTable=function(t,e,a){var i=r._bin,n=e,o={tabs:[]};o.ltype=i.readUshort(t,e),e+=2,o.flag=i.readUshort(t,e),e+=2;var s=i.readUshort(t,e);e+=2;for(var f=o.ltype,d=0;d<s;d++){var h=i.readUshort(t,e);e+=2;var v=a(t,f,n+h,o);o.tabs.push(v)}return o},r._lctf.numOfOnes=function(t){for(var e=0,a=0;a<32;a++)t>>>a&1&&e++;return e},r._lctf.readClassDef=function(t,e){var a=r._bin,i=[],n=a.readUshort(t,e);if(e+=2,n==1){var o=a.readUshort(t,e);e+=2;var s=a.readUshort(t,e);e+=2;for(var f=0;f<s;f++)i.push(o+f),i.push(o+f),i.push(a.readUshort(t,e)),e+=2}if(n==2){var d=a.readUshort(t,e);for(e+=2,f=0;f<d;f++)i.push(a.readUshort(t,e)),e+=2,i.push(a.readUshort(t,e)),e+=2,i.push(a.readUshort(t,e)),e+=2}return i},r._lctf.getInterval=function(t,e){for(var a=0;a<t.length;a+=3){var i=t[a],n=t[a+1];if(t[a+2],i<=e&&e<=n)return a}return-1},r._lctf.readCoverage=function(t,e){var a=r._bin,i={};i.fmt=a.readUshort(t,e),e+=2;var n=a.readUshort(t,e);return e+=2,i.fmt==1&&(i.tab=a.readUshorts(t,e,n)),i.fmt==2&&(i.tab=a.readUshorts(t,e,3*n)),i},r._lctf.coverageIndex=function(t,e){var a=t.tab;if(t.fmt==1)return a.indexOf(e);if(t.fmt==2){var i=r._lctf.getInterval(a,e);if(i!=-1)return a[i+2]+(e-a[i])}return-1},r._lctf.readFeatureList=function(t,e){var a=r._bin,i=e,n=[],o=a.readUshort(t,e);e+=2;for(var s=0;s<o;s++){var f=a.readASCII(t,e,4);e+=4;var d=a.readUshort(t,e);e+=2;var h=r._lctf.readFeatureTable(t,i+d);h.tag=f.trim(),n.push(h)}return n},r._lctf.readFeatureTable=function(t,e){var a=r._bin,i=e,n={},o=a.readUshort(t,e);e+=2,o>0&&(n.featureParams=i+o);var s=a.readUshort(t,e);e+=2,n.tab=[];for(var f=0;f<s;f++)n.tab.push(a.readUshort(t,e+2*f));return n},r._lctf.readScriptList=function(t,e){var a=r._bin,i=e,n={},o=a.readUshort(t,e);e+=2;for(var s=0;s<o;s++){var f=a.readASCII(t,e,4);e+=4;var d=a.readUshort(t,e);e+=2,n[f.trim()]=r._lctf.readScriptTable(t,i+d)}return n},r._lctf.readScriptTable=function(t,e){var a=r._bin,i=e,n={},o=a.readUshort(t,e);e+=2,o>0&&(n.default=r._lctf.readLangSysTable(t,i+o));var s=a.readUshort(t,e);e+=2;for(var f=0;f<s;f++){var d=a.readASCII(t,e,4);e+=4;var h=a.readUshort(t,e);e+=2,n[d.trim()]=r._lctf.readLangSysTable(t,i+h)}return n},r._lctf.readLangSysTable=function(t,e){var a=r._bin,i={};a.readUshort(t,e),e+=2,i.reqFeature=a.readUshort(t,e),e+=2;var n=a.readUshort(t,e);return e+=2,i.features=a.readUshorts(t,e,n),i},r.CFF={},r.CFF.parse=function(t,e,a){var i=r._bin;(t=new Uint8Array(t.buffer,e,a))[e=0],t[++e],t[++e],t[++e],e++;var n=[];e=r.CFF.readIndex(t,e,n);for(var o=[],s=0;s<n.length-1;s++)o.push(i.readASCII(t,e+n[s],n[s+1]-n[s]));e+=n[n.length-1];var f=[];e=r.CFF.readIndex(t,e,f);var d=[];for(s=0;s<f.length-1;s++)d.push(r.CFF.readDict(t,e+f[s],e+f[s+1]));e+=f[f.length-1];var h=d[0],v=[];e=r.CFF.readIndex(t,e,v);var g=[];for(s=0;s<v.length-1;s++)g.push(i.readASCII(t,e+v[s],v[s+1]-v[s]));if(e+=v[v.length-1],r.CFF.readSubrs(t,e,h),h.CharStrings){e=h.CharStrings,v=[],e=r.CFF.readIndex(t,e,v);var m=[];for(s=0;s<v.length-1;s++)m.push(i.readBytes(t,e+v[s],v[s+1]-v[s]));h.CharStrings=m}if(h.ROS){e=h.FDArray;var D=[];for(e=r.CFF.readIndex(t,e,D),h.FDArray=[],s=0;s<D.length-1;s++){var _=r.CFF.readDict(t,e+D[s],e+D[s+1]);r.CFF._readFDict(t,_,g),h.FDArray.push(_)}e+=D[D.length-1],e=h.FDSelect,h.FDSelect=[];var E=t[e];if(e++,E!=3)throw E;var y=i.readUshort(t,e);for(e+=2,s=0;s<y+1;s++)h.FDSelect.push(i.readUshort(t,e),t[e+2]),e+=3}return h.Encoding&&(h.Encoding=r.CFF.readEncoding(t,h.Encoding,h.CharStrings.length)),h.charset&&(h.charset=r.CFF.readCharset(t,h.charset,h.CharStrings.length)),r.CFF._readFDict(t,h,g),h},r.CFF._readFDict=function(t,e,a){var i;for(var n in e.Private&&(i=e.Private[1],e.Private=r.CFF.readDict(t,i,i+e.Private[0]),e.Private.Subrs&&r.CFF.readSubrs(t,i+e.Private.Subrs,e.Private)),e)["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(n)!=-1&&(e[n]=a[e[n]-426+35])},r.CFF.readSubrs=function(t,e,a){var i=r._bin,n=[];e=r.CFF.readIndex(t,e,n);var o,s=n.length;o=s<1240?107:s<33900?1131:32768,a.Bias=o,a.Subrs=[];for(var f=0;f<n.length-1;f++)a.Subrs.push(i.readBytes(t,e+n[f],n[f+1]-n[f]))},r.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],r.CFF.glyphByUnicode=function(t,e){for(var a=0;a<t.charset.length;a++)if(t.charset[a]==e)return a;return-1},r.CFF.glyphBySE=function(t,e){return e<0||e>255?-1:r.CFF.glyphByUnicode(t,r.CFF.tableSE[e])},r.CFF.readEncoding=function(t,e,a){r._bin;var i=[".notdef"],n=t[e];if(e++,n!=0)throw"error: unknown encoding format: "+n;var o=t[e];e++;for(var s=0;s<o;s++)i.push(t[e+s]);return i},r.CFF.readCharset=function(t,e,a){var i=r._bin,n=[".notdef"],o=t[e];if(e++,o==0)for(var s=0;s<a;s++){var f=i.readUshort(t,e);e+=2,n.push(f)}else{if(o!=1&&o!=2)throw"error: format: "+o;for(;n.length<a;){f=i.readUshort(t,e),e+=2;var d=0;for(o==1?(d=t[e],e++):(d=i.readUshort(t,e),e+=2),s=0;s<=d;s++)n.push(f),f++}}return n},r.CFF.readIndex=function(t,e,a){var i=r._bin,n=i.readUshort(t,e)+1,o=t[e+=2];if(e++,o==1)for(var s=0;s<n;s++)a.push(t[e+s]);else if(o==2)for(s=0;s<n;s++)a.push(i.readUshort(t,e+2*s));else if(o==3)for(s=0;s<n;s++)a.push(16777215&i.readUint(t,e+3*s-1));else if(n!=1)throw"unsupported offset size: "+o+", count: "+n;return(e+=n*o)-1},r.CFF.getCharString=function(t,e,a){var i=r._bin,n=t[e],o=t[e+1];t[e+2],t[e+3],t[e+4];var s=1,f=null,d=null;n<=20&&(f=n,s=1),n==12&&(f=100*n+o,s=2),21<=n&&n<=27&&(f=n,s=1),n==28&&(d=i.readShort(t,e+1),s=3),29<=n&&n<=31&&(f=n,s=1),32<=n&&n<=246&&(d=n-139,s=1),247<=n&&n<=250&&(d=256*(n-247)+o+108,s=2),251<=n&&n<=254&&(d=256*-(n-251)-o-108,s=2),n==255&&(d=i.readInt(t,e+1)/65535,s=5),a.val=d??"o"+f,a.size=s},r.CFF.readCharString=function(t,e,a){for(var i=e+a,n=r._bin,o=[];e<i;){var s=t[e],f=t[e+1];t[e+2],t[e+3],t[e+4];var d=1,h=null,v=null;s<=20&&(h=s,d=1),s==12&&(h=100*s+f,d=2),s!=19&&s!=20||(h=s,d=2),21<=s&&s<=27&&(h=s,d=1),s==28&&(v=n.readShort(t,e+1),d=3),29<=s&&s<=31&&(h=s,d=1),32<=s&&s<=246&&(v=s-139,d=1),247<=s&&s<=250&&(v=256*(s-247)+f+108,d=2),251<=s&&s<=254&&(v=256*-(s-251)-f-108,d=2),s==255&&(v=n.readInt(t,e+1)/65535,d=5),o.push(v??"o"+h),e+=d}return o},r.CFF.readDict=function(t,e,a){for(var i=r._bin,n={},o=[];e<a;){var s=t[e],f=t[e+1];t[e+2],t[e+3],t[e+4];var d=1,h=null,v=null;if(s==28&&(v=i.readShort(t,e+1),d=3),s==29&&(v=i.readInt(t,e+1),d=5),32<=s&&s<=246&&(v=s-139,d=1),247<=s&&s<=250&&(v=256*(s-247)+f+108,d=2),251<=s&&s<=254&&(v=256*-(s-251)-f-108,d=2),s==255)throw v=i.readInt(t,e+1)/65535,d=5,"unknown number";if(s==30){var g=[];for(d=1;;){var m=t[e+d];d++;var D=m>>4,_=15&m;if(D!=15&&g.push(D),_!=15&&g.push(_),_==15)break}for(var E="",y=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],x=0;x<g.length;x++)E+=y[g[x]];v=parseFloat(E)}s<=21&&(h=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][s],d=1,s==12&&(h=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][f],d=2)),h!=null?(n[h]=o.length==1?o[0]:o,o=[]):o.push(v),e+=d}return n},r.cmap={},r.cmap.parse=function(t,e,a){t=new Uint8Array(t.buffer,e,a),e=0;var i=r._bin,n={};i.readUshort(t,e),e+=2;var o=i.readUshort(t,e);e+=2;var s=[];n.tables=[];for(var f=0;f<o;f++){var d=i.readUshort(t,e);e+=2;var h=i.readUshort(t,e);e+=2;var v=i.readUint(t,e);e+=4;var g="p"+d+"e"+h,m=s.indexOf(v);if(m==-1){var D;m=n.tables.length,s.push(v);var _=i.readUshort(t,v);_==0?D=r.cmap.parse0(t,v):_==4?D=r.cmap.parse4(t,v):_==6?D=r.cmap.parse6(t,v):_==12?D=r.cmap.parse12(t,v):console.debug("unknown format: "+_,d,h,v),n.tables.push(D)}if(n[g]!=null)throw"multiple tables for one platform+encoding";n[g]=m}return n},r.cmap.parse0=function(t,e){var a=r._bin,i={};i.format=a.readUshort(t,e),e+=2;var n=a.readUshort(t,e);e+=2,a.readUshort(t,e),e+=2,i.map=[];for(var o=0;o<n-6;o++)i.map.push(t[e+o]);return i},r.cmap.parse4=function(t,e){var a=r._bin,i=e,n={};n.format=a.readUshort(t,e),e+=2;var o=a.readUshort(t,e);e+=2,a.readUshort(t,e),e+=2;var s=a.readUshort(t,e);e+=2;var f=s/2;n.searchRange=a.readUshort(t,e),e+=2,n.entrySelector=a.readUshort(t,e),e+=2,n.rangeShift=a.readUshort(t,e),e+=2,n.endCount=a.readUshorts(t,e,f),e+=2*f,e+=2,n.startCount=a.readUshorts(t,e,f),e+=2*f,n.idDelta=[];for(var d=0;d<f;d++)n.idDelta.push(a.readShort(t,e)),e+=2;for(n.idRangeOffset=a.readUshorts(t,e,f),e+=2*f,n.glyphIdArray=[];e<i+o;)n.glyphIdArray.push(a.readUshort(t,e)),e+=2;return n},r.cmap.parse6=function(t,e){var a=r._bin,i={};i.format=a.readUshort(t,e),e+=2,a.readUshort(t,e),e+=2,a.readUshort(t,e),e+=2,i.firstCode=a.readUshort(t,e),e+=2;var n=a.readUshort(t,e);e+=2,i.glyphIdArray=[];for(var o=0;o<n;o++)i.glyphIdArray.push(a.readUshort(t,e)),e+=2;return i},r.cmap.parse12=function(t,e){var a=r._bin,i={};i.format=a.readUshort(t,e),e+=2,e+=2,a.readUint(t,e),e+=4,a.readUint(t,e),e+=4;var n=a.readUint(t,e);e+=4,i.groups=[];for(var o=0;o<n;o++){var s=e+12*o,f=a.readUint(t,s+0),d=a.readUint(t,s+4),h=a.readUint(t,s+8);i.groups.push([f,d,h])}return i},r.glyf={},r.glyf.parse=function(t,e,a,i){for(var n=[],o=0;o<i.maxp.numGlyphs;o++)n.push(null);return n},r.glyf._parseGlyf=function(t,e){var a=r._bin,i=t._data,n=r._tabOffset(i,"glyf",t._offset)+t.loca[e];if(t.loca[e]==t.loca[e+1])return null;var o={};if(o.noc=a.readShort(i,n),n+=2,o.xMin=a.readShort(i,n),n+=2,o.yMin=a.readShort(i,n),n+=2,o.xMax=a.readShort(i,n),n+=2,o.yMax=a.readShort(i,n),n+=2,o.xMin>=o.xMax||o.yMin>=o.yMax)return null;if(o.noc>0){o.endPts=[];for(var s=0;s<o.noc;s++)o.endPts.push(a.readUshort(i,n)),n+=2;var f=a.readUshort(i,n);if(n+=2,i.length-n<f)return null;o.instructions=a.readBytes(i,n,f),n+=f;var d=o.endPts[o.noc-1]+1;for(o.flags=[],s=0;s<d;s++){var h=i[n];if(n++,o.flags.push(h),(8&h)!=0){var v=i[n];n++;for(var g=0;g<v;g++)o.flags.push(h),s++}}for(o.xs=[],s=0;s<d;s++){var m=(2&o.flags[s])!=0,D=(16&o.flags[s])!=0;m?(o.xs.push(D?i[n]:-i[n]),n++):D?o.xs.push(0):(o.xs.push(a.readShort(i,n)),n+=2)}for(o.ys=[],s=0;s<d;s++)m=(4&o.flags[s])!=0,D=(32&o.flags[s])!=0,m?(o.ys.push(D?i[n]:-i[n]),n++):D?o.ys.push(0):(o.ys.push(a.readShort(i,n)),n+=2);var _=0,E=0;for(s=0;s<d;s++)_+=o.xs[s],E+=o.ys[s],o.xs[s]=_,o.ys[s]=E}else{var y;o.parts=[];do{y=a.readUshort(i,n),n+=2;var x={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(o.parts.push(x),x.glyphIndex=a.readUshort(i,n),n+=2,1&y){var A=a.readShort(i,n);n+=2;var w=a.readShort(i,n);n+=2}else A=a.readInt8(i,n),n++,w=a.readInt8(i,n),n++;2&y?(x.m.tx=A,x.m.ty=w):(x.p1=A,x.p2=w),8&y?(x.m.a=x.m.d=a.readF2dot14(i,n),n+=2):64&y?(x.m.a=a.readF2dot14(i,n),n+=2,x.m.d=a.readF2dot14(i,n),n+=2):128&y&&(x.m.a=a.readF2dot14(i,n),n+=2,x.m.b=a.readF2dot14(i,n),n+=2,x.m.c=a.readF2dot14(i,n),n+=2,x.m.d=a.readF2dot14(i,n),n+=2)}while(32&y);if(256&y){var k=a.readUshort(i,n);for(n+=2,o.instr=[],s=0;s<k;s++)o.instr.push(i[n]),n++}}return o},r.GDEF={},r.GDEF.parse=function(t,e,a,i){var n=e;e+=4;var o=r._bin.readUshort(t,e);return{glyphClassDef:o===0?null:r._lctf.readClassDef(t,n+o)}},r.GPOS={},r.GPOS.parse=function(t,e,a,i){return r._lctf.parse(t,e,a,i,r.GPOS.subt)},r.GPOS.subt=function(t,e,a,i){var n=r._bin,o=a,s={};if(s.fmt=n.readUshort(t,a),a+=2,e==1||e==2||e==3||e==7||e==8&&s.fmt<=2){var f=n.readUshort(t,a);a+=2,s.coverage=r._lctf.readCoverage(t,f+o)}if(e==1&&s.fmt==1){var d=n.readUshort(t,a);a+=2,d!=0&&(s.pos=r.GPOS.readValueRecord(t,a,d))}else if(e==2&&s.fmt>=1&&s.fmt<=2){d=n.readUshort(t,a),a+=2;var h=n.readUshort(t,a);a+=2;var v=r._lctf.numOfOnes(d),g=r._lctf.numOfOnes(h);if(s.fmt==1){s.pairsets=[];var m=n.readUshort(t,a);a+=2;for(var D=0;D<m;D++){var _=o+n.readUshort(t,a);a+=2;var E=n.readUshort(t,_);_+=2;for(var y=[],x=0;x<E;x++){var A=n.readUshort(t,_);_+=2,d!=0&&(b=r.GPOS.readValueRecord(t,_,d),_+=2*v),h!=0&&(M=r.GPOS.readValueRecord(t,_,h),_+=2*g),y.push({gid2:A,val1:b,val2:M})}s.pairsets.push(y)}}if(s.fmt==2){var w=n.readUshort(t,a);a+=2;var k=n.readUshort(t,a);a+=2;var I=n.readUshort(t,a);a+=2;var P=n.readUshort(t,a);for(a+=2,s.classDef1=r._lctf.readClassDef(t,o+w),s.classDef2=r._lctf.readClassDef(t,o+k),s.matrix=[],D=0;D<I;D++){var Y=[];for(x=0;x<P;x++){var b=null,M=null;d!=0&&(b=r.GPOS.readValueRecord(t,a,d),a+=2*v),h!=0&&(M=r.GPOS.readValueRecord(t,a,h),a+=2*g),Y.push({val1:b,val2:M})}s.matrix.push(Y)}}}else if(e==4&&s.fmt==1)s.markCoverage=r._lctf.readCoverage(t,n.readUshort(t,a)+o),s.baseCoverage=r._lctf.readCoverage(t,n.readUshort(t,a+2)+o),s.markClassCount=n.readUshort(t,a+4),s.markArray=r.GPOS.readMarkArray(t,n.readUshort(t,a+6)+o),s.baseArray=r.GPOS.readBaseArray(t,n.readUshort(t,a+8)+o,s.markClassCount);else if(e==6&&s.fmt==1)s.mark1Coverage=r._lctf.readCoverage(t,n.readUshort(t,a)+o),s.mark2Coverage=r._lctf.readCoverage(t,n.readUshort(t,a+2)+o),s.markClassCount=n.readUshort(t,a+4),s.mark1Array=r.GPOS.readMarkArray(t,n.readUshort(t,a+6)+o),s.mark2Array=r.GPOS.readBaseArray(t,n.readUshort(t,a+8)+o,s.markClassCount);else{if(e==9&&s.fmt==1){var C=n.readUshort(t,a);a+=2;var X=n.readUint(t,a);if(a+=4,i.ltype==9)i.ltype=C;else if(i.ltype!=C)throw"invalid extension substitution";return r.GPOS.subt(t,i.ltype,o+X)}console.debug("unsupported GPOS table LookupType",e,"format",s.fmt)}return s},r.GPOS.readValueRecord=function(t,e,a){var i=r._bin,n=[];return n.push(1&a?i.readShort(t,e):0),e+=1&a?2:0,n.push(2&a?i.readShort(t,e):0),e+=2&a?2:0,n.push(4&a?i.readShort(t,e):0),e+=4&a?2:0,n.push(8&a?i.readShort(t,e):0),e+=8&a?2:0,n},r.GPOS.readBaseArray=function(t,e,a){var i=r._bin,n=[],o=e,s=i.readUshort(t,e);e+=2;for(var f=0;f<s;f++){for(var d=[],h=0;h<a;h++)d.push(r.GPOS.readAnchorRecord(t,o+i.readUshort(t,e))),e+=2;n.push(d)}return n},r.GPOS.readMarkArray=function(t,e){var a=r._bin,i=[],n=e,o=a.readUshort(t,e);e+=2;for(var s=0;s<o;s++){var f=r.GPOS.readAnchorRecord(t,a.readUshort(t,e+2)+n);f.markClass=a.readUshort(t,e),i.push(f),e+=4}return i},r.GPOS.readAnchorRecord=function(t,e){var a=r._bin,i={};return i.fmt=a.readUshort(t,e),i.x=a.readShort(t,e+2),i.y=a.readShort(t,e+4),i},r.GSUB={},r.GSUB.parse=function(t,e,a,i){return r._lctf.parse(t,e,a,i,r.GSUB.subt)},r.GSUB.subt=function(t,e,a,i){var n=r._bin,o=a,s={};if(s.fmt=n.readUshort(t,a),a+=2,e!=1&&e!=2&&e!=4&&e!=5&&e!=6)return null;if(e==1||e==2||e==4||e==5&&s.fmt<=2||e==6&&s.fmt<=2){var f=n.readUshort(t,a);a+=2,s.coverage=r._lctf.readCoverage(t,o+f)}if(e==1&&s.fmt>=1&&s.fmt<=2){if(s.fmt==1)s.delta=n.readShort(t,a),a+=2;else if(s.fmt==2){var d=n.readUshort(t,a);a+=2,s.newg=n.readUshorts(t,a,d),a+=2*s.newg.length}}else if(e==2&&s.fmt==1){d=n.readUshort(t,a),a+=2,s.seqs=[];for(var h=0;h<d;h++){var v=n.readUshort(t,a)+o;a+=2;var g=n.readUshort(t,v);s.seqs.push(n.readUshorts(t,v+2,g))}}else if(e==4)for(s.vals=[],d=n.readUshort(t,a),a+=2,h=0;h<d;h++){var m=n.readUshort(t,a);a+=2,s.vals.push(r.GSUB.readLigatureSet(t,o+m))}else if(e==5&&s.fmt==2){if(s.fmt==2){var D=n.readUshort(t,a);a+=2,s.cDef=r._lctf.readClassDef(t,o+D),s.scset=[];var _=n.readUshort(t,a);for(a+=2,h=0;h<_;h++){var E=n.readUshort(t,a);a+=2,s.scset.push(E==0?null:r.GSUB.readSubClassSet(t,o+E))}}}else if(e==6&&s.fmt==3){if(s.fmt==3){for(h=0;h<3;h++){d=n.readUshort(t,a),a+=2;for(var y=[],x=0;x<d;x++)y.push(r._lctf.readCoverage(t,o+n.readUshort(t,a+2*x)));a+=2*d,h==0&&(s.backCvg=y),h==1&&(s.inptCvg=y),h==2&&(s.ahedCvg=y)}d=n.readUshort(t,a),a+=2,s.lookupRec=r.GSUB.readSubstLookupRecords(t,a,d)}}else{if(e==7&&s.fmt==1){var A=n.readUshort(t,a);a+=2;var w=n.readUint(t,a);if(a+=4,i.ltype==9)i.ltype=A;else if(i.ltype!=A)throw"invalid extension substitution";return r.GSUB.subt(t,i.ltype,o+w)}console.debug("unsupported GSUB table LookupType",e,"format",s.fmt)}return s},r.GSUB.readSubClassSet=function(t,e){var a=r._bin.readUshort,i=e,n=[],o=a(t,e);e+=2;for(var s=0;s<o;s++){var f=a(t,e);e+=2,n.push(r.GSUB.readSubClassRule(t,i+f))}return n},r.GSUB.readSubClassRule=function(t,e){var a=r._bin.readUshort,i={},n=a(t,e),o=a(t,e+=2);e+=2,i.input=[];for(var s=0;s<n-1;s++)i.input.push(a(t,e)),e+=2;return i.substLookupRecords=r.GSUB.readSubstLookupRecords(t,e,o),i},r.GSUB.readSubstLookupRecords=function(t,e,a){for(var i=r._bin.readUshort,n=[],o=0;o<a;o++)n.push(i(t,e),i(t,e+2)),e+=4;return n},r.GSUB.readChainSubClassSet=function(t,e){var a=r._bin,i=e,n=[],o=a.readUshort(t,e);e+=2;for(var s=0;s<o;s++){var f=a.readUshort(t,e);e+=2,n.push(r.GSUB.readChainSubClassRule(t,i+f))}return n},r.GSUB.readChainSubClassRule=function(t,e){for(var a=r._bin,i={},n=["backtrack","input","lookahead"],o=0;o<n.length;o++){var s=a.readUshort(t,e);e+=2,o==1&&s--,i[n[o]]=a.readUshorts(t,e,s),e+=2*i[n[o]].length}return s=a.readUshort(t,e),e+=2,i.subst=a.readUshorts(t,e,2*s),e+=2*i.subst.length,i},r.GSUB.readLigatureSet=function(t,e){var a=r._bin,i=e,n=[],o=a.readUshort(t,e);e+=2;for(var s=0;s<o;s++){var f=a.readUshort(t,e);e+=2,n.push(r.GSUB.readLigature(t,i+f))}return n},r.GSUB.readLigature=function(t,e){var a=r._bin,i={chain:[]};i.nglyph=a.readUshort(t,e),e+=2;var n=a.readUshort(t,e);e+=2;for(var o=0;o<n-1;o++)i.chain.push(a.readUshort(t,e)),e+=2;return i},r.head={},r.head.parse=function(t,e,a){var i=r._bin,n={};return i.readFixed(t,e),e+=4,n.fontRevision=i.readFixed(t,e),e+=4,i.readUint(t,e),e+=4,i.readUint(t,e),e+=4,n.flags=i.readUshort(t,e),e+=2,n.unitsPerEm=i.readUshort(t,e),e+=2,n.created=i.readUint64(t,e),e+=8,n.modified=i.readUint64(t,e),e+=8,n.xMin=i.readShort(t,e),e+=2,n.yMin=i.readShort(t,e),e+=2,n.xMax=i.readShort(t,e),e+=2,n.yMax=i.readShort(t,e),e+=2,n.macStyle=i.readUshort(t,e),e+=2,n.lowestRecPPEM=i.readUshort(t,e),e+=2,n.fontDirectionHint=i.readShort(t,e),e+=2,n.indexToLocFormat=i.readShort(t,e),e+=2,n.glyphDataFormat=i.readShort(t,e),e+=2,n},r.hhea={},r.hhea.parse=function(t,e,a){var i=r._bin,n={};return i.readFixed(t,e),e+=4,n.ascender=i.readShort(t,e),e+=2,n.descender=i.readShort(t,e),e+=2,n.lineGap=i.readShort(t,e),e+=2,n.advanceWidthMax=i.readUshort(t,e),e+=2,n.minLeftSideBearing=i.readShort(t,e),e+=2,n.minRightSideBearing=i.readShort(t,e),e+=2,n.xMaxExtent=i.readShort(t,e),e+=2,n.caretSlopeRise=i.readShort(t,e),e+=2,n.caretSlopeRun=i.readShort(t,e),e+=2,n.caretOffset=i.readShort(t,e),e+=2,e+=8,n.metricDataFormat=i.readShort(t,e),e+=2,n.numberOfHMetrics=i.readUshort(t,e),e+=2,n},r.hmtx={},r.hmtx.parse=function(t,e,a,i){for(var n=r._bin,o={aWidth:[],lsBearing:[]},s=0,f=0,d=0;d<i.maxp.numGlyphs;d++)d<i.hhea.numberOfHMetrics&&(s=n.readUshort(t,e),e+=2,f=n.readShort(t,e),e+=2),o.aWidth.push(s),o.lsBearing.push(f);return o},r.kern={},r.kern.parse=function(t,e,a,i){var n=r._bin,o=n.readUshort(t,e);if(e+=2,o==1)return r.kern.parseV1(t,e-2,a,i);var s=n.readUshort(t,e);e+=2;for(var f={glyph1:[],rval:[]},d=0;d<s;d++){e+=2,a=n.readUshort(t,e),e+=2;var h=n.readUshort(t,e);e+=2;var v=h>>>8;if((v&=15)!=0)throw"unknown kern table format: "+v;e=r.kern.readFormat0(t,e,f)}return f},r.kern.parseV1=function(t,e,a,i){var n=r._bin;n.readFixed(t,e),e+=4;var o=n.readUint(t,e);e+=4;for(var s={glyph1:[],rval:[]},f=0;f<o;f++){n.readUint(t,e),e+=4;var d=n.readUshort(t,e);e+=2,n.readUshort(t,e),e+=2;var h=d>>>8;if((h&=15)!=0)throw"unknown kern table format: "+h;e=r.kern.readFormat0(t,e,s)}return s},r.kern.readFormat0=function(t,e,a){var i=r._bin,n=-1,o=i.readUshort(t,e);e+=2,i.readUshort(t,e),e+=2,i.readUshort(t,e),e+=2,i.readUshort(t,e),e+=2;for(var s=0;s<o;s++){var f=i.readUshort(t,e);e+=2;var d=i.readUshort(t,e);e+=2;var h=i.readShort(t,e);e+=2,f!=n&&(a.glyph1.push(f),a.rval.push({glyph2:[],vals:[]}));var v=a.rval[a.rval.length-1];v.glyph2.push(d),v.vals.push(h),n=f}return e},r.loca={},r.loca.parse=function(t,e,a,i){var n=r._bin,o=[],s=i.head.indexToLocFormat,f=i.maxp.numGlyphs+1;if(s==0)for(var d=0;d<f;d++)o.push(n.readUshort(t,e+(d<<1))<<1);if(s==1)for(d=0;d<f;d++)o.push(n.readUint(t,e+(d<<2)));return o},r.maxp={},r.maxp.parse=function(t,e,a){var i=r._bin,n={},o=i.readUint(t,e);return e+=4,n.numGlyphs=i.readUshort(t,e),e+=2,o==65536&&(n.maxPoints=i.readUshort(t,e),e+=2,n.maxContours=i.readUshort(t,e),e+=2,n.maxCompositePoints=i.readUshort(t,e),e+=2,n.maxCompositeContours=i.readUshort(t,e),e+=2,n.maxZones=i.readUshort(t,e),e+=2,n.maxTwilightPoints=i.readUshort(t,e),e+=2,n.maxStorage=i.readUshort(t,e),e+=2,n.maxFunctionDefs=i.readUshort(t,e),e+=2,n.maxInstructionDefs=i.readUshort(t,e),e+=2,n.maxStackElements=i.readUshort(t,e),e+=2,n.maxSizeOfInstructions=i.readUshort(t,e),e+=2,n.maxComponentElements=i.readUshort(t,e),e+=2,n.maxComponentDepth=i.readUshort(t,e),e+=2),n},r.name={},r.name.parse=function(t,e,a){var i=r._bin,n={};i.readUshort(t,e),e+=2;var o=i.readUshort(t,e);e+=2,i.readUshort(t,e);for(var s,f=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],d=e+=2,h=0;h<o;h++){var v=i.readUshort(t,e);e+=2;var g=i.readUshort(t,e);e+=2;var m=i.readUshort(t,e);e+=2;var D=i.readUshort(t,e);e+=2;var _=i.readUshort(t,e);e+=2;var E=i.readUshort(t,e);e+=2;var y,x=f[D],A=d+12*o+E;if(v==0)y=i.readUnicode(t,A,_/2);else if(v==3&&g==0)y=i.readUnicode(t,A,_/2);else if(g==0)y=i.readASCII(t,A,_);else if(g==1)y=i.readUnicode(t,A,_/2);else if(g==3)y=i.readUnicode(t,A,_/2);else{if(v!=1)throw"unknown encoding "+g+", platformID: "+v;y=i.readASCII(t,A,_),console.debug("reading unknown MAC encoding "+g+" as ASCII")}var w="p"+v+","+m.toString(16);n[w]==null&&(n[w]={}),n[w][x!==void 0?x:D]=y,n[w]._lang=m}for(var k in n)if(n[k].postScriptName!=null&&n[k]._lang==1033)return n[k];for(var k in n)if(n[k].postScriptName!=null&&n[k]._lang==0)return n[k];for(var k in n)if(n[k].postScriptName!=null&&n[k]._lang==3084)return n[k];for(var k in n)if(n[k].postScriptName!=null)return n[k];for(var k in n){s=k;break}return console.debug("returning name table with languageID "+n[s]._lang),n[s]},r["OS/2"]={},r["OS/2"].parse=function(t,e,a){var i=r._bin.readUshort(t,e);e+=2;var n={};if(i==0)r["OS/2"].version0(t,e,n);else if(i==1)r["OS/2"].version1(t,e,n);else if(i==2||i==3||i==4)r["OS/2"].version2(t,e,n);else{if(i!=5)throw"unknown OS/2 table version: "+i;r["OS/2"].version5(t,e,n)}return n},r["OS/2"].version0=function(t,e,a){var i=r._bin;return a.xAvgCharWidth=i.readShort(t,e),e+=2,a.usWeightClass=i.readUshort(t,e),e+=2,a.usWidthClass=i.readUshort(t,e),e+=2,a.fsType=i.readUshort(t,e),e+=2,a.ySubscriptXSize=i.readShort(t,e),e+=2,a.ySubscriptYSize=i.readShort(t,e),e+=2,a.ySubscriptXOffset=i.readShort(t,e),e+=2,a.ySubscriptYOffset=i.readShort(t,e),e+=2,a.ySuperscriptXSize=i.readShort(t,e),e+=2,a.ySuperscriptYSize=i.readShort(t,e),e+=2,a.ySuperscriptXOffset=i.readShort(t,e),e+=2,a.ySuperscriptYOffset=i.readShort(t,e),e+=2,a.yStrikeoutSize=i.readShort(t,e),e+=2,a.yStrikeoutPosition=i.readShort(t,e),e+=2,a.sFamilyClass=i.readShort(t,e),e+=2,a.panose=i.readBytes(t,e,10),e+=10,a.ulUnicodeRange1=i.readUint(t,e),e+=4,a.ulUnicodeRange2=i.readUint(t,e),e+=4,a.ulUnicodeRange3=i.readUint(t,e),e+=4,a.ulUnicodeRange4=i.readUint(t,e),e+=4,a.achVendID=[i.readInt8(t,e),i.readInt8(t,e+1),i.readInt8(t,e+2),i.readInt8(t,e+3)],e+=4,a.fsSelection=i.readUshort(t,e),e+=2,a.usFirstCharIndex=i.readUshort(t,e),e+=2,a.usLastCharIndex=i.readUshort(t,e),e+=2,a.sTypoAscender=i.readShort(t,e),e+=2,a.sTypoDescender=i.readShort(t,e),e+=2,a.sTypoLineGap=i.readShort(t,e),e+=2,a.usWinAscent=i.readUshort(t,e),e+=2,a.usWinDescent=i.readUshort(t,e),e+=2},r["OS/2"].version1=function(t,e,a){var i=r._bin;return e=r["OS/2"].version0(t,e,a),a.ulCodePageRange1=i.readUint(t,e),e+=4,a.ulCodePageRange2=i.readUint(t,e),e+=4},r["OS/2"].version2=function(t,e,a){var i=r._bin;return e=r["OS/2"].version1(t,e,a),a.sxHeight=i.readShort(t,e),e+=2,a.sCapHeight=i.readShort(t,e),e+=2,a.usDefault=i.readUshort(t,e),e+=2,a.usBreak=i.readUshort(t,e),e+=2,a.usMaxContext=i.readUshort(t,e),e+=2},r["OS/2"].version5=function(t,e,a){var i=r._bin;return e=r["OS/2"].version2(t,e,a),a.usLowerOpticalPointSize=i.readUshort(t,e),e+=2,a.usUpperOpticalPointSize=i.readUshort(t,e),e+=2},r.post={},r.post.parse=function(t,e,a){var i=r._bin,n={};return n.version=i.readFixed(t,e),e+=4,n.italicAngle=i.readFixed(t,e),e+=4,n.underlinePosition=i.readShort(t,e),e+=2,n.underlineThickness=i.readShort(t,e),e+=2,n},r==null&&(r={}),r.U==null&&(r.U={}),r.U.codeToGlyph=function(t,e){var a=t.cmap,i=-1;if(a.p0e4!=null?i=a.p0e4:a.p3e1!=null?i=a.p3e1:a.p1e0!=null?i=a.p1e0:a.p0e3!=null&&(i=a.p0e3),i==-1)throw"no familiar platform and encoding!";var n=a.tables[i];if(n.format==0)return e>=n.map.length?0:n.map[e];if(n.format==4){for(var o=-1,s=0;s<n.endCount.length;s++)if(e<=n.endCount[s]){o=s;break}return o==-1||n.startCount[o]>e?0:65535&(n.idRangeOffset[o]!=0?n.glyphIdArray[e-n.startCount[o]+(n.idRangeOffset[o]>>1)-(n.idRangeOffset.length-o)]:e+n.idDelta[o])}if(n.format==12){if(e>n.groups[n.groups.length-1][1])return 0;for(s=0;s<n.groups.length;s++){var f=n.groups[s];if(f[0]<=e&&e<=f[1])return f[2]+(e-f[0])}return 0}throw"unknown cmap table format "+n.format},r.U.glyphToPath=function(t,e){var a={cmds:[],crds:[]};if(t.SVG&&t.SVG.entries[e]){var i=t.SVG.entries[e];return i==null?a:(typeof i=="string"&&(i=r.SVG.toPath(i),t.SVG.entries[e]=i),i)}if(t.CFF){var n={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:t.CFF.Private?t.CFF.Private.defaultWidthX:0,open:!1},o=t.CFF,s=t.CFF.Private;if(o.ROS){for(var f=0;o.FDSelect[f+2]<=e;)f+=2;s=o.FDArray[o.FDSelect[f+1]].Private}r.U._drawCFF(t.CFF.CharStrings[e],n,o,s,a)}else t.glyf&&r.U._drawGlyf(e,t,a);return a},r.U._drawGlyf=function(t,e,a){var i=e.glyf[t];i==null&&(i=e.glyf[t]=r.glyf._parseGlyf(e,t)),i!=null&&(i.noc>-1?r.U._simpleGlyph(i,a):r.U._compoGlyph(i,e,a))},r.U._simpleGlyph=function(t,e){for(var a=0;a<t.noc;a++){for(var i=a==0?0:t.endPts[a-1]+1,n=t.endPts[a],o=i;o<=n;o++){var s=o==i?n:o-1,f=o==n?i:o+1,d=1&t.flags[o],h=1&t.flags[s],v=1&t.flags[f],g=t.xs[o],m=t.ys[o];if(o==i)if(d){if(!h){r.U.P.moveTo(e,g,m);continue}r.U.P.moveTo(e,t.xs[s],t.ys[s])}else h?r.U.P.moveTo(e,t.xs[s],t.ys[s]):r.U.P.moveTo(e,(t.xs[s]+g)/2,(t.ys[s]+m)/2);d?h&&r.U.P.lineTo(e,g,m):v?r.U.P.qcurveTo(e,g,m,t.xs[f],t.ys[f]):r.U.P.qcurveTo(e,g,m,(g+t.xs[f])/2,(m+t.ys[f])/2)}r.U.P.closePath(e)}},r.U._compoGlyph=function(t,e,a){for(var i=0;i<t.parts.length;i++){var n={cmds:[],crds:[]},o=t.parts[i];r.U._drawGlyf(o.glyphIndex,e,n);for(var s=o.m,f=0;f<n.crds.length;f+=2){var d=n.crds[f],h=n.crds[f+1];a.crds.push(d*s.a+h*s.b+s.tx),a.crds.push(d*s.c+h*s.d+s.ty)}for(f=0;f<n.cmds.length;f++)a.cmds.push(n.cmds[f])}},r.U._getGlyphClass=function(t,e){var a=r._lctf.getInterval(e,t);return a==-1?0:e[a+2]},r.U._applySubs=function(t,e,a,i){for(var n=t.length-e-1,o=0;o<a.tabs.length;o++)if(a.tabs[o]!=null){var s,f=a.tabs[o];if(!f.coverage||(s=r._lctf.coverageIndex(f.coverage,t[e]))!=-1){if(a.ltype==1)t[e],f.fmt==1?t[e]=t[e]+f.delta:t[e]=f.newg[s];else if(a.ltype==4)for(var d=f.vals[s],h=0;h<d.length;h++){var v=d[h],g=v.chain.length;if(!(g>n)){for(var m=!0,D=0,_=0;_<g;_++){for(;t[e+D+(1+_)]==-1;)D++;v.chain[_]!=t[e+D+(1+_)]&&(m=!1)}if(m){for(t[e]=v.nglyph,_=0;_<g+D;_++)t[e+_+1]=-1;break}}}else if(a.ltype==5&&f.fmt==2)for(var E=r._lctf.getInterval(f.cDef,t[e]),y=f.cDef[E+2],x=f.scset[y],A=0;A<x.length;A++){var w=x[A],k=w.input;if(!(k.length>n)){for(m=!0,_=0;_<k.length;_++){var I=r._lctf.getInterval(f.cDef,t[e+1+_]);if(E==-1&&f.cDef[I+2]!=k[_]){m=!1;break}}if(m){var P=w.substLookupRecords;for(h=0;h<P.length;h+=2)P[h],P[h+1]}}}else if(a.ltype==6&&f.fmt==3){if(!r.U._glsCovered(t,f.backCvg,e-f.backCvg.length)||!r.U._glsCovered(t,f.inptCvg,e)||!r.U._glsCovered(t,f.ahedCvg,e+f.inptCvg.length))continue;var Y=f.lookupRec;for(A=0;A<Y.length;A+=2){E=Y[A];var b=i[Y[A+1]];r.U._applySubs(t,e+E,b,i)}}}}},r.U._glsCovered=function(t,e,a){for(var i=0;i<e.length;i++)if(r._lctf.coverageIndex(e[i],t[a+i])==-1)return!1;return!0},r.U.glyphsToPath=function(t,e,a){for(var i={cmds:[],crds:[]},n=0,o=0;o<e.length;o++){var s=e[o];if(s!=-1){for(var f=o<e.length-1&&e[o+1]!=-1?e[o+1]:0,d=r.U.glyphToPath(t,s),h=0;h<d.crds.length;h+=2)i.crds.push(d.crds[h]+n),i.crds.push(d.crds[h+1]);for(a&&i.cmds.push(a),h=0;h<d.cmds.length;h++)i.cmds.push(d.cmds[h]);a&&i.cmds.push("X"),n+=t.hmtx.aWidth[s],o<e.length-1&&(n+=r.U.getPairAdjustment(t,s,f))}}return i},r.U.P={},r.U.P.moveTo=function(t,e,a){t.cmds.push("M"),t.crds.push(e,a)},r.U.P.lineTo=function(t,e,a){t.cmds.push("L"),t.crds.push(e,a)},r.U.P.curveTo=function(t,e,a,i,n,o,s){t.cmds.push("C"),t.crds.push(e,a,i,n,o,s)},r.U.P.qcurveTo=function(t,e,a,i,n){t.cmds.push("Q"),t.crds.push(e,a,i,n)},r.U.P.closePath=function(t){t.cmds.push("Z")},r.U._drawCFF=function(t,e,a,i,n){for(var o=e.stack,s=e.nStems,f=e.haveWidth,d=e.width,h=e.open,v=0,g=e.x,m=e.y,D=0,_=0,E=0,y=0,x=0,A=0,w=0,k=0,I=0,P=0,Y={val:0,size:0};v<t.length;){r.CFF.getCharString(t,v,Y);var b=Y.val;if(v+=Y.size,b=="o1"||b=="o18")o.length%2!=0&&!f&&(d=o.shift()+i.nominalWidthX),s+=o.length>>1,o.length=0,f=!0;else if(b=="o3"||b=="o23")o.length%2!=0&&!f&&(d=o.shift()+i.nominalWidthX),s+=o.length>>1,o.length=0,f=!0;else if(b=="o4")o.length>1&&!f&&(d=o.shift()+i.nominalWidthX,f=!0),h&&r.U.P.closePath(n),m+=o.pop(),r.U.P.moveTo(n,g,m),h=!0;else if(b=="o5")for(;o.length>0;)g+=o.shift(),m+=o.shift(),r.U.P.lineTo(n,g,m);else if(b=="o6"||b=="o7")for(var M=o.length,C=b=="o6",X=0;X<M;X++){var z=o.shift();C?g+=z:m+=z,C=!C,r.U.P.lineTo(n,g,m)}else if(b=="o8"||b=="o24"){M=o.length;for(var q=0;q+6<=M;)D=g+o.shift(),_=m+o.shift(),E=D+o.shift(),y=_+o.shift(),g=E+o.shift(),m=y+o.shift(),r.U.P.curveTo(n,D,_,E,y,g,m),q+=6;b=="o24"&&(g+=o.shift(),m+=o.shift(),r.U.P.lineTo(n,g,m))}else{if(b=="o11")break;if(b=="o1234"||b=="o1235"||b=="o1236"||b=="o1237")b=="o1234"&&(_=m,E=(D=g+o.shift())+o.shift(),P=y=_+o.shift(),A=y,k=m,g=(w=(x=(I=E+o.shift())+o.shift())+o.shift())+o.shift(),r.U.P.curveTo(n,D,_,E,y,I,P),r.U.P.curveTo(n,x,A,w,k,g,m)),b=="o1235"&&(D=g+o.shift(),_=m+o.shift(),E=D+o.shift(),y=_+o.shift(),I=E+o.shift(),P=y+o.shift(),x=I+o.shift(),A=P+o.shift(),w=x+o.shift(),k=A+o.shift(),g=w+o.shift(),m=k+o.shift(),o.shift(),r.U.P.curveTo(n,D,_,E,y,I,P),r.U.P.curveTo(n,x,A,w,k,g,m)),b=="o1236"&&(D=g+o.shift(),_=m+o.shift(),E=D+o.shift(),P=y=_+o.shift(),A=y,w=(x=(I=E+o.shift())+o.shift())+o.shift(),k=A+o.shift(),g=w+o.shift(),r.U.P.curveTo(n,D,_,E,y,I,P),r.U.P.curveTo(n,x,A,w,k,g,m)),b=="o1237"&&(D=g+o.shift(),_=m+o.shift(),E=D+o.shift(),y=_+o.shift(),I=E+o.shift(),P=y+o.shift(),x=I+o.shift(),A=P+o.shift(),w=x+o.shift(),k=A+o.shift(),Math.abs(w-g)>Math.abs(k-m)?g=w+o.shift():m=k+o.shift(),r.U.P.curveTo(n,D,_,E,y,I,P),r.U.P.curveTo(n,x,A,w,k,g,m));else if(b=="o14"){if(o.length>0&&!f&&(d=o.shift()+a.nominalWidthX,f=!0),o.length==4){var ne=o.shift(),B=o.shift(),R=o.shift(),p=o.shift(),S=r.CFF.glyphBySE(a,R),T=r.CFF.glyphBySE(a,p);r.U._drawCFF(a.CharStrings[S],e,a,i,n),e.x=ne,e.y=B,r.U._drawCFF(a.CharStrings[T],e,a,i,n)}h&&(r.U.P.closePath(n),h=!1)}else if(b=="o19"||b=="o20")o.length%2!=0&&!f&&(d=o.shift()+i.nominalWidthX),s+=o.length>>1,o.length=0,f=!0,v+=s+7>>3;else if(b=="o21")o.length>2&&!f&&(d=o.shift()+i.nominalWidthX,f=!0),m+=o.pop(),g+=o.pop(),h&&r.U.P.closePath(n),r.U.P.moveTo(n,g,m),h=!0;else if(b=="o22")o.length>1&&!f&&(d=o.shift()+i.nominalWidthX,f=!0),g+=o.pop(),h&&r.U.P.closePath(n),r.U.P.moveTo(n,g,m),h=!0;else if(b=="o25"){for(;o.length>6;)g+=o.shift(),m+=o.shift(),r.U.P.lineTo(n,g,m);D=g+o.shift(),_=m+o.shift(),E=D+o.shift(),y=_+o.shift(),g=E+o.shift(),m=y+o.shift(),r.U.P.curveTo(n,D,_,E,y,g,m)}else if(b=="o26")for(o.length%2&&(g+=o.shift());o.length>0;)D=g,_=m+o.shift(),g=E=D+o.shift(),m=(y=_+o.shift())+o.shift(),r.U.P.curveTo(n,D,_,E,y,g,m);else if(b=="o27")for(o.length%2&&(m+=o.shift());o.length>0;)_=m,E=(D=g+o.shift())+o.shift(),y=_+o.shift(),g=E+o.shift(),m=y,r.U.P.curveTo(n,D,_,E,y,g,m);else if(b=="o10"||b=="o29"){var F=b=="o10"?i:a;if(o.length==0)console.debug("error: empty stack");else{var U=o.pop(),N=F.Subrs[U+F.Bias];e.x=g,e.y=m,e.nStems=s,e.haveWidth=f,e.width=d,e.open=h,r.U._drawCFF(N,e,a,i,n),g=e.x,m=e.y,s=e.nStems,f=e.haveWidth,d=e.width,h=e.open}}else if(b=="o30"||b=="o31"){var L=o.length,j=(q=0,b=="o31");for(q+=L-(M=-3&L);q<M;)j?(_=m,E=(D=g+o.shift())+o.shift(),m=(y=_+o.shift())+o.shift(),M-q==5?(g=E+o.shift(),q++):g=E,j=!1):(D=g,_=m+o.shift(),E=D+o.shift(),y=_+o.shift(),g=E+o.shift(),M-q==5?(m=y+o.shift(),q++):m=y,j=!0),r.U.P.curveTo(n,D,_,E,y,g,m),q+=4}else{if((b+"").charAt(0)=="o")throw console.debug("Unknown operation: "+b,t),b;o.push(b)}}}e.x=g,e.y=m,e.nStems=s,e.haveWidth=f,e.width=d,e.open=h};var u=r,c={Typr:u};return l.Typr=u,l.default=c,Object.defineProperty(l,"__esModule",{value:!0}),l}({}).Typr}/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/function io(){return function(l){var r=Uint8Array,u=Uint16Array,c=Uint32Array,t=new r([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),e=new r([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),a=new r([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),i=function(b,M){for(var C=new u(31),X=0;X<31;++X)C[X]=M+=1<<b[X-1];var z=new c(C[30]);for(X=1;X<30;++X)for(var q=C[X];q<C[X+1];++q)z[q]=q-C[X]<<5|X;return[C,z]},n=i(t,2),o=n[0],s=n[1];o[28]=258,s[258]=28;for(var f=i(e,0)[0],d=new u(32768),h=0;h<32768;++h){var v=(43690&h)>>>1|(21845&h)<<1;v=(61680&(v=(52428&v)>>>2|(13107&v)<<2))>>>4|(3855&v)<<4,d[h]=((65280&v)>>>8|(255&v)<<8)>>>1}var g=function(b,M,C){for(var X=b.length,z=0,q=new u(M);z<X;++z)++q[b[z]-1];var ne,B=new u(M);for(z=0;z<M;++z)B[z]=B[z-1]+q[z-1]<<1;{ne=new u(1<<M);var R=15-M;for(z=0;z<X;++z)if(b[z])for(var p=z<<4|b[z],S=M-b[z],T=B[b[z]-1]++<<S,F=T|(1<<S)-1;T<=F;++T)ne[d[T]>>>R]=p}return ne},m=new r(288);for(h=0;h<144;++h)m[h]=8;for(h=144;h<256;++h)m[h]=9;for(h=256;h<280;++h)m[h]=7;for(h=280;h<288;++h)m[h]=8;var D=new r(32);for(h=0;h<32;++h)D[h]=5;var _=g(m,9),E=g(D,5),y=function(b){for(var M=b[0],C=1;C<b.length;++C)b[C]>M&&(M=b[C]);return M},x=function(b,M,C){var X=M/8|0;return(b[X]|b[X+1]<<8)>>(7&M)&C},A=function(b,M){var C=M/8|0;return(b[C]|b[C+1]<<8|b[C+2]<<16)>>(7&M)},w=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],k=function(b,M,C){var X=new Error(M||w[b]);if(X.code=b,Error.captureStackTrace&&Error.captureStackTrace(X,k),!C)throw X;return X},I=function(b,M,C){var X=b.length;if(!X||C&&!C.l&&X<5)return M||new r(0);var z=!M||C,q=!C||C.i;C||(C={}),M||(M=new r(3*X));var ne,B=function(fe){var De=M.length;if(fe>De){var Ee=new r(Math.max(2*De,fe));Ee.set(M),M=Ee}},R=C.f||0,p=C.p||0,S=C.b||0,T=C.l,F=C.d,U=C.m,N=C.n,L=8*X;do{if(!T){C.f=R=x(b,p,1);var j=x(b,p+1,3);if(p+=3,!j){var K=b[($=((ne=p)/8|0)+(7&ne&&1)+4)-4]|b[$-3]<<8,ee=$+K;if(ee>X){q&&k(0);break}z&&B(S+K),M.set(b.subarray($,ee),S),C.b=S+=K,C.p=p=8*ee;continue}if(j==1)T=_,F=E,U=9,N=5;else if(j==2){var H=x(b,p,31)+257,W=x(b,p+10,15)+4,ge=H+x(b,p+5,31)+1;p+=14;for(var ue=new r(ge),Q=new r(19),te=0;te<W;++te)Q[a[te]]=x(b,p+3*te,7);p+=3*W;var le=y(Q),V=(1<<le)-1,re=g(Q,le);for(te=0;te<ge;){var $,G=re[x(b,p,V)];if(p+=15&G,($=G>>>4)<16)ue[te++]=$;else{var he=0,Z=0;for($==16?(Z=3+x(b,p,3),p+=2,he=ue[te-1]):$==17?(Z=3+x(b,p,7),p+=3):$==18&&(Z=11+x(b,p,127),p+=7);Z--;)ue[te++]=he}}var oe=ue.subarray(0,H),J=ue.subarray(H);U=y(oe),N=y(J),T=g(oe,U),F=g(J,N)}else k(1);if(p>L){q&&k(0);break}}z&&B(S+131072);for(var Se=(1<<U)-1,ae=(1<<N)-1,ie=p;;ie=p){var ce=(he=T[A(b,p)&Se])>>>4;if((p+=15&he)>L){q&&k(0);break}if(he||k(2),ce<256)M[S++]=ce;else{if(ce==256){ie=p,T=null;break}var ve=ce-254;if(ce>264){var ke=t[te=ce-257];ve=x(b,p,(1<<ke)-1)+o[te],p+=ke}var Fe=F[A(b,p)&ae],ye=Fe>>>4;if(Fe||k(3),p+=15&Fe,J=f[ye],ye>3&&(ke=e[ye],J+=A(b,p)&(1<<ke)-1,p+=ke),p>L){q&&k(0);break}z&&B(S+131072);for(var be=S+ve;S<be;S+=4)M[S]=M[S-J],M[S+1]=M[S+1-J],M[S+2]=M[S+2-J],M[S+3]=M[S+3-J];S=be}}C.l=T,C.p=ie,C.b=S,T&&(R=1,C.m=U,C.d=F,C.n=N)}while(!R);return S==M.length?M:function(fe,De,Ee){(Ee==null||Ee>fe.length)&&(Ee=fe.length);var Be=new(fe instanceof u?u:fe instanceof c?c:r)(Ee-De);return Be.set(fe.subarray(De,Ee)),Be}(M,0,S)},P=new r(0),Y=typeof TextDecoder<"u"&&new TextDecoder;try{Y.decode(P,{stream:!0})}catch{}return l.convert_streams=function(b){var M=new DataView(b),C=0;function X(){var H=M.getUint16(C);return C+=2,H}function z(){var H=M.getUint32(C);return C+=4,H}function q(H){K.setUint16(ee,H),ee+=2}function ne(H){K.setUint32(ee,H),ee+=4}for(var B={signature:z(),flavor:z(),length:z(),numTables:X(),reserved:X(),totalSfntSize:z(),majorVersion:X(),minorVersion:X(),metaOffset:z(),metaLength:z(),metaOrigLength:z(),privOffset:z(),privLength:z()},R=0;Math.pow(2,R)<=B.numTables;)R++;R--;for(var p=16*Math.pow(2,R),S=16*B.numTables-p,T=12,F=[],U=0;U<B.numTables;U++)F.push({tag:z(),offset:z(),compLength:z(),origLength:z(),origChecksum:z()}),T+=16;var N,L=new Uint8Array(12+16*F.length+F.reduce(function(H,W){return H+W.origLength+4},0)),j=L.buffer,K=new DataView(j),ee=0;return ne(B.flavor),q(B.numTables),q(p),q(R),q(S),F.forEach(function(H){ne(H.tag),ne(H.origChecksum),ne(T),ne(H.origLength),H.outOffset=T,(T+=H.origLength)%4!=0&&(T+=4-T%4)}),F.forEach(function(H){var W,ge=b.slice(H.offset,H.offset+H.compLength);if(H.compLength!=H.origLength){var ue=new Uint8Array(H.origLength);W=new Uint8Array(ge,2),I(W,ue)}else ue=new Uint8Array(ge);L.set(ue,H.outOffset);var Q=0;(T=H.outOffset+H.origLength)%4!=0&&(Q=4-T%4),L.set(new Uint8Array(Q).buffer,H.outOffset+H.origLength),N=T+Q}),j.slice(0,N)},Object.defineProperty(l,"__esModule",{value:!0}),l}({}).convert_streams}function so(l,r){const u={M:2,L:2,Q:4,C:6,Z:0},c={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},t=1,e=2,a=4,i=8,n=16,o=32;let s;function f(w){if(!s){const k={R:e,L:t,D:a,C:n,U:o,T:i};s=new Map;for(let I in c){let P=0;c[I].split(",").forEach(Y=>{let[b,M]=Y.split("+");b=parseInt(b,36),M=M?parseInt(M,36):0,s.set(P+=b,k[I]);for(let C=M;C--;)s.set(++P,k[I])})}}return s.get(w)||o}const d=1,h=2,v=3,g=4,m=[null,"isol","init","fina","medi"];function D(w){const k=new Uint8Array(w.length);let I=o,P=d,Y=-1;for(let b=0;b<w.length;b++){const M=w.codePointAt(b);let C=f(M)|0,X=d;C&i||(I&(t|a|n)?C&(e|a|n)?(X=v,(P===d||P===v)&&k[Y]++):C&(t|o)&&(P===h||P===g)&&k[Y]--:I&(e|o)&&(P===h||P===g)&&k[Y]--,P=k[b]=X,I=C,Y=b,M>65535&&b++)}return k}function _(w,k){const I=[];for(let Y=0;Y<k.length;Y++){const b=k.codePointAt(Y);b>65535&&Y++,I.push(l.U.codeToGlyph(w,b))}const P=w.GSUB;if(P){const{lookupList:Y,featureList:b}=P;let M;const C=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,X=[];b.forEach(z=>{if(C.test(z.tag))for(let q=0;q<z.tab.length;q++){if(X[z.tab[q]])continue;X[z.tab[q]]=!0;const ne=Y[z.tab[q]],B=/^(isol|init|fina|medi)$/.test(z.tag);B&&!M&&(M=D(k));for(let R=0;R<I.length;R++)(!M||!B||m[M[R]]===z.tag)&&l.U._applySubs(I,R,ne,Y)}})}return I}function E(w,k){const I=new Int16Array(k.length*3);let P=0;for(;P<k.length;P++){const C=k[P];if(C===-1)continue;I[P*3+2]=w.hmtx.aWidth[C];const X=w.GPOS;if(X){const z=X.lookupList;for(let q=0;q<z.length;q++){const ne=z[q];for(let B=0;B<ne.tabs.length;B++){const R=ne.tabs[B];if(ne.ltype===1){if(l._lctf.coverageIndex(R.coverage,C)!==-1&&R.pos){M(R.pos,P);break}}else if(ne.ltype===2){let p=null,S=Y();if(S!==-1){const T=l._lctf.coverageIndex(R.coverage,k[S]);if(T!==-1){if(R.fmt===1){const F=R.pairsets[T];for(let U=0;U<F.length;U++)F[U].gid2===C&&(p=F[U])}else if(R.fmt===2){const F=l.U._getGlyphClass(k[S],R.classDef1),U=l.U._getGlyphClass(C,R.classDef2);p=R.matrix[F][U]}if(p){p.val1&&M(p.val1,S),p.val2&&M(p.val2,P);break}}}}else if(ne.ltype===4){const p=l._lctf.coverageIndex(R.markCoverage,C);if(p!==-1){const S=Y(b),T=S===-1?-1:l._lctf.coverageIndex(R.baseCoverage,k[S]);if(T!==-1){const F=R.markArray[p],U=R.baseArray[T][F.markClass];I[P*3]=U.x-F.x+I[S*3]-I[S*3+2],I[P*3+1]=U.y-F.y+I[S*3+1];break}}}else if(ne.ltype===6){const p=l._lctf.coverageIndex(R.mark1Coverage,C);if(p!==-1){const S=Y();if(S!==-1){const T=k[S];if(y(w,T)===3){const F=l._lctf.coverageIndex(R.mark2Coverage,T);if(F!==-1){const U=R.mark1Array[p],N=R.mark2Array[F][U.markClass];I[P*3]=N.x-U.x+I[S*3]-I[S*3+2],I[P*3+1]=N.y-U.y+I[S*3+1];break}}}}}}}}else if(w.kern&&!w.cff){const z=Y();if(z!==-1){const q=w.kern.glyph1.indexOf(k[z]);if(q!==-1){const ne=w.kern.rval[q].glyph2.indexOf(C);ne!==-1&&(I[z*3+2]+=w.kern.rval[q].vals[ne])}}}}return I;function Y(C){for(let X=P-1;X>=0;X--)if(k[X]!==-1&&(!C||C(k[X])))return X;return-1}function b(C){return y(w,C)===1}function M(C,X){for(let z=0;z<3;z++)I[X*3+z]+=C[z]||0}}function y(w,k){const I=w.GDEF&&w.GDEF.glyphClassDef;return I?l.U._getGlyphClass(k,I):0}function x(...w){for(let k=0;k<w.length;k++)if(typeof w[k]=="number")return w[k]}function A(w){const k=Object.create(null),I=w["OS/2"],P=w.hhea,Y=w.head.unitsPerEm,b=x(I&&I.sTypoAscender,P&&P.ascender,Y),M={unitsPerEm:Y,ascender:b,descender:x(I&&I.sTypoDescender,P&&P.descender,0),capHeight:x(I&&I.sCapHeight,b),xHeight:x(I&&I.sxHeight,b),lineGap:x(I&&I.sTypoLineGap,P&&P.lineGap),supportsCodePoint(C){return l.U.codeToGlyph(w,C)>0},forEachGlyph(C,X,z,q){let ne=0;const B=1/M.unitsPerEm*X,R=_(w,C);let p=0;const S=E(w,R);return R.forEach((T,F)=>{if(T!==-1){let U=k[T];if(!U){const{cmds:N,crds:L}=l.U.glyphToPath(w,T);let j="",K=0;for(let ue=0,Q=N.length;ue<Q;ue++){const te=u[N[ue]];j+=N[ue];for(let le=1;le<=te;le++)j+=(le>1?",":"")+L[K++]}let ee,H,W,ge;if(L.length){ee=H=1/0,W=ge=-1/0;for(let ue=0,Q=L.length;ue<Q;ue+=2){let te=L[ue],le=L[ue+1];te<ee&&(ee=te),le<H&&(H=le),te>W&&(W=te),le>ge&&(ge=le)}}else ee=W=H=ge=0;U=k[T]={index:T,advanceWidth:w.hmtx.aWidth[T],xMin:ee,yMin:H,xMax:W,yMax:ge,path:j}}q.call(null,U,ne+S[F*3]*B,S[F*3+1]*B,p),ne+=S[F*3+2]*B,z&&(ne+=z*X)}p+=C.codePointAt(p)>65535?2:1}),ne}};return M}return function(k){const I=new Uint8Array(k,0,4),P=l._bin.readASCII(I,0,4);if(P==="wOFF")k=r(k);else if(P==="wOF2")throw new Error("woff2 fonts not supported");return A(l.parse(k)[0])}}const lo=gt({name:"Typr Font Parser",dependencies:[oo,io,so],init(l,r,u){const c=l(),t=r();return u(c,t)}});/*!
Custom bundle of @unicode-font-resolver/client v1.0.2 (https://github.com/lojjic/unicode-font-resolver)
for use in Troika text rendering. 
Original MIT license applies
*/function fo(){return function(l){var r=function(){this.buckets=new Map};r.prototype.add=function(E){var y=E>>5;this.buckets.set(y,(this.buckets.get(y)||0)|1<<(31&E))},r.prototype.has=function(E){var y=this.buckets.get(E>>5);return y!==void 0&&(y&1<<(31&E))!=0},r.prototype.serialize=function(){var E=[];return this.buckets.forEach(function(y,x){E.push((+x).toString(36)+":"+y.toString(36))}),E.join(",")},r.prototype.deserialize=function(E){var y=this;this.buckets.clear(),E.split(",").forEach(function(x){var A=x.split(":");y.buckets.set(parseInt(A[0],36),parseInt(A[1],36))})};var u=Math.pow(2,8),c=u-1,t=~c;function e(E){var y=function(A){return A&t}(E).toString(16),x=function(A){return(A&t)+u-1}(E).toString(16);return"codepoint-index/plane"+(E>>16)+"/"+y+"-"+x+".json"}function a(E,y){var x=E&c,A=y.codePointAt(x/6|0);return((A=(A||48)-48)&1<<x%6)!=0}function i(E,y){var x;(x=E,x.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map(function(A){return A.split("-").map(function(w){return parseInt(w.trim(),16)})})).forEach(function(A){var w=A[0],k=A[1];k===void 0&&(k=w),y(w,k)})}function n(E,y){i(E,function(x,A){for(var w=x;w<=A;w++)y(w)})}var o={},s={},f=new WeakMap,d="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function h(E){var y=f.get(E);return y||(y=new r,n(E.ranges,function(x){return y.add(x)}),f.set(E,y)),y}var v,g=new Map;function m(E,y,x){return E[y]?y:E[x]?x:function(A){for(var w in A)return w}(E)}function D(E,y){var x=y;if(!E.includes(x)){x=1/0;for(var A=0;A<E.length;A++)Math.abs(E[A]-y)<Math.abs(x-y)&&(x=E[A])}return x}function _(E){return v||(v=new Set,n("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",function(y){v.add(y)})),v.has(E)}return l.CodePointSet=r,l.clearCache=function(){o={},s={}},l.getFontsForString=function(E,y){y===void 0&&(y={});var x,A=y.lang;A===void 0&&(A=new RegExp("\\p{Script=Hangul}","u").test(x=E)?"ko":new RegExp("\\p{Script=Hiragana}|\\p{Script=Katakana}","u").test(x)?"ja":"en");var w=y.category;w===void 0&&(w="sans-serif");var k=y.style;k===void 0&&(k="normal");var I=y.weight;I===void 0&&(I=400);var P=(y.dataUrl||d).replace(/\/$/g,""),Y=new Map,b=new Uint8Array(E.length),M={},C={},X=new Array(E.length),z=new Map,q=!1;function ne(p){var S=g.get(p);return S||(S=fetch(P+"/"+p).then(function(T){if(!T.ok)throw new Error(T.statusText);return T.json().then(function(F){if(!Array.isArray(F)||F[0]!==1)throw new Error("Incorrect schema version; need 1, got "+F[0]);return F[1]})}).catch(function(T){if(P!==d)return q||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+P+'", trying default CDN. '+T.message),q=!0),P=d,g.delete(p),ne(p);throw T}),g.set(p,S)),S}for(var B=function(p){var S=E.codePointAt(p),T=e(S);X[p]=T,o[T]||z.has(T)||z.set(T,ne(T).then(function(F){o[T]=F})),S>65535&&(p++,R=p)},R=0;R<E.length;R++)B(R);return Promise.all(z.values()).then(function(){z.clear();for(var p=function(T){var F=E.codePointAt(T),U=null,N=o[X[T]],L=void 0;for(var j in N){var K=C[j];if(K===void 0&&(K=C[j]=new RegExp(j).test(A||"en")),K){for(var ee in L=j,N[j])if(a(F,N[j][ee])){U=ee;break}break}}if(!U){e:for(var H in N)if(H!==L){for(var W in N[H])if(a(F,N[H][W])){U=W;break e}}}U||(console.debug("No font coverage for U+"+F.toString(16)),U="latin"),X[T]=U,s[U]||z.has(U)||z.set(U,ne("font-meta/"+U+".json").then(function(ge){s[U]=ge})),F>65535&&(T++,S=T)},S=0;S<E.length;S++)p(S);return Promise.all(z.values())}).then(function(){for(var p,S=null,T=0;T<E.length;T++){var F=E.codePointAt(T);if(S&&(_(F)||h(S).has(F)))b[T]=b[T-1];else{S=s[X[T]];var U=M[S.id];if(!U){var N=S.typeforms,L=m(N,w,"sans-serif"),j=m(N[L],k,"normal"),K=D((p=N[L])===null||p===void 0?void 0:p[j],I);U=M[S.id]=P+"/font-files/"+S.id+"/"+L+"."+j+"."+K+".woff"}var ee=Y.get(U);ee==null&&(ee=Y.size,Y.set(U,ee)),b[T]=ee}F>65535&&(T++,b[T]=b[T-1])}return{fontUrls:Array.from(Y.keys()),chars:b}})},Object.defineProperty(l,"__esModule",{value:!0}),l}({})}function co(l,r){const u=Object.create(null),c=Object.create(null);function t(a,i){const n=o=>{console.error(`Failure loading font ${a}`,o)};try{const o=new XMLHttpRequest;o.open("get",a,!0),o.responseType="arraybuffer",o.onload=function(){if(o.status>=400)n(new Error(o.statusText));else if(o.status>0)try{const s=l(o.response);s.src=a,i(s)}catch(s){n(s)}},o.onerror=n,o.send()}catch(o){n(o)}}function e(a,i){let n=u[a];n?i(n):c[a]?c[a].push(i):(c[a]=[i],t(a,o=>{o.src=a,u[a]=o,c[a].forEach(s=>s(o)),delete c[a]}))}return function(a,i,{lang:n,fonts:o=[],style:s="normal",weight:f="normal",unicodeFontsURL:d}={}){const h=new Uint8Array(a.length),v=[];a.length||_();const g=new Map,m=[];if(s!=="italic"&&(s="normal"),typeof f!="number"&&(f=f==="bold"?700:400),o&&!Array.isArray(o)&&(o=[o]),o=o.slice().filter(y=>!y.lang||y.lang.test(n)).reverse(),o.length){let w=0;(function k(I=0){for(let P=I,Y=a.length;P<Y;P++){const b=a.codePointAt(P);if(w===1&&v[h[P-1]].supportsCodePoint(b)||P>0&&/\s/.test(a[P]))h[P]=h[P-1],w===2&&(m[m.length-1][1]=P);else for(let M=h[P],C=o.length;M<=C;M++)if(M===C){const X=w===2?m[m.length-1]:m[m.length]=[P,P];X[1]=P,w=2}else{h[P]=M;const{src:X,unicodeRange:z}=o[M];if(!z||E(b,z)){const q=u[X];if(!q){e(X,()=>{k(P)});return}if(q.supportsCodePoint(b)){let ne=g.get(q);typeof ne!="number"&&(ne=v.length,v.push(q),g.set(q,ne)),h[P]=ne,w=1;break}}}b>65535&&P+1<Y&&(h[P+1]=h[P],P++,w===2&&(m[m.length-1][1]=P))}D()})()}else m.push([0,a.length-1]),D();function D(){if(m.length){const y=m.map(x=>a.substring(x[0],x[1]+1)).join(`
`);r.getFontsForString(y,{lang:n||void 0,style:s,weight:f,dataUrl:d}).then(({fontUrls:x,chars:A})=>{const w=v.length;let k=0;m.forEach(P=>{for(let Y=0,b=P[1]-P[0];Y<=b;Y++)h[P[0]+Y]=A[k++]+w;k++});let I=0;x.forEach((P,Y)=>{e(P,b=>{v[Y+w]=b,++I===x.length&&_()})})})}else _()}function _(){i({chars:h,fonts:v})}function E(y,x){for(let A=0;A<x.length;A++){const[w,k=w]=x[A];if(w<=y&&y<=k)return!0}return!1}}}const uo=gt({name:"FontResolver",dependencies:[co,lo,fo],init(l,r,u){return l(r,u())}});function ho(l,r){const c=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,t="[^\\S\\u00A0]",e=new RegExp(`${t}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function a({text:v,lang:g,fonts:m,style:D,weight:_,preResolvedFonts:E,unicodeFontsURL:y},x){const A=({chars:w,fonts:k})=>{let I,P;const Y=[];for(let b=0;b<w.length;b++)w[b]!==P?(P=w[b],Y.push(I={start:b,end:b,fontObj:k[w[b]]})):I.end=b;x(Y)};E?A(E):l(v,A,{lang:g,fonts:m,style:D,weight:_,unicodeFontsURL:y})}function i({text:v="",font:g,lang:m,sdfGlyphSize:D=64,fontSize:_=400,fontWeight:E=1,fontStyle:y="normal",letterSpacing:x=0,lineHeight:A="normal",maxWidth:w=1/0,direction:k,textAlign:I="left",textIndent:P=0,whiteSpace:Y="normal",overflowWrap:b="normal",anchorX:M=0,anchorY:C=0,metricsOnly:X=!1,unicodeFontsURL:z,preResolvedFonts:q=null,includeCaretPositions:ne=!1,chunkedBoundsSize:B=8192,colorRanges:R=null},p){const S=f(),T={fontLoad:0,typesetting:0};v.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),v=v.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),_=+_,x=+x,w=+w,A=A||"normal",P=+P,a({text:v,lang:m,style:y,weight:E,fonts:typeof g=="string"?[{src:g}]:g,unicodeFontsURL:z,preResolvedFonts:q},F=>{T.fontLoad=f()-S;const U=isFinite(w);let N=null,L=null,j=null,K=null,ee=null,H=null,W=null,ge=null,ue=0,Q=0,te=Y!=="nowrap";const le=new Map,V=f();let re=P,$=0,G=new d;const he=[G];F.forEach(ae=>{const{fontObj:ie}=ae,{ascender:ce,descender:ve,unitsPerEm:ke,lineGap:Fe,capHeight:ye,xHeight:be}=ie;let fe=le.get(ie);if(!fe){const de=_/ke,we=A==="normal"?(ce-ve+Fe)*de:A*_,qe=(we-(ce-ve)*de)/2,_e=Math.min(we,(ce-ve)*de),xe=(ce+ve)/2*de+_e/2;fe={index:le.size,src:ie.src,fontObj:ie,fontSizeMult:de,unitsPerEm:ke,ascender:ce*de,descender:ve*de,capHeight:ye*de,xHeight:be*de,lineHeight:we,baseline:-qe-ce*de,caretTop:xe,caretBottom:xe-_e},le.set(ie,fe)}const{fontSizeMult:De}=fe,Ee=v.slice(ae.start,ae.end+1);let Be,Ue;ie.forEachGlyph(Ee,_,x,(de,we,qe,_e)=>{we+=$,_e+=ae.start,Be=we,Ue=de;const xe=v.charAt(_e),Ae=de.advanceWidth*De,Te=G.count;let pe;if("isEmpty"in de||(de.isWhitespace=!!xe&&new RegExp(t).test(xe),de.canBreakAfter=!!xe&&e.test(xe),de.isEmpty=de.xMin===de.xMax||de.yMin===de.yMax||c.test(xe)),!de.isWhitespace&&!de.isEmpty&&Q++,te&&U&&!de.isWhitespace&&we+Ae+re>w&&Te){if(G.glyphAt(Te-1).glyphObj.canBreakAfter)pe=new d,re=-we;else for(let Oe=Te;Oe--;)if(Oe===0&&b==="break-word"){pe=new d,re=-we;break}else if(G.glyphAt(Oe).glyphObj.canBreakAfter){pe=G.splitAt(Oe+1);const Re=pe.glyphAt(0).x;re-=Re;for(let Me=pe.count;Me--;)pe.glyphAt(Me).x-=Re;break}pe&&(G.isSoftWrapped=!0,G=pe,he.push(G),ue=w)}let Ce=G.glyphAt(G.count);Ce.glyphObj=de,Ce.x=we+re,Ce.y=qe,Ce.width=Ae,Ce.charIndex=_e,Ce.fontData=fe,xe===`
`&&(G=new d,he.push(G),re=-(we+Ae+x*_)+P)}),$=Be+Ue.advanceWidth*De+x*_});let Z=0;he.forEach(ae=>{let ie=!0;for(let ce=ae.count;ce--;){const ve=ae.glyphAt(ce);ie&&!ve.glyphObj.isWhitespace&&(ae.width=ve.x+ve.width,ae.width>ue&&(ue=ae.width),ie=!1);let{lineHeight:ke,capHeight:Fe,xHeight:ye,baseline:be}=ve.fontData;ke>ae.lineHeight&&(ae.lineHeight=ke);const fe=be-ae.baseline;fe<0&&(ae.baseline+=fe,ae.cap+=fe,ae.ex+=fe),ae.cap=Math.max(ae.cap,ae.baseline+Fe),ae.ex=Math.max(ae.ex,ae.baseline+ye)}ae.baseline-=Z,ae.cap-=Z,ae.ex-=Z,Z+=ae.lineHeight});let oe=0,J=0;if(M&&(typeof M=="number"?oe=-M:typeof M=="string"&&(oe=-ue*(M==="left"?0:M==="center"?.5:M==="right"?1:o(M)))),C&&(typeof C=="number"?J=-C:typeof C=="string"&&(J=C==="top"?0:C==="top-baseline"?-he[0].baseline:C==="top-cap"?-he[0].cap:C==="top-ex"?-he[0].ex:C==="middle"?Z/2:C==="bottom"?Z:C==="bottom-baseline"?-he[he.length-1].baseline:o(C)*Z)),!X){const ae=r.getEmbeddingLevels(v,k);N=new Uint16Array(Q),L=new Uint8Array(Q),j=new Float32Array(Q*2),K={},W=[1/0,1/0,-1/0,-1/0],ge=[],ne&&(H=new Float32Array(v.length*4)),R&&(ee=new Uint8Array(Q*3));let ie=0,ce=-1,ve=-1,ke,Fe;if(he.forEach((ye,be)=>{let{count:fe,width:De}=ye;if(fe>0){let Ee=0;for(let _e=fe;_e--&&ye.glyphAt(_e).glyphObj.isWhitespace;)Ee++;let Be=0,Ue=0;if(I==="center")Be=(ue-De)/2;else if(I==="right")Be=ue-De;else if(I==="justify"&&ye.isSoftWrapped){let _e=0;for(let xe=fe-Ee;xe--;)ye.glyphAt(xe).glyphObj.isWhitespace&&_e++;Ue=(ue-De)/_e}if(Ue||Be){let _e=0;for(let xe=0;xe<fe;xe++){let Ae=ye.glyphAt(xe);const Te=Ae.glyphObj;Ae.x+=Be+_e,Ue!==0&&Te.isWhitespace&&xe<fe-Ee&&(_e+=Ue,Ae.width+=Ue)}}const de=r.getReorderSegments(v,ae,ye.glyphAt(0).charIndex,ye.glyphAt(ye.count-1).charIndex);for(let _e=0;_e<de.length;_e++){const[xe,Ae]=de[_e];let Te=1/0,pe=-1/0;for(let Ce=0;Ce<fe;Ce++)if(ye.glyphAt(Ce).charIndex>=xe){let Oe=Ce,Re=Ce;for(;Re<fe;Re++){let Me=ye.glyphAt(Re);if(Me.charIndex>Ae)break;Re<fe-Ee&&(Te=Math.min(Te,Me.x),pe=Math.max(pe,Me.x+Me.width))}for(let Me=Oe;Me<Re;Me++){const ze=ye.glyphAt(Me);ze.x=pe-(ze.x+ze.width-Te)}break}}let we;const qe=_e=>we=_e;for(let _e=0;_e<fe;_e++){const xe=ye.glyphAt(_e);we=xe.glyphObj;const Ae=we.index,Te=ae.levels[xe.charIndex]&1;if(Te){const pe=r.getMirroredCharacter(v[xe.charIndex]);pe&&xe.fontData.fontObj.forEachGlyph(pe,0,0,qe)}if(ne){const{charIndex:pe,fontData:Ce}=xe,Oe=xe.x+oe,Re=xe.x+xe.width+oe;H[pe*4]=Te?Re:Oe,H[pe*4+1]=Te?Oe:Re,H[pe*4+2]=ye.baseline+Ce.caretBottom+J,H[pe*4+3]=ye.baseline+Ce.caretTop+J;const Me=pe-ce;Me>1&&s(H,ce,Me),ce=pe}if(R){const{charIndex:pe}=xe;for(;pe>ve;)ve++,R.hasOwnProperty(ve)&&(Fe=R[ve])}if(!we.isWhitespace&&!we.isEmpty){const pe=ie++,{fontSizeMult:Ce,src:Oe,index:Re}=xe.fontData,Me=K[Oe]||(K[Oe]={});Me[Ae]||(Me[Ae]={path:we.path,pathBounds:[we.xMin,we.yMin,we.xMax,we.yMax]});const ze=xe.x+oe,$e=xe.y+ye.baseline+J;j[pe*2]=ze,j[pe*2+1]=$e;const Ye=ze+we.xMin*Ce,et=$e+we.yMin*Ce,at=ze+we.xMax*Ce,Ke=$e+we.yMax*Ce;Ye<W[0]&&(W[0]=Ye),et<W[1]&&(W[1]=et),at>W[2]&&(W[2]=at),Ke>W[3]&&(W[3]=Ke),pe%B===0&&(ke={start:pe,end:pe,rect:[1/0,1/0,-1/0,-1/0]},ge.push(ke)),ke.end++;const Ge=ke.rect;if(Ye<Ge[0]&&(Ge[0]=Ye),et<Ge[1]&&(Ge[1]=et),at>Ge[2]&&(Ge[2]=at),Ke>Ge[3]&&(Ge[3]=Ke),N[pe]=Ae,L[pe]=Re,R){const ot=pe*3;ee[ot]=Fe>>16&255,ee[ot+1]=Fe>>8&255,ee[ot+2]=Fe&255}}}}}),H){const ye=v.length-ce;ye>1&&s(H,ce,ye)}}const Se=[];le.forEach(({index:ae,src:ie,unitsPerEm:ce,ascender:ve,descender:ke,lineHeight:Fe,capHeight:ye,xHeight:be})=>{Se[ae]={src:ie,unitsPerEm:ce,ascender:ve,descender:ke,lineHeight:Fe,capHeight:ye,xHeight:be}}),T.typesetting=f()-V,p({glyphIds:N,glyphFontIndices:L,glyphPositions:j,glyphData:K,fontData:Se,caretPositions:H,glyphColors:ee,chunkedBounds:ge,fontSize:_,topBaseline:J+he[0].baseline,blockBounds:[oe,J-Z,oe+ue,J],visibleBounds:W,timings:T})})}function n(v,g){i({...v,metricsOnly:!0},m=>{const[D,_,E,y]=m.blockBounds;g({width:E-D,height:y-_})})}function o(v){let g=v.match(/^([\d.]+)%$/),m=g?parseFloat(g[1]):NaN;return isNaN(m)?0:m/100}function s(v,g,m){const D=v[g*4],_=v[g*4+1],E=v[g*4+2],y=v[g*4+3],x=(_-D)/m;for(let A=0;A<m;A++){const w=(g+A)*4;v[w]=D+x*A,v[w+1]=D+x*(A+1),v[w+2]=E,v[w+3]=y}}function f(){return(self.performance||Date).now()}function d(){this.data=[]}const h=["glyphObj","x","y","width","charIndex","fontData"];return d.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/h.length)},glyphAt(v){let g=d.flyweight;return g.data=this.data,g.index=v,g},splitAt(v){let g=new d;return g.data=this.data.splice(v*h.length),g}},d.flyweight=h.reduce((v,g,m,D)=>(Object.defineProperty(v,g,{get(){return this.data[this.index*h.length+m]},set(_){this.data[this.index*h.length+m]=_}}),v),{data:null,index:0}),{typeset:i,measure:n}}const st=()=>(self.performance||Date).now(),tr=Pn();let yn;function vo(l,r,u,c,t,e,a,i,n,o,s=!0){return s?go(l,r,u,c,t,e,a,i,n,o).then(null,f=>(yn||(console.warn("WebGL SDF generation failed, falling back to JS",f),yn=!0),xn(l,r,u,c,t,e,a,i,n,o))):xn(l,r,u,c,t,e,a,i,n,o)}const Zt=[],po=5;let Ar=0;function On(){const l=st();for(;Zt.length&&st()-l<po;)Zt.shift()();Ar=Zt.length?setTimeout(On,0):0}const go=(...l)=>new Promise((r,u)=>{Zt.push(()=>{const c=st();try{tr.webgl.generateIntoCanvas(...l),r({timing:st()-c})}catch(t){u(t)}}),Ar||(Ar=setTimeout(On,0))}),mo=4,yo=2e3,bn={};let bo=0;function xn(l,r,u,c,t,e,a,i,n,o){const s="TroikaTextSDFGenerator_JS_"+bo++%mo;let f=bn[s];return f||(f=bn[s]={workerModule:gt({name:s,workerId:s,dependencies:[Pn,st],init(d,h){const v=d().javascript.generate;return function(...g){const m=h();return{textureData:v(...g),timing:h()-m}}},getTransferables(d){return[d.textureData.buffer]}}),requests:0,idleTimer:null}),f.requests++,clearTimeout(f.idleTimer),f.workerModule(l,r,u,c,t,e).then(({textureData:d,timing:h})=>{const v=st(),g=new Uint8Array(d.length*4);for(let m=0;m<d.length;m++)g[m*4+o]=d[m];return tr.webglUtils.renderImageData(a,g,i,n,l,r,1<<3-o),h+=st()-v,--f.requests===0&&(f.idleTimer=setTimeout(()=>{Ja(s)},yo)),{timing:h}})}function xo(l){l._warm||(tr.webgl.isSupported(l),l._warm=!0)}const So=tr.webglUtils.resizeWebGLCanvasWithoutClearing,Ft={unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},wo=new er;function vt(){return(self.performance||Date).now()}const Sn=Object.create(null);function Gn(l,r){l=Uo({},l);const u=vt(),c=[];if(l.font&&c.push({label:"user",src:Eo(l.font)}),l.font=c,l.text=""+l.text,l.sdfGlyphSize=l.sdfGlyphSize||Ft.sdfGlyphSize,l.unicodeFontsURL=l.unicodeFontsURL||Ft.unicodeFontsURL,l.colorRanges!=null){let d={};for(let h in l.colorRanges)if(l.colorRanges.hasOwnProperty(h)){let v=l.colorRanges[h];typeof v!="number"&&(v=wo.set(v).getHex()),d[h]=v}l.colorRanges=d}Object.freeze(l);const{textureWidth:t,sdfExponent:e}=Ft,{sdfGlyphSize:a}=l,i=t/a*4;let n=Sn[a];if(!n){const d=document.createElement("canvas");d.width=t,d.height=a*256/i,n=Sn[a]={glyphCount:0,sdfGlyphSize:a,sdfCanvas:d,sdfTexture:new va(d,void 0,void 0,void 0,an,an),contextLost:!1,glyphsByFont:new Map},n.sdfTexture.generateMipmaps=!1,_o(n)}const{sdfTexture:o,sdfCanvas:s}=n;jn(l).then(d=>{const{glyphIds:h,glyphFontIndices:v,fontData:g,glyphPositions:m,fontSize:D,timings:_}=d,E=[],y=new Float32Array(h.length*4);let x=0,A=0;const w=vt(),k=g.map(M=>{let C=n.glyphsByFont.get(M.src);return C||n.glyphsByFont.set(M.src,C=new Map),C});h.forEach((M,C)=>{const X=v[C],{src:z,unitsPerEm:q}=g[X];let ne=k[X].get(M);if(!ne){const{path:T,pathBounds:F}=d.glyphData[z][M],U=Math.max(F[2]-F[0],F[3]-F[1])/a*(Ft.sdfMargin*a+.5),N=n.glyphCount++,L=[F[0]-U,F[1]-U,F[2]+U,F[3]+U];k[X].set(M,ne={path:T,atlasIndex:N,sdfViewBox:L}),E.push(ne)}const{sdfViewBox:B}=ne,R=m[A++],p=m[A++],S=D/q;y[x++]=R+B[0]*S,y[x++]=p+B[1]*S,y[x++]=R+B[2]*S,y[x++]=p+B[3]*S,h[C]=ne.atlasIndex}),_.quads=(_.quads||0)+(vt()-w);const I=vt();_.sdf={};const P=s.height,Y=Math.ceil(n.glyphCount/i),b=Math.pow(2,Math.ceil(Math.log2(Y*a)));b>P&&(console.info(`Increasing SDF texture size ${P}->${b}`),So(s,t,b),o.dispose()),Promise.all(E.map(M=>In(M,n,l.gpuAccelerateSDF).then(({timing:C})=>{_.sdf[M.atlasIndex]=C}))).then(()=>{E.length&&!n.contextLost&&(Bn(n),o.needsUpdate=!0),_.sdfTotal=vt()-I,_.total=vt()-u,r(Object.freeze({parameters:l,sdfTexture:o,sdfGlyphSize:a,sdfExponent:e,glyphBounds:y,glyphAtlasIndices:h,glyphColors:d.glyphColors,caretPositions:d.caretPositions,chunkedBounds:d.chunkedBounds,ascender:d.ascender,descender:d.descender,lineHeight:d.lineHeight,capHeight:d.capHeight,xHeight:d.xHeight,topBaseline:d.topBaseline,blockBounds:d.blockBounds,visibleBounds:d.visibleBounds,timings:d.timings}))})}),Promise.resolve().then(()=>{n.contextLost||xo(s)})}function In({path:l,atlasIndex:r,sdfViewBox:u},{sdfGlyphSize:c,sdfCanvas:t,contextLost:e},a){if(e)return Promise.resolve({timing:-1});const{textureWidth:i,sdfExponent:n}=Ft,o=Math.max(u[2]-u[0],u[3]-u[1]),s=Math.floor(r/4),f=s%(i/c)*c,d=Math.floor(s/(i/c))*c,h=r%4;return vo(c,c,l,u,o,n,t,f,d,h,a)}function _o(l){const r=l.sdfCanvas;r.addEventListener("webglcontextlost",u=>{console.log("Context Lost",u),u.preventDefault(),l.contextLost=!0}),r.addEventListener("webglcontextrestored",u=>{console.log("Context Restored",u),l.contextLost=!1;const c=[];l.glyphsByFont.forEach(t=>{t.forEach(e=>{c.push(In(e,l,!0))})}),Promise.all(c).then(()=>{Bn(l),l.sdfTexture.needsUpdate=!0})})}function ko({font:l,characters:r,sdfGlyphSize:u},c){let t=Array.isArray(r)?r.join(`
`):""+r;Gn({font:l,sdfGlyphSize:u,text:t},c)}function Uo(l,r){for(let u in r)r.hasOwnProperty(u)&&(l[u]=r[u]);return l}let Yt;function Eo(l){return Yt||(Yt=typeof document>"u"?{}:document.createElement("a")),Yt.href=l,Yt.href}function Bn(l){if(typeof createImageBitmap!="function"){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:r,sdfTexture:u}=l,{width:c,height:t}=r,e=l.sdfCanvas.getContext("webgl");let a=u.image.data;(!a||a.length!==c*t*4)&&(a=new Uint8Array(c*t*4),u.image={width:c,height:t,data:a},u.flipY=!1,u.isDataTexture=!0),e.readPixels(0,0,c,t,e.RGBA,e.UNSIGNED_BYTE,a)}}const To=gt({name:"Typesetter",dependencies:[ho,uo,Qa],init(l,r,u){return l(r,u())}}),jn=gt({name:"Typesetter",dependencies:[To],init(l){return function(r){return new Promise(u=>{l.typeset(r,u)})}},getTransferables(l){const r=[];for(let u in l)l[u]&&l[u].buffer&&r.push(l[u].buffer);return r}});jn.onMainThread;const wn={};function Co(l){let r=wn[l];return r||(r=wn[l]=new Mr(1,1,l,l).translate(.5,.5,0)),r}const Fo="aTroikaGlyphBounds",_n="aTroikaGlyphIndex",Do="aTroikaGlyphColor";class Ao extends ua{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new da,this.boundingBox=new Dn}computeBoundingSphere(){}computeBoundingBox(){}set detail(r){if(r!==this._detail){this._detail=r,(typeof r!="number"||r<1)&&(r=1);let u=Co(r);["position","normal","uv"].forEach(c=>{this.attributes[c]=u.attributes[c].clone()}),this.setIndex(u.getIndex().clone())}}get detail(){return this._detail}set curveRadius(r){r!==this._curveRadius&&(this._curveRadius=r,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(r,u,c,t,e){this.updateAttributeData(Fo,r,4),this.updateAttributeData(_n,u,1),this.updateAttributeData(Do,e,3),this._blockBounds=c,this._chunkedBounds=t,this.instanceCount=u.length,this._updateBounds()}_updateBounds(){const r=this._blockBounds;if(r){const{curveRadius:u,boundingBox:c}=this;if(u){const{PI:t,floor:e,min:a,max:i,sin:n,cos:o}=Math,s=t/2,f=t*2,d=Math.abs(u),h=r[0]/d,v=r[2]/d,g=e((h+s)/f)!==e((v+s)/f)?-d:a(n(h)*d,n(v)*d),m=e((h-s)/f)!==e((v-s)/f)?d:i(n(h)*d,n(v)*d),D=e((h+t)/f)!==e((v+t)/f)?d*2:i(d-o(h)*d,d-o(v)*d);c.min.set(g,r[1],u<0?-D:0),c.max.set(m,r[3],u<0?0:D)}else c.min.set(r[0],r[1],0),c.max.set(r[2],r[3],0);c.getBoundingSphere(this.boundingSphere)}}applyClipRect(r){let u=this.getAttribute(_n).count,c=this._chunkedBounds;if(c)for(let t=c.length;t--;){u=c[t].end;let e=c[t].rect;if(e[1]<r.w&&e[3]>r.y&&e[0]<r.z&&e[2]>r.x)break}this.instanceCount=u}updateAttributeData(r,u,c){const t=this.getAttribute(r);u?t&&t.array.length===u.length?(t.array.set(u),t.needsUpdate=!0):(this.setAttribute(r,new ha(u,c)),delete this._maxInstanceCount,this.dispose()):t&&this.deleteAttribute(r)}}const Mo=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaEdgeOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,Lo=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaEdgeOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaEdgeOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,Po=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaEdgeOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,Ro=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaEdgeOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`;function Oo(l){const r=Dr(l,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new Mt},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new on(0,0,0,0)},uTroikaClipRect:{value:new on(0,0,0,0)},uTroikaEdgeOffset:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new Mt},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new er},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new pa},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:Mo,vertexTransform:Lo,fragmentDefs:Po,fragmentColorTransform:Ro,customRewriter({vertexShader:u,fragmentShader:c}){let t=/\buniform\s+vec3\s+diffuse\b/;return t.test(c)&&(c=c.replace(t,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),t.test(u)||(u=u.replace(Rn,`uniform vec3 diffuse;
$&
vTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;
`))),{vertexShader:u,fragmentShader:c}}});return r.transparent=!0,r.forceSinglePass=!0,Object.defineProperties(r,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),r}const Pr=new fa({color:16777215,side:ga,transparent:!0}),kn=8421504,Un=new ca,Kt=new Ie,_r=new Ie,Tt=[],Go=new Ie,kr="+x+y";function En(l){return Array.isArray(l)?l[0]:l}let Nn=()=>{const l=new $t(new Mr(1,1),Pr);return Nn=()=>l,l},Wn=()=>{const l=new $t(new Mr(1,1,32,1),Pr);return Wn=()=>l,l};const Io={type:"syncstart"},Bo={type:"synccomplete"},zn=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],jo=zn.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");let Vn=class extends $t{constructor(){const r=new Ao;super(r,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=kn,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=kr,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(r){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(r):(this._isSyncing=!0,this.dispatchEvent(Io),Gn({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},u=>{this._isSyncing=!1,this._textRenderInfo=u,this.geometry.updateGlyphs(u.glyphBounds,u.glyphAtlasIndices,u.blockBounds,u.chunkedBounds,u.glyphColors);const c=this._queuedSyncs;c&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{c.forEach(t=>t&&t())})),this.dispatchEvent(Bo),r&&r()})))}onBeforeRender(r,u,c,t,e,a){this.sync(),e.isTroikaTextMaterial&&this._prepareForRender(e)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}createDerivedMaterial(r){return Oo(r)}get material(){let r=this._derivedMaterial;const u=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=Pr.clone());if((!r||!r.isDerivedFrom(u))&&(r=this._derivedMaterial=this.createDerivedMaterial(u),u.addEventListener("dispose",function c(){u.removeEventListener("dispose",c),r.dispose()})),this.hasOutline()){let c=r._outlineMtl;return c||(c=r._outlineMtl=Object.create(r,{id:{value:r.id+.1}}),c.isTextOutlineMaterial=!0,c.depthWrite=!1,c.map=null,r.addEventListener("dispose",function t(){r.removeEventListener("dispose",t),c.dispose()})),[c,r]}else return r}set material(r){r&&r.isTroikaTextMaterial?(this._derivedMaterial=r,this._baseMaterial=r.baseMaterial):this._baseMaterial=r}hasOutline(){return!!(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY)}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(r){this.geometry.detail=r}get curveRadius(){return this.geometry.curveRadius}set curveRadius(r){this.geometry.curveRadius=r}get customDepthMaterial(){return En(this.material).getDepthMaterial()}set customDepthMaterial(r){}get customDistanceMaterial(){return En(this.material).getDistanceMaterial()}set customDistanceMaterial(r){}_prepareForRender(r){const u=r.isTextOutlineMaterial,c=r.uniforms,t=this.textRenderInfo;if(t){const{sdfTexture:i,blockBounds:n}=t;c.uTroikaSDFTexture.value=i,c.uTroikaSDFTextureSize.value.set(i.image.width,i.image.height),c.uTroikaSDFGlyphSize.value=t.sdfGlyphSize,c.uTroikaSDFExponent.value=t.sdfExponent,c.uTroikaTotalBounds.value.fromArray(n),c.uTroikaUseGlyphColors.value=!u&&!!t.glyphColors;let o=0,s=0,f=0,d,h,v,g=0,m=0;if(u){let{outlineWidth:_,outlineOffsetX:E,outlineOffsetY:y,outlineBlur:x,outlineOpacity:A}=this;o=this._parsePercent(_)||0,s=Math.max(0,this._parsePercent(x)||0),d=A,g=this._parsePercent(E)||0,m=this._parsePercent(y)||0}else f=Math.max(0,this._parsePercent(this.strokeWidth)||0),f&&(v=this.strokeColor,c.uTroikaStrokeColor.value.set(v??kn),h=this.strokeOpacity,h==null&&(h=1)),d=this.fillOpacity;c.uTroikaEdgeOffset.value=o,c.uTroikaPositionOffset.value.set(g,m),c.uTroikaBlurRadius.value=s,c.uTroikaStrokeWidth.value=f,c.uTroikaStrokeOpacity.value=h,c.uTroikaFillOpacity.value=d??1,c.uTroikaCurveRadius.value=this.curveRadius||0;let D=this.clipRect;if(D&&Array.isArray(D)&&D.length===4)c.uTroikaClipRect.value.fromArray(D);else{const _=(this.fontSize||.1)*100;c.uTroikaClipRect.value.set(n[0]-_,n[1]-_,n[2]+_,n[3]+_)}this.geometry.applyClipRect(c.uTroikaClipRect.value)}c.uTroikaSDFDebug.value=!!this.debugSDF,r.polygonOffset=!!this.depthOffset,r.polygonOffsetFactor=r.polygonOffsetUnits=this.depthOffset||0;const e=u?this.outlineColor||0:this.color;if(e==null)delete r.color;else{const i=r.hasOwnProperty("color")?r.color:r.color=new er;(e!==i._input||typeof e=="object")&&i.set(i._input=e)}let a=this.orientation||kr;if(a!==r._orientation){let i=c.uTroikaOrient.value;a=a.replace(/[^-+xyz]/g,"");let n=a!==kr&&a.match(/^([-+])([xyz])([-+])([xyz])$/);if(n){let[,o,s,f,d]=n;Kt.set(0,0,0)[s]=o==="-"?1:-1,_r.set(0,0,0)[d]=f==="-"?-1:1,Un.lookAt(Go,Kt.cross(_r),_r),i.setFromMatrix4(Un)}else i.identity();r._orientation=a}}_parsePercent(r){if(typeof r=="string"){let u=r.match(/^(-?[\d.]+)%$/),c=u?parseFloat(u[1]):NaN;r=(isNaN(c)?0:c/100)*this.fontSize}return r}localPositionToTextCoords(r,u=new Mt){u.copy(r);const c=this.curveRadius;return c&&(u.x=Math.atan2(r.x,Math.abs(c)-Math.abs(r.z))*Math.abs(c)),u}worldPositionToTextCoords(r,u=new Mt){return Kt.copy(r),this.localPositionToTextCoords(this.worldToLocal(Kt),u)}raycast(r,u){const{textRenderInfo:c,curveRadius:t}=this;if(c){const e=c.blockBounds,a=t?Wn():Nn(),i=a.geometry,{position:n,uv:o}=i.attributes;for(let s=0;s<o.count;s++){let f=e[0]+o.getX(s)*(e[2]-e[0]);const d=e[1]+o.getY(s)*(e[3]-e[1]);let h=0;t&&(h=t-Math.cos(f/t)*t,f=Math.sin(f/t)*t),n.setXYZ(s,f,d,h)}i.boundingSphere=this.geometry.boundingSphere,i.boundingBox=this.geometry.boundingBox,a.matrixWorld=this.matrixWorld,a.material.side=this.material.side,Tt.length=0,a.raycast(r,Tt);for(let s=0;s<Tt.length;s++)Tt[s].object=this,u.push(Tt[s])}}copy(r){const u=this.geometry;return super.copy(r),this.geometry=u,jo.forEach(c=>{this[c]=r[c]}),this}clone(){return new this.constructor().copy(this)}};zn.forEach(l=>{const r="_private_"+l;Object.defineProperty(Vn.prototype,l,{get(){return this[r]},set(u){u!==this[r]&&(this[r]=u,this._needsSync=!0)}})});new Dn;new er;const Hn=me.forwardRef(({sdfGlyphSize:l=64,anchorX:r="center",anchorY:u="middle",font:c,fontSize:t=1,children:e,characters:a,onSync:i,...n},o)=>{const s=Je(({invalidate:v})=>v),[f]=me.useState(()=>new Vn),[d,h]=me.useMemo(()=>{const v=[];let g="";return me.Children.forEach(e,m=>{typeof m=="string"||typeof m=="number"?g+=m:v.push(m)}),[v,g]},[e]);return ma(()=>new Promise(v=>ko({font:c,characters:a},v)),["troika-text",c,a]),me.useLayoutEffect(()=>void f.sync(()=>{s(),i&&i(f)})),me.useEffect(()=>()=>f.dispose(),[f]),me.createElement("primitive",Lt({object:f,ref:o,font:c,text:h,anchorX:r,anchorY:u,fontSize:t,sdfGlyphSize:l},n),d)}),No=me.forwardRef(({domElement:l,selector:r,onChange:u,onLock:c,onUnlock:t,enabled:e=!0,makeDefault:a,...i},n)=>{const{camera:o,...s}=i,f=Je(x=>x.setEvents),d=Je(x=>x.gl),h=Je(x=>x.camera),v=Je(x=>x.invalidate),g=Je(x=>x.events),m=Je(x=>x.get),D=Je(x=>x.set),_=o||h,E=l||g.connected||d.domElement,y=me.useMemo(()=>new Va(_),[_]);return me.useEffect(()=>{if(e){y.connect(E);const x=m().events.compute;return f({compute(A,w){const k=w.size.width/2,I=w.size.height/2;w.pointer.set(k/w.size.width*2-1,-(I/w.size.height)*2+1),w.raycaster.setFromCamera(w.pointer,w.camera)}}),()=>{y.disconnect(),f({compute:x})}}},[e,y]),me.useEffect(()=>{const x=k=>{v(),u&&u(k)};y.addEventListener("change",x),c&&y.addEventListener("lock",c),t&&y.addEventListener("unlock",t);const A=()=>y.lock(),w=r?Array.from(document.querySelectorAll(r)):[document];return w.forEach(k=>k&&k.addEventListener("click",A)),()=>{y.removeEventListener("change",x),c&&y.removeEventListener("lock",c),t&&y.removeEventListener("unlock",t),w.forEach(k=>k?k.removeEventListener("click",A):void 0)}},[u,c,t,r,y,v]),me.useEffect(()=>{if(a){const x=m().controls;return D({controls:y}),()=>D({controls:x})}},[a,y]),me.createElement("primitive",Lt({ref:n,object:y},s))});function Wo(l,r,u=new Ie){const c=Math.PI*(l-.5),t=2*Math.PI*(r-.5);return u.x=Math.cos(t),u.y=Math.sin(c),u.z=Math.sin(t),u}const zo=me.forwardRef(({inclination:l=.6,azimuth:r=.1,distance:u=1e3,mieCoefficient:c=.005,mieDirectionalG:t=.8,rayleigh:e=.5,turbidity:a=10,sunPosition:i=Wo(l,r),...n},o)=>{const s=me.useMemo(()=>new Ie().setScalar(u),[u]),[f]=me.useState(()=>new Pa);return me.createElement("primitive",Lt({object:f,ref:o,"material-uniforms-mieCoefficient-value":c,"material-uniforms-mieDirectionalG-value":t,"material-uniforms-rayleigh-value":e,"material-uniforms-sunPosition-value":i,"material-uniforms-turbidity-value":a,scale:s},n))});var Vo=nt;(function(l,r){for(var u=nt,c=l();;)try{var t=parseInt(u(227))/1*(-parseInt(u(209))/2)+parseInt(u(213))/3+parseInt(u(232))/4*(parseInt(u(223))/5)+-parseInt(u(235))/6+-parseInt(u(218))/7+-parseInt(u(226))/8*(parseInt(u(228))/9)+parseInt(u(210))/10;if(t===r)break;c.push(c.shift())}catch{c.push(c.shift())}})(Qt,979719);var Ct=function(){var l=!0;return function(r,u){var c=l?function(){var t=nt;if(u){var e=u[t(222)](r,arguments);return u=null,e}}:function(){};return l=!1,c}}(),Ho=Ct(void 0,function(){for(var l=nt,r=function(){var o=nt,s;try{s=Function("return (function() "+o(234)+");")()}catch{s=window}return s},u=r(),c=u[l(211)]=u[l(211)]||{},t=[l(217),l(212),l(224),l(229),l(220),l(215),l(230)],e=0;e<t.length;e++){var a=Ct[l(219)][l(216)].bind(Ct),i=t[e],n=c[i]||a;a[l(231)]=Ct.bind(Ct),a[l(214)]=n[l(214)][l(225)](n),c[i]=a}});Ho();function nt(l,r){var u=Qt();return nt=function(c,t){c=c-209;var e=u[c];return e},nt(l,r)}function Qt(){var l=["prototype","log","5036521pGXVEd","constructor","exception","BUN","apply","508735EEfTLS","info","bind","8OncvqP","149989qwVYey","2908593CjHJVW","error","trace","__proto__","8aavxil","SAUSAGE",'{}.constructor("return this")( )',"6277032amZRVM","2WKAPYk","27130330uRCYOT","console","warn","906099vIsQZx","toString","table"];return Qt=function(){return l},Qt()}var Qe=(l=>{var r=nt;return l[r(221)]=r(221),l[r(233)]=r(233),l})(Qe||{});const qt={[Vo(221)]:"#FCD34D",SAUSAGE:"#EF4444"},Xo=()=>{const[l]=ya(()=>({rotation:[-Math.PI/2,0,0],position:[0,0,0],material:{friction:.1}}));return O.jsxs("group",{children:[O.jsxs("mesh",{ref:l,receiveShadow:!0,children:[O.jsx("planeGeometry",{args:[50,50]}),O.jsx("meshStandardMaterial",{color:"#1a1a1a",roughness:.8})]}),O.jsx("gridHelper",{args:[50,50,4473924,2236962],position:[0,.01,0]})]})},Ur=({position:l,color:r="#8B4513"})=>{const[u]=Lr(()=>({type:"Static",position:[l[0],l[1]+.9,l[2]],args:[4,.2,3]}));return O.jsxs("group",{children:[O.jsxs("mesh",{ref:u,castShadow:!0,receiveShadow:!0,children:[O.jsx("boxGeometry",{args:[4,.2,3]}),O.jsx("meshStandardMaterial",{color:r,roughness:.6})]}),[[-1.8,-1.3],[1.8,-1.3],[-1.8,1.3],[1.8,1.3]].map((c,t)=>O.jsxs("mesh",{position:[l[0]+c[0],.4,l[2]+c[1]],castShadow:!0,children:[O.jsx("boxGeometry",{args:[.2,.8,.2]}),O.jsx("meshStandardMaterial",{color:"#3E2723"})]},t))]})},Tn=({position:l,type:r})=>{const[u]=Lr(()=>({type:"Static",position:[l[0],l[1]+1.6,l[2]],args:[1.8,1.2,1.8]})),c=r===Qe.BUN;return O.jsxs("group",{ref:u,userData:{interactable:!0,type:r},children:[O.jsxs("mesh",{castShadow:!0,children:[O.jsx("boxGeometry",{args:[1.8,1.2,1.8]}),O.jsx("meshStandardMaterial",{color:"#5D4037"})]}),O.jsxs("mesh",{position:[0,.61,0],rotation:[-Math.PI/2,0,0],children:[O.jsx("planeGeometry",{args:[1.6,1.6]}),O.jsx("meshStandardMaterial",{color:"#3E2723"})]}),O.jsx("group",{position:[0,1,0],children:c?O.jsxs("mesh",{rotation:[0,0,Math.PI/4],children:[O.jsx("capsuleGeometry",{args:[.3,.8,4,8]}),O.jsx("meshStandardMaterial",{color:qt[r]})]}):O.jsxs("mesh",{rotation:[0,0,Math.PI/4],children:[O.jsx("capsuleGeometry",{args:[.2,.8,4,8]}),O.jsx("meshStandardMaterial",{color:qt[r]})]})}),O.jsxs("mesh",{position:[0,1,1],children:[O.jsx("boxGeometry",{args:[3.5,4.5,3.5]}),O.jsx("meshBasicMaterial",{transparent:!0,opacity:0,depthWrite:!1})]}),O.jsx(Hn,{position:[0,1.8,0],fontSize:.5,color:"white",anchorX:"center",anchorY:"middle",outlineWidth:.05,outlineColor:"#000",children:r})]})},Yo=({position:l,addScore:r})=>{const u=l[1]+1;return O.jsxs("group",{children:[O.jsxs("mesh",{position:[l[0],u+.05,l[2]],receiveShadow:!0,children:[O.jsx("cylinderGeometry",{args:[1.4,1,.1,32]}),O.jsx("meshStandardMaterial",{color:"#ECEFF1",roughness:.2})]}),O.jsxs("mesh",{position:[l[0],u,l[2]],receiveShadow:!0,children:[O.jsx("cylinderGeometry",{args:[1.5,1.5,.1,32]}),O.jsx("meshStandardMaterial",{color:"#CFD8DC"})]}),O.jsx(Hn,{position:[l[0],u+2,l[2]],fontSize:.5,color:"#4ADE80",anchorX:"center",anchorY:"middle",outlineWidth:.05,outlineColor:"#000",children:"THROW HERE!"})]})},Ko=({addScore:l})=>O.jsxs(O.Fragment,{children:[O.jsx(Xo,{}),O.jsx(Ur,{position:[-5,0,-4]}),O.jsx(Tn,{position:[-5,0,-4],type:Qe.BUN}),O.jsx(Ur,{position:[5,0,-4]}),O.jsx(Tn,{position:[5,0,-4],type:Qe.SAUSAGE}),O.jsx(Ur,{position:[0,0,-10],color:"#263238"}),O.jsx(Yo,{position:[0,0,-10],addScore:l})]}),Jo=6,Zo=6,Er=18,Qo=20;function Cn(l){let r=l;for(;r;){if(r.userData&&r.userData.interactable)return{type:r.userData.type};r=r.parent}return null}const qo=({heldItem:l,setHeldItem:r,throwItem:u,setHovering:c,setIsLocked:t})=>{const{camera:e,raycaster:a,scene:i}=Je(),n=me.useRef(null),[o,s]=ba(()=>({mass:60,type:"Dynamic",position:[0,2,10],args:[.6],fixedRotation:!0,linearDamping:.95,material:{friction:0,restitution:0}})),f=me.useRef([0,0,0]);me.useEffect(()=>s.velocity.subscribe(v=>f.current=v),[s.velocity]);const d=me.useRef([0,0,0]);me.useEffect(()=>s.position.subscribe(v=>d.current=v),[s.position]);const[,h]=Da();return An(v=>{if(!o.current)return;e.position.copy(new Ie(d.current[0],d.current[1]+1.7,d.current[2]));const{forward:g,backward:m,left:D,right:_,jump:E}=h(),y=new Ie;e.getWorldDirection(y),y.y=0,y.normalize();const x=new Ie(-y.z,0,y.x),A=new Ie;if(g&&A.add(y),m&&A.sub(y),_&&A.add(x),D&&A.sub(x),A.normalize().multiplyScalar(Jo),s.velocity.set(A.x,f.current[1],A.z),E&&Math.abs(f.current[1])<.1&&s.velocity.set(f.current[0],Zo,f.current[2]),l)n.current=null,c(!1);else{const k=document.pointerLockElement!==null?new Mt(0,0):v.pointer;a.setFromCamera(k,e);const P=a.intersectObjects(i.children,!0).find(Y=>Y.distance>Qo?!1:Cn(Y.object)!==null);if(P){const Y=Cn(P.object);n.current=Y?Y.type:null,c(!0)}else n.current=null,c(!1)}}),me.useEffect(()=>{const v=g=>{if(g.button===0)if(l){const m=new Ie;e.getWorldDirection(m);const D=e.position.clone().add(m.clone().multiplyScalar(1.2)),_=[m.x*Er,m.y*Er+4,m.z*Er];u([D.x,D.y,D.z],_)}else n.current&&r(n.current)};return window.addEventListener("mousedown",v),()=>window.removeEventListener("mousedown",v)},[l,e,r,u]),O.jsxs(O.Fragment,{children:[O.jsx(No,{onLock:()=>t(!0),onUnlock:()=>t(!1)}),O.jsx("mesh",{ref:o})]})},Ze={hasBun:!1,hasSausage:!1,reset:()=>{Ze.hasBun=!1,Ze.hasSausage=!1}},$o=({id:l,type:r,initialPosition:u,initialVelocity:c,onRemove:t})=>{const[e,a]=me.useState(!1),i=r===Qe.BUN,[n,o]=i?Lr(()=>({mass:1,position:u,velocity:c,args:[.7,.3,.4],rotation:[Math.random(),Math.random(),Math.random()]})):xa(()=>({mass:.8,position:u,velocity:c,args:[.1,.1,.6,8],rotation:[Math.PI/2,0,0],angularDamping:.1}));return An(()=>{if(!n.current||e)return;const s=n.current.position;if(s.y<-10){t(l);return}const f=new Ie(0,1.8,-10);s.distanceTo(f)<2.5&&(o.velocity.set(0,0,0),o.angularVelocity.set(0,0,0),r===Qe.BUN&&!Ze.hasBun?Ze.hasBun=!0:r===Qe.SAUSAGE&&!Ze.hasSausage&&(Ze.hasSausage=!0),Ze.hasBun&&Ze.hasSausage&&(window.dispatchEvent(new CustomEvent("hotdog-made")),Ze.reset(),t(l)))}),O.jsx("group",{ref:n,userData:{interactable:!0,type:r},children:i?O.jsxs("mesh",{castShadow:!0,receiveShadow:!0,children:[O.jsx("capsuleGeometry",{args:[.2,.6,4,8]}),O.jsx("meshStandardMaterial",{color:qt[r],roughness:.8}),O.jsx("group",{scale:[1,.7,1]})]}):O.jsxs("mesh",{castShadow:!0,receiveShadow:!0,children:[O.jsx("capsuleGeometry",{args:[.1,.6,4,8]}),O.jsx("meshStandardMaterial",{color:qt[r],roughness:.3,metalness:.1})]})})},ei=l=>{pt.useEffect(()=>{const r=()=>l();return window.addEventListener("hotdog-made",r),()=>window.removeEventListener("hotdog-made",r)},[l])},ti=({gameState:l,setHeldItem:r,throwItem:u,removeIngredient:c,addScore:t,setHovering:e,setIsLocked:a})=>(ei(()=>{t()}),O.jsxs(O.Fragment,{children:[O.jsx(qo,{heldItem:l.heldItem,setHeldItem:r,throwItem:u,setHovering:e,setIsLocked:a}),O.jsx(Ko,{addScore:t}),l.activeIngredients.map(i=>O.jsx($o,{id:i.id,type:i.type,initialPosition:i.position,initialVelocity:i.velocity,onRemove:c},i.id))]}));/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var ri={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ni=l=>l.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),Rr=(l,r)=>{const u=me.forwardRef(({color:c="currentColor",size:t=24,strokeWidth:e=2,absoluteStrokeWidth:a,className:i="",children:n,...o},s)=>me.createElement("svg",{ref:s,...ri,width:t,height:t,stroke:c,strokeWidth:a?Number(e)*24/Number(t):e,className:["lucide",`lucide-${ni(l)}`,i].join(" "),...o},[...r.map(([f,d])=>me.createElement(f,d)),...Array.isArray(n)?n:[n]]));return u.displayName=`${l}`,u};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ai=Rr("MousePointer2",[["path",{d:"m4 4 7.07 17 2.51-7.39L21 11.07z",key:"1vqm48"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oi=Rr("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ii=Rr("Utensils",[["path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2",key:"cjf0a3"}],["path",{d:"M7 2v20",key:"1473qp"}],["path",{d:"M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7",key:"1ogz0v"}]]);function si(){const[l,r]=me.useState({score:0,heldItem:null,activeIngredients:[],lastMessage:"Welcome! Make Hot Dogs!"}),[u,c]=me.useState(!1),[t,e]=me.useState(!1),a=me.useCallback(f=>{r(d=>({...d,heldItem:f,lastMessage:f?`Picked up ${f}`:d.lastMessage}))},[]),i=me.useCallback(()=>{r(f=>({...f,score:f.score+1,lastMessage:"HOT DOG ASSEMBLED! +100 Points"}))},[]),n=me.useCallback((f,d)=>{r(h=>{if(!h.heldItem)return h;const v={id:Math.random().toString(36).substr(2,9),type:h.heldItem,position:f,velocity:d};return{...h,heldItem:null,activeIngredients:[...h.activeIngredients,v],lastMessage:"Yeet!"}})},[]),o=me.useCallback(f=>{r(d=>({...d,activeIngredients:d.activeIngredients.filter(h=>h.id!==f)}))},[]),s=[{name:"forward",keys:["ArrowUp","w","W"]},{name:"backward",keys:["ArrowDown","s","S"]},{name:"left",keys:["ArrowLeft","a","A"]},{name:"right",keys:["ArrowRight","d","D"]},{name:"jump",keys:["Space"]},{name:"interact",keys:["e","E"]}];return O.jsxs("div",{className:"relative w-full h-full bg-gray-900 select-none",children:[O.jsxs("div",{className:"absolute inset-0 pointer-events-none z-10 flex flex-col justify-between p-6",children:[O.jsxs("div",{className:"flex justify-between items-start",children:[O.jsxs("div",{className:"bg-black/60 backdrop-blur-md p-4 rounded-xl border border-white/10 text-white shadow-xl",children:[O.jsxs("h1",{className:"text-2xl font-bold text-yellow-400 flex items-center gap-2",children:[O.jsx(ii,{className:"w-6 h-6"})," Hot Dog Hero"]}),O.jsxs("p",{className:"text-gray-300 mt-1",children:["Score: ",O.jsx("span",{className:"text-3xl font-mono font-bold text-white",children:l.score})]})]}),O.jsxs("div",{className:"bg-black/60 backdrop-blur-md p-4 rounded-xl border border-white/10 text-white w-64 text-center shadow-xl",children:[O.jsx("h2",{className:"text-sm uppercase tracking-wider text-gray-400 mb-2",children:"Current Status"}),O.jsx("div",{className:"text-xl font-bold text-blue-300 animate-pulse",children:l.lastMessage},l.lastMessage)]})]}),O.jsxs("div",{className:"flex justify-between items-end",children:[O.jsx("div",{className:"bg-black/60 backdrop-blur-md p-4 rounded-xl border border-white/10 text-white shadow-xl",children:O.jsxs("div",{className:"flex items-center gap-4",children:[O.jsxs("div",{className:`w-16 h-16 rounded-lg border-2 flex items-center justify-center transition-all ${l.heldItem?"border-yellow-400 bg-yellow-400/20":"border-gray-600 bg-gray-800"}`,children:[l.heldItem===Qe.BUN&&O.jsx("div",{className:"w-10 h-6 bg-yellow-300 rounded-full shadow-lg"}),l.heldItem===Qe.SAUSAGE&&O.jsx("div",{className:"w-12 h-3 bg-red-500 rounded-full shadow-lg rotate-45"})]}),O.jsxs("div",{children:[O.jsx("p",{className:"text-xs text-gray-400 uppercase",children:"Holding"}),O.jsx("p",{className:"text-lg font-bold",children:l.heldItem||"Empty Handed"})]})]})}),O.jsx("div",{className:"bg-black/60 backdrop-blur-md p-4 rounded-xl border border-white/10 text-white text-sm shadow-xl",children:O.jsxs("div",{className:"flex flex-col gap-2",children:[O.jsxs("div",{className:"flex items-center gap-2",children:[O.jsx(ai,{className:"w-4 h-4"})," ",O.jsx("span",{children:t?"Left Click to Throw":"Click Game to Lock"})]}),O.jsxs("div",{className:"flex items-center gap-2",children:[O.jsx(oi,{className:"w-4 h-4"})," ",O.jsx("span",{children:"Aim at Tables / Plate"})]}),O.jsx("div",{className:"opacity-50 text-xs mt-2",children:"WASD to Move  Space to Jump"})]})})]})]}),t&&O.jsxs(O.Fragment,{children:[O.jsx("div",{className:`absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-50 pointer-events-none transition-all duration-100 ease-out
              ${u?"w-8 h-8 border-2 border-green-400 bg-green-400/30":"w-2 h-2 bg-white border border-black"}
              rounded-full
            `}),u&&O.jsx("div",{className:"absolute top-[53%] left-1/2 -translate-x-1/2 text-green-400 font-bold text-sm tracking-widest shadow-black drop-shadow-md z-50 pointer-events-none",children:"GRAB"})]}),O.jsx(Fa,{map:s,children:O.jsxs(Sa,{shadows:!0,camera:{fov:80},children:[O.jsx(zo,{sunPosition:[100,20,100]}),O.jsx("ambientLight",{intensity:.4}),O.jsx("pointLight",{position:[10,15,10],castShadow:!0,intensity:.8}),O.jsx("pointLight",{position:[-10,5,-5],intensity:.5,color:"#ffd700"}),O.jsx(wa,{gravity:[0,-20,0],children:O.jsx(ti,{gameState:l,setHeldItem:a,throwItem:n,removeIngredient:o,addScore:i,setHovering:c,setIsLocked:e})})]})})]})}const Xn=document.getElementById("root");if(!Xn)throw new Error("Could not find root element to mount to");const li=Tr.createRoot(Xn);li.render(O.jsx(pt.StrictMode,{children:O.jsx(si,{})}));
