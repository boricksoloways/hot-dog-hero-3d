import{r as $n,R as Et,a as de,b as ea,V as Oe,S as ta,B as ra,U as An,M as Qt,c as na,E as aa,d as oa,e as ia,f as sa,g as la,h as ca,C as qt,i as fa,j as At,I as ua,k as da,l as Dn,m as ha,T as va,L as an,n as pa,o as on,D as Ur,P as Dr,u as Qe,s as ma,p as Fr,q as ga,t as g,v as ya,w as Pr,x as xa,y as ba,z as Sa,A as wa}from"./vendor-CkaNGULj.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))f(t);new MutationObserver(t=>{for(const e of t)if(e.type==="childList")for(const a of e.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&f(a)}).observe(document,{childList:!0,subtree:!0});function u(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?e.credentials="include":t.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function f(t){if(t.ep)return;t.ep=!0;const e=u(t);fetch(t.href,e)}})();var Er={},sn=$n;Er.createRoot=sn.createRoot,Er.hydrateRoot=sn.hydrateRoot;function Dt(){return Dt=Object.assign?Object.assign.bind():function(l){for(var r=1;r<arguments.length;r++){var u=arguments[r];for(var f in u)({}).hasOwnProperty.call(u,f)&&(l[f]=u[f])}return l},Dt.apply(null,arguments)}const ln=l=>{let r;const u=new Set,f=(o,s)=>{const c=typeof o=="function"?o(r):o;if(!Object.is(c,r)){const d=r;r=s??(typeof c!="object"||c===null)?c:Object.assign({},r,c),u.forEach(h=>h(r,d))}},t=()=>r,i={setState:f,getState:t,getInitialState:()=>n,subscribe:o=>(u.add(o),()=>u.delete(o))},n=r=l(f,t,i);return i},ka=l=>l?ln(l):ln,_a=l=>l;function Ua(l,r=_a){const u=Et.useSyncExternalStore(l.subscribe,Et.useCallback(()=>r(l.getState()),[l,r]),Et.useCallback(()=>r(l.getInitialState()),[l,r]));return Et.useDebugValue(u),u}const cn=l=>{const r=ka(l),u=f=>Ua(r,f);return Object.assign(u,r),u},Ea=l=>l?cn(l):cn,Ta=l=>(r,u,f)=>{const t=f.subscribe;return f.subscribe=(a,i,n)=>{let o=a;if(i){const s=(n==null?void 0:n.equalityFn)||Object.is;let c=a(f.getState());o=d=>{const h=a(d);if(!s(c,h)){const v=c;i(c=h,v)}},n!=null&&n.fireImmediately&&i(c,c)}return t(o)},l(r,u,f)},Ca=Ta,Fn=de.createContext(null);function Ma({map:l,children:r,onChange:u,domElement:f}){const t=l.map(n=>n.name+n.keys).join("-"),e=de.useMemo(()=>Ea(Ca(()=>l.reduce((n,o)=>({...n,[o.name]:!1}),{}))),[t]),a=de.useMemo(()=>[e.subscribe,e.getState,e],[t]),i=e.setState;return de.useEffect(()=>{const o=l.map(({name:h,keys:v,up:m})=>({keys:v,up:m,fn:p=>{i({[h]:p}),u&&u(h,p,a[1]())}})).reduce((h,{keys:v,fn:m,up:p=!0})=>(v.forEach(C=>h[C]={fn:m,pressed:!1,up:p}),h),{}),s=({key:h,code:v})=>{const m=o[h]||o[v];if(!m)return;const{fn:p,pressed:C,up:k}=m;m.pressed=!0,(k||!C)&&p(!0)},c=({key:h,code:v})=>{const m=o[h]||o[v];if(!m)return;const{fn:p,up:C}=m;m.pressed=!1,C&&p(!1)},d=f||window;return d.addEventListener("keydown",s,{passive:!0}),d.addEventListener("keyup",c,{passive:!0}),()=>{d.removeEventListener("keydown",s),d.removeEventListener("keyup",c)}},[f,t]),de.createElement(Fn.Provider,{value:a,children:r})}function Aa(l){const[r,u,f]=de.useContext(Fn);return[r,u]}const Da=parseInt(ea.replace(/\D+/g,""));var Fa=Object.defineProperty,Pa=(l,r,u)=>r in l?Fa(l,r,{enumerable:!0,configurable:!0,writable:!0,value:u}):l[r]=u,fn=(l,r,u)=>(Pa(l,typeof r!="symbol"?r+"":r,u),u);const ja=(()=>{const l={uniforms:{turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new Oe},up:{value:new Oe(0,1,0)}},vertexShader:`
      uniform vec3 sunPosition;
      uniform float rayleigh;
      uniform float turbidity;
      uniform float mieCoefficient;
      uniform vec3 up;

      varying vec3 vWorldPosition;
      varying vec3 vSunDirection;
      varying float vSunfade;
      varying vec3 vBetaR;
      varying vec3 vBetaM;
      varying float vSunE;

      // constants for atmospheric scattering
      const float e = 2.71828182845904523536028747135266249775724709369995957;
      const float pi = 3.141592653589793238462643383279502884197169;

      // wavelength of used primaries, according to preetham
      const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );
      // this pre-calcuation replaces older TotalRayleigh(vec3 lambda) function:
      // (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn))
      const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );

      // mie stuff
      // K coefficient for the primaries
      const float v = 4.0;
      const vec3 K = vec3( 0.686, 0.678, 0.666 );
      // MieConst = pi * pow( ( 2.0 * pi ) / lambda, vec3( v - 2.0 ) ) * K
      const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );

      // earth shadow hack
      // cutoffAngle = pi / 1.95;
      const float cutoffAngle = 1.6110731556870734;
      const float steepness = 1.5;
      const float EE = 1000.0;

      float sunIntensity( float zenithAngleCos ) {
        zenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );
        return EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );
      }

      vec3 totalMie( float T ) {
        float c = ( 0.2 * T ) * 10E-18;
        return 0.434 * c * MieConst;
      }

      void main() {

        vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
        vWorldPosition = worldPosition.xyz;

        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        gl_Position.z = gl_Position.w; // set z to camera.far

        vSunDirection = normalize( sunPosition );

        vSunE = sunIntensity( dot( vSunDirection, up ) );

        vSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );

        float rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );

      // extinction (absorbtion + out scattering)
      // rayleigh coefficients
        vBetaR = totalRayleigh * rayleighCoefficient;

      // mie coefficients
        vBetaM = totalMie( turbidity ) * mieCoefficient;

      }
    `,fragmentShader:`
      varying vec3 vWorldPosition;
      varying vec3 vSunDirection;
      varying float vSunfade;
      varying vec3 vBetaR;
      varying vec3 vBetaM;
      varying float vSunE;

      uniform float mieDirectionalG;
      uniform vec3 up;

      const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );

      // constants for atmospheric scattering
      const float pi = 3.141592653589793238462643383279502884197169;

      const float n = 1.0003; // refractive index of air
      const float N = 2.545E25; // number of molecules per unit volume for air at 288.15K and 1013mb (sea level -45 celsius)

      // optical length at zenith for molecules
      const float rayleighZenithLength = 8.4E3;
      const float mieZenithLength = 1.25E3;
      // 66 arc seconds -> degrees, and the cosine of that
      const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;

      // 3.0 / ( 16.0 * pi )
      const float THREE_OVER_SIXTEENPI = 0.05968310365946075;
      // 1.0 / ( 4.0 * pi )
      const float ONE_OVER_FOURPI = 0.07957747154594767;

      float rayleighPhase( float cosTheta ) {
        return THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );
      }

      float hgPhase( float cosTheta, float g ) {
        float g2 = pow( g, 2.0 );
        float inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );
        return ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );
      }

      void main() {

        vec3 direction = normalize( vWorldPosition - cameraPos );

      // optical length
      // cutoff angle at 90 to avoid singularity in next formula.
        float zenithAngle = acos( max( 0.0, dot( up, direction ) ) );
        float inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );
        float sR = rayleighZenithLength * inverse;
        float sM = mieZenithLength * inverse;

      // combined extinction factor
        vec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );

      // in scattering
        float cosTheta = dot( direction, vSunDirection );

        float rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );
        vec3 betaRTheta = vBetaR * rPhase;

        float mPhase = hgPhase( cosTheta, mieDirectionalG );
        vec3 betaMTheta = vBetaM * mPhase;

        vec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );
        Lin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );

      // nightsky
        float theta = acos( direction.y ); // elevation --> y-axis, [-pi/2, pi/2]
        float phi = atan( direction.z, direction.x ); // azimuth --> x-axis [-pi/2, pi/2]
        vec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );
        vec3 L0 = vec3( 0.1 ) * Fex;

      // composition + solar disc
        float sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );
        L0 += ( vSunE * 19000.0 * Fex ) * sundisk;

        vec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );

        vec3 retColor = pow( texColor, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );

        gl_FragColor = vec4( retColor, 1.0 );

      #include <tonemapping_fragment>
      #include <${Da>=154?"colorspace_fragment":"encodings_fragment"}>

      }
    `},r=new ta({name:"SkyShader",fragmentShader:l.fragmentShader,vertexShader:l.vertexShader,uniforms:An.clone(l.uniforms),side:ra,depthWrite:!1});class u extends Qt{constructor(){super(new na(1,1,1),r)}}return fn(u,"SkyShader",l),fn(u,"material",r),u})();var La=Object.defineProperty,Ga=(l,r,u)=>r in l?La(l,r,{enumerable:!0,configurable:!0,writable:!0,value:u}):l[r]=u,Ra=(l,r,u)=>(Ga(l,r+"",u),u);class Ia{constructor(){Ra(this,"_listeners")}addEventListener(r,u){this._listeners===void 0&&(this._listeners={});const f=this._listeners;f[r]===void 0&&(f[r]=[]),f[r].indexOf(u)===-1&&f[r].push(u)}hasEventListener(r,u){if(this._listeners===void 0)return!1;const f=this._listeners;return f[r]!==void 0&&f[r].indexOf(u)!==-1}removeEventListener(r,u){if(this._listeners===void 0)return;const t=this._listeners[r];if(t!==void 0){const e=t.indexOf(u);e!==-1&&t.splice(e,1)}}dispatchEvent(r){if(this._listeners===void 0)return;const f=this._listeners[r.type];if(f!==void 0){r.target=this;const t=f.slice(0);for(let e=0,a=t.length;e<a;e++)t[e].call(this,r);r.target=null}}}var Oa=Object.defineProperty,Ba=(l,r,u)=>r in l?Oa(l,r,{enumerable:!0,configurable:!0,writable:!0,value:u}):l[r]=u,je=(l,r,u)=>(Ba(l,typeof r!="symbol"?r+"":r,u),u);const ut=new aa(0,0,0,"YXZ"),dt=new Oe,Na={type:"change"},Wa={type:"lock"},za={type:"unlock"},un=.002,dn=Math.PI/2;let Va=class extends Ia{constructor(r,u){super(),je(this,"camera"),je(this,"domElement"),je(this,"isLocked"),je(this,"minPolarAngle"),je(this,"maxPolarAngle"),je(this,"pointerSpeed"),je(this,"onMouseMove",f=>{!this.domElement||this.isLocked===!1||(ut.setFromQuaternion(this.camera.quaternion),ut.y-=f.movementX*un*this.pointerSpeed,ut.x-=f.movementY*un*this.pointerSpeed,ut.x=Math.max(dn-this.maxPolarAngle,Math.min(dn-this.minPolarAngle,ut.x)),this.camera.quaternion.setFromEuler(ut),this.dispatchEvent(Na))}),je(this,"onPointerlockChange",()=>{this.domElement&&(this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(Wa),this.isLocked=!0):(this.dispatchEvent(za),this.isLocked=!1))}),je(this,"onPointerlockError",()=>{console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}),je(this,"connect",f=>{this.domElement=f||this.domElement,this.domElement&&(this.domElement.ownerDocument.addEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError))}),je(this,"disconnect",()=>{this.domElement&&(this.domElement.ownerDocument.removeEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError))}),je(this,"dispose",()=>{this.disconnect()}),je(this,"getObject",()=>this.camera),je(this,"direction",new Oe(0,0,-1)),je(this,"getDirection",f=>f.copy(this.direction).applyQuaternion(this.camera.quaternion)),je(this,"moveForward",f=>{dt.setFromMatrixColumn(this.camera.matrix,0),dt.crossVectors(this.camera.up,dt),this.camera.position.addScaledVector(dt,f)}),je(this,"moveRight",f=>{dt.setFromMatrixColumn(this.camera.matrix,0),this.camera.position.addScaledVector(dt,f)}),je(this,"lock",()=>{this.domElement&&this.domElement.requestPointerLock()}),je(this,"unlock",()=>{this.domElement&&this.domElement.ownerDocument.exitPointerLock()}),this.camera=r,this.domElement=u,this.isLocked=!1,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,u&&this.connect(u)}};function Ha(){var l=Object.create(null);function r(t,e){var a=t.id,i=t.name,n=t.dependencies;n===void 0&&(n=[]);var o=t.init;o===void 0&&(o=function(){});var s=t.getTransferables;if(s===void 0&&(s=null),!l[a])try{n=n.map(function(d){return d&&d.isWorkerModule&&(r(d,function(h){if(h instanceof Error)throw h}),d=l[d.id].value),d}),o=f("<"+i+">.init",o),s&&(s=f("<"+i+">.getTransferables",s));var c=null;typeof o=="function"?c=o.apply(void 0,n):console.error("worker module init function failed to rehydrate"),l[a]={id:a,value:c,getTransferables:s},e(c)}catch(d){d&&d.noLog||console.error(d),e(d)}}function u(t,e){var a,i=t.id,n=t.args;(!l[i]||typeof l[i].value!="function")&&e(new Error("Worker module "+i+": not found or its 'init' did not return a function"));try{var o=(a=l[i]).value.apply(a,n);o&&typeof o.then=="function"?o.then(s,function(c){return e(c instanceof Error?c:new Error(""+c))}):s(o)}catch(c){e(c)}function s(c){try{var d=l[i].getTransferables&&l[i].getTransferables(c);(!d||!Array.isArray(d)||!d.length)&&(d=void 0),e(c,d)}catch(h){console.error(h),e(h)}}}function f(t,e){var a=void 0;self.troikaDefine=function(n){return a=n};var i=URL.createObjectURL(new Blob(["/** "+t.replace(/\*/g,"")+` **/

troikaDefine(
`+e+`
)`],{type:"application/javascript"}));try{importScripts(i)}catch(n){console.error(n)}return URL.revokeObjectURL(i),delete self.troikaDefine,a}self.addEventListener("message",function(t){var e=t.data,a=e.messageId,i=e.action,n=e.data;try{i==="registerModule"&&r(n,function(o){o instanceof Error?postMessage({messageId:a,success:!1,error:o.message}):postMessage({messageId:a,success:!0,result:{isCallable:typeof o=="function"}})}),i==="callModule"&&u(n,function(o,s){o instanceof Error?postMessage({messageId:a,success:!1,error:o.message}):postMessage({messageId:a,success:!0,result:o},s||void 0)})}catch(o){postMessage({messageId:a,success:!1,error:o.stack})}})}function Xa(l){var r=function(){for(var u=[],f=arguments.length;f--;)u[f]=arguments[f];return r._getInitResult().then(function(t){if(typeof t=="function")return t.apply(void 0,u);throw new Error("Worker module function was called but `init` did not return a callable function")})};return r._getInitResult=function(){var u=l.dependencies,f=l.init;u=Array.isArray(u)?u.map(function(e){return e&&(e=e.onMainThread||e,e._getInitResult&&(e=e._getInitResult())),e}):[];var t=Promise.all(u).then(function(e){return f.apply(null,e)});return r._getInitResult=function(){return t},t},r}var Pn=function(){var l=!1;if(typeof window<"u"&&typeof window.document<"u")try{var r=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})));r.terminate(),l=!0}catch(u){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+u.message+"]")}return Pn=function(){return l},l},Ya=0,Ka=0,br=!1,Ct=Object.create(null),Mt=Object.create(null),Tr=Object.create(null);function vt(l){if((!l||typeof l.init!="function")&&!br)throw new Error("requires `options.init` function");var r=l.dependencies,u=l.init,f=l.getTransferables,t=l.workerId,e=Xa(l);t==null&&(t="#default");var a="workerModule"+ ++Ya,i=l.name||a,n=null;r=r&&r.map(function(s){return typeof s=="function"&&!s.workerModuleData&&(br=!0,s=vt({workerId:t,name:"<"+i+"> function dependency: "+s.name,init:`function(){return (
`+Jt(s)+`
)}`}),br=!1),s&&s.workerModuleData&&(s=s.workerModuleData),s});function o(){for(var s=[],c=arguments.length;c--;)s[c]=arguments[c];if(!Pn())return e.apply(void 0,s);if(!n){n=hn(t,"registerModule",o.workerModuleData);var d=function(){n=null,Mt[t].delete(d)};(Mt[t]||(Mt[t]=new Set)).add(d)}return n.then(function(h){var v=h.isCallable;if(v)return hn(t,"callModule",{id:a,args:s});throw new Error("Worker module function was called but `init` did not return a callable function")})}return o.workerModuleData={isWorkerModule:!0,id:a,name:i,dependencies:r,init:Jt(u),getTransferables:f&&Jt(f)},o.onMainThread=e,o}function Ja(l){Mt[l]&&Mt[l].forEach(function(r){r()}),Ct[l]&&(Ct[l].terminate(),delete Ct[l])}function Jt(l){var r=l.toString();return!/^function/.test(r)&&/^\w+\s*\(/.test(r)&&(r="function "+r),r}function Za(l){var r=Ct[l];if(!r){var u=Jt(Ha);r=Ct[l]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+l.replace(/\*/g,"")+` **/

;(`+u+")()"],{type:"application/javascript"}))),r.onmessage=function(f){var t=f.data,e=t.messageId,a=Tr[e];if(!a)throw new Error("WorkerModule response with empty or unknown messageId");delete Tr[e],a(t)}}return r}function hn(l,r,u){return new Promise(function(f,t){var e=++Ka;Tr[e]=function(a){a.success?f(a.result):t(new Error("Error in worker "+r+" call: "+a.error))},Za(l).postMessage({messageId:e,action:r,data:u})})}function jn(){var l=function(r){function u(O,G,y,w,M,D,T,N){var j=1-T;N.x=j*j*O+2*j*T*y+T*T*M,N.y=j*j*G+2*j*T*w+T*T*D}function f(O,G,y,w,M,D,T,N,j,B){var K=1-j;B.x=K*K*K*O+3*K*K*j*y+3*K*j*j*M+j*j*j*T,B.y=K*K*K*G+3*K*K*j*w+3*K*j*j*D+j*j*j*N}function t(O,G){for(var y=/([MLQCZ])([^MLQCZ]*)/g,w,M,D,T,N;w=y.exec(O);){var j=w[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(B){return parseFloat(B)});switch(w[1]){case"M":T=M=j[0],N=D=j[1];break;case"L":(j[0]!==T||j[1]!==N)&&G("L",T,N,T=j[0],N=j[1]);break;case"Q":{G("Q",T,N,T=j[2],N=j[3],j[0],j[1]);break}case"C":{G("C",T,N,T=j[4],N=j[5],j[0],j[1],j[2],j[3]);break}case"Z":(T!==M||N!==D)&&G("L",T,N,M,D);break}}}function e(O,G,y){y===void 0&&(y=16);var w={x:0,y:0};t(O,function(M,D,T,N,j,B,K,ee,H){switch(M){case"L":G(D,T,N,j);break;case"Q":{for(var W=D,ge=T,ue=1;ue<y;ue++)u(D,T,B,K,N,j,ue/(y-1),w),G(W,ge,w.x,w.y),W=w.x,ge=w.y;break}case"C":{for(var Q=D,te=T,le=1;le<y;le++)f(D,T,B,K,ee,H,N,j,le/(y-1),w),G(Q,te,w.x,w.y),Q=w.x,te=w.y;break}}})}var a="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",i="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",n=new WeakMap,o={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function s(O,G){var y=O.getContext?O.getContext("webgl",o):O,w=n.get(y);if(!w){let K=function(Q){var te=D[Q];if(!te&&(te=D[Q]=y.getExtension(Q),!te))throw new Error(Q+" not supported");return te},ee=function(Q,te){var le=y.createShader(te);return y.shaderSource(le,Q),y.compileShader(le),le},H=function(Q,te,le,V){if(!T[Q]){var re={},$={},R=y.createProgram();y.attachShader(R,ee(te,y.VERTEX_SHADER)),y.attachShader(R,ee(le,y.FRAGMENT_SHADER)),y.linkProgram(R),T[Q]={program:R,transaction:function(Z){y.useProgram(R),Z({setUniform:function(J,Se){for(var ae=[],ie=arguments.length-2;ie-- >0;)ae[ie]=arguments[ie+2];var fe=$[Se]||($[Se]=y.getUniformLocation(R,Se));y["uniform"+J].apply(y,[fe].concat(ae))},setAttribute:function(J,Se,ae,ie,fe){var pe=re[J];pe||(pe=re[J]={buf:y.createBuffer(),loc:y.getAttribLocation(R,J),data:null}),y.bindBuffer(y.ARRAY_BUFFER,pe.buf),y.vertexAttribPointer(pe.loc,Se,y.FLOAT,!1,0,0),y.enableVertexAttribArray(pe.loc),M?y.vertexAttribDivisor(pe.loc,ie):K("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(pe.loc,ie),fe!==pe.data&&(y.bufferData(y.ARRAY_BUFFER,fe,ae),pe.data=fe)}})}}}T[Q].transaction(V)},W=function(Q,te){j++;try{y.activeTexture(y.TEXTURE0+j);var le=N[Q];le||(le=N[Q]=y.createTexture(),y.bindTexture(y.TEXTURE_2D,le),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,y.NEAREST),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,y.NEAREST)),y.bindTexture(y.TEXTURE_2D,le),te(le,j)}finally{j--}},ge=function(Q,te,le){var V=y.createFramebuffer();B.push(V),y.bindFramebuffer(y.FRAMEBUFFER,V),y.activeTexture(y.TEXTURE0+te),y.bindTexture(y.TEXTURE_2D,Q),y.framebufferTexture2D(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0,y.TEXTURE_2D,Q,0);try{le(V)}finally{y.deleteFramebuffer(V),y.bindFramebuffer(y.FRAMEBUFFER,B[--B.length-1]||null)}},ue=function(){D={},T={},N={},j=-1,B.length=0};var M=typeof WebGL2RenderingContext<"u"&&y instanceof WebGL2RenderingContext,D={},T={},N={},j=-1,B=[];y.canvas.addEventListener("webglcontextlost",function(Q){ue(),Q.preventDefault()},!1),n.set(y,w={gl:y,isWebGL2:M,getExtension:K,withProgram:H,withTexture:W,withTextureFramebuffer:ge,handleContextLoss:ue})}G(w)}function c(O,G,y,w,M,D,T,N){T===void 0&&(T=15),N===void 0&&(N=null),s(O,function(j){var B=j.gl,K=j.withProgram,ee=j.withTexture;ee("copy",function(H,W){B.texImage2D(B.TEXTURE_2D,0,B.RGBA,M,D,0,B.RGBA,B.UNSIGNED_BYTE,G),K("copy",a,i,function(ge){var ue=ge.setUniform,Q=ge.setAttribute;Q("aUV",2,B.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),ue("1i","image",W),B.bindFramebuffer(B.FRAMEBUFFER,N||null),B.disable(B.BLEND),B.colorMask(T&8,T&4,T&2,T&1),B.viewport(y,w,M,D),B.scissor(y,w,M,D),B.drawArrays(B.TRIANGLES,0,3)})})})}function d(O,G,y){var w=O.width,M=O.height;s(O,function(D){var T=D.gl,N=new Uint8Array(w*M*4);T.readPixels(0,0,w,M,T.RGBA,T.UNSIGNED_BYTE,N),O.width=G,O.height=y,c(T,N,0,0,w,M)})}var h=Object.freeze({__proto__:null,withWebGLContext:s,renderImageData:c,resizeWebGLCanvasWithoutClearing:d});function v(O,G,y,w,M,D){D===void 0&&(D=1);var T=new Uint8Array(O*G),N=w[2]-w[0],j=w[3]-w[1],B=[];e(y,function(Q,te,le,V){B.push({x1:Q,y1:te,x2:le,y2:V,minX:Math.min(Q,le),minY:Math.min(te,V),maxX:Math.max(Q,le),maxY:Math.max(te,V)})}),B.sort(function(Q,te){return Q.maxX-te.maxX});for(var K=0;K<O;K++)for(var ee=0;ee<G;ee++){var H=ge(w[0]+N*(K+.5)/O,w[1]+j*(ee+.5)/G),W=Math.pow(1-Math.abs(H)/M,D)/2;H<0&&(W=1-W),W=Math.max(0,Math.min(255,Math.round(W*255))),T[ee*O+K]=W}return T;function ge(Q,te){for(var le=1/0,V=1/0,re=B.length;re--;){var $=B[re];if($.maxX+V<=Q)break;if(Q+V>$.minX&&te-V<$.maxY&&te+V>$.minY){var R=C(Q,te,$.x1,$.y1,$.x2,$.y2);R<le&&(le=R,V=Math.sqrt(le))}}return ue(Q,te)&&(V=-V),V}function ue(Q,te){for(var le=0,V=B.length;V--;){var re=B[V];if(re.maxX<=Q)break;var $=re.y1>te!=re.y2>te&&Q<(re.x2-re.x1)*(te-re.y1)/(re.y2-re.y1)+re.x1;$&&(le+=re.y1<re.y2?1:-1)}return le!==0}}function m(O,G,y,w,M,D,T,N,j,B){D===void 0&&(D=1),N===void 0&&(N=0),j===void 0&&(j=0),B===void 0&&(B=0),p(O,G,y,w,M,D,T,null,N,j,B)}function p(O,G,y,w,M,D,T,N,j,B,K){D===void 0&&(D=1),j===void 0&&(j=0),B===void 0&&(B=0),K===void 0&&(K=0);for(var ee=v(O,G,y,w,M,D),H=new Uint8Array(ee.length*4),W=0;W<ee.length;W++)H[W*4+K]=ee[W];c(T,H,j,B,O,G,1<<3-K,N)}function C(O,G,y,w,M,D){var T=M-y,N=D-w,j=T*T+N*N,B=j?Math.max(0,Math.min(1,((O-y)*T+(G-w)*N)/j)):0,K=O-(y+B*T),ee=G-(w+B*N);return K*K+ee*ee}var k=Object.freeze({__proto__:null,generate:v,generateIntoCanvas:m,generateIntoFramebuffer:p}),E="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",x="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",S="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",F=new Float32Array([0,0,2,0,0,2]),_=null,U=!1,I={},L=new WeakMap;function Y(O){if(!U&&!X(O))throw new Error("WebGL generation not supported")}function b(O,G,y,w,M,D,T){if(D===void 0&&(D=1),T===void 0&&(T=null),!T&&(T=_,!T)){var N=typeof OffscreenCanvas=="function"?new OffscreenCanvas(1,1):typeof document<"u"?document.createElement("canvas"):null;if(!N)throw new Error("OffscreenCanvas or DOM canvas not supported");T=_=N.getContext("webgl",{depth:!1})}Y(T);var j=new Uint8Array(O*G*4);s(T,function(H){var W=H.gl,ge=H.withTexture,ue=H.withTextureFramebuffer;ge("readable",function(Q,te){W.texImage2D(W.TEXTURE_2D,0,W.RGBA,O,G,0,W.RGBA,W.UNSIGNED_BYTE,null),ue(Q,te,function(le){A(O,G,y,w,M,D,W,le,0,0,0),W.readPixels(0,0,O,G,W.RGBA,W.UNSIGNED_BYTE,j)})})});for(var B=new Uint8Array(O*G),K=0,ee=0;K<j.length;K+=4)B[ee++]=j[K];return B}function P(O,G,y,w,M,D,T,N,j,B){D===void 0&&(D=1),N===void 0&&(N=0),j===void 0&&(j=0),B===void 0&&(B=0),A(O,G,y,w,M,D,T,null,N,j,B)}function A(O,G,y,w,M,D,T,N,j,B,K){D===void 0&&(D=1),j===void 0&&(j=0),B===void 0&&(B=0),K===void 0&&(K=0),Y(T);var ee=[];e(y,function(H,W,ge,ue){ee.push(H,W,ge,ue)}),ee=new Float32Array(ee),s(T,function(H){var W=H.gl,ge=H.isWebGL2,ue=H.getExtension,Q=H.withProgram,te=H.withTexture,le=H.withTextureFramebuffer,V=H.handleContextLoss;if(te("rawDistances",function(re,$){(O!==re._lastWidth||G!==re._lastHeight)&&W.texImage2D(W.TEXTURE_2D,0,W.RGBA,re._lastWidth=O,re._lastHeight=G,0,W.RGBA,W.UNSIGNED_BYTE,null),Q("main",E,x,function(R){var ve=R.setAttribute,Z=R.setUniform,oe=!ge&&ue("ANGLE_instanced_arrays"),J=!ge&&ue("EXT_blend_minmax");ve("aUV",2,W.STATIC_DRAW,0,F),ve("aLineSegment",4,W.DYNAMIC_DRAW,1,ee),Z.apply(void 0,["4f","uGlyphBounds"].concat(w)),Z("1f","uMaxDistance",M),Z("1f","uExponent",D),le(re,$,function(Se){W.enable(W.BLEND),W.colorMask(!0,!0,!0,!0),W.viewport(0,0,O,G),W.scissor(0,0,O,G),W.blendFunc(W.ONE,W.ONE),W.blendEquationSeparate(W.FUNC_ADD,ge?W.MAX:J.MAX_EXT),W.clear(W.COLOR_BUFFER_BIT),ge?W.drawArraysInstanced(W.TRIANGLES,0,3,ee.length/4):oe.drawArraysInstancedANGLE(W.TRIANGLES,0,3,ee.length/4)})}),Q("post",a,S,function(R){R.setAttribute("aUV",2,W.STATIC_DRAW,0,F),R.setUniform("1i","tex",$),W.bindFramebuffer(W.FRAMEBUFFER,N),W.disable(W.BLEND),W.colorMask(K===0,K===1,K===2,K===3),W.viewport(j,B,O,G),W.scissor(j,B,O,G),W.drawArrays(W.TRIANGLES,0,3)})}),W.isContextLost())throw V(),new Error("webgl context lost")})}function X(O){var G=!O||O===_?I:O.canvas||O,y=L.get(G);if(y===void 0){U=!0;var w=null;try{var M=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],D=b(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,O);y=D&&M.length===D.length&&D.every(function(T,N){return T===M[N]}),y||(w="bad trial run results",console.info(M,D))}catch(T){y=!1,w=T.message}w&&console.warn("WebGL SDF generation not supported:",w),U=!1,L.set(G,y)}return y}var z=Object.freeze({__proto__:null,generate:b,generateIntoCanvas:P,generateIntoFramebuffer:A,isSupported:X});function q(O,G,y,w,M,D){M===void 0&&(M=Math.max(w[2]-w[0],w[3]-w[1])/2),D===void 0&&(D=1);try{return b.apply(z,arguments)}catch(T){return console.info("WebGL SDF generation failed, falling back to JS",T),v.apply(k,arguments)}}function ne(O,G,y,w,M,D,T,N,j,B){M===void 0&&(M=Math.max(w[2]-w[0],w[3]-w[1])/2),D===void 0&&(D=1),N===void 0&&(N=0),j===void 0&&(j=0),B===void 0&&(B=0);try{return P.apply(z,arguments)}catch(K){return console.info("WebGL SDF generation failed, falling back to JS",K),m.apply(k,arguments)}}return r.forEachPathCommand=t,r.generate=q,r.generateIntoCanvas=ne,r.javascript=k,r.pathToLineSegments=e,r.webgl=z,r.webglUtils=h,Object.defineProperty(r,"__esModule",{value:!0}),r}({});return l}function Qa(){var l=function(r){var u={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},f={},t={};f.L=1,t[1]="L",Object.keys(u).forEach(function(V,re){f[V]=1<<re+1,t[f[V]]=V}),Object.freeze(f);var e=f.LRI|f.RLI|f.FSI,a=f.L|f.R|f.AL,i=f.B|f.S|f.WS|f.ON|f.FSI|f.LRI|f.RLI|f.PDI,n=f.BN|f.RLE|f.LRE|f.RLO|f.LRO|f.PDF,o=f.S|f.WS|f.B|e|f.PDI|n,s=null;function c(){if(!s){s=new Map;var V=function($){if(u.hasOwnProperty($)){var R=0;u[$].split(",").forEach(function(ve){var Z=ve.split("+"),oe=Z[0],J=Z[1];oe=parseInt(oe,36),J=J?parseInt(J,36):0,s.set(R+=oe,f[$]);for(var Se=0;Se<J;Se++)s.set(++R,f[$])})}};for(var re in u)V(re)}}function d(V){return c(),s.get(V.codePointAt(0))||f.L}function h(V){return t[d(V)]}var v={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function m(V,re){var $=36,R=0,ve=new Map,Z=re&&new Map,oe;return V.split(",").forEach(function J(Se){if(Se.indexOf("+")!==-1)for(var ae=+Se;ae--;)J(oe);else{oe=Se;var ie=Se.split(">"),fe=ie[0],pe=ie[1];fe=String.fromCodePoint(R+=parseInt(fe,$)),pe=String.fromCodePoint(R+=parseInt(pe,$)),ve.set(fe,pe),re&&Z.set(pe,fe)}}),{map:ve,reverseMap:Z}}var p,C,k;function E(){if(!p){var V=m(v.pairs,!0),re=V.map,$=V.reverseMap;p=re,C=$,k=m(v.canonical,!1).map}}function x(V){return E(),p.get(V)||null}function S(V){return E(),C.get(V)||null}function F(V){return E(),k.get(V)||null}var _=f.L,U=f.R,I=f.EN,L=f.ES,Y=f.ET,b=f.AN,P=f.CS,A=f.B,X=f.S,z=f.ON,q=f.BN,ne=f.NSM,O=f.AL,G=f.LRO,y=f.RLO,w=f.LRE,M=f.RLE,D=f.PDF,T=f.LRI,N=f.RLI,j=f.FSI,B=f.PDI;function K(V,re){for(var $=125,R=new Uint32Array(V.length),ve=0;ve<V.length;ve++)R[ve]=d(V[ve]);var Z=new Map;function oe(Ne,Xe){var We=R[Ne];R[Ne]=Xe,Z.set(We,Z.get(We)-1),We&i&&Z.set(i,Z.get(i)-1),Z.set(Xe,(Z.get(Xe)||0)+1),Xe&i&&Z.set(i,(Z.get(i)||0)+1)}for(var J=new Uint8Array(V.length),Se=new Map,ae=[],ie=null,fe=0;fe<V.length;fe++)ie||ae.push(ie={start:fe,end:V.length-1,level:re==="rtl"?1:re==="ltr"?0:rn(fe,!1)}),R[fe]&A&&(ie.end=fe,ie=null);for(var pe=M|w|y|G|e|B|D|A,_e=function(Ne){return Ne+(Ne&1?1:2)},Ae=function(Ne){return Ne+(Ne&1?2:1)},ye=0;ye<ae.length;ye++){ie=ae[ye];var xe=[{_level:ie.level,_override:0,_isolate:0}],ce=void 0,De=0,Te=0,Be=0;Z.clear();for(var Ue=ie.start;Ue<=ie.end;Ue++){var he=R[Ue];if(ce=xe[xe.length-1],Z.set(he,(Z.get(he)||0)+1),he&i&&Z.set(i,(Z.get(i)||0)+1),he&pe)if(he&(M|w)){J[Ue]=ce._level;var we=(he===M?Ae:_e)(ce._level);we<=$&&!De&&!Te?xe.push({_level:we,_override:0,_isolate:0}):De||Te++}else if(he&(y|G)){J[Ue]=ce._level;var qe=(he===y?Ae:_e)(ce._level);qe<=$&&!De&&!Te?xe.push({_level:qe,_override:he&y?U:_,_isolate:0}):De||Te++}else if(he&e){he&j&&(he=rn(Ue+1,!0)===1?N:T),J[Ue]=ce._level,ce._override&&oe(Ue,ce._override);var ke=(he===N?Ae:_e)(ce._level);ke<=$&&De===0&&Te===0?(Be++,xe.push({_level:ke,_override:0,_isolate:1,_isolInitIndex:Ue})):De++}else if(he&B){if(De>0)De--;else if(Be>0){for(Te=0;!xe[xe.length-1]._isolate;)xe.pop();var be=xe[xe.length-1]._isolInitIndex;be!=null&&(Se.set(be,Ue),Se.set(Ue,be)),xe.pop(),Be--}ce=xe[xe.length-1],J[Ue]=ce._level,ce._override&&oe(Ue,ce._override)}else he&D?(De===0&&(Te>0?Te--:!ce._isolate&&xe.length>1&&(xe.pop(),ce=xe[xe.length-1])),J[Ue]=ce._level):he&A&&(J[Ue]=ie.level);else J[Ue]=ce._level,ce._override&&he!==q&&oe(Ue,ce._override)}for(var Fe=[],Ce=null,me=ie.start;me<=ie.end;me++){var Me=R[me];if(!(Me&n)){var Re=J[me],Ge=Me&e,Pe=Me===B;Ce&&Re===Ce._level?(Ce._end=me,Ce._endsWithIsolInit=Ge):Fe.push(Ce={_start:me,_end:me,_level:Re,_startsWithPDI:Pe,_endsWithIsolInit:Ge})}}for(var Ve=[],$e=0;$e<Fe.length;$e++){var Je=Fe[$e];if(!Je._startsWithPDI||Je._startsWithPDI&&!Se.has(Je._start)){for(var et=[Ce=Je],nt=void 0;Ce&&Ce._endsWithIsolInit&&(nt=Se.get(Ce._end))!=null;)for(var Ze=$e+1;Ze<Fe.length;Ze++)if(Fe[Ze]._start===nt){et.push(Ce=Fe[Ze]);break}for(var Ie=[],at=0;at<et.length;at++)for(var Gr=et[at],er=Gr._start;er<=Gr._end;er++)Ie.push(er);for(var Yn=J[Ie[0]],Rr=ie.level,Pt=Ie[0]-1;Pt>=0;Pt--)if(!(R[Pt]&n)){Rr=J[Pt];break}var tr=Ie[Ie.length-1],Kn=J[tr],Ir=ie.level;if(!(R[tr]&e)){for(var jt=tr+1;jt<=ie.end;jt++)if(!(R[jt]&n)){Ir=J[jt];break}}Ve.push({_seqIndices:Ie,_sosType:Math.max(Rr,Yn)%2?U:_,_eosType:Math.max(Ir,Kn)%2?U:_})}}for(var rr=0;rr<Ve.length;rr++){var nr=Ve[rr],se=nr._seqIndices,pt=nr._sosType,Jn=nr._eosType,st=J[se[0]]&1?U:_;if(Z.get(ne))for(var Lt=0;Lt<se.length;Lt++){var Or=se[Lt];if(R[Or]&ne){for(var ar=pt,Gt=Lt-1;Gt>=0;Gt--)if(!(R[se[Gt]]&n)){ar=R[se[Gt]];break}oe(Or,ar&(e|B)?z:ar)}}if(Z.get(I))for(var Rt=0;Rt<se.length;Rt++){var Br=se[Rt];if(R[Br]&I)for(var It=Rt-1;It>=-1;It--){var Nr=It===-1?pt:R[se[It]];if(Nr&a){Nr===O&&oe(Br,b);break}}}if(Z.get(O))for(var or=0;or<se.length;or++){var Wr=se[or];R[Wr]&O&&oe(Wr,U)}if(Z.get(L)||Z.get(P))for(var mt=1;mt<se.length-1;mt++){var ir=se[mt];if(R[ir]&(L|P)){for(var lt=0,sr=0,lr=mt-1;lr>=0&&(lt=R[se[lr]],!!(lt&n));lr--);for(var cr=mt+1;cr<se.length&&(sr=R[se[cr]],!!(sr&n));cr++);lt===sr&&(R[ir]===L?lt===I:lt&(I|b))&&oe(ir,lt)}}if(Z.get(I))for(var Ke=0;Ke<se.length;Ke++){var Zn=se[Ke];if(R[Zn]&I){for(var Ot=Ke-1;Ot>=0&&R[se[Ot]]&(Y|n);Ot--)oe(se[Ot],I);for(Ke++;Ke<se.length&&R[se[Ke]]&(Y|n|I);Ke++)R[se[Ke]]!==I&&oe(se[Ke],I)}}if(Z.get(Y)||Z.get(L)||Z.get(P))for(var gt=0;gt<se.length;gt++){var zr=se[gt];if(R[zr]&(Y|L|P)){oe(zr,z);for(var Bt=gt-1;Bt>=0&&R[se[Bt]]&n;Bt--)oe(se[Bt],z);for(var Nt=gt+1;Nt<se.length&&R[se[Nt]]&n;Nt++)oe(se[Nt],z)}}if(Z.get(I))for(var fr=0,Vr=pt;fr<se.length;fr++){var Hr=se[fr],ur=R[Hr];ur&I?Vr===_&&oe(Hr,_):ur&a&&(Vr=ur)}if(Z.get(i)){var yt=U|I|b,Xr=yt|_,Wt=[];{for(var ct=[],ft=0;ft<se.length;ft++)if(R[se[ft]]&i){var xt=V[se[ft]],Yr=void 0;if(x(xt)!==null)if(ct.length<63)ct.push({char:xt,seqIndex:ft});else break;else if((Yr=S(xt))!==null)for(var bt=ct.length-1;bt>=0;bt--){var dr=ct[bt].char;if(dr===Yr||dr===S(F(xt))||x(F(dr))===xt){Wt.push([ct[bt].seqIndex,ft]),ct.length=bt;break}}}Wt.sort(function(Ne,Xe){return Ne[0]-Xe[0]})}for(var hr=0;hr<Wt.length;hr++){for(var Kr=Wt[hr],zt=Kr[0],vr=Kr[1],Jr=!1,He=0,pr=zt+1;pr<vr;pr++){var Zr=se[pr];if(R[Zr]&Xr){Jr=!0;var Qr=R[Zr]&yt?U:_;if(Qr===st){He=Qr;break}}}if(Jr&&!He){He=pt;for(var mr=zt-1;mr>=0;mr--){var qr=se[mr];if(R[qr]&Xr){var $r=R[qr]&yt?U:_;$r!==st?He=$r:He=st;break}}}if(He){if(R[se[zt]]=R[se[vr]]=He,He!==st){for(var St=zt+1;St<se.length;St++)if(!(R[se[St]]&n)){d(V[se[St]])&ne&&(R[se[St]]=He);break}}if(He!==st){for(var wt=vr+1;wt<se.length;wt++)if(!(R[se[wt]]&n)){d(V[se[wt]])&ne&&(R[se[wt]]=He);break}}}}for(var tt=0;tt<se.length;tt++)if(R[se[tt]]&i){for(var en=tt,gr=tt,yr=pt,kt=tt-1;kt>=0;kt--)if(R[se[kt]]&n)en=kt;else{yr=R[se[kt]]&yt?U:_;break}for(var tn=Jn,_t=tt+1;_t<se.length;_t++)if(R[se[_t]]&(i|n))gr=_t;else{tn=R[se[_t]]&yt?U:_;break}for(var xr=en;xr<=gr;xr++)R[se[xr]]=yr===tn?yr:st;tt=gr}}}for(var ze=ie.start;ze<=ie.end;ze++){var Qn=J[ze],Vt=R[ze];if(Qn&1?Vt&(_|I|b)&&J[ze]++:Vt&U?J[ze]++:Vt&(b|I)&&(J[ze]+=2),Vt&n&&(J[ze]=ze===0?ie.level:J[ze-1]),ze===ie.end||d(V[ze])&(X|A))for(var Ht=ze;Ht>=0&&d(V[Ht])&o;Ht--)J[Ht]=ie.level}}return{levels:J,paragraphs:ae};function rn(Ne,Xe){for(var We=Ne;We<V.length;We++){var rt=R[We];if(rt&(U|O))return 1;if(rt&(A|_)||Xe&&rt===B)return 0;if(rt&e){var nn=qn(We);We=nn===-1?V.length:nn}}return 0}function qn(Ne){for(var Xe=1,We=Ne+1;We<V.length;We++){var rt=R[We];if(rt&A)break;if(rt&B){if(--Xe===0)return We}else rt&e&&Xe++}return-1}}var ee="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",H;function W(){if(!H){var V=m(ee,!0),re=V.map,$=V.reverseMap;$.forEach(function(R,ve){re.set(ve,R)}),H=re}}function ge(V){return W(),H.get(V)||null}function ue(V,re,$,R){var ve=V.length;$=Math.max(0,$==null?0:+$),R=Math.min(ve-1,R==null?ve-1:+R);for(var Z=new Map,oe=$;oe<=R;oe++)if(re[oe]&1){var J=ge(V[oe]);J!==null&&Z.set(oe,J)}return Z}function Q(V,re,$,R){var ve=V.length;$=Math.max(0,$==null?0:+$),R=Math.min(ve-1,R==null?ve-1:+R);var Z=[];return re.paragraphs.forEach(function(oe){var J=Math.max($,oe.start),Se=Math.min(R,oe.end);if(J<Se){for(var ae=re.levels.slice(J,Se+1),ie=Se;ie>=J&&d(V[ie])&o;ie--)ae[ie]=oe.level;for(var fe=oe.level,pe=1/0,_e=0;_e<ae.length;_e++){var Ae=ae[_e];Ae>fe&&(fe=Ae),Ae<pe&&(pe=Ae|1)}for(var ye=fe;ye>=pe;ye--)for(var xe=0;xe<ae.length;xe++)if(ae[xe]>=ye){for(var ce=xe;xe+1<ae.length&&ae[xe+1]>=ye;)xe++;xe>ce&&Z.push([ce+J,xe+J])}}}),Z}function te(V,re,$,R){var ve=le(V,re,$,R),Z=[].concat(V);return ve.forEach(function(oe,J){Z[J]=(re.levels[oe]&1?ge(V[oe]):null)||V[oe]}),Z.join("")}function le(V,re,$,R){for(var ve=Q(V,re,$,R),Z=[],oe=0;oe<V.length;oe++)Z[oe]=oe;return ve.forEach(function(J){for(var Se=J[0],ae=J[1],ie=Z.slice(Se,ae+1),fe=ie.length;fe--;)Z[ae-fe]=ie[fe]}),Z}return r.closingToOpeningBracket=S,r.getBidiCharType=d,r.getBidiCharTypeName=h,r.getCanonicalBracket=F,r.getEmbeddingLevels=K,r.getMirroredCharacter=ge,r.getMirroredCharactersMap=ue,r.getReorderSegments=Q,r.getReorderedIndices=le,r.getReorderedString=te,r.openingToClosingBracket=x,Object.defineProperty(r,"__esModule",{value:!0}),r}({});return l}const Ln=/\bvoid\s+main\s*\(\s*\)\s*{/g;function Cr(l){const r=/^[ \t]*#include +<([\w\d./]+)>/gm;function u(f,t){let e=la[t];return e?Cr(e):f}return l.replace(r,u)}const Le=[];for(let l=0;l<256;l++)Le[l]=(l<16?"0":"")+l.toString(16);function qa(){const l=Math.random()*4294967295|0,r=Math.random()*4294967295|0,u=Math.random()*4294967295|0,f=Math.random()*4294967295|0;return(Le[l&255]+Le[l>>8&255]+Le[l>>16&255]+Le[l>>24&255]+"-"+Le[r&255]+Le[r>>8&255]+"-"+Le[r>>16&15|64]+Le[r>>24&255]+"-"+Le[u&63|128]+Le[u>>8&255]+"-"+Le[u>>16&255]+Le[u>>24&255]+Le[f&255]+Le[f>>8&255]+Le[f>>16&255]+Le[f>>24&255]).toUpperCase()}const ot=Object.assign||function(){let l=arguments[0];for(let r=1,u=arguments.length;r<u;r++){let f=arguments[r];if(f)for(let t in f)Object.prototype.hasOwnProperty.call(f,t)&&(l[t]=f[t])}return l},$a=Date.now(),vn=new WeakMap,pn=new Map;let eo=1e10;function Mr(l,r){const u=ao(r);let f=vn.get(l);if(f||vn.set(l,f=Object.create(null)),f[u])return new f[u];const t=`_onBeforeCompile${u}`,e=function(o,s){l.onBeforeCompile.call(this,o,s);const c=this.customProgramCacheKey()+"|"+o.vertexShader+"|"+o.fragmentShader;let d=pn[c];if(!d){const h=to(this,o,r,u);d=pn[c]=h}o.vertexShader=d.vertexShader,o.fragmentShader=d.fragmentShader,ot(o.uniforms,this.uniforms),r.timeUniform&&(o.uniforms[r.timeUniform]={get value(){return Date.now()-$a}}),this[t]&&this[t](o)},a=function(){return i(r.chained?l:l.clone())},i=function(o){const s=Object.create(o,n);return Object.defineProperty(s,"baseMaterial",{value:l}),Object.defineProperty(s,"id",{value:eo++}),s.uuid=qa(),s.uniforms=ot({},o.uniforms,r.uniforms),s.defines=ot({},o.defines,r.defines),s.defines[`TROIKA_DERIVED_MATERIAL_${u}`]="",s.extensions=ot({},o.extensions,r.extensions),s._listeners=void 0,s},n={constructor:{value:a},isDerivedMaterial:{value:!0},type:{get:()=>l.type,set:o=>{l.type=o}},isDerivedFrom:{writable:!0,configurable:!0,value:function(o){const s=this.baseMaterial;return o===s||s.isDerivedMaterial&&s.isDerivedFrom(o)||!1}},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return l.customProgramCacheKey()+"|"+u}},onBeforeCompile:{get(){return e},set(o){this[t]=o}},copy:{writable:!0,configurable:!0,value:function(o){return l.copy.call(this,o),!l.isShaderMaterial&&!l.isDerivedMaterial&&(ot(this.extensions,o.extensions),ot(this.defines,o.defines),ot(this.uniforms,An.clone(o.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const o=new l.constructor;return i(o).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let o=this._depthMaterial;return o||(o=this._depthMaterial=Mr(l.isDerivedMaterial?l.getDepthMaterial():new ia({depthPacking:sa}),r),o.defines.IS_DEPTH_MATERIAL="",o.uniforms=this.uniforms),o}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let o=this._distanceMaterial;return o||(o=this._distanceMaterial=Mr(l.isDerivedMaterial?l.getDistanceMaterial():new oa,r),o.defines.IS_DISTANCE_MATERIAL="",o.uniforms=this.uniforms),o}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:o,_distanceMaterial:s}=this;o&&o.dispose(),s&&s.dispose(),l.dispose.call(this)}}};return f[u]=a,new a}function to(l,{vertexShader:r,fragmentShader:u},f,t){let{vertexDefs:e,vertexMainIntro:a,vertexMainOutro:i,vertexTransform:n,fragmentDefs:o,fragmentMainIntro:s,fragmentMainOutro:c,fragmentColorTransform:d,customRewriter:h,timeUniform:v}=f;if(e=e||"",a=a||"",i=i||"",o=o||"",s=s||"",c=c||"",(n||h)&&(r=Cr(r)),(d||h)&&(u=u.replace(/^[ \t]*#include <((?:tonemapping|encodings|colorspace|fog|premultiplied_alpha|dithering)_fragment)>/gm,`
//!BEGIN_POST_CHUNK $1
$&
//!END_POST_CHUNK
`),u=Cr(u)),h){let m=h({vertexShader:r,fragmentShader:u});r=m.vertexShader,u=m.fragmentShader}if(d){let m=[];u=u.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,p=>(m.push(p),"")),c=`${d}
${m.join(`
`)}
${c}`}if(v){const m=`
uniform float ${v};
`;e=m+e,o=m+o}return n&&(r=`vec3 troika_position_${t};
vec3 troika_normal_${t};
vec2 troika_uv_${t};
${r}
`,e=`${e}
void troikaVertexTransform${t}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${n}
}
`,a=`
troika_position_${t} = vec3(position);
troika_normal_${t} = vec3(normal);
troika_uv_${t} = vec2(uv);
troikaVertexTransform${t}(troika_position_${t}, troika_normal_${t}, troika_uv_${t});
${a}
`,r=r.replace(/\b(position|normal|uv)\b/g,(m,p,C,k)=>/\battribute\s+vec[23]\s+$/.test(k.substr(0,C))?p:`troika_${p}_${t}`),l.map&&l.map.channel>0||(r=r.replace(/\bMAP_UV\b/g,`troika_uv_${t}`))),r=mn(r,t,e,a,i),u=mn(u,t,o,s,c),{vertexShader:r,fragmentShader:u}}function mn(l,r,u,f,t){return(f||t||u)&&(l=l.replace(Ln,`
${u}
void troikaOrigMain${r}() {`),l+=`
void main() {
  ${f}
  troikaOrigMain${r}();
  ${t}
}`),l}function ro(l,r){return l==="uniforms"?void 0:typeof r=="function"?r.toString():r}let no=0;const gn=new Map;function ao(l){const r=JSON.stringify(l,ro);let u=gn.get(r);return u==null&&gn.set(r,u=++no),u}/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/function oo(){return typeof window>"u"&&(self.window=self),function(l){var r={parse:function(t){var e=r._bin,a=new Uint8Array(t);if(e.readASCII(a,0,4)=="ttcf"){var i=4;e.readUshort(a,i),i+=2,e.readUshort(a,i),i+=2;var n=e.readUint(a,i);i+=4;for(var o=[],s=0;s<n;s++){var c=e.readUint(a,i);i+=4,o.push(r._readFont(a,c))}return o}return[r._readFont(a,0)]},_readFont:function(t,e){var a=r._bin,i=e;a.readFixed(t,e),e+=4;var n=a.readUshort(t,e);e+=2,a.readUshort(t,e),e+=2,a.readUshort(t,e),e+=2,a.readUshort(t,e),e+=2;for(var o=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],s={_data:t,_offset:i},c={},d=0;d<n;d++){var h=a.readASCII(t,e,4);e+=4,a.readUint(t,e),e+=4;var v=a.readUint(t,e);e+=4;var m=a.readUint(t,e);e+=4,c[h]={offset:v,length:m}}for(d=0;d<o.length;d++){var p=o[d];c[p]&&(s[p.trim()]=r[p.trim()].parse(t,c[p].offset,c[p].length,s))}return s},_tabOffset:function(t,e,a){for(var i=r._bin,n=i.readUshort(t,a+4),o=a+12,s=0;s<n;s++){var c=i.readASCII(t,o,4);o+=4,i.readUint(t,o),o+=4;var d=i.readUint(t,o);if(o+=4,i.readUint(t,o),o+=4,c==e)return d}return 0}};r._bin={readFixed:function(t,e){return(t[e]<<8|t[e+1])+(t[e+2]<<8|t[e+3])/65540},readF2dot14:function(t,e){return r._bin.readShort(t,e)/16384},readInt:function(t,e){return r._bin._view(t).getInt32(e)},readInt8:function(t,e){return r._bin._view(t).getInt8(e)},readShort:function(t,e){return r._bin._view(t).getInt16(e)},readUshort:function(t,e){return r._bin._view(t).getUint16(e)},readUshorts:function(t,e,a){for(var i=[],n=0;n<a;n++)i.push(r._bin.readUshort(t,e+2*n));return i},readUint:function(t,e){return r._bin._view(t).getUint32(e)},readUint64:function(t,e){return 4294967296*r._bin.readUint(t,e)+r._bin.readUint(t,e+4)},readASCII:function(t,e,a){for(var i="",n=0;n<a;n++)i+=String.fromCharCode(t[e+n]);return i},readUnicode:function(t,e,a){for(var i="",n=0;n<a;n++){var o=t[e++]<<8|t[e++];i+=String.fromCharCode(o)}return i},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(t,e,a){var i=r._bin._tdec;return i&&e==0&&a==t.length?i.decode(t):r._bin.readASCII(t,e,a)},readBytes:function(t,e,a){for(var i=[],n=0;n<a;n++)i.push(t[e+n]);return i},readASCIIArray:function(t,e,a){for(var i=[],n=0;n<a;n++)i.push(String.fromCharCode(t[e+n]));return i},_view:function(t){return t._dataView||(t._dataView=t.buffer?new DataView(t.buffer,t.byteOffset,t.byteLength):new DataView(new Uint8Array(t).buffer))}},r._lctf={},r._lctf.parse=function(t,e,a,i,n){var o=r._bin,s={},c=e;o.readFixed(t,e),e+=4;var d=o.readUshort(t,e);e+=2;var h=o.readUshort(t,e);e+=2;var v=o.readUshort(t,e);return e+=2,s.scriptList=r._lctf.readScriptList(t,c+d),s.featureList=r._lctf.readFeatureList(t,c+h),s.lookupList=r._lctf.readLookupList(t,c+v,n),s},r._lctf.readLookupList=function(t,e,a){var i=r._bin,n=e,o=[],s=i.readUshort(t,e);e+=2;for(var c=0;c<s;c++){var d=i.readUshort(t,e);e+=2;var h=r._lctf.readLookupTable(t,n+d,a);o.push(h)}return o},r._lctf.readLookupTable=function(t,e,a){var i=r._bin,n=e,o={tabs:[]};o.ltype=i.readUshort(t,e),e+=2,o.flag=i.readUshort(t,e),e+=2;var s=i.readUshort(t,e);e+=2;for(var c=o.ltype,d=0;d<s;d++){var h=i.readUshort(t,e);e+=2;var v=a(t,c,n+h,o);o.tabs.push(v)}return o},r._lctf.numOfOnes=function(t){for(var e=0,a=0;a<32;a++)t>>>a&1&&e++;return e},r._lctf.readClassDef=function(t,e){var a=r._bin,i=[],n=a.readUshort(t,e);if(e+=2,n==1){var o=a.readUshort(t,e);e+=2;var s=a.readUshort(t,e);e+=2;for(var c=0;c<s;c++)i.push(o+c),i.push(o+c),i.push(a.readUshort(t,e)),e+=2}if(n==2){var d=a.readUshort(t,e);for(e+=2,c=0;c<d;c++)i.push(a.readUshort(t,e)),e+=2,i.push(a.readUshort(t,e)),e+=2,i.push(a.readUshort(t,e)),e+=2}return i},r._lctf.getInterval=function(t,e){for(var a=0;a<t.length;a+=3){var i=t[a],n=t[a+1];if(t[a+2],i<=e&&e<=n)return a}return-1},r._lctf.readCoverage=function(t,e){var a=r._bin,i={};i.fmt=a.readUshort(t,e),e+=2;var n=a.readUshort(t,e);return e+=2,i.fmt==1&&(i.tab=a.readUshorts(t,e,n)),i.fmt==2&&(i.tab=a.readUshorts(t,e,3*n)),i},r._lctf.coverageIndex=function(t,e){var a=t.tab;if(t.fmt==1)return a.indexOf(e);if(t.fmt==2){var i=r._lctf.getInterval(a,e);if(i!=-1)return a[i+2]+(e-a[i])}return-1},r._lctf.readFeatureList=function(t,e){var a=r._bin,i=e,n=[],o=a.readUshort(t,e);e+=2;for(var s=0;s<o;s++){var c=a.readASCII(t,e,4);e+=4;var d=a.readUshort(t,e);e+=2;var h=r._lctf.readFeatureTable(t,i+d);h.tag=c.trim(),n.push(h)}return n},r._lctf.readFeatureTable=function(t,e){var a=r._bin,i=e,n={},o=a.readUshort(t,e);e+=2,o>0&&(n.featureParams=i+o);var s=a.readUshort(t,e);e+=2,n.tab=[];for(var c=0;c<s;c++)n.tab.push(a.readUshort(t,e+2*c));return n},r._lctf.readScriptList=function(t,e){var a=r._bin,i=e,n={},o=a.readUshort(t,e);e+=2;for(var s=0;s<o;s++){var c=a.readASCII(t,e,4);e+=4;var d=a.readUshort(t,e);e+=2,n[c.trim()]=r._lctf.readScriptTable(t,i+d)}return n},r._lctf.readScriptTable=function(t,e){var a=r._bin,i=e,n={},o=a.readUshort(t,e);e+=2,o>0&&(n.default=r._lctf.readLangSysTable(t,i+o));var s=a.readUshort(t,e);e+=2;for(var c=0;c<s;c++){var d=a.readASCII(t,e,4);e+=4;var h=a.readUshort(t,e);e+=2,n[d.trim()]=r._lctf.readLangSysTable(t,i+h)}return n},r._lctf.readLangSysTable=function(t,e){var a=r._bin,i={};a.readUshort(t,e),e+=2,i.reqFeature=a.readUshort(t,e),e+=2;var n=a.readUshort(t,e);return e+=2,i.features=a.readUshorts(t,e,n),i},r.CFF={},r.CFF.parse=function(t,e,a){var i=r._bin;(t=new Uint8Array(t.buffer,e,a))[e=0],t[++e],t[++e],t[++e],e++;var n=[];e=r.CFF.readIndex(t,e,n);for(var o=[],s=0;s<n.length-1;s++)o.push(i.readASCII(t,e+n[s],n[s+1]-n[s]));e+=n[n.length-1];var c=[];e=r.CFF.readIndex(t,e,c);var d=[];for(s=0;s<c.length-1;s++)d.push(r.CFF.readDict(t,e+c[s],e+c[s+1]));e+=c[c.length-1];var h=d[0],v=[];e=r.CFF.readIndex(t,e,v);var m=[];for(s=0;s<v.length-1;s++)m.push(i.readASCII(t,e+v[s],v[s+1]-v[s]));if(e+=v[v.length-1],r.CFF.readSubrs(t,e,h),h.CharStrings){e=h.CharStrings,v=[],e=r.CFF.readIndex(t,e,v);var p=[];for(s=0;s<v.length-1;s++)p.push(i.readBytes(t,e+v[s],v[s+1]-v[s]));h.CharStrings=p}if(h.ROS){e=h.FDArray;var C=[];for(e=r.CFF.readIndex(t,e,C),h.FDArray=[],s=0;s<C.length-1;s++){var k=r.CFF.readDict(t,e+C[s],e+C[s+1]);r.CFF._readFDict(t,k,m),h.FDArray.push(k)}e+=C[C.length-1],e=h.FDSelect,h.FDSelect=[];var E=t[e];if(e++,E!=3)throw E;var x=i.readUshort(t,e);for(e+=2,s=0;s<x+1;s++)h.FDSelect.push(i.readUshort(t,e),t[e+2]),e+=3}return h.Encoding&&(h.Encoding=r.CFF.readEncoding(t,h.Encoding,h.CharStrings.length)),h.charset&&(h.charset=r.CFF.readCharset(t,h.charset,h.CharStrings.length)),r.CFF._readFDict(t,h,m),h},r.CFF._readFDict=function(t,e,a){var i;for(var n in e.Private&&(i=e.Private[1],e.Private=r.CFF.readDict(t,i,i+e.Private[0]),e.Private.Subrs&&r.CFF.readSubrs(t,i+e.Private.Subrs,e.Private)),e)["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(n)!=-1&&(e[n]=a[e[n]-426+35])},r.CFF.readSubrs=function(t,e,a){var i=r._bin,n=[];e=r.CFF.readIndex(t,e,n);var o,s=n.length;o=s<1240?107:s<33900?1131:32768,a.Bias=o,a.Subrs=[];for(var c=0;c<n.length-1;c++)a.Subrs.push(i.readBytes(t,e+n[c],n[c+1]-n[c]))},r.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],r.CFF.glyphByUnicode=function(t,e){for(var a=0;a<t.charset.length;a++)if(t.charset[a]==e)return a;return-1},r.CFF.glyphBySE=function(t,e){return e<0||e>255?-1:r.CFF.glyphByUnicode(t,r.CFF.tableSE[e])},r.CFF.readEncoding=function(t,e,a){r._bin;var i=[".notdef"],n=t[e];if(e++,n!=0)throw"error: unknown encoding format: "+n;var o=t[e];e++;for(var s=0;s<o;s++)i.push(t[e+s]);return i},r.CFF.readCharset=function(t,e,a){var i=r._bin,n=[".notdef"],o=t[e];if(e++,o==0)for(var s=0;s<a;s++){var c=i.readUshort(t,e);e+=2,n.push(c)}else{if(o!=1&&o!=2)throw"error: format: "+o;for(;n.length<a;){c=i.readUshort(t,e),e+=2;var d=0;for(o==1?(d=t[e],e++):(d=i.readUshort(t,e),e+=2),s=0;s<=d;s++)n.push(c),c++}}return n},r.CFF.readIndex=function(t,e,a){var i=r._bin,n=i.readUshort(t,e)+1,o=t[e+=2];if(e++,o==1)for(var s=0;s<n;s++)a.push(t[e+s]);else if(o==2)for(s=0;s<n;s++)a.push(i.readUshort(t,e+2*s));else if(o==3)for(s=0;s<n;s++)a.push(16777215&i.readUint(t,e+3*s-1));else if(n!=1)throw"unsupported offset size: "+o+", count: "+n;return(e+=n*o)-1},r.CFF.getCharString=function(t,e,a){var i=r._bin,n=t[e],o=t[e+1];t[e+2],t[e+3],t[e+4];var s=1,c=null,d=null;n<=20&&(c=n,s=1),n==12&&(c=100*n+o,s=2),21<=n&&n<=27&&(c=n,s=1),n==28&&(d=i.readShort(t,e+1),s=3),29<=n&&n<=31&&(c=n,s=1),32<=n&&n<=246&&(d=n-139,s=1),247<=n&&n<=250&&(d=256*(n-247)+o+108,s=2),251<=n&&n<=254&&(d=256*-(n-251)-o-108,s=2),n==255&&(d=i.readInt(t,e+1)/65535,s=5),a.val=d??"o"+c,a.size=s},r.CFF.readCharString=function(t,e,a){for(var i=e+a,n=r._bin,o=[];e<i;){var s=t[e],c=t[e+1];t[e+2],t[e+3],t[e+4];var d=1,h=null,v=null;s<=20&&(h=s,d=1),s==12&&(h=100*s+c,d=2),s!=19&&s!=20||(h=s,d=2),21<=s&&s<=27&&(h=s,d=1),s==28&&(v=n.readShort(t,e+1),d=3),29<=s&&s<=31&&(h=s,d=1),32<=s&&s<=246&&(v=s-139,d=1),247<=s&&s<=250&&(v=256*(s-247)+c+108,d=2),251<=s&&s<=254&&(v=256*-(s-251)-c-108,d=2),s==255&&(v=n.readInt(t,e+1)/65535,d=5),o.push(v??"o"+h),e+=d}return o},r.CFF.readDict=function(t,e,a){for(var i=r._bin,n={},o=[];e<a;){var s=t[e],c=t[e+1];t[e+2],t[e+3],t[e+4];var d=1,h=null,v=null;if(s==28&&(v=i.readShort(t,e+1),d=3),s==29&&(v=i.readInt(t,e+1),d=5),32<=s&&s<=246&&(v=s-139,d=1),247<=s&&s<=250&&(v=256*(s-247)+c+108,d=2),251<=s&&s<=254&&(v=256*-(s-251)-c-108,d=2),s==255)throw v=i.readInt(t,e+1)/65535,d=5,"unknown number";if(s==30){var m=[];for(d=1;;){var p=t[e+d];d++;var C=p>>4,k=15&p;if(C!=15&&m.push(C),k!=15&&m.push(k),k==15)break}for(var E="",x=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],S=0;S<m.length;S++)E+=x[m[S]];v=parseFloat(E)}s<=21&&(h=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][s],d=1,s==12&&(h=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][c],d=2)),h!=null?(n[h]=o.length==1?o[0]:o,o=[]):o.push(v),e+=d}return n},r.cmap={},r.cmap.parse=function(t,e,a){t=new Uint8Array(t.buffer,e,a),e=0;var i=r._bin,n={};i.readUshort(t,e),e+=2;var o=i.readUshort(t,e);e+=2;var s=[];n.tables=[];for(var c=0;c<o;c++){var d=i.readUshort(t,e);e+=2;var h=i.readUshort(t,e);e+=2;var v=i.readUint(t,e);e+=4;var m="p"+d+"e"+h,p=s.indexOf(v);if(p==-1){var C;p=n.tables.length,s.push(v);var k=i.readUshort(t,v);k==0?C=r.cmap.parse0(t,v):k==4?C=r.cmap.parse4(t,v):k==6?C=r.cmap.parse6(t,v):k==12?C=r.cmap.parse12(t,v):console.debug("unknown format: "+k,d,h,v),n.tables.push(C)}if(n[m]!=null)throw"multiple tables for one platform+encoding";n[m]=p}return n},r.cmap.parse0=function(t,e){var a=r._bin,i={};i.format=a.readUshort(t,e),e+=2;var n=a.readUshort(t,e);e+=2,a.readUshort(t,e),e+=2,i.map=[];for(var o=0;o<n-6;o++)i.map.push(t[e+o]);return i},r.cmap.parse4=function(t,e){var a=r._bin,i=e,n={};n.format=a.readUshort(t,e),e+=2;var o=a.readUshort(t,e);e+=2,a.readUshort(t,e),e+=2;var s=a.readUshort(t,e);e+=2;var c=s/2;n.searchRange=a.readUshort(t,e),e+=2,n.entrySelector=a.readUshort(t,e),e+=2,n.rangeShift=a.readUshort(t,e),e+=2,n.endCount=a.readUshorts(t,e,c),e+=2*c,e+=2,n.startCount=a.readUshorts(t,e,c),e+=2*c,n.idDelta=[];for(var d=0;d<c;d++)n.idDelta.push(a.readShort(t,e)),e+=2;for(n.idRangeOffset=a.readUshorts(t,e,c),e+=2*c,n.glyphIdArray=[];e<i+o;)n.glyphIdArray.push(a.readUshort(t,e)),e+=2;return n},r.cmap.parse6=function(t,e){var a=r._bin,i={};i.format=a.readUshort(t,e),e+=2,a.readUshort(t,e),e+=2,a.readUshort(t,e),e+=2,i.firstCode=a.readUshort(t,e),e+=2;var n=a.readUshort(t,e);e+=2,i.glyphIdArray=[];for(var o=0;o<n;o++)i.glyphIdArray.push(a.readUshort(t,e)),e+=2;return i},r.cmap.parse12=function(t,e){var a=r._bin,i={};i.format=a.readUshort(t,e),e+=2,e+=2,a.readUint(t,e),e+=4,a.readUint(t,e),e+=4;var n=a.readUint(t,e);e+=4,i.groups=[];for(var o=0;o<n;o++){var s=e+12*o,c=a.readUint(t,s+0),d=a.readUint(t,s+4),h=a.readUint(t,s+8);i.groups.push([c,d,h])}return i},r.glyf={},r.glyf.parse=function(t,e,a,i){for(var n=[],o=0;o<i.maxp.numGlyphs;o++)n.push(null);return n},r.glyf._parseGlyf=function(t,e){var a=r._bin,i=t._data,n=r._tabOffset(i,"glyf",t._offset)+t.loca[e];if(t.loca[e]==t.loca[e+1])return null;var o={};if(o.noc=a.readShort(i,n),n+=2,o.xMin=a.readShort(i,n),n+=2,o.yMin=a.readShort(i,n),n+=2,o.xMax=a.readShort(i,n),n+=2,o.yMax=a.readShort(i,n),n+=2,o.xMin>=o.xMax||o.yMin>=o.yMax)return null;if(o.noc>0){o.endPts=[];for(var s=0;s<o.noc;s++)o.endPts.push(a.readUshort(i,n)),n+=2;var c=a.readUshort(i,n);if(n+=2,i.length-n<c)return null;o.instructions=a.readBytes(i,n,c),n+=c;var d=o.endPts[o.noc-1]+1;for(o.flags=[],s=0;s<d;s++){var h=i[n];if(n++,o.flags.push(h),(8&h)!=0){var v=i[n];n++;for(var m=0;m<v;m++)o.flags.push(h),s++}}for(o.xs=[],s=0;s<d;s++){var p=(2&o.flags[s])!=0,C=(16&o.flags[s])!=0;p?(o.xs.push(C?i[n]:-i[n]),n++):C?o.xs.push(0):(o.xs.push(a.readShort(i,n)),n+=2)}for(o.ys=[],s=0;s<d;s++)p=(4&o.flags[s])!=0,C=(32&o.flags[s])!=0,p?(o.ys.push(C?i[n]:-i[n]),n++):C?o.ys.push(0):(o.ys.push(a.readShort(i,n)),n+=2);var k=0,E=0;for(s=0;s<d;s++)k+=o.xs[s],E+=o.ys[s],o.xs[s]=k,o.ys[s]=E}else{var x;o.parts=[];do{x=a.readUshort(i,n),n+=2;var S={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(o.parts.push(S),S.glyphIndex=a.readUshort(i,n),n+=2,1&x){var F=a.readShort(i,n);n+=2;var _=a.readShort(i,n);n+=2}else F=a.readInt8(i,n),n++,_=a.readInt8(i,n),n++;2&x?(S.m.tx=F,S.m.ty=_):(S.p1=F,S.p2=_),8&x?(S.m.a=S.m.d=a.readF2dot14(i,n),n+=2):64&x?(S.m.a=a.readF2dot14(i,n),n+=2,S.m.d=a.readF2dot14(i,n),n+=2):128&x&&(S.m.a=a.readF2dot14(i,n),n+=2,S.m.b=a.readF2dot14(i,n),n+=2,S.m.c=a.readF2dot14(i,n),n+=2,S.m.d=a.readF2dot14(i,n),n+=2)}while(32&x);if(256&x){var U=a.readUshort(i,n);for(n+=2,o.instr=[],s=0;s<U;s++)o.instr.push(i[n]),n++}}return o},r.GDEF={},r.GDEF.parse=function(t,e,a,i){var n=e;e+=4;var o=r._bin.readUshort(t,e);return{glyphClassDef:o===0?null:r._lctf.readClassDef(t,n+o)}},r.GPOS={},r.GPOS.parse=function(t,e,a,i){return r._lctf.parse(t,e,a,i,r.GPOS.subt)},r.GPOS.subt=function(t,e,a,i){var n=r._bin,o=a,s={};if(s.fmt=n.readUshort(t,a),a+=2,e==1||e==2||e==3||e==7||e==8&&s.fmt<=2){var c=n.readUshort(t,a);a+=2,s.coverage=r._lctf.readCoverage(t,c+o)}if(e==1&&s.fmt==1){var d=n.readUshort(t,a);a+=2,d!=0&&(s.pos=r.GPOS.readValueRecord(t,a,d))}else if(e==2&&s.fmt>=1&&s.fmt<=2){d=n.readUshort(t,a),a+=2;var h=n.readUshort(t,a);a+=2;var v=r._lctf.numOfOnes(d),m=r._lctf.numOfOnes(h);if(s.fmt==1){s.pairsets=[];var p=n.readUshort(t,a);a+=2;for(var C=0;C<p;C++){var k=o+n.readUshort(t,a);a+=2;var E=n.readUshort(t,k);k+=2;for(var x=[],S=0;S<E;S++){var F=n.readUshort(t,k);k+=2,d!=0&&(b=r.GPOS.readValueRecord(t,k,d),k+=2*v),h!=0&&(P=r.GPOS.readValueRecord(t,k,h),k+=2*m),x.push({gid2:F,val1:b,val2:P})}s.pairsets.push(x)}}if(s.fmt==2){var _=n.readUshort(t,a);a+=2;var U=n.readUshort(t,a);a+=2;var I=n.readUshort(t,a);a+=2;var L=n.readUshort(t,a);for(a+=2,s.classDef1=r._lctf.readClassDef(t,o+_),s.classDef2=r._lctf.readClassDef(t,o+U),s.matrix=[],C=0;C<I;C++){var Y=[];for(S=0;S<L;S++){var b=null,P=null;d!=0&&(b=r.GPOS.readValueRecord(t,a,d),a+=2*v),h!=0&&(P=r.GPOS.readValueRecord(t,a,h),a+=2*m),Y.push({val1:b,val2:P})}s.matrix.push(Y)}}}else if(e==4&&s.fmt==1)s.markCoverage=r._lctf.readCoverage(t,n.readUshort(t,a)+o),s.baseCoverage=r._lctf.readCoverage(t,n.readUshort(t,a+2)+o),s.markClassCount=n.readUshort(t,a+4),s.markArray=r.GPOS.readMarkArray(t,n.readUshort(t,a+6)+o),s.baseArray=r.GPOS.readBaseArray(t,n.readUshort(t,a+8)+o,s.markClassCount);else if(e==6&&s.fmt==1)s.mark1Coverage=r._lctf.readCoverage(t,n.readUshort(t,a)+o),s.mark2Coverage=r._lctf.readCoverage(t,n.readUshort(t,a+2)+o),s.markClassCount=n.readUshort(t,a+4),s.mark1Array=r.GPOS.readMarkArray(t,n.readUshort(t,a+6)+o),s.mark2Array=r.GPOS.readBaseArray(t,n.readUshort(t,a+8)+o,s.markClassCount);else{if(e==9&&s.fmt==1){var A=n.readUshort(t,a);a+=2;var X=n.readUint(t,a);if(a+=4,i.ltype==9)i.ltype=A;else if(i.ltype!=A)throw"invalid extension substitution";return r.GPOS.subt(t,i.ltype,o+X)}console.debug("unsupported GPOS table LookupType",e,"format",s.fmt)}return s},r.GPOS.readValueRecord=function(t,e,a){var i=r._bin,n=[];return n.push(1&a?i.readShort(t,e):0),e+=1&a?2:0,n.push(2&a?i.readShort(t,e):0),e+=2&a?2:0,n.push(4&a?i.readShort(t,e):0),e+=4&a?2:0,n.push(8&a?i.readShort(t,e):0),e+=8&a?2:0,n},r.GPOS.readBaseArray=function(t,e,a){var i=r._bin,n=[],o=e,s=i.readUshort(t,e);e+=2;for(var c=0;c<s;c++){for(var d=[],h=0;h<a;h++)d.push(r.GPOS.readAnchorRecord(t,o+i.readUshort(t,e))),e+=2;n.push(d)}return n},r.GPOS.readMarkArray=function(t,e){var a=r._bin,i=[],n=e,o=a.readUshort(t,e);e+=2;for(var s=0;s<o;s++){var c=r.GPOS.readAnchorRecord(t,a.readUshort(t,e+2)+n);c.markClass=a.readUshort(t,e),i.push(c),e+=4}return i},r.GPOS.readAnchorRecord=function(t,e){var a=r._bin,i={};return i.fmt=a.readUshort(t,e),i.x=a.readShort(t,e+2),i.y=a.readShort(t,e+4),i},r.GSUB={},r.GSUB.parse=function(t,e,a,i){return r._lctf.parse(t,e,a,i,r.GSUB.subt)},r.GSUB.subt=function(t,e,a,i){var n=r._bin,o=a,s={};if(s.fmt=n.readUshort(t,a),a+=2,e!=1&&e!=2&&e!=4&&e!=5&&e!=6)return null;if(e==1||e==2||e==4||e==5&&s.fmt<=2||e==6&&s.fmt<=2){var c=n.readUshort(t,a);a+=2,s.coverage=r._lctf.readCoverage(t,o+c)}if(e==1&&s.fmt>=1&&s.fmt<=2){if(s.fmt==1)s.delta=n.readShort(t,a),a+=2;else if(s.fmt==2){var d=n.readUshort(t,a);a+=2,s.newg=n.readUshorts(t,a,d),a+=2*s.newg.length}}else if(e==2&&s.fmt==1){d=n.readUshort(t,a),a+=2,s.seqs=[];for(var h=0;h<d;h++){var v=n.readUshort(t,a)+o;a+=2;var m=n.readUshort(t,v);s.seqs.push(n.readUshorts(t,v+2,m))}}else if(e==4)for(s.vals=[],d=n.readUshort(t,a),a+=2,h=0;h<d;h++){var p=n.readUshort(t,a);a+=2,s.vals.push(r.GSUB.readLigatureSet(t,o+p))}else if(e==5&&s.fmt==2){if(s.fmt==2){var C=n.readUshort(t,a);a+=2,s.cDef=r._lctf.readClassDef(t,o+C),s.scset=[];var k=n.readUshort(t,a);for(a+=2,h=0;h<k;h++){var E=n.readUshort(t,a);a+=2,s.scset.push(E==0?null:r.GSUB.readSubClassSet(t,o+E))}}}else if(e==6&&s.fmt==3){if(s.fmt==3){for(h=0;h<3;h++){d=n.readUshort(t,a),a+=2;for(var x=[],S=0;S<d;S++)x.push(r._lctf.readCoverage(t,o+n.readUshort(t,a+2*S)));a+=2*d,h==0&&(s.backCvg=x),h==1&&(s.inptCvg=x),h==2&&(s.ahedCvg=x)}d=n.readUshort(t,a),a+=2,s.lookupRec=r.GSUB.readSubstLookupRecords(t,a,d)}}else{if(e==7&&s.fmt==1){var F=n.readUshort(t,a);a+=2;var _=n.readUint(t,a);if(a+=4,i.ltype==9)i.ltype=F;else if(i.ltype!=F)throw"invalid extension substitution";return r.GSUB.subt(t,i.ltype,o+_)}console.debug("unsupported GSUB table LookupType",e,"format",s.fmt)}return s},r.GSUB.readSubClassSet=function(t,e){var a=r._bin.readUshort,i=e,n=[],o=a(t,e);e+=2;for(var s=0;s<o;s++){var c=a(t,e);e+=2,n.push(r.GSUB.readSubClassRule(t,i+c))}return n},r.GSUB.readSubClassRule=function(t,e){var a=r._bin.readUshort,i={},n=a(t,e),o=a(t,e+=2);e+=2,i.input=[];for(var s=0;s<n-1;s++)i.input.push(a(t,e)),e+=2;return i.substLookupRecords=r.GSUB.readSubstLookupRecords(t,e,o),i},r.GSUB.readSubstLookupRecords=function(t,e,a){for(var i=r._bin.readUshort,n=[],o=0;o<a;o++)n.push(i(t,e),i(t,e+2)),e+=4;return n},r.GSUB.readChainSubClassSet=function(t,e){var a=r._bin,i=e,n=[],o=a.readUshort(t,e);e+=2;for(var s=0;s<o;s++){var c=a.readUshort(t,e);e+=2,n.push(r.GSUB.readChainSubClassRule(t,i+c))}return n},r.GSUB.readChainSubClassRule=function(t,e){for(var a=r._bin,i={},n=["backtrack","input","lookahead"],o=0;o<n.length;o++){var s=a.readUshort(t,e);e+=2,o==1&&s--,i[n[o]]=a.readUshorts(t,e,s),e+=2*i[n[o]].length}return s=a.readUshort(t,e),e+=2,i.subst=a.readUshorts(t,e,2*s),e+=2*i.subst.length,i},r.GSUB.readLigatureSet=function(t,e){var a=r._bin,i=e,n=[],o=a.readUshort(t,e);e+=2;for(var s=0;s<o;s++){var c=a.readUshort(t,e);e+=2,n.push(r.GSUB.readLigature(t,i+c))}return n},r.GSUB.readLigature=function(t,e){var a=r._bin,i={chain:[]};i.nglyph=a.readUshort(t,e),e+=2;var n=a.readUshort(t,e);e+=2;for(var o=0;o<n-1;o++)i.chain.push(a.readUshort(t,e)),e+=2;return i},r.head={},r.head.parse=function(t,e,a){var i=r._bin,n={};return i.readFixed(t,e),e+=4,n.fontRevision=i.readFixed(t,e),e+=4,i.readUint(t,e),e+=4,i.readUint(t,e),e+=4,n.flags=i.readUshort(t,e),e+=2,n.unitsPerEm=i.readUshort(t,e),e+=2,n.created=i.readUint64(t,e),e+=8,n.modified=i.readUint64(t,e),e+=8,n.xMin=i.readShort(t,e),e+=2,n.yMin=i.readShort(t,e),e+=2,n.xMax=i.readShort(t,e),e+=2,n.yMax=i.readShort(t,e),e+=2,n.macStyle=i.readUshort(t,e),e+=2,n.lowestRecPPEM=i.readUshort(t,e),e+=2,n.fontDirectionHint=i.readShort(t,e),e+=2,n.indexToLocFormat=i.readShort(t,e),e+=2,n.glyphDataFormat=i.readShort(t,e),e+=2,n},r.hhea={},r.hhea.parse=function(t,e,a){var i=r._bin,n={};return i.readFixed(t,e),e+=4,n.ascender=i.readShort(t,e),e+=2,n.descender=i.readShort(t,e),e+=2,n.lineGap=i.readShort(t,e),e+=2,n.advanceWidthMax=i.readUshort(t,e),e+=2,n.minLeftSideBearing=i.readShort(t,e),e+=2,n.minRightSideBearing=i.readShort(t,e),e+=2,n.xMaxExtent=i.readShort(t,e),e+=2,n.caretSlopeRise=i.readShort(t,e),e+=2,n.caretSlopeRun=i.readShort(t,e),e+=2,n.caretOffset=i.readShort(t,e),e+=2,e+=8,n.metricDataFormat=i.readShort(t,e),e+=2,n.numberOfHMetrics=i.readUshort(t,e),e+=2,n},r.hmtx={},r.hmtx.parse=function(t,e,a,i){for(var n=r._bin,o={aWidth:[],lsBearing:[]},s=0,c=0,d=0;d<i.maxp.numGlyphs;d++)d<i.hhea.numberOfHMetrics&&(s=n.readUshort(t,e),e+=2,c=n.readShort(t,e),e+=2),o.aWidth.push(s),o.lsBearing.push(c);return o},r.kern={},r.kern.parse=function(t,e,a,i){var n=r._bin,o=n.readUshort(t,e);if(e+=2,o==1)return r.kern.parseV1(t,e-2,a,i);var s=n.readUshort(t,e);e+=2;for(var c={glyph1:[],rval:[]},d=0;d<s;d++){e+=2,a=n.readUshort(t,e),e+=2;var h=n.readUshort(t,e);e+=2;var v=h>>>8;if((v&=15)!=0)throw"unknown kern table format: "+v;e=r.kern.readFormat0(t,e,c)}return c},r.kern.parseV1=function(t,e,a,i){var n=r._bin;n.readFixed(t,e),e+=4;var o=n.readUint(t,e);e+=4;for(var s={glyph1:[],rval:[]},c=0;c<o;c++){n.readUint(t,e),e+=4;var d=n.readUshort(t,e);e+=2,n.readUshort(t,e),e+=2;var h=d>>>8;if((h&=15)!=0)throw"unknown kern table format: "+h;e=r.kern.readFormat0(t,e,s)}return s},r.kern.readFormat0=function(t,e,a){var i=r._bin,n=-1,o=i.readUshort(t,e);e+=2,i.readUshort(t,e),e+=2,i.readUshort(t,e),e+=2,i.readUshort(t,e),e+=2;for(var s=0;s<o;s++){var c=i.readUshort(t,e);e+=2;var d=i.readUshort(t,e);e+=2;var h=i.readShort(t,e);e+=2,c!=n&&(a.glyph1.push(c),a.rval.push({glyph2:[],vals:[]}));var v=a.rval[a.rval.length-1];v.glyph2.push(d),v.vals.push(h),n=c}return e},r.loca={},r.loca.parse=function(t,e,a,i){var n=r._bin,o=[],s=i.head.indexToLocFormat,c=i.maxp.numGlyphs+1;if(s==0)for(var d=0;d<c;d++)o.push(n.readUshort(t,e+(d<<1))<<1);if(s==1)for(d=0;d<c;d++)o.push(n.readUint(t,e+(d<<2)));return o},r.maxp={},r.maxp.parse=function(t,e,a){var i=r._bin,n={},o=i.readUint(t,e);return e+=4,n.numGlyphs=i.readUshort(t,e),e+=2,o==65536&&(n.maxPoints=i.readUshort(t,e),e+=2,n.maxContours=i.readUshort(t,e),e+=2,n.maxCompositePoints=i.readUshort(t,e),e+=2,n.maxCompositeContours=i.readUshort(t,e),e+=2,n.maxZones=i.readUshort(t,e),e+=2,n.maxTwilightPoints=i.readUshort(t,e),e+=2,n.maxStorage=i.readUshort(t,e),e+=2,n.maxFunctionDefs=i.readUshort(t,e),e+=2,n.maxInstructionDefs=i.readUshort(t,e),e+=2,n.maxStackElements=i.readUshort(t,e),e+=2,n.maxSizeOfInstructions=i.readUshort(t,e),e+=2,n.maxComponentElements=i.readUshort(t,e),e+=2,n.maxComponentDepth=i.readUshort(t,e),e+=2),n},r.name={},r.name.parse=function(t,e,a){var i=r._bin,n={};i.readUshort(t,e),e+=2;var o=i.readUshort(t,e);e+=2,i.readUshort(t,e);for(var s,c=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],d=e+=2,h=0;h<o;h++){var v=i.readUshort(t,e);e+=2;var m=i.readUshort(t,e);e+=2;var p=i.readUshort(t,e);e+=2;var C=i.readUshort(t,e);e+=2;var k=i.readUshort(t,e);e+=2;var E=i.readUshort(t,e);e+=2;var x,S=c[C],F=d+12*o+E;if(v==0)x=i.readUnicode(t,F,k/2);else if(v==3&&m==0)x=i.readUnicode(t,F,k/2);else if(m==0)x=i.readASCII(t,F,k);else if(m==1)x=i.readUnicode(t,F,k/2);else if(m==3)x=i.readUnicode(t,F,k/2);else{if(v!=1)throw"unknown encoding "+m+", platformID: "+v;x=i.readASCII(t,F,k),console.debug("reading unknown MAC encoding "+m+" as ASCII")}var _="p"+v+","+p.toString(16);n[_]==null&&(n[_]={}),n[_][S!==void 0?S:C]=x,n[_]._lang=p}for(var U in n)if(n[U].postScriptName!=null&&n[U]._lang==1033)return n[U];for(var U in n)if(n[U].postScriptName!=null&&n[U]._lang==0)return n[U];for(var U in n)if(n[U].postScriptName!=null&&n[U]._lang==3084)return n[U];for(var U in n)if(n[U].postScriptName!=null)return n[U];for(var U in n){s=U;break}return console.debug("returning name table with languageID "+n[s]._lang),n[s]},r["OS/2"]={},r["OS/2"].parse=function(t,e,a){var i=r._bin.readUshort(t,e);e+=2;var n={};if(i==0)r["OS/2"].version0(t,e,n);else if(i==1)r["OS/2"].version1(t,e,n);else if(i==2||i==3||i==4)r["OS/2"].version2(t,e,n);else{if(i!=5)throw"unknown OS/2 table version: "+i;r["OS/2"].version5(t,e,n)}return n},r["OS/2"].version0=function(t,e,a){var i=r._bin;return a.xAvgCharWidth=i.readShort(t,e),e+=2,a.usWeightClass=i.readUshort(t,e),e+=2,a.usWidthClass=i.readUshort(t,e),e+=2,a.fsType=i.readUshort(t,e),e+=2,a.ySubscriptXSize=i.readShort(t,e),e+=2,a.ySubscriptYSize=i.readShort(t,e),e+=2,a.ySubscriptXOffset=i.readShort(t,e),e+=2,a.ySubscriptYOffset=i.readShort(t,e),e+=2,a.ySuperscriptXSize=i.readShort(t,e),e+=2,a.ySuperscriptYSize=i.readShort(t,e),e+=2,a.ySuperscriptXOffset=i.readShort(t,e),e+=2,a.ySuperscriptYOffset=i.readShort(t,e),e+=2,a.yStrikeoutSize=i.readShort(t,e),e+=2,a.yStrikeoutPosition=i.readShort(t,e),e+=2,a.sFamilyClass=i.readShort(t,e),e+=2,a.panose=i.readBytes(t,e,10),e+=10,a.ulUnicodeRange1=i.readUint(t,e),e+=4,a.ulUnicodeRange2=i.readUint(t,e),e+=4,a.ulUnicodeRange3=i.readUint(t,e),e+=4,a.ulUnicodeRange4=i.readUint(t,e),e+=4,a.achVendID=[i.readInt8(t,e),i.readInt8(t,e+1),i.readInt8(t,e+2),i.readInt8(t,e+3)],e+=4,a.fsSelection=i.readUshort(t,e),e+=2,a.usFirstCharIndex=i.readUshort(t,e),e+=2,a.usLastCharIndex=i.readUshort(t,e),e+=2,a.sTypoAscender=i.readShort(t,e),e+=2,a.sTypoDescender=i.readShort(t,e),e+=2,a.sTypoLineGap=i.readShort(t,e),e+=2,a.usWinAscent=i.readUshort(t,e),e+=2,a.usWinDescent=i.readUshort(t,e),e+=2},r["OS/2"].version1=function(t,e,a){var i=r._bin;return e=r["OS/2"].version0(t,e,a),a.ulCodePageRange1=i.readUint(t,e),e+=4,a.ulCodePageRange2=i.readUint(t,e),e+=4},r["OS/2"].version2=function(t,e,a){var i=r._bin;return e=r["OS/2"].version1(t,e,a),a.sxHeight=i.readShort(t,e),e+=2,a.sCapHeight=i.readShort(t,e),e+=2,a.usDefault=i.readUshort(t,e),e+=2,a.usBreak=i.readUshort(t,e),e+=2,a.usMaxContext=i.readUshort(t,e),e+=2},r["OS/2"].version5=function(t,e,a){var i=r._bin;return e=r["OS/2"].version2(t,e,a),a.usLowerOpticalPointSize=i.readUshort(t,e),e+=2,a.usUpperOpticalPointSize=i.readUshort(t,e),e+=2},r.post={},r.post.parse=function(t,e,a){var i=r._bin,n={};return n.version=i.readFixed(t,e),e+=4,n.italicAngle=i.readFixed(t,e),e+=4,n.underlinePosition=i.readShort(t,e),e+=2,n.underlineThickness=i.readShort(t,e),e+=2,n},r==null&&(r={}),r.U==null&&(r.U={}),r.U.codeToGlyph=function(t,e){var a=t.cmap,i=-1;if(a.p0e4!=null?i=a.p0e4:a.p3e1!=null?i=a.p3e1:a.p1e0!=null?i=a.p1e0:a.p0e3!=null&&(i=a.p0e3),i==-1)throw"no familiar platform and encoding!";var n=a.tables[i];if(n.format==0)return e>=n.map.length?0:n.map[e];if(n.format==4){for(var o=-1,s=0;s<n.endCount.length;s++)if(e<=n.endCount[s]){o=s;break}return o==-1||n.startCount[o]>e?0:65535&(n.idRangeOffset[o]!=0?n.glyphIdArray[e-n.startCount[o]+(n.idRangeOffset[o]>>1)-(n.idRangeOffset.length-o)]:e+n.idDelta[o])}if(n.format==12){if(e>n.groups[n.groups.length-1][1])return 0;for(s=0;s<n.groups.length;s++){var c=n.groups[s];if(c[0]<=e&&e<=c[1])return c[2]+(e-c[0])}return 0}throw"unknown cmap table format "+n.format},r.U.glyphToPath=function(t,e){var a={cmds:[],crds:[]};if(t.SVG&&t.SVG.entries[e]){var i=t.SVG.entries[e];return i==null?a:(typeof i=="string"&&(i=r.SVG.toPath(i),t.SVG.entries[e]=i),i)}if(t.CFF){var n={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:t.CFF.Private?t.CFF.Private.defaultWidthX:0,open:!1},o=t.CFF,s=t.CFF.Private;if(o.ROS){for(var c=0;o.FDSelect[c+2]<=e;)c+=2;s=o.FDArray[o.FDSelect[c+1]].Private}r.U._drawCFF(t.CFF.CharStrings[e],n,o,s,a)}else t.glyf&&r.U._drawGlyf(e,t,a);return a},r.U._drawGlyf=function(t,e,a){var i=e.glyf[t];i==null&&(i=e.glyf[t]=r.glyf._parseGlyf(e,t)),i!=null&&(i.noc>-1?r.U._simpleGlyph(i,a):r.U._compoGlyph(i,e,a))},r.U._simpleGlyph=function(t,e){for(var a=0;a<t.noc;a++){for(var i=a==0?0:t.endPts[a-1]+1,n=t.endPts[a],o=i;o<=n;o++){var s=o==i?n:o-1,c=o==n?i:o+1,d=1&t.flags[o],h=1&t.flags[s],v=1&t.flags[c],m=t.xs[o],p=t.ys[o];if(o==i)if(d){if(!h){r.U.P.moveTo(e,m,p);continue}r.U.P.moveTo(e,t.xs[s],t.ys[s])}else h?r.U.P.moveTo(e,t.xs[s],t.ys[s]):r.U.P.moveTo(e,(t.xs[s]+m)/2,(t.ys[s]+p)/2);d?h&&r.U.P.lineTo(e,m,p):v?r.U.P.qcurveTo(e,m,p,t.xs[c],t.ys[c]):r.U.P.qcurveTo(e,m,p,(m+t.xs[c])/2,(p+t.ys[c])/2)}r.U.P.closePath(e)}},r.U._compoGlyph=function(t,e,a){for(var i=0;i<t.parts.length;i++){var n={cmds:[],crds:[]},o=t.parts[i];r.U._drawGlyf(o.glyphIndex,e,n);for(var s=o.m,c=0;c<n.crds.length;c+=2){var d=n.crds[c],h=n.crds[c+1];a.crds.push(d*s.a+h*s.b+s.tx),a.crds.push(d*s.c+h*s.d+s.ty)}for(c=0;c<n.cmds.length;c++)a.cmds.push(n.cmds[c])}},r.U._getGlyphClass=function(t,e){var a=r._lctf.getInterval(e,t);return a==-1?0:e[a+2]},r.U._applySubs=function(t,e,a,i){for(var n=t.length-e-1,o=0;o<a.tabs.length;o++)if(a.tabs[o]!=null){var s,c=a.tabs[o];if(!c.coverage||(s=r._lctf.coverageIndex(c.coverage,t[e]))!=-1){if(a.ltype==1)t[e],c.fmt==1?t[e]=t[e]+c.delta:t[e]=c.newg[s];else if(a.ltype==4)for(var d=c.vals[s],h=0;h<d.length;h++){var v=d[h],m=v.chain.length;if(!(m>n)){for(var p=!0,C=0,k=0;k<m;k++){for(;t[e+C+(1+k)]==-1;)C++;v.chain[k]!=t[e+C+(1+k)]&&(p=!1)}if(p){for(t[e]=v.nglyph,k=0;k<m+C;k++)t[e+k+1]=-1;break}}}else if(a.ltype==5&&c.fmt==2)for(var E=r._lctf.getInterval(c.cDef,t[e]),x=c.cDef[E+2],S=c.scset[x],F=0;F<S.length;F++){var _=S[F],U=_.input;if(!(U.length>n)){for(p=!0,k=0;k<U.length;k++){var I=r._lctf.getInterval(c.cDef,t[e+1+k]);if(E==-1&&c.cDef[I+2]!=U[k]){p=!1;break}}if(p){var L=_.substLookupRecords;for(h=0;h<L.length;h+=2)L[h],L[h+1]}}}else if(a.ltype==6&&c.fmt==3){if(!r.U._glsCovered(t,c.backCvg,e-c.backCvg.length)||!r.U._glsCovered(t,c.inptCvg,e)||!r.U._glsCovered(t,c.ahedCvg,e+c.inptCvg.length))continue;var Y=c.lookupRec;for(F=0;F<Y.length;F+=2){E=Y[F];var b=i[Y[F+1]];r.U._applySubs(t,e+E,b,i)}}}}},r.U._glsCovered=function(t,e,a){for(var i=0;i<e.length;i++)if(r._lctf.coverageIndex(e[i],t[a+i])==-1)return!1;return!0},r.U.glyphsToPath=function(t,e,a){for(var i={cmds:[],crds:[]},n=0,o=0;o<e.length;o++){var s=e[o];if(s!=-1){for(var c=o<e.length-1&&e[o+1]!=-1?e[o+1]:0,d=r.U.glyphToPath(t,s),h=0;h<d.crds.length;h+=2)i.crds.push(d.crds[h]+n),i.crds.push(d.crds[h+1]);for(a&&i.cmds.push(a),h=0;h<d.cmds.length;h++)i.cmds.push(d.cmds[h]);a&&i.cmds.push("X"),n+=t.hmtx.aWidth[s],o<e.length-1&&(n+=r.U.getPairAdjustment(t,s,c))}}return i},r.U.P={},r.U.P.moveTo=function(t,e,a){t.cmds.push("M"),t.crds.push(e,a)},r.U.P.lineTo=function(t,e,a){t.cmds.push("L"),t.crds.push(e,a)},r.U.P.curveTo=function(t,e,a,i,n,o,s){t.cmds.push("C"),t.crds.push(e,a,i,n,o,s)},r.U.P.qcurveTo=function(t,e,a,i,n){t.cmds.push("Q"),t.crds.push(e,a,i,n)},r.U.P.closePath=function(t){t.cmds.push("Z")},r.U._drawCFF=function(t,e,a,i,n){for(var o=e.stack,s=e.nStems,c=e.haveWidth,d=e.width,h=e.open,v=0,m=e.x,p=e.y,C=0,k=0,E=0,x=0,S=0,F=0,_=0,U=0,I=0,L=0,Y={val:0,size:0};v<t.length;){r.CFF.getCharString(t,v,Y);var b=Y.val;if(v+=Y.size,b=="o1"||b=="o18")o.length%2!=0&&!c&&(d=o.shift()+i.nominalWidthX),s+=o.length>>1,o.length=0,c=!0;else if(b=="o3"||b=="o23")o.length%2!=0&&!c&&(d=o.shift()+i.nominalWidthX),s+=o.length>>1,o.length=0,c=!0;else if(b=="o4")o.length>1&&!c&&(d=o.shift()+i.nominalWidthX,c=!0),h&&r.U.P.closePath(n),p+=o.pop(),r.U.P.moveTo(n,m,p),h=!0;else if(b=="o5")for(;o.length>0;)m+=o.shift(),p+=o.shift(),r.U.P.lineTo(n,m,p);else if(b=="o6"||b=="o7")for(var P=o.length,A=b=="o6",X=0;X<P;X++){var z=o.shift();A?m+=z:p+=z,A=!A,r.U.P.lineTo(n,m,p)}else if(b=="o8"||b=="o24"){P=o.length;for(var q=0;q+6<=P;)C=m+o.shift(),k=p+o.shift(),E=C+o.shift(),x=k+o.shift(),m=E+o.shift(),p=x+o.shift(),r.U.P.curveTo(n,C,k,E,x,m,p),q+=6;b=="o24"&&(m+=o.shift(),p+=o.shift(),r.U.P.lineTo(n,m,p))}else{if(b=="o11")break;if(b=="o1234"||b=="o1235"||b=="o1236"||b=="o1237")b=="o1234"&&(k=p,E=(C=m+o.shift())+o.shift(),L=x=k+o.shift(),F=x,U=p,m=(_=(S=(I=E+o.shift())+o.shift())+o.shift())+o.shift(),r.U.P.curveTo(n,C,k,E,x,I,L),r.U.P.curveTo(n,S,F,_,U,m,p)),b=="o1235"&&(C=m+o.shift(),k=p+o.shift(),E=C+o.shift(),x=k+o.shift(),I=E+o.shift(),L=x+o.shift(),S=I+o.shift(),F=L+o.shift(),_=S+o.shift(),U=F+o.shift(),m=_+o.shift(),p=U+o.shift(),o.shift(),r.U.P.curveTo(n,C,k,E,x,I,L),r.U.P.curveTo(n,S,F,_,U,m,p)),b=="o1236"&&(C=m+o.shift(),k=p+o.shift(),E=C+o.shift(),L=x=k+o.shift(),F=x,_=(S=(I=E+o.shift())+o.shift())+o.shift(),U=F+o.shift(),m=_+o.shift(),r.U.P.curveTo(n,C,k,E,x,I,L),r.U.P.curveTo(n,S,F,_,U,m,p)),b=="o1237"&&(C=m+o.shift(),k=p+o.shift(),E=C+o.shift(),x=k+o.shift(),I=E+o.shift(),L=x+o.shift(),S=I+o.shift(),F=L+o.shift(),_=S+o.shift(),U=F+o.shift(),Math.abs(_-m)>Math.abs(U-p)?m=_+o.shift():p=U+o.shift(),r.U.P.curveTo(n,C,k,E,x,I,L),r.U.P.curveTo(n,S,F,_,U,m,p));else if(b=="o14"){if(o.length>0&&!c&&(d=o.shift()+a.nominalWidthX,c=!0),o.length==4){var ne=o.shift(),O=o.shift(),G=o.shift(),y=o.shift(),w=r.CFF.glyphBySE(a,G),M=r.CFF.glyphBySE(a,y);r.U._drawCFF(a.CharStrings[w],e,a,i,n),e.x=ne,e.y=O,r.U._drawCFF(a.CharStrings[M],e,a,i,n)}h&&(r.U.P.closePath(n),h=!1)}else if(b=="o19"||b=="o20")o.length%2!=0&&!c&&(d=o.shift()+i.nominalWidthX),s+=o.length>>1,o.length=0,c=!0,v+=s+7>>3;else if(b=="o21")o.length>2&&!c&&(d=o.shift()+i.nominalWidthX,c=!0),p+=o.pop(),m+=o.pop(),h&&r.U.P.closePath(n),r.U.P.moveTo(n,m,p),h=!0;else if(b=="o22")o.length>1&&!c&&(d=o.shift()+i.nominalWidthX,c=!0),m+=o.pop(),h&&r.U.P.closePath(n),r.U.P.moveTo(n,m,p),h=!0;else if(b=="o25"){for(;o.length>6;)m+=o.shift(),p+=o.shift(),r.U.P.lineTo(n,m,p);C=m+o.shift(),k=p+o.shift(),E=C+o.shift(),x=k+o.shift(),m=E+o.shift(),p=x+o.shift(),r.U.P.curveTo(n,C,k,E,x,m,p)}else if(b=="o26")for(o.length%2&&(m+=o.shift());o.length>0;)C=m,k=p+o.shift(),m=E=C+o.shift(),p=(x=k+o.shift())+o.shift(),r.U.P.curveTo(n,C,k,E,x,m,p);else if(b=="o27")for(o.length%2&&(p+=o.shift());o.length>0;)k=p,E=(C=m+o.shift())+o.shift(),x=k+o.shift(),m=E+o.shift(),p=x,r.U.P.curveTo(n,C,k,E,x,m,p);else if(b=="o10"||b=="o29"){var D=b=="o10"?i:a;if(o.length==0)console.debug("error: empty stack");else{var T=o.pop(),N=D.Subrs[T+D.Bias];e.x=m,e.y=p,e.nStems=s,e.haveWidth=c,e.width=d,e.open=h,r.U._drawCFF(N,e,a,i,n),m=e.x,p=e.y,s=e.nStems,c=e.haveWidth,d=e.width,h=e.open}}else if(b=="o30"||b=="o31"){var j=o.length,B=(q=0,b=="o31");for(q+=j-(P=-3&j);q<P;)B?(k=p,E=(C=m+o.shift())+o.shift(),p=(x=k+o.shift())+o.shift(),P-q==5?(m=E+o.shift(),q++):m=E,B=!1):(C=m,k=p+o.shift(),E=C+o.shift(),x=k+o.shift(),m=E+o.shift(),P-q==5?(p=x+o.shift(),q++):p=x,B=!0),r.U.P.curveTo(n,C,k,E,x,m,p),q+=4}else{if((b+"").charAt(0)=="o")throw console.debug("Unknown operation: "+b,t),b;o.push(b)}}}e.x=m,e.y=p,e.nStems=s,e.haveWidth=c,e.width=d,e.open=h};var u=r,f={Typr:u};return l.Typr=u,l.default=f,Object.defineProperty(l,"__esModule",{value:!0}),l}({}).Typr}/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/function io(){return function(l){var r=Uint8Array,u=Uint16Array,f=Uint32Array,t=new r([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),e=new r([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),a=new r([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),i=function(b,P){for(var A=new u(31),X=0;X<31;++X)A[X]=P+=1<<b[X-1];var z=new f(A[30]);for(X=1;X<30;++X)for(var q=A[X];q<A[X+1];++q)z[q]=q-A[X]<<5|X;return[A,z]},n=i(t,2),o=n[0],s=n[1];o[28]=258,s[258]=28;for(var c=i(e,0)[0],d=new u(32768),h=0;h<32768;++h){var v=(43690&h)>>>1|(21845&h)<<1;v=(61680&(v=(52428&v)>>>2|(13107&v)<<2))>>>4|(3855&v)<<4,d[h]=((65280&v)>>>8|(255&v)<<8)>>>1}var m=function(b,P,A){for(var X=b.length,z=0,q=new u(P);z<X;++z)++q[b[z]-1];var ne,O=new u(P);for(z=0;z<P;++z)O[z]=O[z-1]+q[z-1]<<1;{ne=new u(1<<P);var G=15-P;for(z=0;z<X;++z)if(b[z])for(var y=z<<4|b[z],w=P-b[z],M=O[b[z]-1]++<<w,D=M|(1<<w)-1;M<=D;++M)ne[d[M]>>>G]=y}return ne},p=new r(288);for(h=0;h<144;++h)p[h]=8;for(h=144;h<256;++h)p[h]=9;for(h=256;h<280;++h)p[h]=7;for(h=280;h<288;++h)p[h]=8;var C=new r(32);for(h=0;h<32;++h)C[h]=5;var k=m(p,9),E=m(C,5),x=function(b){for(var P=b[0],A=1;A<b.length;++A)b[A]>P&&(P=b[A]);return P},S=function(b,P,A){var X=P/8|0;return(b[X]|b[X+1]<<8)>>(7&P)&A},F=function(b,P){var A=P/8|0;return(b[A]|b[A+1]<<8|b[A+2]<<16)>>(7&P)},_=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],U=function(b,P,A){var X=new Error(P||_[b]);if(X.code=b,Error.captureStackTrace&&Error.captureStackTrace(X,U),!A)throw X;return X},I=function(b,P,A){var X=b.length;if(!X||A&&!A.l&&X<5)return P||new r(0);var z=!P||A,q=!A||A.i;A||(A={}),P||(P=new r(3*X));var ne,O=function(ce){var De=P.length;if(ce>De){var Te=new r(Math.max(2*De,ce));Te.set(P),P=Te}},G=A.f||0,y=A.p||0,w=A.b||0,M=A.l,D=A.d,T=A.m,N=A.n,j=8*X;do{if(!M){A.f=G=S(b,y,1);var B=S(b,y+1,3);if(y+=3,!B){var K=b[($=((ne=y)/8|0)+(7&ne&&1)+4)-4]|b[$-3]<<8,ee=$+K;if(ee>X){q&&U(0);break}z&&O(w+K),P.set(b.subarray($,ee),w),A.b=w+=K,A.p=y=8*ee;continue}if(B==1)M=k,D=E,T=9,N=5;else if(B==2){var H=S(b,y,31)+257,W=S(b,y+10,15)+4,ge=H+S(b,y+5,31)+1;y+=14;for(var ue=new r(ge),Q=new r(19),te=0;te<W;++te)Q[a[te]]=S(b,y+3*te,7);y+=3*W;var le=x(Q),V=(1<<le)-1,re=m(Q,le);for(te=0;te<ge;){var $,R=re[S(b,y,V)];if(y+=15&R,($=R>>>4)<16)ue[te++]=$;else{var ve=0,Z=0;for($==16?(Z=3+S(b,y,3),y+=2,ve=ue[te-1]):$==17?(Z=3+S(b,y,7),y+=3):$==18&&(Z=11+S(b,y,127),y+=7);Z--;)ue[te++]=ve}}var oe=ue.subarray(0,H),J=ue.subarray(H);T=x(oe),N=x(J),M=m(oe,T),D=m(J,N)}else U(1);if(y>j){q&&U(0);break}}z&&O(w+131072);for(var Se=(1<<T)-1,ae=(1<<N)-1,ie=y;;ie=y){var fe=(ve=M[F(b,y)&Se])>>>4;if((y+=15&ve)>j){q&&U(0);break}if(ve||U(2),fe<256)P[w++]=fe;else{if(fe==256){ie=y,M=null;break}var pe=fe-254;if(fe>264){var _e=t[te=fe-257];pe=S(b,y,(1<<_e)-1)+o[te],y+=_e}var Ae=D[F(b,y)&ae],ye=Ae>>>4;if(Ae||U(3),y+=15&Ae,J=c[ye],ye>3&&(_e=e[ye],J+=F(b,y)&(1<<_e)-1,y+=_e),y>j){q&&U(0);break}z&&O(w+131072);for(var xe=w+pe;w<xe;w+=4)P[w]=P[w-J],P[w+1]=P[w+1-J],P[w+2]=P[w+2-J],P[w+3]=P[w+3-J];w=xe}}A.l=M,A.p=ie,A.b=w,M&&(G=1,A.m=T,A.d=D,A.n=N)}while(!G);return w==P.length?P:function(ce,De,Te){(Te==null||Te>ce.length)&&(Te=ce.length);var Be=new(ce instanceof u?u:ce instanceof f?f:r)(Te-De);return Be.set(ce.subarray(De,Te)),Be}(P,0,w)},L=new r(0),Y=typeof TextDecoder<"u"&&new TextDecoder;try{Y.decode(L,{stream:!0})}catch{}return l.convert_streams=function(b){var P=new DataView(b),A=0;function X(){var H=P.getUint16(A);return A+=2,H}function z(){var H=P.getUint32(A);return A+=4,H}function q(H){K.setUint16(ee,H),ee+=2}function ne(H){K.setUint32(ee,H),ee+=4}for(var O={signature:z(),flavor:z(),length:z(),numTables:X(),reserved:X(),totalSfntSize:z(),majorVersion:X(),minorVersion:X(),metaOffset:z(),metaLength:z(),metaOrigLength:z(),privOffset:z(),privLength:z()},G=0;Math.pow(2,G)<=O.numTables;)G++;G--;for(var y=16*Math.pow(2,G),w=16*O.numTables-y,M=12,D=[],T=0;T<O.numTables;T++)D.push({tag:z(),offset:z(),compLength:z(),origLength:z(),origChecksum:z()}),M+=16;var N,j=new Uint8Array(12+16*D.length+D.reduce(function(H,W){return H+W.origLength+4},0)),B=j.buffer,K=new DataView(B),ee=0;return ne(O.flavor),q(O.numTables),q(y),q(G),q(w),D.forEach(function(H){ne(H.tag),ne(H.origChecksum),ne(M),ne(H.origLength),H.outOffset=M,(M+=H.origLength)%4!=0&&(M+=4-M%4)}),D.forEach(function(H){var W,ge=b.slice(H.offset,H.offset+H.compLength);if(H.compLength!=H.origLength){var ue=new Uint8Array(H.origLength);W=new Uint8Array(ge,2),I(W,ue)}else ue=new Uint8Array(ge);j.set(ue,H.outOffset);var Q=0;(M=H.outOffset+H.origLength)%4!=0&&(Q=4-M%4),j.set(new Uint8Array(Q).buffer,H.outOffset+H.origLength),N=M+Q}),B.slice(0,N)},Object.defineProperty(l,"__esModule",{value:!0}),l}({}).convert_streams}function so(l,r){const u={M:2,L:2,Q:4,C:6,Z:0},f={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},t=1,e=2,a=4,i=8,n=16,o=32;let s;function c(_){if(!s){const U={R:e,L:t,D:a,C:n,U:o,T:i};s=new Map;for(let I in f){let L=0;f[I].split(",").forEach(Y=>{let[b,P]=Y.split("+");b=parseInt(b,36),P=P?parseInt(P,36):0,s.set(L+=b,U[I]);for(let A=P;A--;)s.set(++L,U[I])})}}return s.get(_)||o}const d=1,h=2,v=3,m=4,p=[null,"isol","init","fina","medi"];function C(_){const U=new Uint8Array(_.length);let I=o,L=d,Y=-1;for(let b=0;b<_.length;b++){const P=_.codePointAt(b);let A=c(P)|0,X=d;A&i||(I&(t|a|n)?A&(e|a|n)?(X=v,(L===d||L===v)&&U[Y]++):A&(t|o)&&(L===h||L===m)&&U[Y]--:I&(e|o)&&(L===h||L===m)&&U[Y]--,L=U[b]=X,I=A,Y=b,P>65535&&b++)}return U}function k(_,U){const I=[];for(let Y=0;Y<U.length;Y++){const b=U.codePointAt(Y);b>65535&&Y++,I.push(l.U.codeToGlyph(_,b))}const L=_.GSUB;if(L){const{lookupList:Y,featureList:b}=L;let P;const A=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,X=[];b.forEach(z=>{if(A.test(z.tag))for(let q=0;q<z.tab.length;q++){if(X[z.tab[q]])continue;X[z.tab[q]]=!0;const ne=Y[z.tab[q]],O=/^(isol|init|fina|medi)$/.test(z.tag);O&&!P&&(P=C(U));for(let G=0;G<I.length;G++)(!P||!O||p[P[G]]===z.tag)&&l.U._applySubs(I,G,ne,Y)}})}return I}function E(_,U){const I=new Int16Array(U.length*3);let L=0;for(;L<U.length;L++){const A=U[L];if(A===-1)continue;I[L*3+2]=_.hmtx.aWidth[A];const X=_.GPOS;if(X){const z=X.lookupList;for(let q=0;q<z.length;q++){const ne=z[q];for(let O=0;O<ne.tabs.length;O++){const G=ne.tabs[O];if(ne.ltype===1){if(l._lctf.coverageIndex(G.coverage,A)!==-1&&G.pos){P(G.pos,L);break}}else if(ne.ltype===2){let y=null,w=Y();if(w!==-1){const M=l._lctf.coverageIndex(G.coverage,U[w]);if(M!==-1){if(G.fmt===1){const D=G.pairsets[M];for(let T=0;T<D.length;T++)D[T].gid2===A&&(y=D[T])}else if(G.fmt===2){const D=l.U._getGlyphClass(U[w],G.classDef1),T=l.U._getGlyphClass(A,G.classDef2);y=G.matrix[D][T]}if(y){y.val1&&P(y.val1,w),y.val2&&P(y.val2,L);break}}}}else if(ne.ltype===4){const y=l._lctf.coverageIndex(G.markCoverage,A);if(y!==-1){const w=Y(b),M=w===-1?-1:l._lctf.coverageIndex(G.baseCoverage,U[w]);if(M!==-1){const D=G.markArray[y],T=G.baseArray[M][D.markClass];I[L*3]=T.x-D.x+I[w*3]-I[w*3+2],I[L*3+1]=T.y-D.y+I[w*3+1];break}}}else if(ne.ltype===6){const y=l._lctf.coverageIndex(G.mark1Coverage,A);if(y!==-1){const w=Y();if(w!==-1){const M=U[w];if(x(_,M)===3){const D=l._lctf.coverageIndex(G.mark2Coverage,M);if(D!==-1){const T=G.mark1Array[y],N=G.mark2Array[D][T.markClass];I[L*3]=N.x-T.x+I[w*3]-I[w*3+2],I[L*3+1]=N.y-T.y+I[w*3+1];break}}}}}}}}else if(_.kern&&!_.cff){const z=Y();if(z!==-1){const q=_.kern.glyph1.indexOf(U[z]);if(q!==-1){const ne=_.kern.rval[q].glyph2.indexOf(A);ne!==-1&&(I[z*3+2]+=_.kern.rval[q].vals[ne])}}}}return I;function Y(A){for(let X=L-1;X>=0;X--)if(U[X]!==-1&&(!A||A(U[X])))return X;return-1}function b(A){return x(_,A)===1}function P(A,X){for(let z=0;z<3;z++)I[X*3+z]+=A[z]||0}}function x(_,U){const I=_.GDEF&&_.GDEF.glyphClassDef;return I?l.U._getGlyphClass(U,I):0}function S(..._){for(let U=0;U<_.length;U++)if(typeof _[U]=="number")return _[U]}function F(_){const U=Object.create(null),I=_["OS/2"],L=_.hhea,Y=_.head.unitsPerEm,b=S(I&&I.sTypoAscender,L&&L.ascender,Y),P={unitsPerEm:Y,ascender:b,descender:S(I&&I.sTypoDescender,L&&L.descender,0),capHeight:S(I&&I.sCapHeight,b),xHeight:S(I&&I.sxHeight,b),lineGap:S(I&&I.sTypoLineGap,L&&L.lineGap),supportsCodePoint(A){return l.U.codeToGlyph(_,A)>0},forEachGlyph(A,X,z,q){let ne=0;const O=1/P.unitsPerEm*X,G=k(_,A);let y=0;const w=E(_,G);return G.forEach((M,D)=>{if(M!==-1){let T=U[M];if(!T){const{cmds:N,crds:j}=l.U.glyphToPath(_,M);let B="",K=0;for(let ue=0,Q=N.length;ue<Q;ue++){const te=u[N[ue]];B+=N[ue];for(let le=1;le<=te;le++)B+=(le>1?",":"")+j[K++]}let ee,H,W,ge;if(j.length){ee=H=1/0,W=ge=-1/0;for(let ue=0,Q=j.length;ue<Q;ue+=2){let te=j[ue],le=j[ue+1];te<ee&&(ee=te),le<H&&(H=le),te>W&&(W=te),le>ge&&(ge=le)}}else ee=W=H=ge=0;T=U[M]={index:M,advanceWidth:_.hmtx.aWidth[M],xMin:ee,yMin:H,xMax:W,yMax:ge,path:B}}q.call(null,T,ne+w[D*3]*O,w[D*3+1]*O,y),ne+=w[D*3+2]*O,z&&(ne+=z*X)}y+=A.codePointAt(y)>65535?2:1}),ne}};return P}return function(U){const I=new Uint8Array(U,0,4),L=l._bin.readASCII(I,0,4);if(L==="wOFF")U=r(U);else if(L==="wOF2")throw new Error("woff2 fonts not supported");return F(l.parse(U)[0])}}const lo=vt({name:"Typr Font Parser",dependencies:[oo,io,so],init(l,r,u){const f=l(),t=r();return u(f,t)}});/*!
Custom bundle of @unicode-font-resolver/client v1.0.2 (https://github.com/lojjic/unicode-font-resolver)
for use in Troika text rendering. 
Original MIT license applies
*/function co(){return function(l){var r=function(){this.buckets=new Map};r.prototype.add=function(E){var x=E>>5;this.buckets.set(x,(this.buckets.get(x)||0)|1<<(31&E))},r.prototype.has=function(E){var x=this.buckets.get(E>>5);return x!==void 0&&(x&1<<(31&E))!=0},r.prototype.serialize=function(){var E=[];return this.buckets.forEach(function(x,S){E.push((+S).toString(36)+":"+x.toString(36))}),E.join(",")},r.prototype.deserialize=function(E){var x=this;this.buckets.clear(),E.split(",").forEach(function(S){var F=S.split(":");x.buckets.set(parseInt(F[0],36),parseInt(F[1],36))})};var u=Math.pow(2,8),f=u-1,t=~f;function e(E){var x=function(F){return F&t}(E).toString(16),S=function(F){return(F&t)+u-1}(E).toString(16);return"codepoint-index/plane"+(E>>16)+"/"+x+"-"+S+".json"}function a(E,x){var S=E&f,F=x.codePointAt(S/6|0);return((F=(F||48)-48)&1<<S%6)!=0}function i(E,x){var S;(S=E,S.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map(function(F){return F.split("-").map(function(_){return parseInt(_.trim(),16)})})).forEach(function(F){var _=F[0],U=F[1];U===void 0&&(U=_),x(_,U)})}function n(E,x){i(E,function(S,F){for(var _=S;_<=F;_++)x(_)})}var o={},s={},c=new WeakMap,d="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function h(E){var x=c.get(E);return x||(x=new r,n(E.ranges,function(S){return x.add(S)}),c.set(E,x)),x}var v,m=new Map;function p(E,x,S){return E[x]?x:E[S]?S:function(F){for(var _ in F)return _}(E)}function C(E,x){var S=x;if(!E.includes(S)){S=1/0;for(var F=0;F<E.length;F++)Math.abs(E[F]-x)<Math.abs(S-x)&&(S=E[F])}return S}function k(E){return v||(v=new Set,n("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",function(x){v.add(x)})),v.has(E)}return l.CodePointSet=r,l.clearCache=function(){o={},s={}},l.getFontsForString=function(E,x){x===void 0&&(x={});var S,F=x.lang;F===void 0&&(F=new RegExp("\\p{Script=Hangul}","u").test(S=E)?"ko":new RegExp("\\p{Script=Hiragana}|\\p{Script=Katakana}","u").test(S)?"ja":"en");var _=x.category;_===void 0&&(_="sans-serif");var U=x.style;U===void 0&&(U="normal");var I=x.weight;I===void 0&&(I=400);var L=(x.dataUrl||d).replace(/\/$/g,""),Y=new Map,b=new Uint8Array(E.length),P={},A={},X=new Array(E.length),z=new Map,q=!1;function ne(y){var w=m.get(y);return w||(w=fetch(L+"/"+y).then(function(M){if(!M.ok)throw new Error(M.statusText);return M.json().then(function(D){if(!Array.isArray(D)||D[0]!==1)throw new Error("Incorrect schema version; need 1, got "+D[0]);return D[1]})}).catch(function(M){if(L!==d)return q||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+L+'", trying default CDN. '+M.message),q=!0),L=d,m.delete(y),ne(y);throw M}),m.set(y,w)),w}for(var O=function(y){var w=E.codePointAt(y),M=e(w);X[y]=M,o[M]||z.has(M)||z.set(M,ne(M).then(function(D){o[M]=D})),w>65535&&(y++,G=y)},G=0;G<E.length;G++)O(G);return Promise.all(z.values()).then(function(){z.clear();for(var y=function(M){var D=E.codePointAt(M),T=null,N=o[X[M]],j=void 0;for(var B in N){var K=A[B];if(K===void 0&&(K=A[B]=new RegExp(B).test(F||"en")),K){for(var ee in j=B,N[B])if(a(D,N[B][ee])){T=ee;break}break}}if(!T){e:for(var H in N)if(H!==j){for(var W in N[H])if(a(D,N[H][W])){T=W;break e}}}T||(console.debug("No font coverage for U+"+D.toString(16)),T="latin"),X[M]=T,s[T]||z.has(T)||z.set(T,ne("font-meta/"+T+".json").then(function(ge){s[T]=ge})),D>65535&&(M++,w=M)},w=0;w<E.length;w++)y(w);return Promise.all(z.values())}).then(function(){for(var y,w=null,M=0;M<E.length;M++){var D=E.codePointAt(M);if(w&&(k(D)||h(w).has(D)))b[M]=b[M-1];else{w=s[X[M]];var T=P[w.id];if(!T){var N=w.typeforms,j=p(N,_,"sans-serif"),B=p(N[j],U,"normal"),K=C((y=N[j])===null||y===void 0?void 0:y[B],I);T=P[w.id]=L+"/font-files/"+w.id+"/"+j+"."+B+"."+K+".woff"}var ee=Y.get(T);ee==null&&(ee=Y.size,Y.set(T,ee)),b[M]=ee}D>65535&&(M++,b[M]=b[M-1])}return{fontUrls:Array.from(Y.keys()),chars:b}})},Object.defineProperty(l,"__esModule",{value:!0}),l}({})}function fo(l,r){const u=Object.create(null),f=Object.create(null);function t(a,i){const n=o=>{console.error(`Failure loading font ${a}`,o)};try{const o=new XMLHttpRequest;o.open("get",a,!0),o.responseType="arraybuffer",o.onload=function(){if(o.status>=400)n(new Error(o.statusText));else if(o.status>0)try{const s=l(o.response);s.src=a,i(s)}catch(s){n(s)}},o.onerror=n,o.send()}catch(o){n(o)}}function e(a,i){let n=u[a];n?i(n):f[a]?f[a].push(i):(f[a]=[i],t(a,o=>{o.src=a,u[a]=o,f[a].forEach(s=>s(o)),delete f[a]}))}return function(a,i,{lang:n,fonts:o=[],style:s="normal",weight:c="normal",unicodeFontsURL:d}={}){const h=new Uint8Array(a.length),v=[];a.length||k();const m=new Map,p=[];if(s!=="italic"&&(s="normal"),typeof c!="number"&&(c=c==="bold"?700:400),o&&!Array.isArray(o)&&(o=[o]),o=o.slice().filter(x=>!x.lang||x.lang.test(n)).reverse(),o.length){let _=0;(function U(I=0){for(let L=I,Y=a.length;L<Y;L++){const b=a.codePointAt(L);if(_===1&&v[h[L-1]].supportsCodePoint(b)||L>0&&/\s/.test(a[L]))h[L]=h[L-1],_===2&&(p[p.length-1][1]=L);else for(let P=h[L],A=o.length;P<=A;P++)if(P===A){const X=_===2?p[p.length-1]:p[p.length]=[L,L];X[1]=L,_=2}else{h[L]=P;const{src:X,unicodeRange:z}=o[P];if(!z||E(b,z)){const q=u[X];if(!q){e(X,()=>{U(L)});return}if(q.supportsCodePoint(b)){let ne=m.get(q);typeof ne!="number"&&(ne=v.length,v.push(q),m.set(q,ne)),h[L]=ne,_=1;break}}}b>65535&&L+1<Y&&(h[L+1]=h[L],L++,_===2&&(p[p.length-1][1]=L))}C()})()}else p.push([0,a.length-1]),C();function C(){if(p.length){const x=p.map(S=>a.substring(S[0],S[1]+1)).join(`
`);r.getFontsForString(x,{lang:n||void 0,style:s,weight:c,dataUrl:d}).then(({fontUrls:S,chars:F})=>{const _=v.length;let U=0;p.forEach(L=>{for(let Y=0,b=L[1]-L[0];Y<=b;Y++)h[L[0]+Y]=F[U++]+_;U++});let I=0;S.forEach((L,Y)=>{e(L,b=>{v[Y+_]=b,++I===S.length&&k()})})})}else k()}function k(){i({chars:h,fonts:v})}function E(x,S){for(let F=0;F<S.length;F++){const[_,U=_]=S[F];if(_<=x&&x<=U)return!0}return!1}}}const uo=vt({name:"FontResolver",dependencies:[fo,lo,co],init(l,r,u){return l(r,u())}});function ho(l,r){const f=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,t="[^\\S\\u00A0]",e=new RegExp(`${t}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function a({text:v,lang:m,fonts:p,style:C,weight:k,preResolvedFonts:E,unicodeFontsURL:x},S){const F=({chars:_,fonts:U})=>{let I,L;const Y=[];for(let b=0;b<_.length;b++)_[b]!==L?(L=_[b],Y.push(I={start:b,end:b,fontObj:U[_[b]]})):I.end=b;S(Y)};E?F(E):l(v,F,{lang:m,fonts:p,style:C,weight:k,unicodeFontsURL:x})}function i({text:v="",font:m,lang:p,sdfGlyphSize:C=64,fontSize:k=400,fontWeight:E=1,fontStyle:x="normal",letterSpacing:S=0,lineHeight:F="normal",maxWidth:_=1/0,direction:U,textAlign:I="left",textIndent:L=0,whiteSpace:Y="normal",overflowWrap:b="normal",anchorX:P=0,anchorY:A=0,metricsOnly:X=!1,unicodeFontsURL:z,preResolvedFonts:q=null,includeCaretPositions:ne=!1,chunkedBoundsSize:O=8192,colorRanges:G=null},y){const w=c(),M={fontLoad:0,typesetting:0};v.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),v=v.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),k=+k,S=+S,_=+_,F=F||"normal",L=+L,a({text:v,lang:p,style:x,weight:E,fonts:typeof m=="string"?[{src:m}]:m,unicodeFontsURL:z,preResolvedFonts:q},D=>{M.fontLoad=c()-w;const T=isFinite(_);let N=null,j=null,B=null,K=null,ee=null,H=null,W=null,ge=null,ue=0,Q=0,te=Y!=="nowrap";const le=new Map,V=c();let re=L,$=0,R=new d;const ve=[R];D.forEach(ae=>{const{fontObj:ie}=ae,{ascender:fe,descender:pe,unitsPerEm:_e,lineGap:Ae,capHeight:ye,xHeight:xe}=ie;let ce=le.get(ie);if(!ce){const he=k/_e,we=F==="normal"?(fe-pe+Ae)*he:F*k,qe=(we-(fe-pe)*he)/2,ke=Math.min(we,(fe-pe)*he),be=(fe+pe)/2*he+ke/2;ce={index:le.size,src:ie.src,fontObj:ie,fontSizeMult:he,unitsPerEm:_e,ascender:fe*he,descender:pe*he,capHeight:ye*he,xHeight:xe*he,lineHeight:we,baseline:-qe-fe*he,caretTop:be,caretBottom:be-ke},le.set(ie,ce)}const{fontSizeMult:De}=ce,Te=v.slice(ae.start,ae.end+1);let Be,Ue;ie.forEachGlyph(Te,k,S,(he,we,qe,ke)=>{we+=$,ke+=ae.start,Be=we,Ue=he;const be=v.charAt(ke),Fe=he.advanceWidth*De,Ce=R.count;let me;if("isEmpty"in he||(he.isWhitespace=!!be&&new RegExp(t).test(be),he.canBreakAfter=!!be&&e.test(be),he.isEmpty=he.xMin===he.xMax||he.yMin===he.yMax||f.test(be)),!he.isWhitespace&&!he.isEmpty&&Q++,te&&T&&!he.isWhitespace&&we+Fe+re>_&&Ce){if(R.glyphAt(Ce-1).glyphObj.canBreakAfter)me=new d,re=-we;else for(let Re=Ce;Re--;)if(Re===0&&b==="break-word"){me=new d,re=-we;break}else if(R.glyphAt(Re).glyphObj.canBreakAfter){me=R.splitAt(Re+1);const Ge=me.glyphAt(0).x;re-=Ge;for(let Pe=me.count;Pe--;)me.glyphAt(Pe).x-=Ge;break}me&&(R.isSoftWrapped=!0,R=me,ve.push(R),ue=_)}let Me=R.glyphAt(R.count);Me.glyphObj=he,Me.x=we+re,Me.y=qe,Me.width=Fe,Me.charIndex=ke,Me.fontData=ce,be===`
`&&(R=new d,ve.push(R),re=-(we+Fe+S*k)+L)}),$=Be+Ue.advanceWidth*De+S*k});let Z=0;ve.forEach(ae=>{let ie=!0;for(let fe=ae.count;fe--;){const pe=ae.glyphAt(fe);ie&&!pe.glyphObj.isWhitespace&&(ae.width=pe.x+pe.width,ae.width>ue&&(ue=ae.width),ie=!1);let{lineHeight:_e,capHeight:Ae,xHeight:ye,baseline:xe}=pe.fontData;_e>ae.lineHeight&&(ae.lineHeight=_e);const ce=xe-ae.baseline;ce<0&&(ae.baseline+=ce,ae.cap+=ce,ae.ex+=ce),ae.cap=Math.max(ae.cap,ae.baseline+Ae),ae.ex=Math.max(ae.ex,ae.baseline+ye)}ae.baseline-=Z,ae.cap-=Z,ae.ex-=Z,Z+=ae.lineHeight});let oe=0,J=0;if(P&&(typeof P=="number"?oe=-P:typeof P=="string"&&(oe=-ue*(P==="left"?0:P==="center"?.5:P==="right"?1:o(P)))),A&&(typeof A=="number"?J=-A:typeof A=="string"&&(J=A==="top"?0:A==="top-baseline"?-ve[0].baseline:A==="top-cap"?-ve[0].cap:A==="top-ex"?-ve[0].ex:A==="middle"?Z/2:A==="bottom"?Z:A==="bottom-baseline"?-ve[ve.length-1].baseline:o(A)*Z)),!X){const ae=r.getEmbeddingLevels(v,U);N=new Uint16Array(Q),j=new Uint8Array(Q),B=new Float32Array(Q*2),K={},W=[1/0,1/0,-1/0,-1/0],ge=[],ne&&(H=new Float32Array(v.length*4)),G&&(ee=new Uint8Array(Q*3));let ie=0,fe=-1,pe=-1,_e,Ae;if(ve.forEach((ye,xe)=>{let{count:ce,width:De}=ye;if(ce>0){let Te=0;for(let ke=ce;ke--&&ye.glyphAt(ke).glyphObj.isWhitespace;)Te++;let Be=0,Ue=0;if(I==="center")Be=(ue-De)/2;else if(I==="right")Be=ue-De;else if(I==="justify"&&ye.isSoftWrapped){let ke=0;for(let be=ce-Te;be--;)ye.glyphAt(be).glyphObj.isWhitespace&&ke++;Ue=(ue-De)/ke}if(Ue||Be){let ke=0;for(let be=0;be<ce;be++){let Fe=ye.glyphAt(be);const Ce=Fe.glyphObj;Fe.x+=Be+ke,Ue!==0&&Ce.isWhitespace&&be<ce-Te&&(ke+=Ue,Fe.width+=Ue)}}const he=r.getReorderSegments(v,ae,ye.glyphAt(0).charIndex,ye.glyphAt(ye.count-1).charIndex);for(let ke=0;ke<he.length;ke++){const[be,Fe]=he[ke];let Ce=1/0,me=-1/0;for(let Me=0;Me<ce;Me++)if(ye.glyphAt(Me).charIndex>=be){let Re=Me,Ge=Me;for(;Ge<ce;Ge++){let Pe=ye.glyphAt(Ge);if(Pe.charIndex>Fe)break;Ge<ce-Te&&(Ce=Math.min(Ce,Pe.x),me=Math.max(me,Pe.x+Pe.width))}for(let Pe=Re;Pe<Ge;Pe++){const Ve=ye.glyphAt(Pe);Ve.x=me-(Ve.x+Ve.width-Ce)}break}}let we;const qe=ke=>we=ke;for(let ke=0;ke<ce;ke++){const be=ye.glyphAt(ke);we=be.glyphObj;const Fe=we.index,Ce=ae.levels[be.charIndex]&1;if(Ce){const me=r.getMirroredCharacter(v[be.charIndex]);me&&be.fontData.fontObj.forEachGlyph(me,0,0,qe)}if(ne){const{charIndex:me,fontData:Me}=be,Re=be.x+oe,Ge=be.x+be.width+oe;H[me*4]=Ce?Ge:Re,H[me*4+1]=Ce?Re:Ge,H[me*4+2]=ye.baseline+Me.caretBottom+J,H[me*4+3]=ye.baseline+Me.caretTop+J;const Pe=me-fe;Pe>1&&s(H,fe,Pe),fe=me}if(G){const{charIndex:me}=be;for(;me>pe;)pe++,G.hasOwnProperty(pe)&&(Ae=G[pe])}if(!we.isWhitespace&&!we.isEmpty){const me=ie++,{fontSizeMult:Me,src:Re,index:Ge}=be.fontData,Pe=K[Re]||(K[Re]={});Pe[Fe]||(Pe[Fe]={path:we.path,pathBounds:[we.xMin,we.yMin,we.xMax,we.yMax]});const Ve=be.x+oe,$e=be.y+ye.baseline+J;B[me*2]=Ve,B[me*2+1]=$e;const Je=Ve+we.xMin*Me,et=$e+we.yMin*Me,nt=Ve+we.xMax*Me,Ze=$e+we.yMax*Me;Je<W[0]&&(W[0]=Je),et<W[1]&&(W[1]=et),nt>W[2]&&(W[2]=nt),Ze>W[3]&&(W[3]=Ze),me%O===0&&(_e={start:me,end:me,rect:[1/0,1/0,-1/0,-1/0]},ge.push(_e)),_e.end++;const Ie=_e.rect;if(Je<Ie[0]&&(Ie[0]=Je),et<Ie[1]&&(Ie[1]=et),nt>Ie[2]&&(Ie[2]=nt),Ze>Ie[3]&&(Ie[3]=Ze),N[me]=Fe,j[me]=Ge,G){const at=me*3;ee[at]=Ae>>16&255,ee[at+1]=Ae>>8&255,ee[at+2]=Ae&255}}}}}),H){const ye=v.length-fe;ye>1&&s(H,fe,ye)}}const Se=[];le.forEach(({index:ae,src:ie,unitsPerEm:fe,ascender:pe,descender:_e,lineHeight:Ae,capHeight:ye,xHeight:xe})=>{Se[ae]={src:ie,unitsPerEm:fe,ascender:pe,descender:_e,lineHeight:Ae,capHeight:ye,xHeight:xe}}),M.typesetting=c()-V,y({glyphIds:N,glyphFontIndices:j,glyphPositions:B,glyphData:K,fontData:Se,caretPositions:H,glyphColors:ee,chunkedBounds:ge,fontSize:k,topBaseline:J+ve[0].baseline,blockBounds:[oe,J-Z,oe+ue,J],visibleBounds:W,timings:M})})}function n(v,m){i({...v,metricsOnly:!0},p=>{const[C,k,E,x]=p.blockBounds;m({width:E-C,height:x-k})})}function o(v){let m=v.match(/^([\d.]+)%$/),p=m?parseFloat(m[1]):NaN;return isNaN(p)?0:p/100}function s(v,m,p){const C=v[m*4],k=v[m*4+1],E=v[m*4+2],x=v[m*4+3],S=(k-C)/p;for(let F=0;F<p;F++){const _=(m+F)*4;v[_]=C+S*F,v[_+1]=C+S*(F+1),v[_+2]=E,v[_+3]=x}}function c(){return(self.performance||Date).now()}function d(){this.data=[]}const h=["glyphObj","x","y","width","charIndex","fontData"];return d.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/h.length)},glyphAt(v){let m=d.flyweight;return m.data=this.data,m.index=v,m},splitAt(v){let m=new d;return m.data=this.data.splice(v*h.length),m}},d.flyweight=h.reduce((v,m,p,C)=>(Object.defineProperty(v,m,{get(){return this.data[this.index*h.length+p]},set(k){this.data[this.index*h.length+p]=k}}),v),{data:null,index:0}),{typeset:i,measure:n}}const it=()=>(self.performance||Date).now(),$t=jn();let yn;function vo(l,r,u,f,t,e,a,i,n,o,s=!0){return s?mo(l,r,u,f,t,e,a,i,n,o).then(null,c=>(yn||(console.warn("WebGL SDF generation failed, falling back to JS",c),yn=!0),bn(l,r,u,f,t,e,a,i,n,o))):bn(l,r,u,f,t,e,a,i,n,o)}const Zt=[],po=5;let Ar=0;function Gn(){const l=it();for(;Zt.length&&it()-l<po;)Zt.shift()();Ar=Zt.length?setTimeout(Gn,0):0}const mo=(...l)=>new Promise((r,u)=>{Zt.push(()=>{const f=it();try{$t.webgl.generateIntoCanvas(...l),r({timing:it()-f})}catch(t){u(t)}}),Ar||(Ar=setTimeout(Gn,0))}),go=4,yo=2e3,xn={};let xo=0;function bn(l,r,u,f,t,e,a,i,n,o){const s="TroikaTextSDFGenerator_JS_"+xo++%go;let c=xn[s];return c||(c=xn[s]={workerModule:vt({name:s,workerId:s,dependencies:[jn,it],init(d,h){const v=d().javascript.generate;return function(...m){const p=h();return{textureData:v(...m),timing:h()-p}}},getTransferables(d){return[d.textureData.buffer]}}),requests:0,idleTimer:null}),c.requests++,clearTimeout(c.idleTimer),c.workerModule(l,r,u,f,t,e).then(({textureData:d,timing:h})=>{const v=it(),m=new Uint8Array(d.length*4);for(let p=0;p<d.length;p++)m[p*4+o]=d[p];return $t.webglUtils.renderImageData(a,m,i,n,l,r,1<<3-o),h+=it()-v,--c.requests===0&&(c.idleTimer=setTimeout(()=>{Ja(s)},yo)),{timing:h}})}function bo(l){l._warm||($t.webgl.isSupported(l),l._warm=!0)}const So=$t.webglUtils.resizeWebGLCanvasWithoutClearing,Tt={unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},wo=new qt;function ht(){return(self.performance||Date).now()}const Sn=Object.create(null);function Rn(l,r){l=Uo({},l);const u=ht(),f=[];if(l.font&&f.push({label:"user",src:Eo(l.font)}),l.font=f,l.text=""+l.text,l.sdfGlyphSize=l.sdfGlyphSize||Tt.sdfGlyphSize,l.unicodeFontsURL=l.unicodeFontsURL||Tt.unicodeFontsURL,l.colorRanges!=null){let d={};for(let h in l.colorRanges)if(l.colorRanges.hasOwnProperty(h)){let v=l.colorRanges[h];typeof v!="number"&&(v=wo.set(v).getHex()),d[h]=v}l.colorRanges=d}Object.freeze(l);const{textureWidth:t,sdfExponent:e}=Tt,{sdfGlyphSize:a}=l,i=t/a*4;let n=Sn[a];if(!n){const d=document.createElement("canvas");d.width=t,d.height=a*256/i,n=Sn[a]={glyphCount:0,sdfGlyphSize:a,sdfCanvas:d,sdfTexture:new va(d,void 0,void 0,void 0,an,an),contextLost:!1,glyphsByFont:new Map},n.sdfTexture.generateMipmaps=!1,ko(n)}const{sdfTexture:o,sdfCanvas:s}=n;Bn(l).then(d=>{const{glyphIds:h,glyphFontIndices:v,fontData:m,glyphPositions:p,fontSize:C,timings:k}=d,E=[],x=new Float32Array(h.length*4);let S=0,F=0;const _=ht(),U=m.map(P=>{let A=n.glyphsByFont.get(P.src);return A||n.glyphsByFont.set(P.src,A=new Map),A});h.forEach((P,A)=>{const X=v[A],{src:z,unitsPerEm:q}=m[X];let ne=U[X].get(P);if(!ne){const{path:M,pathBounds:D}=d.glyphData[z][P],T=Math.max(D[2]-D[0],D[3]-D[1])/a*(Tt.sdfMargin*a+.5),N=n.glyphCount++,j=[D[0]-T,D[1]-T,D[2]+T,D[3]+T];U[X].set(P,ne={path:M,atlasIndex:N,sdfViewBox:j}),E.push(ne)}const{sdfViewBox:O}=ne,G=p[F++],y=p[F++],w=C/q;x[S++]=G+O[0]*w,x[S++]=y+O[1]*w,x[S++]=G+O[2]*w,x[S++]=y+O[3]*w,h[A]=ne.atlasIndex}),k.quads=(k.quads||0)+(ht()-_);const I=ht();k.sdf={};const L=s.height,Y=Math.ceil(n.glyphCount/i),b=Math.pow(2,Math.ceil(Math.log2(Y*a)));b>L&&(console.info(`Increasing SDF texture size ${L}->${b}`),So(s,t,b),o.dispose()),Promise.all(E.map(P=>In(P,n,l.gpuAccelerateSDF).then(({timing:A})=>{k.sdf[P.atlasIndex]=A}))).then(()=>{E.length&&!n.contextLost&&(On(n),o.needsUpdate=!0),k.sdfTotal=ht()-I,k.total=ht()-u,r(Object.freeze({parameters:l,sdfTexture:o,sdfGlyphSize:a,sdfExponent:e,glyphBounds:x,glyphAtlasIndices:h,glyphColors:d.glyphColors,caretPositions:d.caretPositions,chunkedBounds:d.chunkedBounds,ascender:d.ascender,descender:d.descender,lineHeight:d.lineHeight,capHeight:d.capHeight,xHeight:d.xHeight,topBaseline:d.topBaseline,blockBounds:d.blockBounds,visibleBounds:d.visibleBounds,timings:d.timings}))})}),Promise.resolve().then(()=>{n.contextLost||bo(s)})}function In({path:l,atlasIndex:r,sdfViewBox:u},{sdfGlyphSize:f,sdfCanvas:t,contextLost:e},a){if(e)return Promise.resolve({timing:-1});const{textureWidth:i,sdfExponent:n}=Tt,o=Math.max(u[2]-u[0],u[3]-u[1]),s=Math.floor(r/4),c=s%(i/f)*f,d=Math.floor(s/(i/f))*f,h=r%4;return vo(f,f,l,u,o,n,t,c,d,h,a)}function ko(l){const r=l.sdfCanvas;r.addEventListener("webglcontextlost",u=>{console.log("Context Lost",u),u.preventDefault(),l.contextLost=!0}),r.addEventListener("webglcontextrestored",u=>{console.log("Context Restored",u),l.contextLost=!1;const f=[];l.glyphsByFont.forEach(t=>{t.forEach(e=>{f.push(In(e,l,!0))})}),Promise.all(f).then(()=>{On(l),l.sdfTexture.needsUpdate=!0})})}function _o({font:l,characters:r,sdfGlyphSize:u},f){let t=Array.isArray(r)?r.join(`
`):""+r;Rn({font:l,sdfGlyphSize:u,text:t},f)}function Uo(l,r){for(let u in r)r.hasOwnProperty(u)&&(l[u]=r[u]);return l}let Xt;function Eo(l){return Xt||(Xt=typeof document>"u"?{}:document.createElement("a")),Xt.href=l,Xt.href}function On(l){if(typeof createImageBitmap!="function"){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:r,sdfTexture:u}=l,{width:f,height:t}=r,e=l.sdfCanvas.getContext("webgl");let a=u.image.data;(!a||a.length!==f*t*4)&&(a=new Uint8Array(f*t*4),u.image={width:f,height:t,data:a},u.flipY=!1,u.isDataTexture=!0),e.readPixels(0,0,f,t,e.RGBA,e.UNSIGNED_BYTE,a)}}const To=vt({name:"Typesetter",dependencies:[ho,uo,Qa],init(l,r,u){return l(r,u())}}),Bn=vt({name:"Typesetter",dependencies:[To],init(l){return function(r){return new Promise(u=>{l.typeset(r,u)})}},getTransferables(l){const r=[];for(let u in l)l[u]&&l[u].buffer&&r.push(l[u].buffer);return r}});Bn.onMainThread;const wn={};function Co(l){let r=wn[l];return r||(r=wn[l]=new Dr(1,1,l,l).translate(.5,.5,0)),r}const Mo="aTroikaGlyphBounds",kn="aTroikaGlyphIndex",Ao="aTroikaGlyphColor";class Do extends ua{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new da,this.boundingBox=new Dn}computeBoundingSphere(){}computeBoundingBox(){}set detail(r){if(r!==this._detail){this._detail=r,(typeof r!="number"||r<1)&&(r=1);let u=Co(r);["position","normal","uv"].forEach(f=>{this.attributes[f]=u.attributes[f].clone()}),this.setIndex(u.getIndex().clone())}}get detail(){return this._detail}set curveRadius(r){r!==this._curveRadius&&(this._curveRadius=r,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(r,u,f,t,e){this.updateAttributeData(Mo,r,4),this.updateAttributeData(kn,u,1),this.updateAttributeData(Ao,e,3),this._blockBounds=f,this._chunkedBounds=t,this.instanceCount=u.length,this._updateBounds()}_updateBounds(){const r=this._blockBounds;if(r){const{curveRadius:u,boundingBox:f}=this;if(u){const{PI:t,floor:e,min:a,max:i,sin:n,cos:o}=Math,s=t/2,c=t*2,d=Math.abs(u),h=r[0]/d,v=r[2]/d,m=e((h+s)/c)!==e((v+s)/c)?-d:a(n(h)*d,n(v)*d),p=e((h-s)/c)!==e((v-s)/c)?d:i(n(h)*d,n(v)*d),C=e((h+t)/c)!==e((v+t)/c)?d*2:i(d-o(h)*d,d-o(v)*d);f.min.set(m,r[1],u<0?-C:0),f.max.set(p,r[3],u<0?0:C)}else f.min.set(r[0],r[1],0),f.max.set(r[2],r[3],0);f.getBoundingSphere(this.boundingSphere)}}applyClipRect(r){let u=this.getAttribute(kn).count,f=this._chunkedBounds;if(f)for(let t=f.length;t--;){u=f[t].end;let e=f[t].rect;if(e[1]<r.w&&e[3]>r.y&&e[0]<r.z&&e[2]>r.x)break}this.instanceCount=u}updateAttributeData(r,u,f){const t=this.getAttribute(r);u?t&&t.array.length===u.length?(t.array.set(u),t.needsUpdate=!0):(this.setAttribute(r,new ha(u,f)),delete this._maxInstanceCount,this.dispose()):t&&this.deleteAttribute(r)}}const Fo=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaEdgeOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,Po=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaEdgeOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaEdgeOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,jo=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaEdgeOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,Lo=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaEdgeOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`;function Go(l){const r=Mr(l,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new At},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new on(0,0,0,0)},uTroikaClipRect:{value:new on(0,0,0,0)},uTroikaEdgeOffset:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new At},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new qt},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new pa},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:Fo,vertexTransform:Po,fragmentDefs:jo,fragmentColorTransform:Lo,customRewriter({vertexShader:u,fragmentShader:f}){let t=/\buniform\s+vec3\s+diffuse\b/;return t.test(f)&&(f=f.replace(t,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),t.test(u)||(u=u.replace(Ln,`uniform vec3 diffuse;
$&
vTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;
`))),{vertexShader:u,fragmentShader:f}}});return r.transparent=!0,r.forceSinglePass=!0,Object.defineProperties(r,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),r}const jr=new ca({color:16777215,side:Ur,transparent:!0}),_n=8421504,Un=new fa,Yt=new Oe,Sr=new Oe,Ut=[],Ro=new Oe,wr="+x+y";function En(l){return Array.isArray(l)?l[0]:l}let Nn=()=>{const l=new Qt(new Dr(1,1),jr);return Nn=()=>l,l},Wn=()=>{const l=new Qt(new Dr(1,1,32,1),jr);return Wn=()=>l,l};const Io={type:"syncstart"},Oo={type:"synccomplete"},zn=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],Bo=zn.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");let Vn=class extends Qt{constructor(){const r=new Do;super(r,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=_n,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=wr,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(r){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(r):(this._isSyncing=!0,this.dispatchEvent(Io),Rn({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},u=>{this._isSyncing=!1,this._textRenderInfo=u,this.geometry.updateGlyphs(u.glyphBounds,u.glyphAtlasIndices,u.blockBounds,u.chunkedBounds,u.glyphColors);const f=this._queuedSyncs;f&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{f.forEach(t=>t&&t())})),this.dispatchEvent(Oo),r&&r()})))}onBeforeRender(r,u,f,t,e,a){this.sync(),e.isTroikaTextMaterial&&this._prepareForRender(e)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}createDerivedMaterial(r){return Go(r)}get material(){let r=this._derivedMaterial;const u=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=jr.clone());if((!r||!r.isDerivedFrom(u))&&(r=this._derivedMaterial=this.createDerivedMaterial(u),u.addEventListener("dispose",function f(){u.removeEventListener("dispose",f),r.dispose()})),this.hasOutline()){let f=r._outlineMtl;return f||(f=r._outlineMtl=Object.create(r,{id:{value:r.id+.1}}),f.isTextOutlineMaterial=!0,f.depthWrite=!1,f.map=null,r.addEventListener("dispose",function t(){r.removeEventListener("dispose",t),f.dispose()})),[f,r]}else return r}set material(r){r&&r.isTroikaTextMaterial?(this._derivedMaterial=r,this._baseMaterial=r.baseMaterial):this._baseMaterial=r}hasOutline(){return!!(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY)}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(r){this.geometry.detail=r}get curveRadius(){return this.geometry.curveRadius}set curveRadius(r){this.geometry.curveRadius=r}get customDepthMaterial(){return En(this.material).getDepthMaterial()}set customDepthMaterial(r){}get customDistanceMaterial(){return En(this.material).getDistanceMaterial()}set customDistanceMaterial(r){}_prepareForRender(r){const u=r.isTextOutlineMaterial,f=r.uniforms,t=this.textRenderInfo;if(t){const{sdfTexture:i,blockBounds:n}=t;f.uTroikaSDFTexture.value=i,f.uTroikaSDFTextureSize.value.set(i.image.width,i.image.height),f.uTroikaSDFGlyphSize.value=t.sdfGlyphSize,f.uTroikaSDFExponent.value=t.sdfExponent,f.uTroikaTotalBounds.value.fromArray(n),f.uTroikaUseGlyphColors.value=!u&&!!t.glyphColors;let o=0,s=0,c=0,d,h,v,m=0,p=0;if(u){let{outlineWidth:k,outlineOffsetX:E,outlineOffsetY:x,outlineBlur:S,outlineOpacity:F}=this;o=this._parsePercent(k)||0,s=Math.max(0,this._parsePercent(S)||0),d=F,m=this._parsePercent(E)||0,p=this._parsePercent(x)||0}else c=Math.max(0,this._parsePercent(this.strokeWidth)||0),c&&(v=this.strokeColor,f.uTroikaStrokeColor.value.set(v??_n),h=this.strokeOpacity,h==null&&(h=1)),d=this.fillOpacity;f.uTroikaEdgeOffset.value=o,f.uTroikaPositionOffset.value.set(m,p),f.uTroikaBlurRadius.value=s,f.uTroikaStrokeWidth.value=c,f.uTroikaStrokeOpacity.value=h,f.uTroikaFillOpacity.value=d??1,f.uTroikaCurveRadius.value=this.curveRadius||0;let C=this.clipRect;if(C&&Array.isArray(C)&&C.length===4)f.uTroikaClipRect.value.fromArray(C);else{const k=(this.fontSize||.1)*100;f.uTroikaClipRect.value.set(n[0]-k,n[1]-k,n[2]+k,n[3]+k)}this.geometry.applyClipRect(f.uTroikaClipRect.value)}f.uTroikaSDFDebug.value=!!this.debugSDF,r.polygonOffset=!!this.depthOffset,r.polygonOffsetFactor=r.polygonOffsetUnits=this.depthOffset||0;const e=u?this.outlineColor||0:this.color;if(e==null)delete r.color;else{const i=r.hasOwnProperty("color")?r.color:r.color=new qt;(e!==i._input||typeof e=="object")&&i.set(i._input=e)}let a=this.orientation||wr;if(a!==r._orientation){let i=f.uTroikaOrient.value;a=a.replace(/[^-+xyz]/g,"");let n=a!==wr&&a.match(/^([-+])([xyz])([-+])([xyz])$/);if(n){let[,o,s,c,d]=n;Yt.set(0,0,0)[s]=o==="-"?1:-1,Sr.set(0,0,0)[d]=c==="-"?-1:1,Un.lookAt(Ro,Yt.cross(Sr),Sr),i.setFromMatrix4(Un)}else i.identity();r._orientation=a}}_parsePercent(r){if(typeof r=="string"){let u=r.match(/^(-?[\d.]+)%$/),f=u?parseFloat(u[1]):NaN;r=(isNaN(f)?0:f/100)*this.fontSize}return r}localPositionToTextCoords(r,u=new At){u.copy(r);const f=this.curveRadius;return f&&(u.x=Math.atan2(r.x,Math.abs(f)-Math.abs(r.z))*Math.abs(f)),u}worldPositionToTextCoords(r,u=new At){return Yt.copy(r),this.localPositionToTextCoords(this.worldToLocal(Yt),u)}raycast(r,u){const{textRenderInfo:f,curveRadius:t}=this;if(f){const e=f.blockBounds,a=t?Wn():Nn(),i=a.geometry,{position:n,uv:o}=i.attributes;for(let s=0;s<o.count;s++){let c=e[0]+o.getX(s)*(e[2]-e[0]);const d=e[1]+o.getY(s)*(e[3]-e[1]);let h=0;t&&(h=t-Math.cos(c/t)*t,c=Math.sin(c/t)*t),n.setXYZ(s,c,d,h)}i.boundingSphere=this.geometry.boundingSphere,i.boundingBox=this.geometry.boundingBox,a.matrixWorld=this.matrixWorld,a.material.side=this.material.side,Ut.length=0,a.raycast(r,Ut);for(let s=0;s<Ut.length;s++)Ut[s].object=this,u.push(Ut[s])}}copy(r){const u=this.geometry;return super.copy(r),this.geometry=u,Bo.forEach(f=>{this[f]=r[f]}),this}clone(){return new this.constructor().copy(this)}};zn.forEach(l=>{const r="_private_"+l;Object.defineProperty(Vn.prototype,l,{get(){return this[r]},set(u){u!==this[r]&&(this[r]=u,this._needsSync=!0)}})});new Dn;new qt;const Lr=de.forwardRef(({sdfGlyphSize:l=64,anchorX:r="center",anchorY:u="middle",font:f,fontSize:t=1,children:e,characters:a,onSync:i,...n},o)=>{const s=Qe(({invalidate:v})=>v),[c]=de.useState(()=>new Vn),[d,h]=de.useMemo(()=>{const v=[];let m="";return de.Children.forEach(e,p=>{typeof p=="string"||typeof p=="number"?m+=p:v.push(p)}),[v,m]},[e]);return ma(()=>new Promise(v=>_o({font:f,characters:a},v)),["troika-text",f,a]),de.useLayoutEffect(()=>void c.sync(()=>{s(),i&&i(c)})),de.useEffect(()=>()=>c.dispose(),[c]),de.createElement("primitive",Dt({object:c,ref:o,font:f,text:h,anchorX:r,anchorY:u,fontSize:t,sdfGlyphSize:l},n),d)}),No=de.forwardRef(({domElement:l,selector:r,onChange:u,onLock:f,onUnlock:t,enabled:e=!0,makeDefault:a,...i},n)=>{const{camera:o,...s}=i,c=Qe(S=>S.setEvents),d=Qe(S=>S.gl),h=Qe(S=>S.camera),v=Qe(S=>S.invalidate),m=Qe(S=>S.events),p=Qe(S=>S.get),C=Qe(S=>S.set),k=o||h,E=l||m.connected||d.domElement,x=de.useMemo(()=>new Va(k),[k]);return de.useEffect(()=>{if(e){x.connect(E);const S=p().events.compute;return c({compute(F,_){const U=_.size.width/2,I=_.size.height/2;_.pointer.set(U/_.size.width*2-1,-(I/_.size.height)*2+1),_.raycaster.setFromCamera(_.pointer,_.camera)}}),()=>{x.disconnect(),c({compute:S})}}},[e,x]),de.useEffect(()=>{const S=U=>{v(),u&&u(U)};x.addEventListener("change",S),f&&x.addEventListener("lock",f),t&&x.addEventListener("unlock",t);const F=()=>x.lock(),_=r?Array.from(document.querySelectorAll(r)):[document];return _.forEach(U=>U&&U.addEventListener("click",F)),()=>{x.removeEventListener("change",S),f&&x.removeEventListener("lock",f),t&&x.removeEventListener("unlock",t),_.forEach(U=>U?U.removeEventListener("click",F):void 0)}},[u,f,t,r,x,v]),de.useEffect(()=>{if(a){const S=p().controls;return C({controls:x}),()=>C({controls:S})}},[a,x]),de.createElement("primitive",Dt({ref:n,object:x},s))}),Hn=de.forwardRef(({children:l,enabled:r=!0,speed:u=1,rotationIntensity:f=1,floatIntensity:t=1,floatingRange:e=[-.1,.1],autoInvalidate:a=!1,...i},n)=>{const o=de.useRef(null);de.useImperativeHandle(n,()=>o.current,[]);const s=de.useRef(Math.random()*1e4);return Fr(c=>{var d,h;if(!r||u===0)return;a&&c.invalidate();const v=s.current+c.clock.elapsedTime;o.current.rotation.x=Math.cos(v/4*u)/8*f,o.current.rotation.y=Math.sin(v/4*u)/8*f,o.current.rotation.z=Math.sin(v/4*u)/20*f;let m=Math.sin(v/4*u)/10;m=ga.mapLinear(m,-.1,.1,(d=e==null?void 0:e[0])!==null&&d!==void 0?d:-.1,(h=e==null?void 0:e[1])!==null&&h!==void 0?h:.1),o.current.position.y=m*t,o.current.updateMatrix()}),de.createElement("group",i,de.createElement("group",{ref:o,matrixAutoUpdate:!1},l))});function Wo(l,r,u=new Oe){const f=Math.PI*(l-.5),t=2*Math.PI*(r-.5);return u.x=Math.cos(t),u.y=Math.sin(f),u.z=Math.sin(t),u}const zo=de.forwardRef(({inclination:l=.6,azimuth:r=.1,distance:u=1e3,mieCoefficient:f=.005,mieDirectionalG:t=.8,rayleigh:e=.5,turbidity:a=10,sunPosition:i=Wo(l,r),...n},o)=>{const s=de.useMemo(()=>new Oe().setScalar(u),[u]),[c]=de.useState(()=>new ja);return de.createElement("primitive",Dt({object:c,ref:o,"material-uniforms-mieCoefficient-value":f,"material-uniforms-mieDirectionalG-value":t,"material-uniforms-rayleigh-value":e,"material-uniforms-sunPosition-value":i,"material-uniforms-turbidity-value":a,scale:s},n))});var Ee=(l=>(l.BUN="BUN",l.SAUSAGE="SAUSAGE",l))(Ee||{});const Ye={BUN:"#FCD34D",SAUSAGE:"#EF4444"},Vo=()=>{const[l]=ya(()=>({rotation:[-Math.PI/2,0,0],position:[0,0,0],material:{friction:.1}}));return g.jsxs("group",{children:[g.jsxs("mesh",{ref:l,receiveShadow:!0,children:[g.jsx("planeGeometry",{args:[100,100]}),g.jsx("meshStandardMaterial",{color:"#202020",roughness:.8})]}),g.jsx("gridHelper",{args:[100,50,6710886,3355443],position:[0,.01,0]})]})},Kt=({position:l,color:r="#8B4513"})=>{const[u]=Pr(()=>({type:"Static",position:[l[0],l[1]+.9,l[2]],args:[4,.2,3]}));return g.jsxs("group",{children:[g.jsxs("mesh",{ref:u,castShadow:!0,receiveShadow:!0,children:[g.jsx("boxGeometry",{args:[4,.2,3]}),g.jsx("meshStandardMaterial",{color:r,roughness:.5})]}),g.jsxs("mesh",{position:[l[0],l[1]+1.01,l[2]],rotation:[-Math.PI/2,0,0],receiveShadow:!0,children:[g.jsx("planeGeometry",{args:[3.8,2.8]}),g.jsx("meshStandardMaterial",{color:"white"})]}),[[-1.8,-1.3],[1.8,-1.3],[-1.8,1.3],[1.8,1.3]].map((f,t)=>g.jsxs("mesh",{position:[l[0]+f[0],.4,l[2]+f[1]],castShadow:!0,children:[g.jsx("boxGeometry",{args:[.2,.9,.2]}),g.jsx("meshStandardMaterial",{color:"#3E2723"})]},t))]})},Tn=({position:l,type:r,isNext:u})=>{const[f]=Pr(()=>({type:"Static",position:[l[0],l[1]+1.6,l[2]],args:[1.8,1.2,1.8]})),t=r===Ee.BUN;return g.jsxs("group",{ref:f,userData:{interactable:!0,type:r,isSpawner:!0},children:[u&&g.jsx(Hn,{speed:4,rotationIntensity:0,floatIntensity:.5,children:g.jsx("group",{position:[0,2.2,0],children:g.jsxs("mesh",{position:[0,0,0],rotation:[Math.PI,0,0],children:[g.jsx("coneGeometry",{args:[.3,.6,4]}),g.jsx("meshStandardMaterial",{color:"#FCD34D",emissive:"#FCD34D",emissiveIntensity:1})]})})}),u&&g.jsx("pointLight",{position:[0,1,0],intensity:1.5,distance:4,color:Ye[r],decay:2}),g.jsxs("mesh",{castShadow:!0,children:[g.jsx("boxGeometry",{args:[1.8,1.2,1.8]}),g.jsx("meshStandardMaterial",{color:"#795548"})]}),g.jsxs("mesh",{position:[0,.61,0],rotation:[-Math.PI/2,0,0],children:[g.jsx("planeGeometry",{args:[1.6,1.6]}),g.jsx("meshStandardMaterial",{color:"#3E2723"})]}),g.jsx("group",{position:[0,.9,0],children:t?g.jsxs("mesh",{rotation:[0,0,0],children:[g.jsx("boxGeometry",{args:[.8,.4,.5]}),g.jsx("meshStandardMaterial",{color:Ye[r],emissive:u?Ye[r]:"black",emissiveIntensity:u?.3:0})]}):g.jsxs("mesh",{rotation:[Math.PI/2,0,Math.PI/4],children:[g.jsx("capsuleGeometry",{args:[.15,.8,8,16]}),g.jsx("meshStandardMaterial",{color:Ye[r],emissive:u?Ye[r]:"black",emissiveIntensity:u?.3:0})]})}),g.jsxs("mesh",{position:[0,.5,1],children:[g.jsx("boxGeometry",{args:[2.5,3.5,2.5]}),g.jsx("meshBasicMaterial",{visible:!1})]}),g.jsx(Lr,{position:[0,1.5,1],fontSize:.4,color:"white",anchorX:"center",anchorY:"bottom",outlineWidth:.04,outlineColor:"#000",children:r})]})},Ho=({position:l,plateState:r,nextNeededIngredient:u,heldItem:f})=>{const t=l[1]+1,e=f&&f===u;return g.jsxs("group",{children:[e&&g.jsxs("group",{position:[l[0],t+1.5,l[2]],children:[g.jsx(Hn,{speed:5,floatIntensity:.2,children:g.jsxs("mesh",{position:[0,0,0],rotation:[Math.PI,0,0],children:[g.jsx("coneGeometry",{args:[.4,.8,4]}),g.jsx("meshStandardMaterial",{color:"#4ADE80",emissive:"#4ADE80",emissiveIntensity:1})]})}),g.jsxs("mesh",{position:[0,-.75,0],children:[g.jsx("cylinderGeometry",{args:[1.4,1.4,1.5,32,1,!0]}),g.jsx("meshBasicMaterial",{color:"#4ADE80",transparent:!0,opacity:.15,side:Ur,depthWrite:!1})]})]}),g.jsxs("mesh",{position:[l[0],t+.05,l[2]],receiveShadow:!0,children:[g.jsx("cylinderGeometry",{args:[1.4,1,.1,32]}),g.jsx("meshStandardMaterial",{color:"#FFFFFF",roughness:.1})]}),g.jsxs("mesh",{position:[l[0],t+.08,l[2]],rotation:[-Math.PI/2,0,0],receiveShadow:!0,children:[g.jsx("ringGeometry",{args:[1.3,1.4,32]}),g.jsx("meshStandardMaterial",{color:"#EEE",side:Ur})]}),r.hasBun&&g.jsxs("group",{position:[l[0],t+.3,l[2]],rotation:[0,Math.PI/2,0],children:[g.jsxs("mesh",{castShadow:!0,children:[g.jsx("boxGeometry",{args:[.8,.35,2]}),g.jsx("meshStandardMaterial",{color:Ye[Ee.BUN]})]}),g.jsxs("mesh",{position:[0,.18,0],children:[g.jsx("boxGeometry",{args:[.4,.1,2]}),g.jsx("meshStandardMaterial",{color:"#C9A473"})]})]}),r.hasSausage&&g.jsxs("mesh",{position:[l[0],t+.5,l[2]],rotation:[Math.PI/2,0,Math.PI/2],castShadow:!0,children:[g.jsx("capsuleGeometry",{args:[.18,2.1,8,16]}),g.jsx("meshStandardMaterial",{color:Ye[Ee.SAUSAGE]})]})]})},Xo=({position:l,index:r})=>{const f=r*123.45%.5-.25;return g.jsxs("group",{position:[l[0],l[1],l[2]],rotation:[0,Math.PI/2+f,0],children:[g.jsxs("mesh",{castShadow:!0,children:[g.jsx("boxGeometry",{args:[.8,.35,2]}),g.jsx("meshStandardMaterial",{color:Ye[Ee.BUN]})]}),g.jsxs("mesh",{position:[0,.18,0],children:[g.jsx("boxGeometry",{args:[.4,.1,2]}),g.jsx("meshStandardMaterial",{color:"#C9A473"})]}),g.jsxs("mesh",{position:[0,.2,0],rotation:[Math.PI/2,0,0],castShadow:!0,children:[g.jsx("capsuleGeometry",{args:[.18,2.1,8,16]}),g.jsx("meshStandardMaterial",{color:Ye[Ee.SAUSAGE]})]})]})},Yo=({position:l,completedCount:r})=>{const u=l[1]+1;return g.jsxs("group",{children:[g.jsxs("mesh",{position:[l[0],u,l[2]],receiveShadow:!0,castShadow:!0,children:[g.jsx("boxGeometry",{args:[3.5,.1,5]}),g.jsx("meshStandardMaterial",{color:"#8D6E63",roughness:.9})]}),g.jsx(Lr,{position:[l[0],u+.1,l[2]+2],fontSize:.3,color:"white",rotation:[-Math.PI/2,0,0],anchorX:"center",anchorY:"middle",children:"FINISHED ORDERS"}),Array.from({length:r}).map((f,t)=>{const e=t%2,a=Math.floor(t/2),i=e===0?-.8:.8,n=-1.5+a*1.2;return g.jsx(Xo,{index:t,position:[l[0]+i,u+.2,l[2]+n]},t)})]})},Ko=({plateState:l,nextNeededIngredient:r,heldItem:u,completedCount:f})=>g.jsxs(g.Fragment,{children:[g.jsx(Vo,{}),g.jsx(Kt,{position:[-5,0,-4],color:"#5D4037"}),g.jsx(Tn,{position:[-5,0,-4],type:Ee.BUN,isNext:r===Ee.BUN&&u!==Ee.BUN}),g.jsx(Kt,{position:[5,0,-4],color:"#5D4037"}),g.jsx(Tn,{position:[5,0,-4],type:Ee.SAUSAGE,isNext:r===Ee.SAUSAGE&&u!==Ee.SAUSAGE}),g.jsx(Kt,{position:[0,0,-10],color:"#37474F"}),g.jsx(Ho,{position:[0,0,-10],plateState:l,nextNeededIngredient:r,heldItem:u}),g.jsx(Kt,{position:[4,0,-10],color:"#5D4037"}),g.jsx(Yo,{position:[4,0,-10],completedCount:f}),g.jsx(Lr,{position:[0,5,-15],fontSize:1.5,color:"white",anchorX:"center",anchorY:"middle",font:"https://fonts.gstatic.com/s/raleway/v14/1Ptrg8zYS_SKggPNwK4vaqI.woff",children:"HOT DOG HERO"})]}),Jo=6,Zo=6,kr=18,Qo=20;function Cn(l){let r=l;for(;r;){if(r.userData&&r.userData.interactable)return{type:r.userData.type,id:r.userData.id,isSpawner:r.userData.isSpawner};r=r.parent}return null}const qo=({heldItem:l,pickUpItem:r,throwItem:u,setHovering:f,setIsLocked:t})=>{const{camera:e,raycaster:a,scene:i}=Qe(),n=de.useRef(null),[o,s]=xa(()=>({mass:60,type:"Dynamic",position:[0,2,10],args:[.6],fixedRotation:!0,linearDamping:.95,material:{friction:0,restitution:0}})),c=de.useRef([0,0,0]);de.useEffect(()=>s.velocity.subscribe(v=>c.current=v),[s.velocity]);const d=de.useRef([0,0,0]);de.useEffect(()=>s.position.subscribe(v=>d.current=v),[s.position]);const[,h]=Aa();return Fr(v=>{if(!o.current)return;e.position.copy(new Oe(d.current[0],d.current[1]+1.7,d.current[2]));const{forward:m,backward:p,left:C,right:k,jump:E}=h(),x=new Oe;e.getWorldDirection(x),x.y=0,x.normalize();const S=new Oe(-x.z,0,x.x),F=new Oe;if(m&&F.add(x),p&&F.sub(x),k&&F.add(S),C&&F.sub(S),F.normalize().multiplyScalar(Jo),s.velocity.set(F.x,c.current[1],F.z),E&&Math.abs(c.current[1])<.1&&s.velocity.set(c.current[0],Zo,c.current[2]),l)n.current=null,f(!1);else{const U=document.pointerLockElement!==null?new At(0,0):v.pointer;a.setFromCamera(U,e);const L=a.intersectObjects(i.children,!0).find(Y=>Y.distance>Qo?!1:Cn(Y.object)!==null);if(L){const Y=Cn(L.object);n.current=Y,f(!0)}else n.current=null,f(!1)}}),de.useEffect(()=>{const v=m=>{if(m.button===0)if(l){const p=new Oe;e.getWorldDirection(p);const C=e.position.clone().add(p.clone().multiplyScalar(1.2)),k=[p.x*kr,p.y*kr+4,p.z*kr];u([C.x,C.y,C.z],k)}else n.current&&r(n.current.type,n.current.id)};return window.addEventListener("mousedown",v),()=>window.removeEventListener("mousedown",v)},[l,e,r,u]),g.jsxs(g.Fragment,{children:[g.jsx(No,{onLock:()=>t(!0),onUnlock:()=>t(!1)}),g.jsx("mesh",{ref:o})]})},$o=({id:l,type:r,initialPosition:u,initialVelocity:f,onRemove:t,onLandOnPlate:e})=>{const[a,i]=de.useState(!1),n=de.useRef(0),o=r===Ee.BUN,[s,c]=o?Pr(()=>({mass:1,position:u,velocity:f,args:[.7,.3,.4],rotation:[Math.random(),Math.random(),Math.random()]})):ba(()=>({mass:.8,position:u,velocity:f,args:[.1,.1,.6,8],rotation:[Math.PI/2,0,0],angularDamping:.1}));return de.useEffect(()=>{const d=setTimeout(()=>{i(!0),t(l)},15e3);return()=>clearTimeout(d)},[l,t]),Fr((d,h)=>{if(!s.current||a)return;n.current>0&&(n.current-=h);const v=s.current.position;if(v.y<-10){i(!0),t(l);return}const m=new Oe(0,1,-10);if(v.distanceTo(m)<2&&n.current<=0)if(e(r))i(!0),t(l);else{const k=Math.random()*Math.PI*2,E=10;c.velocity.set(Math.sin(k)*E,10,Math.cos(k)*E),c.angularVelocity.set(Math.random()*10,Math.random()*10,Math.random()*10),n.current=1}}),g.jsx("group",{ref:s,userData:{interactable:!0,type:r,id:l},children:o?g.jsxs("mesh",{castShadow:!0,receiveShadow:!0,children:[g.jsx("boxGeometry",{args:[.7,.3,.4]}),g.jsx("meshStandardMaterial",{color:Ye[r],roughness:.8}),g.jsxs("mesh",{position:[0,.1,0],scale:[.9,.1,.8],children:[g.jsx("boxGeometry",{args:[.7,.1,.1]}),g.jsx("meshStandardMaterial",{color:"#D4B483"})]})]}):g.jsxs("mesh",{castShadow:!0,receiveShadow:!0,rotation:[Math.PI/2,0,0],children:[g.jsx("capsuleGeometry",{args:[.1,.6,8,16]}),g.jsx("meshStandardMaterial",{color:Ye[r],roughness:.3,metalness:.1})]})})},ei=({gameState:l,pickUpItem:r,throwItem:u,removeIngredient:f,handleLandOnPlate:t,setHovering:e,setIsLocked:a,nextNeededIngredient:i})=>g.jsxs(g.Fragment,{children:[g.jsx(qo,{heldItem:l.heldItem,pickUpItem:r,throwItem:u,setHovering:e,setIsLocked:a}),g.jsx(Ko,{plateState:l.plate,nextNeededIngredient:i,heldItem:l.heldItem,completedCount:l.completedCount}),l.activeIngredients.map(n=>g.jsx($o,{id:n.id,type:n.type,initialPosition:n.position,initialVelocity:n.velocity,onRemove:f,onLandOnPlate:t},n.id))]});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var ti={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ri=l=>l.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),Ft=(l,r)=>{const u=de.forwardRef(({color:f="currentColor",size:t=24,strokeWidth:e=2,absoluteStrokeWidth:a,className:i="",children:n,...o},s)=>de.createElement("svg",{ref:s,...ti,width:t,height:t,stroke:f,strokeWidth:a?Number(e)*24/Number(t):e,className:["lucide",`lucide-${ri(l)}`,i].join(" "),...o},[...r.map(([c,d])=>de.createElement(c,d)),...Array.isArray(n)?n:[n]]));return u.displayName=`${l}`,u};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mn=Ft("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ni=Ft("MousePointer2",[["path",{d:"m4 4 7.07 17 2.51-7.39L21 11.07z",key:"1vqm48"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ai=Ft("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oi=Ft("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ii=Ft("Utensils",[["path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2",key:"cjf0a3"}],["path",{d:"M7 2v20",key:"1473qp"}],["path",{d:"M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7",key:"1ogz0v"}]]),_r=5;function si(){const[l,r]=de.useState({score:0,heldItem:null,activeIngredients:[],plate:{hasBun:!1,hasSausage:!1},lastMessage:"Welcome! Make 5 Hot Dogs!",completedCount:0,gameWon:!1}),[u,f]=de.useState(!1),[t,e]=de.useState(!1),a=l.plate.hasBun?l.plate.hasSausage?null:Ee.SAUSAGE:Ee.BUN,i=l.gameWon?"You are the Hot Dog Hero!":a?l.heldItem===a?"Throw it on the plate!":`Go pick up a ${a}`:"Hot Dog Complete!",n=()=>{r({score:0,heldItem:null,activeIngredients:[],plate:{hasBun:!1,hasSausage:!1},lastMessage:"New Shift Started!",completedCount:0,gameWon:!1});const v=document.querySelector("canvas");v==null||v.requestPointerLock()},o=de.useCallback((v,m)=>{r(p=>{if(p.gameWon)return p;const C=m?p.activeIngredients.filter(k=>k.id!==m):p.activeIngredients;return{...p,heldItem:v,activeIngredients:C,lastMessage:`Picked up ${v}`}})},[]),s=de.useCallback((v,m)=>{r(p=>{if(!p.heldItem||p.gameWon)return p;const C={id:Math.random().toString(36).substr(2,9),type:p.heldItem,position:v,velocity:m};return{...p,heldItem:null,activeIngredients:[...p.activeIngredients,C],lastMessage:"Yeet!"}})},[]),c=de.useCallback(v=>{r(m=>({...m,activeIngredients:m.activeIngredients.filter(p=>p.id!==v)}))},[]),d=de.useCallback(v=>{let m=!1;return r(p=>{if(p.gameWon)return p;const{hasBun:C,hasSausage:k}=p.plate;if(v===Ee.BUN&&C)return{...p,lastMessage:"Already have a Bun! Get the Sausage!"};if(v===Ee.SAUSAGE&&!C)return{...p,lastMessage:"Need a Bun first!"};if(v===Ee.BUN&&!C)return m=!0,{...p,plate:{...p.plate,hasBun:!0},lastMessage:"Bun Plated! Now get the Sausage!"};if(v===Ee.SAUSAGE&&!k&&C){m=!0;const E=p.completedCount+1,x=E>=_r;return{...p,score:p.score+100+(x?500:0),plate:{hasBun:!1,hasSausage:!1},completedCount:E,gameWon:x,lastMessage:x?"MISSION COMPLETE!":`Hot Dog #${E} Done!`}}return p}),m},[]),h=[{name:"forward",keys:["ArrowUp","w","W"]},{name:"backward",keys:["ArrowDown","s","S"]},{name:"left",keys:["ArrowLeft","a","A"]},{name:"right",keys:["ArrowRight","d","D"]},{name:"jump",keys:["Space"]},{name:"interact",keys:["e","E"]}];return g.jsxs("div",{className:"relative w-full h-full bg-gray-900 select-none font-sans",children:[l.gameWon&&g.jsx("div",{className:"absolute inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm",children:g.jsxs("div",{className:"bg-gray-800 border-2 border-yellow-400 p-10 rounded-3xl text-center shadow-2xl max-w-md transform animate-in fade-in zoom-in duration-300",children:[g.jsx(oi,{className:"w-24 h-24 text-yellow-400 mx-auto mb-6 animate-bounce"}),g.jsx("h2",{className:"text-5xl font-black text-white mb-2 uppercase italic transform -skew-x-12",children:"Victory!"}),g.jsxs("p",{className:"text-gray-300 mb-8 text-lg",children:["You served ",_r," delicious hot dogs."]}),g.jsxs("div",{className:"bg-black/50 rounded-xl p-4 mb-8",children:[g.jsx("p",{className:"text-sm text-gray-400 uppercase font-bold tracking-widest",children:"Final Score"}),g.jsx("p",{className:"text-4xl font-mono font-bold text-green-400",children:l.score})]}),g.jsxs("button",{onClick:v=>{v.stopPropagation(),n()},className:"bg-yellow-400 hover:bg-yellow-300 text-black font-bold py-4 px-8 rounded-xl text-xl flex items-center justify-center gap-3 w-full transition-transform hover:scale-105 active:scale-95",children:[g.jsx(ai,{className:"w-6 h-6"}),"Cook Again"]})]})}),g.jsxs("div",{className:"absolute inset-0 pointer-events-none z-10 flex flex-col justify-between p-6",children:[g.jsxs("div",{className:"flex justify-between items-start",children:[g.jsxs("div",{className:"bg-black/70 backdrop-blur-md p-4 rounded-2xl border border-white/10 text-white shadow-2xl flex flex-col gap-1 min-w-[200px]",children:[g.jsxs("h1",{className:"text-xl font-bold text-yellow-400 flex items-center gap-2 uppercase tracking-wider",children:[g.jsx(ii,{className:"w-5 h-5"})," Hot Dog Hero"]}),g.jsxs("div",{className:"flex items-baseline gap-2",children:[g.jsx("span",{className:"text-xs text-gray-400 uppercase font-bold",children:"Score"}),g.jsx("span",{className:"text-4xl font-mono font-bold text-white",children:l.score})]}),g.jsxs("div",{className:"mt-2 bg-white/10 rounded-lg p-2 flex justify-between items-center",children:[g.jsx("span",{className:"text-xs font-bold text-gray-300",children:"PROGRESS"}),g.jsxs("span",{className:"text-lg font-bold font-mono text-yellow-400",children:[l.completedCount," / ",_r]})]})]}),!l.gameWon&&g.jsxs("div",{className:"bg-black/70 backdrop-blur-md p-4 rounded-2xl border border-white/10 text-white shadow-2xl min-w-[280px]",children:[g.jsxs("div",{className:"flex justify-between items-center mb-3 border-b border-white/10 pb-2",children:[g.jsx("h2",{className:"text-sm uppercase tracking-wider text-gray-300 font-bold",children:"Current Order"}),g.jsxs("span",{className:"text-xs text-yellow-400 font-mono",children:["#",l.completedCount+1]})]}),g.jsxs("div",{className:"space-y-3",children:[g.jsxs("div",{className:`flex items-center justify-between p-2 rounded-lg transition-colors ${l.plate.hasBun?"bg-green-500/20 border border-green-500/30":a===Ee.BUN?"bg-yellow-500/10 border border-yellow-500/50 animate-pulse":"opacity-50"}`,children:[g.jsxs("div",{className:"flex items-center gap-3",children:[g.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center ${l.plate.hasBun?"bg-green-500":"border-2 border-gray-500"}`,children:l.plate.hasBun?g.jsx(Mn,{className:"w-4 h-4 text-white"}):g.jsx("span",{className:"text-xs font-bold",children:"1"})}),g.jsx("span",{className:"font-bold",children:"Bun"})]}),l.heldItem===Ee.BUN&&!l.plate.hasBun&&g.jsx("span",{className:"text-xs text-yellow-300 bg-yellow-900/50 px-2 py-1 rounded",children:"HOLDING"})]}),g.jsxs("div",{className:`flex items-center justify-between p-2 rounded-lg transition-colors ${l.plate.hasSausage?"bg-green-500/20 border border-green-500/30":a===Ee.SAUSAGE?"bg-yellow-500/10 border border-yellow-500/50 animate-pulse":"opacity-50"}`,children:[g.jsxs("div",{className:"flex items-center gap-3",children:[g.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center ${l.plate.hasSausage?"bg-green-500":"border-2 border-gray-500"}`,children:l.plate.hasSausage?g.jsx(Mn,{className:"w-4 h-4 text-white"}):g.jsx("span",{className:"text-xs font-bold",children:"2"})}),g.jsx("span",{className:"font-bold",children:"Sausage"})]}),l.heldItem===Ee.SAUSAGE&&!l.plate.hasSausage&&g.jsx("span",{className:"text-xs text-yellow-300 bg-yellow-900/50 px-2 py-1 rounded",children:"HOLDING"})]})]}),g.jsx("div",{className:"mt-3 text-center bg-white/5 rounded p-2",children:g.jsx("p",{className:"text-sm font-bold text-blue-300",children:i})})]})]}),g.jsx("div",{className:"absolute top-1/4 left-1/2 -translate-x-1/2 pointer-events-none text-center w-full px-10",children:g.jsx("h2",{className:"text-3xl font-black text-white drop-shadow-[0_4px_0_rgba(0,0,0,1)] stroke-black animate-bounce",children:l.lastMessage},l.lastMessage)}),g.jsxs("div",{className:"flex justify-between items-end",children:[g.jsxs("div",{className:"bg-black/70 backdrop-blur-md p-4 rounded-2xl border border-white/10 text-white shadow-xl flex items-center gap-5",children:[g.jsxs("div",{className:`w-20 h-20 rounded-xl border-2 flex items-center justify-center transition-all ${l.heldItem?"border-yellow-400 bg-yellow-400/10 shadow-[0_0_15px_rgba(250,204,21,0.3)]":"border-gray-600 bg-gray-800/50"}`,children:[l.heldItem===Ee.BUN&&g.jsx("div",{className:"w-14 h-8 bg-yellow-300 rounded-full shadow-lg border border-yellow-600"}),l.heldItem===Ee.SAUSAGE&&g.jsx("div",{className:"w-14 h-4 bg-red-500 rounded-full shadow-lg rotate-45 border border-red-700"}),!l.heldItem&&g.jsx("div",{className:"text-gray-500 text-xs font-bold",children:"EMPTY"})]}),g.jsxs("div",{children:[g.jsx("p",{className:"text-xs text-gray-400 uppercase font-bold tracking-widest mb-1",children:"Hands"}),g.jsx("p",{className:"text-xl font-bold leading-none tracking-tight",children:l.heldItem||"Empty"}),g.jsx("p",{className:"text-[10px] text-gray-500 mt-1",children:l.heldItem?"Click to Throw":"Click Item to Pickup"})]})]}),g.jsx("div",{className:"bg-black/70 backdrop-blur-md p-4 rounded-2xl border border-white/10 text-white text-sm shadow-xl",children:g.jsxs("div",{className:"flex flex-col gap-2",children:[g.jsxs("div",{className:"flex items-center gap-3",children:[g.jsx(ni,{className:`w-4 h-4 ${t?"text-green-400":"text-red-400"}`}),g.jsx("span",{className:"font-medium",children:t?"GAME ACTIVE":"CLICK TO START"})]}),g.jsx("div",{className:"h-px bg-white/10 my-1"}),g.jsxs("div",{className:"opacity-60 text-xs space-y-1 font-mono",children:[g.jsx("p",{children:"[W,A,S,D] Move"}),g.jsx("p",{children:"[Space] Jump"}),g.jsx("p",{children:"[Left Click] Grab / Throw"})]})]})})]})]}),t&&g.jsxs(g.Fragment,{children:[g.jsx("div",{className:`absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-50 pointer-events-none transition-all duration-200 ease-out
              ${u?"w-8 h-8 border-2 border-yellow-400 scale-125 bg-yellow-400/20":"w-2 h-2 bg-white/90 shadow-[0_0_4px_black]"}
              rounded-full flex items-center justify-center
            `,children:u&&g.jsx("div",{className:"w-1 h-1 bg-yellow-400 rounded-full"})}),u&&g.jsx("div",{className:"absolute top-[53%] left-1/2 -translate-x-1/2 text-yellow-400 font-black text-[10px] tracking-[0.2em] drop-shadow-md z-50 pointer-events-none",children:"GRAB"})]}),g.jsx(Ma,{map:h,children:g.jsxs(Sa,{shadows:!0,camera:{fov:80},dpr:[1,2],children:[g.jsx(zo,{sunPosition:[100,20,100],turbidity:.8,rayleigh:.3,mieCoefficient:.005,mieDirectionalG:.8}),g.jsx("ambientLight",{intensity:.7}),g.jsx("directionalLight",{position:[20,30,10],castShadow:!0,intensity:1.5,"shadow-mapSize":[2048,2048],"shadow-camera-left":-20,"shadow-camera-right":20,"shadow-camera-top":20,"shadow-camera-bottom":-20}),g.jsx(wa,{gravity:[0,-25,0],children:g.jsx(ei,{gameState:l,pickUpItem:o,throwItem:s,removeIngredient:c,handleLandOnPlate:d,setHovering:f,setIsLocked:e,nextNeededIngredient:a})})]})})]})}const Xn=document.getElementById("root");if(!Xn)throw new Error("Could not find root element to mount to");const li=Er.createRoot(Xn);li.render(g.jsx(Et.StrictMode,{children:g.jsx(si,{})}));
